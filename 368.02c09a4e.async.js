"use strict";(self.webpackChunkpangcg_components=self.webpackChunkpangcg_components||[]).push([[368],{53002:function(pn,ht,N){N.r(ht),N.d(ht,{ErrorBoundaryContext:function(){return nt}});var Rt=N(67294),nt=(0,Rt.createContext)(null)},51447:function(pn,ht,N){N.r(ht),N.d(ht,{default:function(){return Kt},useErrorBoundary:function(){return Gt}});var Rt=N(12444),nt=N.n(Rt),nn=N(72004),S=N.n(nn),rn=N(25098),Et=N.n(rn),Tt=N(31996),Ye=N.n(Tt),vt=N(26037),Wt=N.n(vt),at=N(67294),Yt=N(53002),Ve={didCatch:!1,error:null};function Vt(){var it=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ot=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return it.length!==ot.length||it.some(function(ye,v){return!Object.is(ye,ot[v])})}var Kt=function(it){Ye()(ye,it);var ot=Wt()(ye);function ye(v){var Ne;return nt()(this,ye),Ne=ot.call(this,v),Ne.resetErrorBoundary=Ne.resetErrorBoundary.bind(Et()(Ne)),Ne.state=Ve,Ne}return S()(ye,[{key:"resetErrorBoundary",value:function(){var Ne=this.state.error;if(Ne!==null){for(var xe,Ke,Ge=arguments.length,e=new Array(Ge),_e=0;_e<Ge;_e++)e[_e]=arguments[_e];(xe=(Ke=this.props).onReset)===null||xe===void 0||xe.call(Ke,{args:e,reason:"imperative-api"}),this.setState(Ve)}}},{key:"componentDidCatch",value:function(Ne,xe){var Ke,Ge;(Ke=this.props)===null||Ke===void 0||(Ge=Ke.onError)===null||Ge===void 0||Ge.call(Ke,Ne,xe)}},{key:"componentDidUpdate",value:function(Ne,xe){var Ke=this.state.didCatch,Ge=this.props.resetKeys;if(Ke&&xe.error!==null&&Vt(Ne.resetKeys,Ge)){var e,_e;(e=(_e=this.props).onReset)===null||e===void 0||e.call(_e,{next:Ge,prev:Ne.resetKeys,reason:"keys"}),this.setState(Ve)}}},{key:"render",value:function(){var Ne=this.props,xe=Ne.children,Ke=Ne.fallbackRender,Ge=Ne.FallbackComponent,e=Ne.fallback,_e=this.state,Jt=_e.didCatch,Ut=_e.error,Nt=xe;if(Jt){var Xt={error:Ut,resetErrorBoundary:this.resetErrorBoundary};if(typeof Ke=="function")Nt=Ke(Xt);else if(Ge)Nt=(0,at.createElement)(Ge,Xt);else if(e!==void 0)Nt=e;else throw console.error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop"),Ut}return(0,at.createElement)(Yt.ErrorBoundaryContext.Provider,{value:{didCatch:Jt,error:Ut,resetErrorBoundary:this.resetErrorBoundary}},Nt)}}],[{key:"getDerivedStateFromError",value:function(Ne){return{didCatch:!0,error:Ne}}}]),ye}(at.Component);function Gt(){var it=at.useContext(Yt.ErrorBoundaryContext);if(it===null)throw new Error("useErrorBoundary must be used within an ErrorBoundary");return it}},28063:function(pn,ht,N){N.r(ht),N.d(ht,{DragSortSingleTable:function(){return lr},DragSortTreeTable:function(){return fr},EMAIL_PATTERN:function(){return kn},EMAIL_PATTERN_S:function(){return Pn},EditFormTable:function(){return Nt},EditFormTreeTable:function(){return _n},ErrorBoundary:function(){return jn.default},ID_CARD_PATTERN:function(){return wn},PHONE_NUMBER_PATTERN:function(){return An},PdfAnnotationExtension:function(){return ea},PdfAnnotationScroll:function(){return ja},PdfPreview:function(){return yr},URL_PATTERN:function(){return Pr},generateUUID:function(){return et},isEmail:function(){return Cr},isEmails:function(){return Er},isEmpty:function(){return Dr},isIDCard:function(){return kr},isNumeric:function(){return wr},isPhoneNumber:function(){return Ar},isURL:function(){return Fr},useEditFormTable:function(){return Ge},useEditFormTreeTable:function(){return Xn},useErrorBoundary:function(){return jn.useErrorBoundary}});var Rt=N(9783),nt=N.n(Rt),nn=N(97857),S=N.n(nn),rn=N(13769),Et=N.n(rn),Tt=N(58610),Ye=N(40741),vt=N(55102),Wt=N(34041),at=N(13457),Yt=N(84567),Ve=N(55742),Vt=N(72269),Kt=N(68351),Gt=N(59847),it=N(3303),ot=N(98644),ye=N(83622),v=N(67294),Ne=N(19632),xe=N.n(Ne),Ke=function(n){var t=n,c=function(x,U){var u=(t==null?void 0:t.getFieldValue(x))||[];u.push(S()({},U)),t.setFieldValue(x,u)},l=function(x,U){var u=(t==null?void 0:t.getFieldValue(x))||[],$=u==null?void 0:u.filter(function(P,w){return w!==U});t.setFieldValue(x,xe()($))},h=function(x,U,u){t.setFieldValue([x,U],S()({},u))},s=function(x,U,u,$){t.setFieldValue([x,U,u],$)},F=function(x,U,u){var $=(t==null?void 0:t.getFieldValue(x))||[];$[U]=S()({},u),t.setFieldValue(x,xe()($))};return{addRecord:c,deleteRecord:l,updateRecord:h,updateRecordField:s,updateRecordWithSource:F}},Ge=Ke,e=N(85893),_e=["formListProps","recordCreatorProps","columns","rowKey"],Jt=Tt.default.RangePicker,Ut=function(n){var t=n.formListProps,c=n.recordCreatorProps,l=c===void 0?{creatorButtonShow:!1}:c,h=n.columns,s=n.rowKey,F=s===void 0?"id":s,T=Et()(n,_e),x=Ye.Z.useFormInstance(),U=function(w,r){switch(w){case"input":return(0,e.jsx)(vt.Z,S()({},r));case"select":return(0,e.jsx)(Wt.default,S()({},r));case"datePicker":return(0,e.jsx)(Tt.default,S()({},r));case"rangePicker":return(0,e.jsx)(Jt,S()({},r));case"inputNumber":return(0,e.jsx)(at.Z,S()({},r));case"checkbox":return(0,e.jsx)(Yt.Z,S()({},r));case"radio":return(0,e.jsx)(Ve.ZP,S()({},r));case"switch":return(0,e.jsx)(Vt.Z,S()({},r));case"timePicker":return(0,e.jsx)(Kt.Z,S()({},r));case"treeSelect":return(0,e.jsx)(Gt.Z,S()({},r));case"cascader":return(0,e.jsx)(it.Z,S()({},r));default:return null}},u=(0,v.useCallback)(function(){return h.map(function(P){var w=P.dataIndex,r=P.componentType,g=r===void 0?"text":r,i=P.componentProps,b=P.formItemProps,H=P.renderFormItem,C=H===void 0?void 0:H;return S()(S()({},P),{},{render:function(L,R,J){if("fieldKey"in R&&delete R.fieldKey,"isListField"in R&&delete R.isListField,(P==null?void 0:P.customRender)instanceof Function)return P.customRender({text:L,record:R,index:J},x);if((P==null?void 0:P.render)instanceof Function)return P.render(L,R,J);if(g!=="text"||C instanceof Function){var G=(b==null?void 0:b.valuePropName)||function(){switch(g){case"switch":case"checkbox":return"checked";default:return"value"}}();return(0,e.jsx)(Ye.Z.Item,S()(S()({},b),{},{valuePropName:G,name:[J,w],style:{marginBottom:0},children:C&&C instanceof Function?C():U(g,i)}))}else if(g==="text")return L}})})},[t.name,h,x]),$=(0,v.useCallback)(function(P){return P==null?void 0:P.map(function(w,r){var g=x.getFieldValue([t.name,r]);return S()(S()({},g),{},{fieldKey:r,isListField:!0})})},[x,t.name]);return(0,e.jsx)(Ye.Z.List,S()(S()({},t||{}),{},{children:function(w,r){var g=r.add;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.Z,S()(S()({},T||{}),{},{columns:u(),dataSource:$(w),rowKey:function(b){return b==null?void 0:b[F]},pagination:!1})),l!=null&&l.creatorButtonShow?(0,e.jsx)("div",{style:{marginTop:24},children:(0,e.jsx)(ye.ZP,S()(S()({},(l==null?void 0:l.buttonProps)||{type:"dashed",block:!0}),{},{onClick:function(){var b,H=l!=null&&l.record?l==null?void 0:l.record():{};g(S()(S()({},H),{},nt()({},"".concat(F),(H==null||(b=H[F])===null||b===void 0?void 0:b.toString())||"add-".concat(et()))))},children:(l==null?void 0:l.creatorButtonText)||"\u65B0\u589E\u4E00\u884C"}))}):null]})}}))},Nt=Ut,Xt=N(96486),Jn=function(n){var t=n,c=function(T,x){var U=(t==null?void 0:t.getFieldValue(T))||[];U.push(S()(S()({},x||{}),{},{_key:"add-"+et()})),t.setFieldValue(T,U)},l=function(T,x,U){var u=(t==null?void 0:t.getFieldValue(T))||[],$=function w(r){return r.map(function(g){var i,b;return(x==null?void 0:x.toString())===(g==null||(i=g._key)===null||i===void 0?void 0:i.toString())?S()(S()({},g),{},{children:[].concat(xe()((g==null?void 0:g.children)||[]),[S()(S()({},U||{}),{},{_key:et()})])}):Array.isArray(g==null?void 0:g.children)&&g!==null&&g!==void 0&&(b=g.children)!==null&&b!==void 0&&b.length?S()(S()({},g),{},{children:w(g.children)}):g})},P=$(u);t.setFieldValue(T,P)},h=function(T,x){var U=(t==null?void 0:t.getFieldValue(T))||[],u=function P(w){return w.filter(function(r){var g,i;return((g=r._key)===null||g===void 0?void 0:g.toString())===(x==null?void 0:x.toString())?!1:(Array.isArray(r==null?void 0:r.children)&&r!==null&&r!==void 0&&(i=r.children)!==null&&i!==void 0&&i.length&&(r.children=P(r.children)),!0)})},$=u(U);t.setFieldValue(T,$)},s=function(T,x,U){var u=(t==null?void 0:t.getFieldValue(T))||[],$=function w(r){return r.map(function(g){var i,b;if((x==null?void 0:x.toString())===(g==null||(i=g._key)===null||i===void 0?void 0:i.toString())){var H;return S()(S()({},g),S()(S()({},U),{},{_key:(g==null||(H=g._key)===null||H===void 0?void 0:H.toString())||et()}))}return Array.isArray(g==null?void 0:g.children)&&g!==null&&g!==void 0&&(b=g.children)!==null&&b!==void 0&&b.length&&(g.children=w(g.children)),g})},P=$(u);t.setFieldValue(T,P)};return{addRootRecord:c,addChildRecord:l,deleteRecord:h,updateRecord:s}},Xn=Jn,Qn=["formListProps","recordCreatorProps","columns","rowKey"],$n=Tt.default.RangePicker,qn=function(n){var t=n.formListProps,c=n.recordCreatorProps,l=c===void 0?{creatorButtonShow:!1}:c,h=n.columns,s=n.rowKey,F=s===void 0?"id":s,T=Et()(n,Qn),x=Ye.Z.useFormInstance(),U=function(r,g){switch(r){case"input":return(0,e.jsx)(vt.Z,S()({},g));case"select":return(0,e.jsx)(Wt.default,S()({},g));case"datePicker":return(0,e.jsx)(Tt.default,S()({},g));case"rangePicker":return(0,e.jsx)($n,S()({},g));case"inputNumber":return(0,e.jsx)(at.Z,S()({},g));case"checkbox":return(0,e.jsx)(Yt.Z,S()({},g));case"radio":return(0,e.jsx)(Ve.ZP,S()({},g));case"switch":return(0,e.jsx)(Vt.Z,S()({},g));case"timePicker":return(0,e.jsx)(Kt.Z,S()({},g));case"treeSelect":return(0,e.jsx)(Gt.Z,S()({},g));default:return null}},u=function(){return h.map(function(r){var g=r.dataIndex,i=r.componentType,b=i===void 0?"text":i,H=r.componentProps,C=r.formItemProps,fe=r.renderFormItem,L=fe===void 0?void 0:fe;return S()(S()({},r),{},{render:function(J,G,M){var f=(0,Xt.cloneDeep)(S()({},G));if((r==null?void 0:r.customRender)instanceof Function)return r.customRender({text:(f==null?void 0:f[g])||void 0,record:f,index:M},x);if((r==null?void 0:r.render)instanceof Function){var W;return r.render((f==null||(W=f[g])===null||W===void 0?void 0:W.toString())||"",f,M)}else if(b!=="text"||L instanceof Function){var V=(C==null?void 0:C.valuePropName)||function(){switch(b){case"switch":case"checkbox":return"checked";default:return"value"}}();return(0,e.jsx)(Ye.Z.Item,S()(S()({},C),{},{valuePropName:V,name:[].concat(xe()(G.fieldKey),[g]),style:{marginBottom:0},children:L&&L instanceof Function?L():U(b,H)}))}else if(b==="text"){var B;return(f==null||(B=f[g])===null||B===void 0?void 0:B.toString())||""}}})})},$=function(r){var g,i=l.record,b=i&&i instanceof Function?i():nt()(nt()({},"".concat(F),"add-".concat(et())),"children",null),H=S()(S()({},b),{},nt()(nt()({},"".concat(F),(b==null||(g=b[F])===null||g===void 0?void 0:g.toString())||"add-".concat(et())),"children",null));r(S()({},H))},P=(0,v.useCallback)(function(w){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return w==null?void 0:w.map(function(g,i){var b,H=[].concat(xe()(r),[i]),C=x.getFieldValue([t.name].concat(xe()(H)));return C._key=(C==null||(b=C[F])===null||b===void 0?void 0:b.toString())||C._key||"add-".concat(et()),S()(S()({},C),{},{fieldKey:H,isListField:!0,children:C!=null&&C.children?P(Array(C.children.length).fill({}),[].concat(xe()(H),["children"])):void 0})})},[x,t.name]);return(0,e.jsx)(Ye.Z.List,S()(S()({},t||{}),{},{children:function(r,g){var i=g.add;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.Z,S()(S()({},T||{}),{},{dataSource:P(r),columns:u(),rowKey:function(H){return H==null?void 0:H._key},pagination:!1})),l!=null&&l.creatorButtonShow?(0,e.jsx)("div",{style:{marginTop:24},children:(0,e.jsx)(ye.ZP,S()(S()({},(l==null?void 0:l.buttonProps)||{type:"dashed",block:!0}),{},{onClick:function(){return $(i)},children:(l==null?void 0:l.creatorButtonText)||"\u6DFB\u52A0\u4E00\u884C"}))}):null]})}}))},_n=qn,er=N(5574),te=N.n(er),mn=N(60887),yn=N(32339),ft=N(45587),xn=N(51329),bn=v.createContext({}),tr=function(n){var t=n.renderDragHandle,c=t===void 0?void 0:t,l=(0,v.useContext)(bn),h=l.setActivatorNodeRef,s=l.listeners;return(0,e.jsx)("div",S()(S()({style:{cursor:"move"},ref:h},s),{},{children:c||(0,e.jsx)(xn.Z,{})}))},nr=tr,Cn=N(24285),rr=function(n){var t=(0,ft.nB)({id:n["data-row-key"]}),c=t.attributes,l=t.listeners,h=t.transform,s=t.transition,F=t.isDragging,T=t.setNodeRef,x=t.setActivatorNodeRef,U=S()(S()({},n.style),{},{transform:Cn.ux.Translate.toString(h),transition:s},F?{position:"relative",zIndex:9999}:{}),u=(0,v.useMemo)(function(){return{setActivatorNodeRef:x,listeners:l}},[x,l]);return(0,e.jsx)(bn.Provider,{value:u,children:(0,e.jsx)("tr",S()(S()({},n),{},{ref:T,style:U},c))})},ar=rr,ir=["rowKey","isDrag","initialDataSource","columns","renderDragHandle","onDragSortEnd"],or=function(n){var t=n.rowKey,c=t===void 0?"id":t,l=n.isDrag,h=l===void 0?!0:l,s=n.initialDataSource,F=s===void 0?[]:s,T=n.columns,x=n.renderDragHandle,U=x===void 0?void 0:x,u=n.onDragSortEnd,$=Et()(n,ir),P=v.useState([]),w=te()(P,2),r=w[0],g=w[1];(0,v.useEffect)(function(){Array.isArray(F)&&g(xe()(F))},[F]);var i=function(fe){return typeof c=="function"?c(fe):String(fe[c])},b=function(fe){var L=fe.active,R=fe.over;R&&L.id!==R.id&&g(function(J){var G=J.findIndex(function(W){return i(W)===(L==null?void 0:L.id)}),M=J.findIndex(function(W){return i(W)===(R==null?void 0:R.id)}),f=(0,ft.Rp)(J,G,M);return u==null||u(f),f})},H=(0,v.useMemo)(function(){var C=xe()(T);return h&&C.unshift({key:"sort",align:"center",width:80,render:function(){return(0,e.jsx)(nr,{renderDragHandle:U})}}),C},[T,h]);return(0,e.jsx)(mn.LB,{modifiers:[yn.DL],onDragEnd:b,children:(0,e.jsx)(ft.Fo,{items:r.map(function(C){return i(C)}),strategy:ft.qw,children:(0,e.jsx)(ot.Z,S()(S()({},$),{},{rowKey:c,columns:H,dataSource:r,components:h?{body:{row:ar}}:void 0}))})})},lr=or,Sn=v.createContext({}),sr=function(n){var t=n.renderDragHandle,c=t===void 0?void 0:t,l=(0,v.useContext)(Sn),h=l.setActivatorNodeRef,s=l.listeners;return(0,e.jsx)("div",S()(S()({style:{cursor:"move"},ref:h},s),{},{children:c||(0,e.jsx)(xn.Z,{})}))},cr=sr,ur=function(n){var t=n["data-parent-id"],c=n["data-row-key"],l=(0,ft.nB)({id:c,data:{parentId:t}}),h=l.attributes,s=l.listeners,F=l.transform,T=l.transition,x=l.isDragging,U=l.setNodeRef,u=l.setActivatorNodeRef,$=S()(S()(S()({},n.style),{},{transform:Cn.ux.Translate.toString(F),transition:T},x?{position:"relative",zIndex:9999}:{}),{},{cursor:"pointer"}),P=(0,v.useMemo)(function(){return{setActivatorNodeRef:u,listeners:s,parentId:t}},[u,s,t]);return(0,e.jsx)(Sn.Provider,{value:P,children:(0,e.jsx)("tr",S()(S()({},n),{},{ref:U,style:$},h))})},dr=ur,hr=["onDragSortEnd","isDrag","initialDataSource","columns","renderDragHandle","rowKey","childrenColumnName","parentIdKey"],vr=function(n){var t=n.onDragSortEnd,c=n.isDrag,l=c===void 0?!0:c,h=n.initialDataSource,s=h===void 0?[]:h,F=n.columns,T=n.renderDragHandle,x=T===void 0?void 0:T,U=n.rowKey,u=U===void 0?"id":U,$=n.childrenColumnName,P=$===void 0?"children":$,w=n.parentIdKey,r=w===void 0?"parentId":w,g=Et()(n,hr),i=v.useState([]),b=te()(i,2),H=b[0],C=b[1];(0,v.useEffect)(function(){Array.isArray(s)&&C(xe()(s))},[s]);var fe=function(d){return typeof u=="function"?u(d):String(d[u])},L=function(d){return d[r]?String(d[r]):null},R=function A(d,y,j){var Z=d.findIndex(function(m){return fe(m)===y}),X=d.findIndex(function(m){return fe(m)===j});return Z!==-1&&X!==-1?(0,ft.Rp)(d,Z,X):d.map(function(m){var re=m[P];return Array.isArray(re)&&re.length>0?S()(S()({},m),{},nt()({},P,A(re,y,j))):m})},J=function(d){var y=d.active,j=d.over;if(j&&y.id!==j.id){var Z,X,m=(Z=y.data.current)===null||Z===void 0?void 0:Z.parentId,re=(X=j.data.current)===null||X===void 0?void 0:X.parentId;if(m!==re)return;C(function(oe){var p=R(oe,y.id,j.id);return t==null||t(p),p})}},G=function A(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return d.map(function(j){var Z=j[P],X=S()({},j);return X[r]=y,Array.isArray(Z)&&Z.length>0&&(X[P]=A(Z,String(fe(j)))),X})},M=(0,v.useMemo)(function(){return G(H)},[H]),f=function A(d){var y=[];return d.forEach(function(j){y.push(fe(j));var Z=j[P];Array.isArray(Z)&&Z.length>0&&(y=[].concat(xe()(y),xe()(A(Z))))}),y},W=(0,v.useMemo)(function(){var A=xe()(F);return l&&A.unshift({key:"sort",title:"\u6392\u5E8F",width:60,fixed:"left",render:function(){return(0,e.jsx)(cr,{renderDragHandle:x})}}),A},[F,l,g.rowSelection]),V=l?function(A){return{"data-parent-id":L(A)}}:void 0,B=(0,v.useMemo)(function(){return f(M)},[M]);return(0,e.jsx)(mn.LB,{modifiers:[yn.DL],onDragEnd:J,children:(0,e.jsx)(ft.Fo,{items:B,strategy:ft.qw,children:(0,e.jsx)(ot.Z,S()(S()({},g),{},{rowKey:u,columns:W,dataSource:M,components:l?{body:{row:dr}}:void 0,onRow:V,expandable:S()(S()({},(g==null?void 0:g.expandable)||{}),{},{expandIconColumnIndex:l&&(g!=null&&g.rowSelection)?3:l?1:0})}))})})},fr=vr,jn=N(51447),gr=N(15009),we=N.n(gr),pr=N(99289),ze=N.n(pr),an=N(19944),on=N(84477),ln=N(52514),sn=N(89514),cn=N(69753),ie=N(45360),un=N(57381),Xe=N(96074),Lt=N(28541),Mt=N(16085),Zt=N(95327);Lt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Lt.i8,"/pdf.worker.min.mjs");var mr=function(n){var t=n.fileUrl,c=n.fileName,l=c===void 0?"\u6587\u4EF6\u9884\u89C8":c,h=n.className,s=h===void 0?"":h,F=n.style,T=F===void 0?{}:F,x=(0,v.useState)(null),U=te()(x,2),u=U[0],$=U[1],P=(0,v.useState)(1),w=te()(P,2),r=w[0],g=w[1],i=(0,v.useState)(1),b=te()(i,2),H=b[0],C=b[1],fe=(0,v.useState)(!0),L=te()(fe,2),R=L[0],J=L[1],G=(0,v.useState)(null),M=te()(G,2),f=M[0],W=M[1],V=(0,v.useState)(l),B=te()(V,2),A=B[0],d=B[1],y=(0,v.useState)(!1),j=te()(y,2),Z=j[0],X=j[1],m=(0,v.useState)(null),re=te()(m,2),oe=re[0],p=re[1],Y=(0,v.useRef)(null),O=(0,v.useRef)(null),D=(0,v.useRef)(null),q=function(E){return typeof File!="undefined"&&E instanceof File},Q=function(E){return typeof Blob!="undefined"&&E instanceof Blob},z=function(){var I=ze()(we()().mark(function E(){var k,K;return we()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:k="",K=!0;try{typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://"))?(W(t),k=t.split("/").pop()||l):typeof t=="string"&&t.startsWith("data:")?W(t):Q(t)||q(t)?(W(t),k=q(t)&&t!==null&&t!==void 0&&t.name?t.name:l):(ie.ZP.error("\u4E0D\u652F\u6301\u7684\u6587\u4EF6\u683C\u5F0F"),K=!1),K&&d(k),J(!1)}catch(ne){console.error("\u5904\u7406\u6587\u4EF6\u65F6\u51FA\u9519:",ne),ie.ZP.error("\u65E0\u6CD5\u52A0\u8F7D\u6587\u4EF6"),J(!1)}case 3:case"end":return ee.stop()}},E)}));return function(){return I.apply(this,arguments)}}();(0,v.useEffect)(function(){J(!0),W(null),g(1),z()},[t,l]);var ke=function(E){var k=E.numPages;$(k),J(!1)},Pe=function(){},Ue=function(E){if(!(!Y.current||!u)){p("thumbnail");var k=Y.current,K=k.scrollHeight,ce=K/(u||1),ee=(E-1)*ce;k.scrollTo({top:ee,behavior:"smooth"}),setTimeout(function(){p(null)},500)}},Ze=function(E){g(E+1),Ue(E+1)},Oe=function(){if(!(!O.current||!r||!u)){var E=O.current,k=E.clientHeight,K=E.scrollHeight,ce=K/(u||1),ee=(r-1)*ce-k/2+ce/2;E.scrollTo({top:Math.max(0,ee),behavior:"smooth"})}},Ae=function(){C(H*1.2)},he=function(){C(H/1.2)},le=function(){try{if(typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://")))window.open(t,"_blank");else if(typeof t=="string"&&t.startsWith("data:")){var E=document.createElement("a");E.href=t,E.download=A||"document.pdf",E.click()}else if(Q(t)||q(t)){var k=URL.createObjectURL(t),K=document.createElement("a");K.href=k,K.download=A||"document.pdf",K.click(),setTimeout(function(){return URL.revokeObjectURL(k)},100)}}catch(ce){console.error("\u4E0B\u8F7D\u6587\u4EF6\u65F6\u51FA\u9519:",ce),ie.ZP.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25")}},a=function(){X(!Z)};(0,v.useEffect)(function(){var I=Y.current;if(!(!I||!u)){var E=function(){if(oe!=="thumbnail"){p("pdf");var ee=I.scrollTop,ne=I.scrollHeight,se=ne/u,de=Math.floor(ee/se)+1,ve=ee%se/se,De=ve>.5?de+1:de,Ce=Math.max(1,Math.min(De,u));Ce!==r&&g(Ce),D.current&&clearTimeout(D.current),D.current=setTimeout(function(){p(null)},150)}},k=null,K=function(){k||(k=setTimeout(function(){E(),k=null},50))};return I.addEventListener("scroll",K),function(){I.removeEventListener("scroll",K),k&&clearTimeout(k),D.current&&clearTimeout(D.current)}}},[u,r,oe]),(0,v.useEffect)(function(){oe==="pdf"&&Oe()},[r,oe]);var o=function(){return R||!f?(0,e.jsx)("div",{className:"document-preview-loading",children:(0,e.jsxs)("div",{className:"loading-container",children:[(0,e.jsx)(un.Z,{size:"large"}),(0,e.jsx)("div",{className:"loading-text",style:{marginTop:"16px",color:"rgba(0, 0, 0, 0.65)",fontSize:"14px",fontWeight:500},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pdf-controls",children:[(0,e.jsx)("div",{className:"pdf-controls-left",children:(0,e.jsx)(ye.ZP,{type:"text",icon:Z?(0,e.jsx)(an.Z,{}):(0,e.jsx)(on.Z,{}),onClick:a,className:"thumbnail-toggle-btn"})}),(0,e.jsxs)("div",{className:"pdf-controls-center",children:[(0,e.jsx)("div",{className:"page-indicator",children:"".concat(r," / ").concat(u||1)}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"page-divider"}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(ln.Z,{}),onClick:he}),(0,e.jsx)("span",{className:"zoom-indicator",children:"".concat(Math.round(H*100),"%")}),(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(sn.Z,{}),onClick:Ae})]})]}),(0,e.jsx)("div",{className:"pdf-controls-right",children:(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(cn.Z,{}),onClick:le,className:"download-btn"})})]}),(0,e.jsxs)("div",{className:"pdf-content-container",children:[(0,e.jsx)("div",{className:"pdf-thumbnails-container ".concat(Z?"collapsed":""),ref:O,children:u&&(0,e.jsx)(Mt.Z,{file:f,onLoadSuccess:Pe,loading:(0,e.jsx)(un.Z,{size:"small"}),children:Array.from(new Array(u),function(E,k){return(0,e.jsxs)("div",{className:"pdf-thumbnail ".concat(r===k+1?"active":""),onClick:function(){return Ze(k)},children:[(0,e.jsx)(Zt.Z,{pageNumber:k+1,scale:.15,renderTextLayer:!1,renderAnnotationLayer:!1}),(0,e.jsx)("div",{className:"thumbnail-page-number",children:k+1})]},"thumbnail-".concat(k))})})}),(0,e.jsx)("div",{className:"pdf-container",ref:Y,children:(0,e.jsx)(Mt.Z,{file:f,onLoadSuccess:ke,onLoadError:function(k){console.error("Error loading PDF:",k),ie.ZP.error("\u65E0\u6CD5\u52A0\u8F7DPDF\u6587\u4EF6"),J(!1)},loading:(0,e.jsx)(un.Z,{size:"large"}),children:Array.from(new Array(u),function(E,k){return(0,e.jsx)("div",{className:"pdf-page-wrapper",id:"pdf-page-".concat(k+1),children:(0,e.jsx)(Zt.Z,{pageNumber:k+1,scale:H,renderTextLayer:!1,renderAnnotationLayer:!1},"page-".concat(k))},"page-wrapper-".concat(k))})})})]})]})};return(0,e.jsx)("div",{className:"document-preview-container ".concat(s),style:T?S()({},T):void 0,children:o()})},yr=mr,Qt=N(11941),xr=N(27484),pe=N.n(xr),br=N(20185),Dn=N.n(br),Da=N(97679),ka=N(22115);function et(){var ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=new Uint8Array(32);return crypto.getRandomValues(n),Array.from(n).map(function(t){return ae[t%ae.length]}).join("")}var kn=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;function Cr(ae){return kn.test(ae)}var Sr=N(52677),jr=N.n(Sr);function Dr(ae){return ae==null?!0:typeof ae=="string"?ae.trim().length===0:Array.isArray(ae)?ae.length===0:jr()(ae)==="object"?Object.keys(ae).length===0:!1}var wn=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;function kr(ae){if(!wn.test(ae))return!1;if(ae.length===18){var n=parseInt(ae.substr(6,4)),t=parseInt(ae.substr(10,2)),c=parseInt(ae.substr(12,2)),l=new Date(n,t-1,c);return l.getFullYear()===n&&l.getMonth()+1===t&&l.getDate()===c}return!0}function wr(ae){return!isNaN(parseFloat(ae))&&isFinite(Number(ae))}var An=/^1[3-9]\d{9}$/;function Ar(ae){return An.test(ae)}var Pr=/^https?:\/\/([a-zA-Z0-9][a-zA-Z0-9-]*\.)*[a-zA-Z0-9][a-zA-Z0-9-]*\.[a-zA-Z]{2,}(:\d{1,5})?(\/[a-zA-Z0-9\-._~:/?#[\]@!$&'()*+,;=]*)?$/;function Fr(ae){if(typeof ae!="string"||!ae.trim())return!1;var n=ae.trim(),t;try{t=new URL(n)}catch(s){return!1}if(!["http:","https:"].includes(t.protocol))return!1;var c=t.hostname;if(/\s/.test(c)||c.startsWith(".")||c.endsWith(".")||/\.\./.test(c))return!1;var l=c.split(".").pop();if(!l||l.length<2)return!1;if(t.port){var h=Number(t.port);if(isNaN(h)||h<=0||h>65535)return!1}return!0}var Pn=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;function Er(ae){return Pn.test(ae)}var Tr=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=(0,v.useState)(n),c=te()(t,2),l=c[0],h=c[1],s=(0,v.useCallback)(function(P){h(function(w){return[].concat(xe()(w),[P])})},[]),F=(0,v.useCallback)(function(P,w){h(function(r){return r.map(function(g){return g.id===P?S()(S()(S()({},g),w),{},{modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}):g})})},[]),T=(0,v.useCallback)(function(P){h(function(w){return w.filter(function(r){return r.id!==P})})},[]),x=(0,v.useCallback)(function(){h([])},[]),U=(0,v.useCallback)(function(P){return l.filter(function(w){return w.pageNumber===P})},[l]),u=(0,v.useCallback)(function(P){return l.filter(function(w){return w.type===P})},[l]),$=(0,v.useCallback)(function(P){h(P)},[]);return{annotations:l,addAnnotation:s,updateAnnotation:F,removeAnnotation:T,clearAnnotations:x,getAnnotationsByPage:U,getAnnotationsByType:u,importAnnotations:$}},me=N(32237),Nr=function(n,t,c){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Arial",h=document.createElement("canvas"),s=h.getContext("2d");if(!s)return{width:200,height:100};s.font="".concat(t,"px ").concat(l);for(var F=n.split(" "),T=[],x=F[0]||"",U=1;U<F.length;U++){var u=F[U],$=s.measureText(x+" "+u).width;$<c?x+=" "+u:(T.push(x),x=u)}T.push(x);for(var P=t*1.2,w=T.length*P+16,r=0,g=0,i=T;g<i.length;g++){var b=i[g],H=s.measureText(b).width;r=Math.max(r,H)}return{width:Math.min(r+16,c),height:w}},Lr=function(n){var t=n.pageNumber,c=n.scale,l=n.width,h=n.height,s=n.activeTool,F=n.activeColor,T=n.activeLineStyle,x=n.annotations,U=n.readOnly,u=U===void 0?!1:U,$=n.zIndex,P=$===void 0?5:$,w=n.onAnnotationAdd,r=n.onAnnotationUpdate,g=n.onAnnotationRemove,i=n.onToolReset,b=n.setShowTextNotePanel,H=n.setTextNotePanelData,C=(0,v.useRef)(null),fe=(0,v.useRef)(null),L=(0,v.useRef)(null),R=(0,v.useState)(null),J=te()(R,2),G=J[0],M=J[1],f=(0,v.useState)(!1),W=te()(f,2),V=W[0],B=W[1],A=(0,v.useState)(null),d=te()(A,2),y=d[0],j=d[1],Z=(0,v.useState)(null),X=te()(Z,2),m=X[0],re=X[1],oe=x.filter(function(le){return["rectangle","circle","ellipse"].includes(le.type)}),p=x.filter(function(le){return["freedraw","freehighlight"].includes(le.type)}),Y=x.filter(function(le){return["signature","stamp"].includes(le.type)}),O=x.filter(function(le){return le.type==="text"}),D=function(a){if(G){var o=a.target,I=o.id(),E=o.scaleX(),k=o.scaleY();try{var K=x.find(function(He){return He.id===I});if(!K)return;var ce,ee=[];switch(K.type){case"rectangle":{var ne=o.width()*E,se=o.height()*k,de=o.x(),ve=o.y();r(I,{x:de,y:ve,width:ne,height:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"circle":{var De=o.width()*E,Ce=o.height()*k,je=Math.max(De,Ce)/2,Ee=o.x(),Je=o.y(),gt=Ee-je,yt=Je-je;r(I,{x:gt,y:yt,width:je*2,height:je*2,radius:je,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"ellipse":{var lt=o.width()*E,st=o.height()*k,xt=o.x(),bt=o.y(),Ct=xt-lt/2,St=bt-st/2;r(I,{x:Ct,y:St,width:lt,height:st,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"signature":case"stamp":{var pt=o.width()*E,jt=o.height()*k,Dt=o.x(),mt=o.y();r(I,{x:Dt,y:mt,width:pt,height:jt,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"freedraw":case"freehighlight":{ce=K;var Be=xe()(ce.points);try{for(var ue=1/0,_=1/0,ge=-1/0,be=-1/0,Se=0;Se<Be.length;Se+=2)ue=Math.min(ue,Be[Se]),ge=Math.max(ge,Be[Se]),_=Math.min(_,Be[Se+1]),be=Math.max(be,Be[Se+1]);var Fe=(ue+ge)/2,Le=(_+be)/2,Me=o.x(),tt=o.y();ee=[];for(var Ie=0;Ie<Be.length;Ie+=2){var kt=Be[Ie]-Fe,wt=Be[Ie+1]-Le,Ot=Me+kt*E,At=tt+wt*k;ee.push(Ot,At)}r(I,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}),o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}catch(He){console.error("\u5904\u7406\u81EA\u7531\u7ED8\u5236/\u9AD8\u4EAE\u53D8\u6362\u65F6\u51FA\u9519:",He),o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}break}case"text":{var qe,ct=o.width()*E,We=o.height()*k,ut=o.x()/c,dt=o.y()/c;r(I,{x:ut,y:dt,width:ct/c,height:We/c,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});var Re=(qe=o.getStage())===null||qe===void 0?void 0:qe.findOne("#text-".concat(I));if(Re){var Te;Re.position({x:o.x()+4*c,y:o.y()+4*c}),Re.width((ct/c-8)*c),Re.height((We/c-8)*c),(Te=Re.getLayer())===null||Te===void 0||Te.batchDraw()}break}}}catch(He){console.error("\u66F4\u65B0\u6279\u6CE8\u5931\u8D25:",He)}o.scaleX(1),o.scaleY(1)}},q=function(a){if(!(u||!s)){var o=a.target===a.currentTarget;if(o){var I=C.current;if(I){var E=I.getPointerPosition();if(E){var k=E.x/c,K=E.y/c;switch(s){case"freedraw":case"freehighlight":{B(!0);var ce=s==="freedraw"?2:10,ee={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:s==="freedraw"?1:.5,points:[k,K],strokeWidth:ce,lineStyle:T};j(ee);break}case"rectangle":case"circle":case"ellipse":{var ne={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:1,x:k,y:K,width:0,height:0,strokeWidth:2,lineStyle:T};re(ne);break}case"text":{i&&i();break}default:break}}}}}},Q=function(a){if(!u){var o=a.target.getStage();if(o){var I=o.getPointerPosition();if(I){var E=I.x/c,k=I.y/c;if(V&&y&&j(S()(S()({},y),{},{points:[].concat(xe()(y.points),[E,k])})),m){var K=E-m.x,ce=k-m.y;re(S()(S()({},m),{},{width:K,height:ce,radius:Math.max(Math.abs(K||0),Math.abs(ce||0))/2}))}}}}},z=function(){if(!u&&(V&&y&&(y.points.length>4&&(w(y),i==null||i()),B(!1),j(null)),m)){if(Math.abs(m.width||0)>5&&Math.abs(m.height||0)>5){var a=m.width||0,o=m.height||0,I=a<0?m.x+a:m.x,E=o<0?m.y+o:m.y,k=Math.abs(a),K=Math.abs(o);w(S()(S()({},m),{},{x:I,y:E,width:k,height:K,radius:m.type==="circle"?Math.max(k,K)/2:void 0})),i==null||i()}re(null)}},ke=function(a){if(!u){var o=a.target.getStage();if(o){if(a.target===a.currentTarget){M(null);return}var I=a.target,E=I.id();s||M(E||null)}}},Pe=function(){return oe.map(function(a){var o=G===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;switch(a.type){case"rectangle":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.UL,{id:a.id,x:a.x,y:a.y,width:a.width||0,height:a.height||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){r(a.id,{x:k.target.x(),y:k.target.y(),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"circle":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.Cd,{id:a.id,x:a.x+(a.radius||0),y:a.y+(a.radius||0),radius:a.radius||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){var K=k.target.x(),ce=k.target.y(),ee=a.radius||0,ne=K-ee,se=ce-ee;r(a.id,{x:ne,y:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"ellipse":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.Pj,{id:a.id,x:a.x+(a.width||0)/2,y:a.y+(a.height||0)/2,radiusX:(a.width||0)/2,radiusY:(a.height||0)/2,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){var K=k.target.x(),ce=k.target.y(),ee=a.width||0,ne=a.height||0,se=K-ee/2,de=ce-ne/2;r(a.id,{x:se,y:de,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);default:return null}})},Ue=function(){return p.map(function(a){var o=G===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.x1,{id:a.id,points:a.points,stroke:a.color,strokeWidth:a.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,globalCompositeOperation:a.type==="freehighlight"?"multiply":"source-over",listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){var K=k.target.x(),ce=k.target.y();k.target.position({x:0,y:0});for(var ee=xe()(a.points),ne=0;ne<ee.length;ne+=2)ee[ne]+=K,ee[ne+1]+=ce;r(a.id,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1})]},a.id)})},Ze=function(){return Y.map(function(a){var o=a.id,I=a.x,E=a.y,k=a.width,K=a.height,ce=a.imageData,ee=a.opacity,ne=G===a.id,se=new window.Image;return se.src=ce,(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.Ee,{id:o,x:I,y:E,width:k,height:K,image:se,opacity:ee,draggable:!u,onClick:function(){return!u&&M(o)},onTap:function(){return!u&&M(o)},onDragEnd:function(ve){r(o,{x:ve.target.x(),y:ve.target.y()})},onTransformEnd:D}),ne&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(ve,De){return De},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},o)})},Oe=function(){if(!y)return null;var a=y.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsx)(me.x1,{points:y.points,stroke:y.color,strokeWidth:y.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:y.opacity,dash:a,perfectDrawEnabled:!1,globalCompositeOperation:y.type==="freehighlight"?"multiply":"source-over",listening:!1})},Ae=function(){if(!m)return null;var a=m.lineStyle==="dashed"?[5,5]:void 0;switch(m.type){case"rectangle":return(0,e.jsx)(me.UL,{x:m.x,y:m.y,width:m.width||0,height:m.height||0,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});case"circle":{var o=m.radius||0;return(0,e.jsx)(me.Cd,{x:m.x+o,y:m.y+o,radius:o,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1})}case"ellipse":return(0,e.jsx)(me.Pj,{x:m.x+(m.width||0)/2,y:m.y+(m.height||0)/2,radiusX:Math.abs(m.width||0)/2,radiusY:Math.abs(m.height||0)/2,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});default:return null}},he=function(){var a;return O==null||(a=O.filter(function(o){return o.pageNumber===t}))===null||a===void 0?void 0:a.map(function(o){var I=G===o.id,E=l*.8,k=Nr(o.text||"",o.fontSize||16,E,"Arial"),K=o.width&&o.width>20?o.width:k.width/c,ce=o.height&&o.height>20?o.height:k.height/c;return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.UL,{id:o.id,x:o.x*c,y:o.y*c,width:K*c,height:ce*c,fill:o.backgroundColor||"#FFFFA0",opacity:.8,cornerRadius:4,stroke:I?"#1890ff":"transparent",strokeWidth:I?2:0,onDblClick:function(){M(o.id),b(!0),H(o)},onDblTap:function(){},draggable:!u,onDragMove:function(ne){var se,de=(se=ne.target.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(de){var ve;de.position({x:ne.target.x()+4*c,y:ne.target.y()+4*c}),(ve=de.getLayer())===null||ve===void 0||ve.batchDraw()}},onDragEnd:function(ne){r(o.id,{x:ne.target.x()/c,y:ne.target.y()/c,width:K,height:ce,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransform:function(ne){var se,de=ne.target,ve=(se=de.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(ve){var De,Ce=de.scaleX(),je=de.scaleY();ve.position({x:de.x()+4*c*Ce,y:de.y()+4*c*je}),ve.width(de.width()*Ce-8*c*Ce),ve.height(de.height()*je-8*c*je),(De=ve.getLayer())===null||De===void 0||De.batchDraw()}},onTransformEnd:D}),(0,e.jsx)(me.xv,{id:"text-".concat(o.id),x:(o.x+4)*c,y:(o.y+4)*c,width:(K-8)*c,height:(ce-8)*c,text:o.text,fontSize:(o.fontSize||16)*c,fontFamily:"Arial",fill:"#333333",wrap:"word",listening:!1}),I&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(ne,se){return se.width<50||se.height<30?ne:se}})]},o.id)})};return(0,v.useEffect)(function(){var le=function(o){(o.key==="Delete"||o.key==="Backspace")&&G&&!u&&(g(G),M(null))};return window.addEventListener("keydown",le),function(){window.removeEventListener("keydown",le)}},[G,g,u]),(0,v.useEffect)(function(){if(G&&L.current&&C.current){var le=C.current.findOne("#".concat(G));if(le){var a=x.find(function(Je){return Je.id===G});if(a&&!["freedraw","freehighlight"].includes(a.type)){var o,I;if((o=L.current)===null||o===void 0||o.nodes([le]),["signature","stamp"].includes(a.type)){var E,k,K;(E=L.current)===null||E===void 0||E.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(k=L.current)===null||k===void 0||k.rotateEnabled(!1),(K=L.current)===null||K===void 0||K.keepRatio(!0)}else if(a.type==="text"){var ce,ee,ne;(ce=L.current)===null||ce===void 0||ce.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(ee=L.current)===null||ee===void 0||ee.rotateEnabled(!1),(ne=L.current)===null||ne===void 0||ne.keepRatio(!1)}else{var se,de,ve;(se=L.current)===null||se===void 0||se.enabledAnchors(["top-left","top-center","top-right","middle-left","middle-right","bottom-left","bottom-center","bottom-right"]),(de=L.current)===null||de===void 0||de.rotateEnabled(!1),(ve=L.current)===null||ve===void 0||ve.keepRatio(a.type==="circle")}(I=L.current)===null||I===void 0||(I=I.getLayer())===null||I===void 0||I.batchDraw()}else{var De,Ce;(De=L.current)===null||De===void 0||De.nodes([]),(Ce=L.current)===null||Ce===void 0||(Ce=Ce.getLayer())===null||Ce===void 0||Ce.batchDraw()}}}else if(L.current){var je,Ee;(je=L.current)===null||je===void 0||je.nodes([]),(Ee=L.current)===null||Ee===void 0||(Ee=Ee.getLayer())===null||Ee===void 0||Ee.batchDraw()}},[G,x]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:u?"none":"auto",zIndex:P},className:"annotation-layer",children:(0,e.jsx)(me.Hf,{ref:C,width:l*c,height:h*c,scale:{x:c,y:c},onClick:ke,onMouseDown:q,onMouseMove:Q,onMouseUp:z,onTouchStart:q,onTouchMove:Q,onTouchEnd:z,style:{position:"absolute",top:0,left:0,pointerEvents:"all"},children:(0,e.jsxs)(me.mh,{ref:fe,children:[Pe(),Ue(),Ze(),he(),Oe(),Ae(),!u&&(0,e.jsx)(me.$T,{ref:L,rotateEnabled:!1,keepRatio:!1,borderDash:[6,2],borderStroke:"#1890ff",anchorStroke:"#1890ff",anchorFill:"#ffffff",anchorSize:8,boundBoxFunc:function(a,o){return o.width<5||o.height<5?a:o}})]})})})},Mr=Lr,Fn=N(82061),En=N(32983),Tn=N(83062),Zr=function(n){var t=n.annotations,c=n.currentPage,l=n.pdfLayerRef,h=n.scale,s=n.readOnly,F=s===void 0?!1:s,T=n.handlePageChange,x=n.onAnnotationSelect,U=n.onAnnotationDelete,u=n.onAnnotationUpdate,$=function(g){var i={highlight:"\u9AD8\u4EAE",strikethrough:"\u5220\u9664\u7EBF",underline:"\u4E0B\u5212\u7EBF",rectangle:"\u77E9\u5F62",circle:"\u5706\u5F62",ellipse:"\u692D\u5706",freedraw:"\u81EA\u7531\u7ED8\u5236",freehighlight:"\u81EA\u7531\u9AD8\u4EAE",signature:"\u7B7E\u540D",stamp:"\u76D6\u7AE0",text:"\u6587\u672C"};return i[g]||g},P=function(g,i){u&&u(g,{comment:i})},w=function r(g){var i=t.find(function(X){return X.id===g});if(i){if(i.pageNumber!==c){typeof T=="function"&&T(i.pageNumber),setTimeout(function(){return r(g)},500);return}if(l!=null&&l.current){var b={x:0,y:0,width:100,height:50};if("x"in i&&"y"in i)if(i.type==="circle"){var H=i.radius||0;b.x=i.x*h,b.y=i.y*h,b.width=H*2*h,b.height=H*2*h}else i.type==="ellipse"||i.type,b.x=i.x*h,b.y=i.y*h,"width"in i&&i.width&&(b.width=i.width*h),"height"in i&&i.height&&(b.height=i.height*h);var C=document.createElement("div");if(C.classList.add("annotation-highlight-selected"),C.style.position="absolute",C.style.left="".concat(b.x,"px"),C.style.top="".concat(b.y,"px"),C.style.width="".concat(b.width,"px"),C.style.height="".concat(b.height,"px"),i.type==="circle"||i.type==="ellipse")C.style.borderRadius="50%",C.style.border="2px solid ".concat(i.color||"#ff5500"),C.style.backgroundColor="transparent";else if(i.type==="rectangle")C.style.border="2px solid ".concat(i.color||"#ff5500"),C.style.backgroundColor="transparent";else if(i.type==="freedraw"||i.type==="freehighlight")if("points"in i&&i.points&&i.points.length>0){for(var fe=i.points,L=1/0,R=1/0,J=-1/0,G=-1/0,M=0;M<fe.length;M+=2){var f=fe[M]*h,W=fe[M+1]*h;L=Math.min(L,f),R=Math.min(R,W),J=Math.max(J,f),G=Math.max(G,W)}var V=5;C.style.left="".concat(L-V,"px"),C.style.top="".concat(R-V,"px"),C.style.width="".concat(J-L+V*2,"px"),C.style.height="".concat(G-R+V*2,"px"),C.style.border="2px solid ".concat(i.color||"#ff5500"),C.style.backgroundColor="transparent"}else C.style.transform="scale(1.2)",C.style.transformOrigin="center",C.style.backgroundColor="transparent";else["highlight","strikethrough","underline"].includes(i.type)&&(C.style.height="20px");l.current.appendChild(C);var B=l.current.parentElement;if(B){var A=b.x+parseInt(C.style.width,10)/2,d=b.y+parseInt(C.style.height,10)/2,y=l.current.getBoundingClientRect(),j=B.scrollTop||0,Z=B.scrollLeft||0;B.scrollTo({left:A+Z-y.width/2,top:d+j-y.height/2,behavior:"smooth"})}setTimeout(function(){l.current&&l.current.contains(C)&&l.current.removeChild(C)},3e3),typeof x=="function"&&x(g)}}};return(0,e.jsxs)("div",{className:"annotation-list-container",children:[(0,e.jsx)("div",{className:"annotation-list-header",children:(0,e.jsxs)("h4",{style:{margin:0},children:["\u6279\u6CE8\u5217\u8868 (\u7B2C ",c," \u9875)"]})}),(0,e.jsx)("div",{className:"annotation-list-content",children:t.length===0?(0,e.jsx)(En.Z,{description:"\u6682\u65E0\u6279\u6CE8"}):(0,e.jsx)("div",{className:"custom-annotation-list",children:t==null?void 0:t.map(function(r){return(0,e.jsxs)("div",{className:"custom-annotation-item",onClick:function(){return w(r.id)},children:[(0,e.jsxs)("div",{className:"annotation-header",children:[(0,e.jsxs)("div",{className:"annotation-type",children:[(0,e.jsx)("span",{className:"annotation-color-block",style:{backgroundColor:r.color}}),$(r.type)]}),!F&&(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(Fn.Z,{}),size:"small",danger:!0,onClick:function(i){i.stopPropagation(),U(r.id)}})]}),(0,e.jsxs)("div",{className:"annotation-date",children:["\u521B\u5EFA: ",(r==null?void 0:r.createdAt)||""]}),"content"in r&&(0,e.jsxs)("div",{className:"annotation-content",children:["\u5185\u5BB9:",(0,e.jsx)(Tn.Z,{title:(r==null?void 0:r.content)||"",children:(0,e.jsx)("span",{className:"annotation-content-text",children:r.content})})]}),(0,e.jsx)("div",{className:"annotation-comment",children:(0,e.jsx)(vt.Z.TextArea,{rows:2,value:r.comment||"",onChange:function(i){var b;return P(r.id,(i==null||(b=i.target)===null||b===void 0?void 0:b.value)||"")},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9...",disabled:F,onClick:function(i){return i.stopPropagation()}})})]},r.id)})})})]})},Br=Zr,Nn=N(51947),Ln=N(84646),Mn=N(90755),Zn=N(21082),Bn=N(64593),Rn=N(40666),$t=N(16801),Yn=N(47389),Un=N(69980),On=N(50797),In=N(52745),Hn=N(63129),Bt=N(51663),Rr=function(n){var t=n.icon,c=n.active,l=c===void 0?!1:c,h=n.disabled,s=h===void 0?!1:h,F=n.onClick;return(0,e.jsx)("div",{className:"annotation-tool-button ".concat(l?"active":""," ").concat(s?"disabled":""),onClick:function(){s||F()},children:(0,e.jsx)("span",{children:t})})},Qe=Rr,Yr=function(n){var t=n.activeTool,c=n.activeColor,l=n.activeLineStyle,h=l===void 0?"solid":l,s=n.onToolSelect,F=n.onColorChange,T=n.onLineStyleChange,x=n.readOnly,U=x===void 0?!1:x,u=!!U;if(u)return null;var $=["#FFFF00","#FF0000","#00FF00","#0000FF","#FF00FF","#00FFFF","#FFA500","#000000","#FFFFFF","#888888"],P=function(r,g){F(g)};return(0,e.jsx)("div",{className:"annotation-toolbar",children:(0,e.jsxs)("div",{className:"annotation-tools",children:[(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Nn.Z,{}),active:t==="highlight",disabled:!0,onClick:function(){return s("highlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u9AD8\u4EAE"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Ln.Z,{}),active:t==="strikethrough",disabled:!0,onClick:function(){return s("strikethrough")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5220\u9664\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Mn.Z,{}),active:t==="underline",disabled:!0,onClick:function(){return s("underline")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u4E0B\u5212\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Zn.Z,{}),active:t==="text",onClick:function(){return s("text")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u6587\u672C"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Bn.Z,{}),active:t==="rectangle",onClick:function(){return s("rectangle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u77E9\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Rn.Z,{style:{transform:"rotate(45deg)"}}),active:t==="circle",onClick:function(){return s("circle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5706\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)($t.Z,{}),active:t==="ellipse",onClick:function(){return s("ellipse")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u692D\u5706"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Yn.Z,{}),active:t==="freedraw",onClick:function(){return s("freedraw")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u7ED8\u5236"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Un.Z,{}),active:t==="freehighlight",onClick:function(){return s("freehighlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u9AD8\u4EAE"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(On.Z,{}),active:t==="signature",onClick:function(){return s("signature")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u7B7E\u540D"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)($t.Z,{style:{color:"#ff4d4f"}}),active:t==="stamp",onClick:function(){return s("stamp")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u76D6\u7AE0"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(In.Z,{}),active:h==="solid",onClick:function(){return T("solid")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5B9E\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Hn.Z,{}),active:h==="dashed",onClick:function(){return T("dashed")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u865A\u7EBF"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsx)("div",{className:"tool-group",children:(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Bt.Z,{value:c,size:"small",className:"color-picker",format:"hex",arrow:!1,placement:"bottomRight",presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:$}],onChange:P}),(0,e.jsx)("span",{className:"tool-name",children:"\u989C\u8272\u9009\u62E9"})]})})]})})},Ur=Yr,zn=N(60219),Wn=N(30019),rt=N(85576),Or=function(n){var t=n.fileUrl,c=n.fileName,l=n.annotations,h=n.currentPage,s=n.numPages,F=n.scale,T=n.sidebarVisible,x=n.readOnly,U=n.pdfLayerRef,u=n.toggleSidebar,$=n.setCurrentPage,P=n.zoomOut,w=n.zoomIn,r=n.onSave,g=(0,v.useState)(!1),i=te()(g,2),b=i[0],H=i[1],C=(0,v.useState)(""),fe=te()(C,2),L=fe[0],R=fe[1],J=function(){var A=ze()(we()().mark(function d(){var y,j,Z,X,m,re;return we()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(p.prev=0,!r){p.next=28;break}if(typeof t!="string"){p.next=26;break}if(!t.startsWith("data:")){p.next=11;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);y=new Blob([X],{type:"application/pdf"}),p.next=24;break;case 11:if(!t.startsWith("http")){p.next=24;break}return p.prev=12,p.next=15,fetch(t);case 15:return re=p.sent,p.next=18,re.blob();case 18:y=p.sent,p.next=24;break;case 21:p.prev=21,p.t0=p.catch(12),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",p.t0);case 24:p.next=27;break;case 26:(t instanceof Blob||t instanceof File)&&(y=t);case 27:r(l,y);case 28:ie.ZP.success("\u6279\u6CE8\u5DF2\u4FDD\u5B58"),p.next=34;break;case 31:p.prev=31,p.t1=p.catch(0),ie.ZP.error("\u4FDD\u5B58\u6279\u6CE8\u5931\u8D25");case 34:case"end":return p.stop()}},d,null,[[0,31],[12,21]])}));return function(){return A.apply(this,arguments)}}(),G=function(){var A=ze()(we()().mark(function d(y,j){var Z,X,m,re,oe,p,Y;return we()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(D.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u5904\u7406PDF\u9875\u9762...",key:y}),U.current){D.next=5;break}return ie.ZP.error({content:"\u65E0\u6CD5\u83B7\u53D6PDF\u5185\u5BB9",key:y}),D.abrupt("return");case 5:return Z=h,H(!0),R("\u51C6\u5907\u4E2D..."),D.prev=8,D.next=11,N.e(120).then(N.t.bind(N,46020,23));case 11:X=D.sent,m=X.default,re=[],oe=1;case 15:if(!(oe<=s)){D.next=28;break}return p="\u6B63\u5728\u5904\u7406\u7B2C ".concat(oe," \u9875 / \u5171 ").concat(s," \u9875..."),R(p),$(oe),D.next=21,new Promise(function(q){setTimeout(function(){q()},1e3)});case 21:return D.next=23,m(U.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,ignoreElements:function(Q){var z;return((z=Q.classList)===null||z===void 0?void 0:z.contains("print-ignore"))||!1}});case 23:Y=D.sent,re.push(Y);case 25:oe++,D.next=15;break;case 28:return $(Z),D.next=31,j(re);case 31:D.next=37;break;case 33:D.prev=33,D.t0=D.catch(8),console.error("\u5904\u7406PDF\u9875\u9762\u5931\u8D25:",D.t0),ie.ZP.error({content:"\u5904\u7406PDF\u9875\u9762\u5931\u8D25",key:y});case 37:return D.prev=37,H(!1),D.finish(37);case 40:D.next=47;break;case 42:D.prev=42,D.t1=D.catch(0),console.error("\u6355\u83B7\u9875\u9762\u9519\u8BEF:",D.t1),ie.ZP.error({content:"\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:y}),H(!1);case 47:case"end":return D.stop()}},d,null,[[0,42],[8,33,37,40]])}));return function(y,j){return A.apply(this,arguments)}}(),M=function(){var A=ze()(we()().mark(function d(){var y,j,Z,X,m,re,oe,p,Y,O,D,q;return we()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(z.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u6253\u5370\u4E2D...",key:"printLoading"}),y=null,typeof t!="string"){z.next=29;break}if(!t.startsWith("data:")){z.next=12;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);y=new Blob([X],{type:"application/pdf"}),z.next=27;break;case 12:if(!t.startsWith("http")){z.next=27;break}return z.prev=13,z.next=16,fetch(t);case 16:return re=z.sent,z.next=19,re.blob();case 19:y=z.sent,z.next=27;break;case 22:return z.prev=22,z.t0=z.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",z.t0),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"printLoading"}),z.abrupt("return");case 27:z.next=30;break;case 29:t instanceof Blob?y=t:t instanceof File&&(y=new Blob([t],{type:t.type}));case 30:if(y){z.next=33;break}return ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"printLoading"}),z.abrupt("return");case 33:oe=URL.createObjectURL(y),p=document.createElement("iframe"),p.style.position="absolute",p.style.width="0px",p.style.height="0px",p.style.border="0",p.style.left="-1000px",document.body.appendChild(p),Y=Date.now(),O=!1,D=!1,q=function ke(){if(!D)try{if(!document.body.contains(p)){D=!0,URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}if(O&&document.hasFocus()&&Date.now()-Y>1e3){D=!0,document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}setTimeout(ke,3e3)}catch(Pe){console.error("\u68C0\u67E5\u6253\u5370\u72B6\u6001\u5931\u8D25:",Pe),document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe)}},p.onload=function(){ie.ZP.success({content:"\u6587\u6863\u5DF2\u51C6\u5907\u597D\uFF0C\u6B63\u5728\u6253\u5F00\u6253\u5370\u5BF9\u8BDD\u6846...",key:"printLoading",duration:2}),setTimeout(function(){try{p.contentWindow?(p.contentWindow.focus(),p.contentWindow.print(),O=!0,setTimeout(q,1e3)):(ie.ZP.error({content:"\u6253\u5370\u5931\u8D25: \u65E0\u6CD5\u8BBF\u95EE\u6253\u5370\u7A97\u53E3",key:"printLoading"}),document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe))}catch(ke){console.error("\u6253\u5370\u5931\u8D25:",ke),document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25",key:"printLoading"})}},800)},p.src=oe,z.next=53;break;case 49:z.prev=49,z.t1=z.catch(0),console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",z.t1),ie.ZP.error({content:"\u6253\u5370\u51C6\u5907\u5931\u8D25",key:"printLoading"});case 53:case"end":return z.stop()}},d,null,[[0,49],[13,22]])}));return function(){return A.apply(this,arguments)}}(),f=function(d){var y;if(d==="original"){M();return}var j=document.createElement("iframe");j.style.position="absolute",j.style.width="0px",j.style.height="0px",j.style.border="0",j.style.left="-1000px",document.body.appendChild(j);var Z=(y=j.contentWindow)===null||y===void 0?void 0:y.document;if(!Z){document.body.removeChild(j),ie.ZP.error("\u521B\u5EFA\u6253\u5370\u6846\u67B6\u5931\u8D25");return}Z.open(),Z.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>PDF\u6253\u5370</title>
          <style>
            body {
              margin: 0;
              padding: 0;
              font-family: Arial, sans-serif;
            }
            .print-container {
              max-width: 100%;
              margin: 0;
              padding: 0;
            }
            .page-container {
              page-break-after: always;
              margin: 0;
              padding: 0;
              border: none;
            }
            .page-container:last-child {
              page-break-after: avoid;
              margin: 0;
            }
            img {
              max-width: 100%;
              display: block;
              margin: 0;
              padding: 0;
              box-shadow: none;
              border: none;
            }
            @media print {
              body {
                margin: 0;
                padding: 0;
              }
              .print-container {
                margin: 0;
                padding: 0;
              }
              .page-container {
                width: 100%;
                height: auto;
                page-break-after: always;
                margin: 0;
                padding: 0;
                border: none;
              }
              @page {
                margin: 0;
              }
            }
          </style>
        </head>
        <body>
          <div class="print-container" id="print-container">
            <!-- \u9875\u9762\u5185\u5BB9\u5C06\u52A8\u6001\u63D2\u5165\u8FD9\u91CC -->
          </div>
        </body>
      </html>
    `),Z.close();var X=Z.getElementById("print-container");if(!X){document.body.removeChild(j),ie.ZP.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25");return}G("printLoading",function(){var m=ze()(we()().mark(function re(oe){return we()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:try{oe.forEach(function(O){var D=Z.createElement("div");D.className="page-container";var q=Z.createElement("img");q.src=O.toDataURL("image/png"),D.appendChild(q),X.appendChild(D)}),ie.ZP.success({content:"\u6253\u5370\u51C6\u5907\u5B8C\u6210",key:"printLoading",duration:1}),setTimeout(function(){try{var O,D;(O=j.contentWindow)===null||O===void 0||O.focus(),(D=j.contentWindow)===null||D===void 0||D.print(),setTimeout(function(){document.body.contains(j)&&document.body.removeChild(j)},1e3)}catch(q){console.error("\u6253\u5370\u8C03\u7528\u5931\u8D25:",q),document.body.removeChild(j),ie.ZP.error("\u6253\u5370\u8C03\u7528\u5931\u8D25")}},500)}catch(O){console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",O),document.body.removeChild(j),ie.ZP.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25")}case 1:case"end":return Y.stop()}},re)}));return function(re){return m.apply(this,arguments)}}())},W=function(){var A=ze()(we()().mark(function d(){return we()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:G("downloadLoading",function(){var Z=ze()(we()().mark(function X(m){var re,oe,p,Y,O,D,q;return we()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.prev=0,z.next=3,N.e(730).then(N.bind(N,84730));case 3:for(re=z.sent,oe=re.default,p=new oe({orientation:"portrait",unit:"px",format:[m[0].width/2,m[0].height/2]}),Y=0;Y<m.length;Y++)O=m[Y],D=O.toDataURL("image/jpeg",.85),Y>0&&p.addPage([O.width/2,O.height/2]),p.addImage(D,"JPEG",0,0,O.width/2,O.height/2);q=c||"document-with-annotations.pdf",p.save(q),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"}),z.next=16;break;case 12:z.prev=12,z.t0=z.catch(0),console.error("\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25:",z.t0),ie.ZP.error({content:"\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25",key:"downloadLoading"});case 16:case"end":return z.stop()}},X,null,[[0,12]])}));return function(X){return Z.apply(this,arguments)}}()).catch(function(Z){console.log("\u9519\u8BEF",Z),ie.ZP.error({content:"\u6355\u83B7PDF\u5931\u8D25",key:"downloadLoading"})});case 1:case"end":return j.stop()}},d)}));return function(){return A.apply(this,arguments)}}(),V=function(){var A=ze()(we()().mark(function d(){var y,j,Z,X,m,re,oe,p,Y,O,D;return we()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(Q.prev=0,y=null,j=c||"document.pdf",typeof t!="string"){Q.next=30;break}if(!t.startsWith("data:")){Q.next=12;break}for(Z=t.split(",")[1],X=atob(Z),m=new Uint8Array(X.length),re=0;re<X.length;re++)m[re]=X.charCodeAt(re);y=new Blob([m],{type:"application/pdf"}),Q.next=28;break;case 12:if(!t.startsWith("http")){Q.next=28;break}return Q.prev=13,Q.next=16,fetch(t);case 16:return oe=Q.sent,Q.next=19,oe.blob();case 19:y=Q.sent,c||(p=t.split("/"),Y=p[p.length-1],Y&&Y.includes(".pdf")&&(j=Y)),Q.next=28;break;case 23:return Q.prev=23,Q.t0=Q.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",Q.t0),ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"downloadLoading"}),Q.abrupt("return");case 28:Q.next=31;break;case 30:t instanceof Blob?y=t:t instanceof File&&(y=new Blob([t],{type:t.type}),c||(j=t.name));case 31:if(y){Q.next=34;break}return ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"downloadLoading"}),Q.abrupt("return");case 34:O=URL.createObjectURL(y),D=document.createElement("a"),D.href=O,D.download=j,document.body.appendChild(D),D.click(),setTimeout(function(){document.body.removeChild(D),URL.revokeObjectURL(O),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"})},100),Q.next=47;break;case 43:Q.prev=43,Q.t1=Q.catch(0),console.error("\u4E0B\u8F7D\u539F\u59CBPDF\u5931\u8D25:",Q.t1),ie.ZP.error({content:"\u4E0B\u8F7D\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:"downloadLoading"});case 47:case"end":return Q.stop()}},d,null,[[0,43],[13,23]])}));return function(){return A.apply(this,arguments)}}(),B=function(d){rt.Z.info({title:d==="print"?"\u9009\u62E9\u6253\u5370\u7C7B\u578B":"\u9009\u62E9\u4E0B\u8F7D\u7C7B\u578B",icon:null,centered:!0,okText:"\u53D6\u6D88",content:(0,e.jsxs)("div",{className:"download-options",style:{marginTop:16,display:"flex",justifyContent:"center"},children:[l!=null&&l.length?(0,e.jsx)(ye.ZP,{type:"primary",style:{marginRight:16,height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){f("with-annotations");return}W()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u5E26\u6279\u6CE8\u7684PDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u5305\u542B\u6240\u6709\u6279\u6CE8\u6807\u8BB0)"})]})}):null,(0,e.jsx)(ye.ZP,{type:"primary",style:{height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){f("original");return}V()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u539F\u59CBPDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u4E0D\u542B\u6279\u6CE8)"})]})})]}),width:500})};return(0,e.jsxs)(e.Fragment,{children:[b&&(0,e.jsxs)("div",{className:"pdf-print-mask",children:[(0,e.jsx)("div",{className:"print-message",children:"\u6B63\u5728\u5904\u7406PDF\u6587\u4EF6\uFF0C\u8BF7\u52FF\u5173\u95ED\u6216\u64CD\u4F5C\u9875\u9762"}),(0,e.jsx)("div",{className:"print-progress",children:L})]}),(0,e.jsx)("div",{className:"pdf-annotation-header",children:(0,e.jsxs)("div",{className:"pdf-annotation-actions",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-sidebar",style:{cursor:"pointer"},onClick:function(){return u(!T)},children:T?(0,e.jsx)(on.Z,{className:"actions-sidebar-menu"}):(0,e.jsx)(an.Z,{className:"actions-sidebar-menu"})}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-option",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-page",children:"".concat(h," / ").concat(s)}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"pdf-annotation-actions-divider"}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-zoom",children:[(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(ln.Z,{}),onClick:P}),(0,e.jsxs)("span",{style:{margin:"0 8px"},children:[Math.round(F*100),"%"]}),(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(sn.Z,{}),onClick:w})]})]}),!x&&(0,e.jsxs)("div",{className:"pdf-annotation-actions-save",children:[(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(zn.Z,{}),type:"text",onClick:J}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(cn.Z,{}),type:"text",onClick:function(){return B("download")}}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(Wn.Z,{}),type:"text",onClick:function(){return B("print")}})]})]})})]})},Ir=Or,Hr=N(89724),Vn=N.n(Hr),qt=new Set,zr=function(n){if(!qt.has(n)){var t=n.querySelectorAll(".react-pdf__Page__textContent span, .react-pdf__Page__textContent div");t.forEach(function(s){var F=s;F.style.userSelect="text",F.style.webkitUserSelect="text",F.style.mozUserSelect="text",F.style.msUserSelect="text",F.style.cursor="text",F.style.position="relative",F.style.zIndex="2",F.style.color=F.style.color||"inherit",F.style.pointerEvents="auto"});var c=n.querySelectorAll("p, span, div:not(.konvajs-content):not([data-highlight-id])");c.forEach(function(s){var F=s;F.style.cursor="text",F.style.userSelect="text"});var l=n.querySelector(".react-pdf__Page__textContent");if(l){var h=l;h.style.userSelect="text",h.style.webkitUserSelect="text",h.style.mozUserSelect="text",h.style.msUserSelect="text",h.style.zIndex="2",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.right="0",h.style.bottom="0",h.style.pointerEvents="auto"}qt.add(n)}},Wr=function(n){var t=n.pageNumber,c=n.scale,l=n.activeTool,h=n.activeColor,s=n.pdfLayerRef,F=n.annotations,T=n.onAnnotationAdd,x=n.onAnnotationRemove,U=n.onToolReset,u=n.readOnly,$=u===void 0?!1:u,P=n.zIndex,w=P===void 0?6:P,r=(0,v.useRef)(null),g=(0,v.useState)(!1),i=te()(g,2),b=i[0],H=i[1],C=(0,v.useState)(),fe=te()(C,2),L=fe[1],R=(0,v.useCallback)(function(){return L({})},[]);(0,v.useEffect)(function(){if(s.current){qt.has(s.current)&&qt.delete(s.current);var M=s.current.querySelectorAll(".web-highlighter-wrapper, [data-highlight-id]");M.forEach(function(W){try{W.remove()}catch(V){console.error("\u6E05\u7406\u73B0\u6709\u9AD8\u4EAE\u5931\u8D25:",V)}}),zr(s.current);try{if(r.current)try{r.current.dispose()}catch(W){console.error("\u6E05\u7406\u65E7\u9AD8\u4EAE\u5668\u5B9E\u4F8B\u5931\u8D25:",W)}var f=new(Vn())({$root:s.current,exceptSelectors:["canvas",".konvajs-content",".annotation-layer","[data-highlight-id]",".text-selection-preview"],wrapTag:"span",style:{className:"web-highlighter-selection",style:{display:"inline"}}});f.includeSelector=[".react-pdf__Page__textContent"],f.devicePixelRatio=window.devicePixelRatio||1,r.current=f,r.current.run()}catch(W){console.error("\u521D\u59CB\u5316web-highlighter\u5931\u8D25:",W)}return function(){if(r.current)try{r.current.dispose(),r.current=null}catch(W){console.error("\u6E05\u7406\u9AD8\u4EAE\u5668\u5931\u8D25:",W)}}}},[s,t]);var J=function(f,W,V){setTimeout(function(){try{var B=document.querySelectorAll('[data-highlight-id="'.concat(f,'"], .web-highlighter-selection[data-highlight-source="').concat(f,'"]'));B&&B.length>0&&B.forEach(function(A){var d=A;d.style.display="inline",d.style.position="relative",d.style.zIndex="5",d.style.pointerEvents="auto",W==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):W==="underline"?(d.style.textDecoration="underline",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):W==="highlight"&&(d.style.backgroundColor=V,d.style.opacity="0.3",d.style.mixBlendMode="multiply"),d.classList.add("pdf-text-".concat(W))})}catch(A){console.error("\u5E94\u7528\u6837\u5F0F\u5931\u8D25:",A)}},50)},G=function(){if(s.current){var f=s.current.querySelectorAll("[data-highlight-id]"),W=new Map;f.forEach(function(V){var B=V.getAttribute("data-highlight-id");if(B)if(W.has(B))try{V.remove()}catch(A){console.error("\u6E05\u7406\u91CD\u590D\u9AD8\u4EAE\u5931\u8D25:",A)}else W.set(B,!0)})}};return(0,v.useEffect)(function(){if(!(!r.current||$)){var M=function(V){var B=V.sources;if(!(!l||!B||B.length===0)){var A=B[0],d={id:A.id||Date.now().toString(),type:l,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:h,opacity:l==="highlight"?.3:1,text:A.text||"",rects:A.rects||[],highlightId:A.id};T(d),H(!1),J(A.id,l,h),R(),G(),U==null||U()}},f=function(V){var B=V.id;l||window.confirm("\u662F\u5426\u5220\u9664\u6B64\u6279\u6CE8\uFF1F")&&(r.current&&r.current.remove(B),x(B))};return r.current.on("selection:create",M),r.current.on("click",f),function(){r.current&&(r.current.off("selection:create",M),r.current.off("click",f))}}},[l,h,t,T,x,$,R,U]),(0,v.useEffect)(function(){if(!(!r.current||$)){var M=function(){var V;if(l){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var A=B.getRangeAt(0);(V=s.current)!==null&&V!==void 0&&V.contains(A.commonAncestorContainer)&&H(!0)}}},f=function(){var V;if(!(!l||!r.current)){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var A=B.getRangeAt(0);if((V=s.current)!==null&&V!==void 0&&V.contains(A.commonAncestorContainer)&&!b){var d=B.toString().trim();if(d){var y={className:"pdf-text-".concat(l)};switch(l){case"highlight":y=S()(S()({},y),{},{backgroundColor:h,opacity:.3,mixBlendMode:"multiply"});break;case"strikethrough":y=S()(S()({},y),{},{textDecoration:"line-through",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break;case"underline":y=S()(S()({},y),{},{textDecoration:"underline",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break}H(!0);try{if(typeof r.current.highlightSelection=="function"){var j,Z=r.current.highlightSelection(y);J(Z,l,h),(j=window.getSelection())===null||j===void 0||j.removeAllRanges(),R(),H(!1),G(),U==null||U()}}catch(X){console.error("\u9AD8\u4EAE\u9009\u533A\u5931\u8D25:",X),H(!1)}}}}}};return document.addEventListener("selectionchange",M),document.addEventListener("mouseup",f),function(){document.removeEventListener("selectionchange",M),document.removeEventListener("mouseup",f)}}},[l,h,s,$,R,b,U]),(0,v.useEffect)(function(){if(!(!r.current||!s.current)){G();var M=F.filter(function(f){return["highlight","strikethrough","underline"].includes(f.type)&&f.pageNumber===t});M.length!==0&&(M.forEach(function(f){try{if(!r.current||!s.current)return;var W=s.current.querySelector('[data-highlight-id="'.concat(f.id,'"]'));if(W){J(f.id,f.type,f.color);return}var V=f;if(typeof r.current.fromStore=="function"&&V.startMeta&&V.endMeta){var B=r.current.fromStore(V.startMeta,V.endMeta,f.text,f.id);J(B,f.type,f.color)}else f.rects&&f.rects.length>0&&f.rects.forEach(function(A){var d=document.createElement("span");d.className="web-highlighter-selection pdf-text-".concat(f.type),d.setAttribute("data-highlight-id",f.id),d.style.position="absolute",d.style.left="".concat(A.x*c,"px"),d.style.top="".concat(A.y*c,"px"),d.style.width="".concat(A.width*c,"px"),d.style.height="".concat(A.height*c,"px"),d.style.zIndex="5",f.type==="highlight"?(d.style.backgroundColor=f.color,d.style.opacity="0.3",d.style.mixBlendMode="multiply"):f.type==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=f.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):f.type==="underline"&&(d.style.textDecoration="underline",d.style.textDecorationColor=f.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"),s.current&&s.current.appendChild(d)})}catch(A){console.error("\u6062\u590D\u6279\u6CE8\u5931\u8D25:",A,f)}}),G())}},[F,t,s,c,R]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:$?"none":"auto",zIndex:w},className:"highlighter-layer",children:(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:$||!l?"none":"auto",zIndex:w+1,cursor:l?"text":"default"},className:"text-selection-layer"})})},Vr=Wr,Kn=N(64082),Gn=N(36457),Kr=Gn.Z.Dragger,Gr=function(n){var t=n.type,c=n.visible,l=n.onSave,h=n.onCancel,s=(0,v.useState)([]),F=te()(s,2),T=F[0],x=F[1],U=(0,v.useState)(!1),u=te()(U,2),$=u[0],P=u[1],w=(0,v.useState)(null),r=te()(w,2),g=r[0],i=r[1],b=(0,v.useState)(t==="signature"?"#000000":"#ff0000"),H=te()(b,2),C=H[0],fe=H[1],L=(0,v.useState)(t==="signature"?2:4),R=te()(L,2),J=R[0],G=R[1],M=(0,v.useRef)(null),f=400,W=200,V=function(Y){P(!0);var O=Y.target.getStage().getPointerPosition();x([].concat(xe()(T),[{points:[O.x,O.y],stroke:C,strokeWidth:J}]))},B=function(Y){if($){var O=Y.target.getStage(),D=O.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),x([].concat(xe()(T.slice(0,-1)),[q]))}},A=function(){P(!1)},d=function(Y){Y.evt.preventDefault();var O=Y.target.getStage(),D=O.getPointerPosition();P(!0),x([].concat(xe()(T),[{points:[D.x,D.y],stroke:C,strokeWidth:J}]))},y=function(Y){if(Y.evt.preventDefault(),!!$){var O=Y.target.getStage(),D=O.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),x([].concat(xe()(T.slice(0,-1)),[q]))}},j=function(Y){Y.evt.preventDefault(),P(!1)},Z=function(){x([]),i(null)},X=function(){if(g){l(g);return}if(T.length===0){ie.ZP.warning("\u8BF7\u5148\u7ED8\u5236\u6216\u4E0A\u4F20\u56FE\u50CF");return}if(M.current){var Y=M.current.toDataURL();l(Y)}},m=function(Y,O){fe(O)},re=t==="signature"?["#000000","#0000FF","#FF0000","#008000"]:["#FF0000","#0000FF","#800000","#FF8C00"],oe=[{key:"draw",label:"\u624B\u7ED8",children:(0,e.jsxs)("div",{className:"signature-canvas-container",children:[(0,e.jsx)(me.Hf,{width:f,height:W,ref:M,onMouseDown:V,onMouseMove:B,onMouseUp:A,onTouchStart:d,onTouchMove:y,onTouchEnd:j,style:{border:"1px solid #ddd",borderRadius:4,background:"#fff"},children:(0,e.jsx)(me.mh,{children:T.map(function(p,Y){return(0,e.jsx)(me.x1,{points:p.points,stroke:p.stroke,strokeWidth:p.strokeWidth,tension:.5,lineCap:"round",lineJoin:"round"},Y)})})}),(0,e.jsxs)("div",{className:"signature-controls",children:[(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u989C\u8272:"}),(0,e.jsx)(Bt.Z,{value:C,onChange:m,presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:re}],size:"small",format:"hex"})]}),(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,e.jsx)("div",{className:"stroke-width-control",children:(0,e.jsxs)(Ve.ZP.Group,{value:J,onChange:function(Y){return G(Y.target.value)},buttonStyle:"solid",size:"small",children:[(0,e.jsx)(Ve.ZP.Button,{value:1,children:"\u7EC6"}),(0,e.jsx)(Ve.ZP.Button,{value:3,children:"\u4E2D"}),(0,e.jsx)(Ve.ZP.Button,{value:5,children:"\u7C97"})]})})]}),(0,e.jsxs)("div",{className:"action-buttons",children:[(0,e.jsx)(ye.ZP,{size:"middle",onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{size:"middle",type:"primary",onClick:X,children:"\u4FDD\u5B58"})]})]})]})},{key:"upload",label:"\u4E0A\u4F20",children:g?(0,e.jsxs)("div",{style:{textAlign:"center"},children:[(0,e.jsx)("img",{src:g,alt:"\u4E0A\u4F20\u7684\u56FE\u7247",style:{maxWidth:"100%",maxHeight:200,marginBottom:16,border:"1px solid #ddd",borderRadius:4}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ye.ZP,{onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{type:"primary",onClick:X,children:"\u4F7F\u7528\u6B64\u56FE\u7247"})]})]}):(0,e.jsxs)(Kr,{accept:".png,.jpg,.jpeg",showUploadList:!1,beforeUpload:function(Y){var O=new FileReader;return O.onload=function(D){var q;(q=D.target)!==null&&q!==void 0&&q.result&&i(D.target.result)},O.readAsDataURL(Y),!1},multiple:!1,children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(Kn.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u5230\u6B64\u533A\u57DF\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u652F\u6301\u5355\u4E2A\u56FE\u7247\u4E0A\u4F20\uFF0C\u63A8\u8350\u4F7F\u7528\u900F\u660E\u80CC\u666F\u7684PNG\u56FE\u7247"})]})}];return(0,e.jsx)(rt.Z,{title:t==="signature"?"\u6DFB\u52A0\u7B7E\u540D":"\u6DFB\u52A0\u76D6\u7AE0",open:c,onCancel:h,footer:null,width:500,children:(0,e.jsx)(Qt.Z,{defaultActiveKey:"draw",items:oe})})},Jr=Gr,Xr=function(n){var t=n.onSave,c=n.onCancel,l=n.visible,h=n.curTextNotePanelData,s=h===void 0?{}:h,F=Ye.Z.useForm(),T=te()(F,1),x=T[0],U=Ye.Z.useWatch(["backgroundColor"],x),u=["#FFFFA0","#A0E7E5","#FFC0CB","#FFCBA4","#D3D3D3","#C1FFC1","#FFFFFF"];(0,v.useEffect)(function(){l&&x.setFieldsValue({text:(s==null?void 0:s.text)||"",fontSize:(s==null?void 0:s.fontSize)||12,backgroundColor:(s==null?void 0:s.backgroundColor)||"#FFFFA0"})},[l,s]);var $=function(w){var r=w.text,g=w.fontSize,i=w.backgroundColor;t(r,g,i)};return(0,e.jsx)(rt.Z,{title:"\u6DFB\u52A0\u6587\u672C\u6279\u6CE8",open:l,onCancel:c,footer:[(0,e.jsx)(ye.ZP,{onClick:c,children:"\u53D6\u6D88"},"cancel"),(0,e.jsx)(ye.ZP,{type:"primary",onClick:function(){return x.submit()},children:"\u6DFB\u52A0\u6279\u6CE8"},"save")],width:500,children:(0,e.jsxs)(Ye.Z,{form:x,layout:"vertical",onFinish:$,children:[(0,e.jsx)(Ye.Z.Item,{name:"text",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C"}],children:(0,e.jsx)(vt.Z.TextArea,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C...",autoFocus:!0,style:{padding:"8px",borderRadius:"4px",backgroundColor:U}})}),(0,e.jsx)(Ye.Z.Item,{label:"\u5B57\u4F53\u5927\u5C0F",name:"fontSize",children:(0,e.jsx)(at.Z,{min:1,max:100,style:{width:"200px"},addonAfter:"px"})}),(0,e.jsx)(Ye.Z.Item,{label:"\u80CC\u666F\u989C\u8272",name:"backgroundColor",children:(0,e.jsx)(Bt.Z,{presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:u}],size:"middle",format:"hex",onChange:function(w){var r;x.setFieldValue("backgroundColor",w==null||(r=w.toHexString)===null||r===void 0?void 0:r.call(w))}})})]})})},Qr=Xr,$r=function(n){var t=n.fileUrl,c=n.numPages,l=n.currentPage,h=n.onPageChange,s=(0,v.useRef)(null),F=(0,v.useState)([]),T=te()(F,2),x=T[0],U=T[1],u=(0,v.useState)(!1),$=te()(u,2),P=$[0],w=$[1],r=(0,v.useState)(!1),g=te()(r,2),i=g[0],b=g[1],H=function(){w(!0);for(var R=[],J=1;J<=Math.min(c,20);J++)R.push(J);U(R),setTimeout(function(){return b(!0)},500)},C=(0,v.useCallback)(function(){if(!(!s.current||c===0||!i)){for(var L=s.current,R=L.scrollTop,J=L.clientHeight,G=5,M=150,f=Math.max(1,Math.floor(R/M)-G),W=Math.min(c,Math.ceil((R+J)/M)+G),V=[],B=f;B<=W;B++)V.push(B);!V.includes(l)&&l<=c&&V.push(l),U(V)}},[c,l,i]);(0,v.useEffect)(function(){if(!(!s.current||!i)){C();var L=s.current,R=function(){requestAnimationFrame(C)};return L.addEventListener("scroll",R),function(){L==null||L.removeEventListener("scroll",R)}}},[C,i]);var fe=function(){if(!P)return(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7DPDF\u7F29\u7565\u56FE..."});for(var R=[],J=function(f){var W=x.includes(f);R.push((0,e.jsxs)("div",{className:"thumbnail-item ".concat(f===l?"active":""),onClick:function(){return h(f)},children:[(0,e.jsx)("div",{className:"thumbnail-page-number",children:f}),(0,e.jsx)("div",{className:"thumbnail-container",children:W&&(0,e.jsx)(Zt.Z,{pageNumber:f,width:100,renderTextLayer:!1,renderAnnotationLayer:!1,loading:null})})]},f))},G=1;G<=c;G++)J(G);return R.push((0,e.jsx)("div",{style:{height:"20px",flexShrink:0}},"bottom-space")),R};return(0,v.useEffect)(function(){if(s.current&&l&&P&&i){var L=150,R=(l-1)*L,J=s.current,G=J.scrollTop,M=J.clientHeight;(R<G||R>G+M-L)&&J.scrollTo({top:R-M/2+L/2,behavior:"smooth"})}},[l,P,i]),(0,e.jsx)("div",{className:"thumbnail-preview",children:(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:H,loading:(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7D\u6587\u6863\u4E2D..."}),error:(0,e.jsx)("div",{className:"thumbnail-error",children:"PDF\u52A0\u8F7D\u5931\u8D25"}),children:(0,e.jsx)("div",{className:"thumbnail-list",ref:s,children:fe()})})})},qr=$r;Dn().showWarnings=!1;var _t={BASE:6,TOP:9};Lt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Lt.i8,"/pdf.worker.min.mjs");var _r=function(n){var t=n.fileUrl,c=n.fileName,l=n.onSave,h=n.readOnly,s=h===void 0?!1:h,F=n.style,T=F===void 0?{}:F,x=n.className,U=x===void 0?"":x,u=n.annotationList,$=u===void 0?[]:u,P=(0,v.useState)(0),w=te()(P,2),r=w[0],g=w[1],i=(0,v.useState)(1),b=te()(i,2),H=b[0],C=b[1],fe=(0,v.useState)(1),L=te()(fe,2),R=L[0],J=L[1],G=(0,v.useState)({width:0,height:0}),M=te()(G,2),f=M[0],W=M[1],V=(0,v.useState)(!0),B=te()(V,2),A=B[0],d=B[1],y=(0,v.useState)(null),j=te()(y,2),Z=j[0],X=j[1],m=(0,v.useState)("#FFFF00"),re=te()(m,2),oe=re[0],p=re[1],Y=(0,v.useState)("solid"),O=te()(Y,2),D=O[0],q=O[1],Q=(0,v.useState)(!1),z=te()(Q,2),ke=z[0],Pe=z[1],Ue=(0,v.useState)(!1),Ze=te()(Ue,2),Oe=Ze[0],Ae=Ze[1],he=(0,v.useState)({}),le=te()(he,2),a=le[0],o=le[1],I=(0,v.useState)("thumbnails"),E=te()(I,2),k=E[0],K=E[1],ce=(0,v.useState)(!0),ee=te()(ce,2),ne=ee[0],se=ee[1],de=(0,v.useRef)(null),ve=(0,v.useRef)(null),De=Tr($),Ce=De.annotations,je=De.addAnnotation,Ee=De.updateAnnotation,Je=De.removeAnnotation,gt=(0,v.useRef)(null),yt=function(){var _=[".highlight-container","[data-highlight-id]",".custom-pdf-highlight",".web-highlighter-selection",".web-highlighter-wrapper"];_.forEach(function(be){document.querySelectorAll(be).forEach(function(Se){try{if(Se.textContent)if(Se.parentNode&&Se.parentNode!==document.body){var Fe=Se.textContent,Le=document.createTextNode(Fe);Se.parentNode.replaceChild(Le,Se)}else Se.remove();else Se.remove()}catch(Me){console.error("\u6E05\u7406\u9AD8\u4EAE\u5143\u7D20\u5931\u8D25:",Me)}})});try{document.querySelectorAll("style[data-highlight-style]").forEach(function(be){be.remove()});var ge=document.querySelector(".react-pdf__Page__textContent");ge&&ge.querySelectorAll("span, div").forEach(function(be){be.style.userSelect="text",be.style.webkitUserSelect="text",be.style.pointerEvents="auto"})}catch(be){console.error("\u6E05\u7406web-highlighter\u5143\u7D20\u5931\u8D25:",be)}},lt=function(_){var ge=_.numPages;g(ge),d(!1)},st=function(_){var ge=_.getViewport({scale:1});W({width:ge.width,height:ge.height})},xt=function(_){q(_)},bt=function(_){X(_),(_==="signature"||_==="stamp")&&Pe(!0),_==="text"&&(Ae(!0),o({}))},Ct=function(_,ge){!f.width||!f.height||(je({id:"add-"+et(),type:ge,pageNumber:H,x:f.width/4,y:f.height/4,width:f.width/2,height:ge==="signature"?f.height/8:f.width/4,imageData:_,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#000000",opacity:1}),Pe(!1),X(null))},St=function(_,ge,be){if(!(!f.width||!f.height)){var Se=function(At,qe){var ct=document.createElement("canvas"),We=ct.getContext("2d");if(!We)return{width:200,height:100};We.font="".concat(qe,"px Arial");for(var ut=f.width*.8,dt=At.split(""),Re=[],Te="",He=0;He<dt.length;He++){var It=dt[He],Ht=Te+It,dn=We.measureText(Ht);dn.width>ut&&Te.length>0?(Re.push(Te),Te=It):Te=Ht}Te.length>0&&Re.push(Te);for(var hn=qe*1.5,vn=Math.max(Re.length*hn+16,40),Pt=0,Ft=0,zt=Re;Ft<zt.length;Ft++){var fn=zt[Ft],gn=We.measureText(fn).width;Pt=Math.max(Pt,gn)}return{width:Math.min(Math.max(Pt+16,100),ut),height:vn}};if(a!=null&&a.id){var Fe=Se(_,ge),Le=Fe.width,Me=Fe.height;Ee(a.id,{text:_,fontSize:ge,backgroundColor:be,width:Le,height:Me,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})}else{var tt=Se(_,ge),Ie=tt.width,kt=tt.height,wt={id:"add-"+et(),type:"text",pageNumber:H,x:(f.width-Ie)/2,y:f.height/4,width:Ie,height:kt,text:_,fontSize:ge,backgroundColor:be,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#333333",opacity:1};je(wt)}Ae(!1),X(null),o({})}},pt=function(_){ve.current&&yt(),C(_)},jt=function(){return J(R*1.2)},Dt=function(){return J(R/1.2)},mt=function(){se(!ne)},Be=function(_){["rectangle","circle","ellipse","freedraw","freehighlight"].includes(_.type)?je(S()(S()({},_),{},{lineStyle:D})):je(_)};return(0,e.jsxs)("div",{className:"pdf-annotation-container ".concat(U),style:T,ref:de,children:[(0,e.jsx)(Ir,{fileUrl:t,fileName:c,annotations:xe()(Ce),currentPage:H,numPages:r,readOnly:s,pdfLayerRef:ve,scale:R,sidebarVisible:ne,toggleSidebar:mt,setCurrentPage:C,zoomOut:Dt,zoomIn:jt,onSave:l}),s?null:(0,e.jsx)(Ur,{activeTool:Z,activeColor:oe,activeLineStyle:D,onToolSelect:bt,onColorChange:p,onLineStyleChange:xt,readOnly:s}),(0,e.jsxs)("div",{className:"pdf-annotation-content",children:[(0,e.jsx)("div",{className:"pdf-annotation-sidebar ".concat(ne?"visible":"hidden"),children:(0,e.jsx)(Qt.Z,{activeKey:k,onChange:function(_){return K(_)},items:[{key:"thumbnails",label:"\u9875\u9762\u9884\u89C8",children:(0,e.jsx)(qr,{fileUrl:t,numPages:r,currentPage:H,onPageChange:pt})},{key:"annotations",label:"\u6279\u6CE8\u5217\u8868",children:(0,e.jsx)(Br,{annotations:Ce==null?void 0:Ce.filter(function(ue){return ue.pageNumber===H}),currentPage:H,pdfLayerRef:ve,scale:R,handlePageChange:pt,onAnnotationDelete:Je,onAnnotationUpdate:Ee,readOnly:s})}]})}),(0,e.jsx)("div",{className:"pdf-annotation-main",children:(0,e.jsxs)("div",{className:"pdf-viewer",ref:ve,children:[(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:lt,loading:(0,e.jsxs)("div",{className:"pdf-loading",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"0 0 1024 1024",width:"48",height:"48",fill:"#1677ff",children:[(0,e.jsx)("path",{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}),(0,e.jsx)("path",{d:"M304 544h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0-144h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 288h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"14px",fontWeight:500,textAlign:"center"},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]}),error:(0,e.jsxs)("div",{className:"pdf-error",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"64 64 896 896",width:"48",height:"48",fill:"#ff4d4f",children:[(0,e.jsx)("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}),(0,e.jsx)("path",{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"16px",fontWeight:500,marginBottom:"8px"},children:"\u52A0\u8F7DPDF\u5931\u8D25"}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.65)",fontSize:"14px"},children:"\u8BF7\u68C0\u67E5\u6587\u4EF6\u683C\u5F0F\u6216\u7F51\u7EDC\u8FDE\u63A5\u540E\u91CD\u8BD5"})]}),children:(0,e.jsx)(Zt.Z,{pageNumber:H,scale:R,onLoadSuccess:st,renderTextLayer:!0,renderAnnotationLayer:!0,inputRef:gt})}),!A&&f.width>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Vr,{pageNumber:H,scale:R,activeTool:["highlight","strikethrough","underline"].includes(Z)?Z:null,activeColor:oe,pdfLayerRef:ve,annotations:Ce.filter(function(ue){return ue.pageNumber===H}),onAnnotationAdd:je,onAnnotationRemove:Je,onAnnotationUpdate:Ee,onToolReset:function(){return X(null)},readOnly:s,zIndex:["highlight","strikethrough","underline"].includes(Z)?_t.TOP:_t.BASE}),(0,e.jsx)(Mr,{pageNumber:H,scale:R,width:f.width,height:f.height,activeTool:["highlight","strikethrough","underline"].includes(Z)?null:Z,activeColor:oe,activeLineStyle:D,annotations:Ce.filter(function(ue){return ue.pageNumber===H}),readOnly:s,zIndex:["highlight","strikethrough","underline"].includes(Z)?_t.BASE:_t.TOP,onAnnotationAdd:Be,onAnnotationUpdate:Ee,onAnnotationRemove:Je,onToolReset:function(){return X(null)},setShowTextNotePanel:Ae,setTextNotePanelData:o})]})]})})]}),ke&&Z&&(0,e.jsx)(Jr,{visible:ke,type:Z,onSave:function(_){return Ct(_,Z)},onCancel:function(){Pe(!1),X(null)}}),Oe&&(0,e.jsx)(Qr,{onSave:St,onCancel:function(){Ae(!1),X(null),o({})},visible:Oe,curTextNotePanelData:a})]})},ea=_r,ta=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=(0,v.useState)(n),c=te()(t,2),l=c[0],h=c[1],s=(0,v.useCallback)(function(P){h(function(w){return[].concat(xe()(w),[P])})},[]),F=(0,v.useCallback)(function(P,w){h(function(r){return r.map(function(g){return g.id===P?S()(S()(S()({},g),w),{},{modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}):g})})},[]),T=(0,v.useCallback)(function(P){h(function(w){return w.filter(function(r){return r.id!==P})})},[]),x=(0,v.useCallback)(function(){h([])},[]),U=(0,v.useCallback)(function(P){return l.filter(function(w){return w.pageNumber===P})},[l]),u=(0,v.useCallback)(function(P){return l.filter(function(w){return w.type===P})},[l]),$=(0,v.useCallback)(function(P){h(P)},[]);return{annotations:l,addAnnotation:s,updateAnnotation:F,removeAnnotation:T,clearAnnotations:x,getAnnotationsByPage:U,getAnnotationsByType:u,importAnnotations:$}},na=function(n,t,c){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Arial",h=document.createElement("canvas"),s=h.getContext("2d");if(!s)return{width:200,height:100};s.font="".concat(t,"px ").concat(l);for(var F=n.split(" "),T=[],x=F[0]||"",U=1;U<F.length;U++){var u=F[U],$=s.measureText(x+" "+u).width;$<c?x+=" "+u:(T.push(x),x=u)}T.push(x);for(var P=t*1.2,w=T.length*P+16,r=0,g=0,i=T;g<i.length;g++){var b=i[g],H=s.measureText(b).width;r=Math.max(r,H)}return{width:Math.min(r+16,c),height:w}},ra=function(n){var t=n.pageNumber,c=n.scale,l=n.width,h=n.height,s=n.activeTool,F=n.activeColor,T=n.activeLineStyle,x=n.annotations,U=n.readOnly,u=U===void 0?!1:U,$=n.zIndex,P=$===void 0?5:$,w=n.onAnnotationAdd,r=n.onAnnotationUpdate,g=n.onAnnotationRemove,i=n.onToolReset,b=n.setShowTextNotePanel,H=n.setTextNotePanelData,C=(0,v.useRef)(null),fe=(0,v.useRef)(null),L=(0,v.useRef)(null),R=(0,v.useState)(null),J=te()(R,2),G=J[0],M=J[1],f=(0,v.useState)(!1),W=te()(f,2),V=W[0],B=W[1],A=(0,v.useState)(null),d=te()(A,2),y=d[0],j=d[1],Z=(0,v.useState)(null),X=te()(Z,2),m=X[0],re=X[1],oe=x.filter(function(le){return["rectangle","circle","ellipse"].includes(le.type)}),p=x.filter(function(le){return["freedraw","freehighlight"].includes(le.type)}),Y=x.filter(function(le){return["signature","stamp"].includes(le.type)}),O=x.filter(function(le){return le.type==="text"}),D=function(a){if(G){var o=a.target,I=o.id(),E=o.scaleX(),k=o.scaleY();try{var K=x.find(function(He){return He.id===I});if(!K)return;var ce,ee=[];switch(K.type){case"rectangle":{var ne=o.width()*E,se=o.height()*k,de=o.x(),ve=o.y();r(I,{x:de,y:ve,width:ne,height:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"circle":{var De=o.width()*E,Ce=o.height()*k,je=Math.max(De,Ce)/2,Ee=o.x(),Je=o.y(),gt=Ee-je,yt=Je-je;r(I,{x:gt,y:yt,width:je*2,height:je*2,radius:je,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"ellipse":{var lt=o.width()*E,st=o.height()*k,xt=o.x(),bt=o.y(),Ct=xt-lt/2,St=bt-st/2;r(I,{x:Ct,y:St,width:lt,height:st,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"signature":case"stamp":{var pt=o.width()*E,jt=o.height()*k,Dt=o.x(),mt=o.y();r(I,{x:Dt,y:mt,width:pt,height:jt,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"freedraw":case"freehighlight":{ce=K;var Be=xe()(ce.points);try{for(var ue=1/0,_=1/0,ge=-1/0,be=-1/0,Se=0;Se<Be.length;Se+=2)ue=Math.min(ue,Be[Se]),ge=Math.max(ge,Be[Se]),_=Math.min(_,Be[Se+1]),be=Math.max(be,Be[Se+1]);var Fe=(ue+ge)/2,Le=(_+be)/2,Me=o.x(),tt=o.y();ee=[];for(var Ie=0;Ie<Be.length;Ie+=2){var kt=Be[Ie]-Fe,wt=Be[Ie+1]-Le,Ot=Me+kt*E,At=tt+wt*k;ee.push(Ot,At)}r(I,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}),o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}catch(He){o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}break}case"text":{var qe,ct=o.width()*E,We=o.height()*k,ut=o.x()/c,dt=o.y()/c;r(I,{x:ut,y:dt,width:ct/c,height:We/c,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});var Re=(qe=o.getStage())===null||qe===void 0?void 0:qe.findOne("#text-".concat(I));if(Re){var Te;Re.position({x:o.x()+4*c,y:o.y()+4*c}),Re.width((ct/c-8)*c),Re.height((We/c-8)*c),(Te=Re.getLayer())===null||Te===void 0||Te.batchDraw()}break}}}catch(He){console.log("\u66F4\u65B0\u6279\u6CE8\u5931\u8D25:",He)}o.scaleX(1),o.scaleY(1)}},q=function(a){if(!(u||!s)){var o=a.target===a.currentTarget;if(o){var I=C.current;if(I){var E=I.getPointerPosition();if(E){var k=E.x/c,K=E.y/c;switch(s){case"freedraw":case"freehighlight":{B(!0);var ce=s==="freedraw"?2:10,ee={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:s==="freedraw"?1:.5,points:[k,K],strokeWidth:ce,lineStyle:T};j(ee);break}case"rectangle":case"circle":case"ellipse":{var ne={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:1,x:k,y:K,width:0,height:0,strokeWidth:2,lineStyle:T};re(ne);break}case"text":{i&&i();break}default:break}}}}}},Q=function(a){if(!u){var o=a.target.getStage();if(o){var I=o.getPointerPosition();if(I){var E=I.x/c,k=I.y/c;if(V&&y&&j(S()(S()({},y),{},{points:[].concat(xe()(y.points),[E,k])})),m){var K=E-m.x,ce=k-m.y;re(S()(S()({},m),{},{width:K,height:ce,radius:Math.max(Math.abs(K||0),Math.abs(ce||0))/2}))}}}}},z=function(){if(!u&&(V&&y&&(y.points.length>4&&(w(y),i==null||i()),B(!1),j(null)),m)){if(Math.abs(m.width||0)>5&&Math.abs(m.height||0)>5){var a=m.width||0,o=m.height||0,I=a<0?m.x+a:m.x,E=o<0?m.y+o:m.y,k=Math.abs(a),K=Math.abs(o);w(S()(S()({},m),{},{x:I,y:E,width:k,height:K,radius:m.type==="circle"?Math.max(k,K)/2:void 0})),i==null||i()}re(null)}},ke=function(a){if(!u){var o=a.target.getStage();if(o){if(a.target===a.currentTarget){M(null);return}var I=a.target,E=I.id();s||M(E||null)}}},Pe=function(){return oe.map(function(a){var o=G===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;switch(a.type){case"rectangle":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.UL,{id:a.id,x:a.x,y:a.y,width:a.width||0,height:a.height||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){r(a.id,{x:k.target.x(),y:k.target.y(),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"circle":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.Cd,{id:a.id,x:a.x+(a.radius||0),y:a.y+(a.radius||0),radius:a.radius||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){var K=k.target.x(),ce=k.target.y(),ee=a.radius||0,ne=K-ee,se=ce-ee;r(a.id,{x:ne,y:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"ellipse":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.Pj,{id:a.id,x:a.x+(a.width||0)/2,y:a.y+(a.height||0)/2,radiusX:(a.width||0)/2,radiusY:(a.height||0)/2,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){var K=k.target.x(),ce=k.target.y(),ee=a.width||0,ne=a.height||0,se=K-ee/2,de=ce-ne/2;r(a.id,{x:se,y:de,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);default:return null}})},Ue=function(){return p.map(function(a){var o=G===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.x1,{id:a.id,points:a.points,stroke:a.color,strokeWidth:a.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,globalCompositeOperation:a.type==="freehighlight"?"multiply":"source-over",listening:!u,onClick:function(){return!u&&M(a.id)},onTap:function(){return!u&&M(a.id)},draggable:!u,onDragEnd:function(k){var K=k.target.x(),ce=k.target.y();k.target.position({x:0,y:0});for(var ee=xe()(a.points),ne=0;ne<ee.length;ne+=2)ee[ne]+=K,ee[ne+1]+=ce;r(a.id,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(k,K){return K},rotateEnabled:!1})]},a.id)})},Ze=function(){return Y.map(function(a){var o=a.id,I=a.x,E=a.y,k=a.width,K=a.height,ce=a.imageData,ee=a.opacity,ne=G===a.id,se=new window.Image;return se.src=ce,(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.Ee,{id:o,x:I,y:E,width:k,height:K,image:se,opacity:ee,draggable:!u,onClick:function(){return!u&&M(o)},onTap:function(){return!u&&M(o)},onDragEnd:function(ve){r(o,{x:ve.target.x(),y:ve.target.y()})},onTransformEnd:D}),ne&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(ve,De){return De},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},o)})},Oe=function(){if(!y)return null;var a=y.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsx)(me.x1,{points:y.points,stroke:y.color,strokeWidth:y.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:y.opacity,dash:a,perfectDrawEnabled:!1,globalCompositeOperation:y.type==="freehighlight"?"multiply":"source-over",listening:!1})},Ae=function(){if(!m)return null;var a=m.lineStyle==="dashed"?[5,5]:void 0;switch(m.type){case"rectangle":return(0,e.jsx)(me.UL,{x:m.x,y:m.y,width:m.width||0,height:m.height||0,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});case"circle":{var o=m.radius||0;return(0,e.jsx)(me.Cd,{x:m.x+o,y:m.y+o,radius:o,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1})}case"ellipse":return(0,e.jsx)(me.Pj,{x:m.x+(m.width||0)/2,y:m.y+(m.height||0)/2,radiusX:Math.abs(m.width||0)/2,radiusY:Math.abs(m.height||0)/2,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});default:return null}},he=function(){var a;return O==null||(a=O.filter(function(o){return o.pageNumber===t}))===null||a===void 0?void 0:a.map(function(o){var I=G===o.id,E=l*.8,k=na(o.text||"",o.fontSize||16,E,"Arial"),K=o.width&&o.width>20?o.width:k.width/c,ce=o.height&&o.height>20?o.height:k.height/c;return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(me.UL,{id:o.id,x:o.x*c,y:o.y*c,width:K*c,height:ce*c,fill:o.backgroundColor||"#FFFFA0",opacity:.8,cornerRadius:4,stroke:I?"#1890ff":"transparent",strokeWidth:I?2:0,onDblClick:function(){M(o.id),b(!0),H(o)},onDblTap:function(){},draggable:!u,onDragMove:function(ne){var se,de=(se=ne.target.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(de){var ve;de.position({x:ne.target.x()+4*c,y:ne.target.y()+4*c}),(ve=de.getLayer())===null||ve===void 0||ve.batchDraw()}},onDragEnd:function(ne){r(o.id,{x:ne.target.x()/c,y:ne.target.y()/c,width:K,height:ce,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransform:function(ne){var se,de=ne.target,ve=(se=de.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(ve){var De,Ce=de.scaleX(),je=de.scaleY();ve.position({x:de.x()+4*c*Ce,y:de.y()+4*c*je}),ve.width(de.width()*Ce-8*c*Ce),ve.height(de.height()*je-8*c*je),(De=ve.getLayer())===null||De===void 0||De.batchDraw()}},onTransformEnd:D}),(0,e.jsx)(me.xv,{id:"text-".concat(o.id),x:(o.x+4)*c,y:(o.y+4)*c,width:(K-8)*c,height:(ce-8)*c,text:o.text,fontSize:(o.fontSize||16)*c,fontFamily:"Arial",fill:"#333333",wrap:"word",listening:!1}),I&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(ne,se){return se.width<50||se.height<30?ne:se}})]},o.id)})};return(0,v.useEffect)(function(){var le=function(o){(o.key==="Delete"||o.key==="Backspace")&&G&&!u&&(g(G),M(null))};return window.addEventListener("keydown",le),function(){window.removeEventListener("keydown",le)}},[G,g,u]),(0,v.useEffect)(function(){if(G&&L.current&&C.current){var le=C.current.findOne("#".concat(G));if(le){var a=x.find(function(Je){return Je.id===G});if(a&&!["freedraw","freehighlight"].includes(a.type)){var o,I;if((o=L.current)===null||o===void 0||o.nodes([le]),["signature","stamp"].includes(a.type)){var E,k,K;(E=L.current)===null||E===void 0||E.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(k=L.current)===null||k===void 0||k.rotateEnabled(!1),(K=L.current)===null||K===void 0||K.keepRatio(!0)}else if(a.type==="text"){var ce,ee,ne;(ce=L.current)===null||ce===void 0||ce.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(ee=L.current)===null||ee===void 0||ee.rotateEnabled(!1),(ne=L.current)===null||ne===void 0||ne.keepRatio(!1)}else{var se,de,ve;(se=L.current)===null||se===void 0||se.enabledAnchors(["top-left","top-center","top-right","middle-left","middle-right","bottom-left","bottom-center","bottom-right"]),(de=L.current)===null||de===void 0||de.rotateEnabled(!1),(ve=L.current)===null||ve===void 0||ve.keepRatio(a.type==="circle")}(I=L.current)===null||I===void 0||(I=I.getLayer())===null||I===void 0||I.batchDraw()}else{var De,Ce;(De=L.current)===null||De===void 0||De.nodes([]),(Ce=L.current)===null||Ce===void 0||(Ce=Ce.getLayer())===null||Ce===void 0||Ce.batchDraw()}}}else if(L.current){var je,Ee;(je=L.current)===null||je===void 0||je.nodes([]),(Ee=L.current)===null||Ee===void 0||(Ee=Ee.getLayer())===null||Ee===void 0||Ee.batchDraw()}},[G,x]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:u?"none":"auto",zIndex:P},className:"annotation-layer",children:(0,e.jsx)(me.Hf,{ref:C,width:l*c,height:h*c,scale:{x:c,y:c},onClick:ke,onMouseDown:q,onMouseMove:Q,onMouseUp:z,onTouchStart:q,onTouchMove:Q,onTouchEnd:z,style:{position:"absolute",top:0,left:0,pointerEvents:"all"},children:(0,e.jsxs)(me.mh,{ref:fe,children:[Pe(),Ue(),Ze(),he(),Oe(),Ae(),!u&&(0,e.jsx)(me.$T,{ref:L,rotateEnabled:!1,keepRatio:!1,borderDash:[6,2],borderStroke:"#1890ff",anchorStroke:"#1890ff",anchorFill:"#ffffff",anchorSize:8,boundBoxFunc:function(a,o){return o.width<5||o.height<5?a:o}})]})})})},aa=ra,ia=function(n){var t=n.annotations,c=n.currentPage,l=n.pdfLayerRef,h=n.scale,s=n.readOnly,F=s===void 0?!1:s,T=n.handlePageChange,x=n.onAnnotationSelect,U=n.onAnnotationDelete,u=n.onAnnotationUpdate,$=function(g){var i={highlight:"\u9AD8\u4EAE",strikethrough:"\u5220\u9664\u7EBF",underline:"\u4E0B\u5212\u7EBF",rectangle:"\u77E9\u5F62",circle:"\u5706\u5F62",ellipse:"\u692D\u5706",freedraw:"\u81EA\u7531\u7ED8\u5236",freehighlight:"\u81EA\u7531\u9AD8\u4EAE",signature:"\u7B7E\u540D",stamp:"\u76D6\u7AE0",text:"\u6587\u672C"};return i[g]||g},P=function(g,i){u&&u(g,{comment:i})},w=function(g){var i=t.find(function(X){return X.id===g});if(i&&(i.pageNumber!==c&&T(i.pageNumber),l!=null&&l.current)){var b={x:0,y:0,width:100,height:50};if("x"in i&&"y"in i)if(i.type==="circle"){var H=i.radius||0;b.x=i.x*h,b.y=i.y*h,b.width=H*2*h,b.height=H*2*h}else i.type==="ellipse"||i.type,b.x=i.x*h,b.y=i.y*h,"width"in i&&i.width&&(b.width=i.width*h),"height"in i&&i.height&&(b.height=i.height*h);var C=document.createElement("div");if(C.classList.add("annotation-highlight-selected"),C.style.position="absolute",C.style.left="".concat(b.x,"px"),C.style.top="".concat(b.y,"px"),C.style.width="".concat(b.width,"px"),C.style.height="".concat(b.height,"px"),i.type==="circle"||i.type==="ellipse")C.style.borderRadius="50%",C.style.border="2px solid ".concat(i.color||"#ff5500"),C.style.backgroundColor="transparent";else if(i.type==="rectangle")C.style.border="2px solid ".concat(i.color||"#ff5500"),C.style.backgroundColor="transparent";else if(i.type==="freedraw"||i.type==="freehighlight")if("points"in i&&i.points&&i.points.length>0){for(var fe=i.points,L=1/0,R=1/0,J=-1/0,G=-1/0,M=0;M<fe.length;M+=2){var f=fe[M]*h,W=fe[M+1]*h;L=Math.min(L,f),R=Math.min(R,W),J=Math.max(J,f),G=Math.max(G,W)}var V=5;C.style.left="".concat(L-V,"px"),C.style.top="".concat(R-V,"px"),C.style.width="".concat(J-L+V*2,"px"),C.style.height="".concat(G-R+V*2,"px"),C.style.border="2px solid ".concat(i.color||"#ff5500"),C.style.backgroundColor="transparent"}else C.style.transform="scale(1.2)",C.style.transformOrigin="center",C.style.backgroundColor="transparent";else["highlight","strikethrough","underline"].includes(i.type)&&(C.style.height="20px");l.current.appendChild(C);var B=l.current.parentElement;if(B){var A=b.x+parseInt(C.style.width,10)/2,d=b.y+parseInt(C.style.height,10)/2,y=l.current.getBoundingClientRect(),j=B.scrollTop||0,Z=B.scrollLeft||0;B.scrollTo({left:A+Z-y.width/2,top:d+j-y.height/2,behavior:"smooth"})}setTimeout(function(){l.current&&l.current.contains(C)&&l.current.removeChild(C)},3e3),typeof x=="function"&&x(g)}};return(0,e.jsxs)("div",{className:"annotation-list-container-box",children:[(0,e.jsx)("div",{className:"annotation-list-header",children:(0,e.jsxs)("h4",{style:{margin:0},children:["\u6279\u6CE8\u5217\u8868 (\u7B2C ",c," \u9875)"]})}),(0,e.jsx)("div",{className:"annotation-list-content",children:t.length===0?(0,e.jsx)(En.Z,{description:"\u6682\u65E0\u6279\u6CE8"}):(0,e.jsx)("div",{className:"custom-annotation-list",children:t==null?void 0:t.map(function(r){return(0,e.jsxs)("div",{className:"custom-annotation-item",onClick:function(){return w(r.id)},children:[(0,e.jsxs)("div",{className:"annotation-header",children:[(0,e.jsxs)("div",{className:"annotation-type",children:[(0,e.jsx)("span",{className:"annotation-color-block",style:{backgroundColor:r.color}}),$(r.type)]}),!F&&(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(Fn.Z,{}),size:"small",danger:!0,onClick:function(i){i.stopPropagation(),U(r.id)}})]}),(0,e.jsxs)("div",{className:"annotation-date",children:["\u521B\u5EFA: ",(r==null?void 0:r.createdAt)||""]}),"content"in r&&(0,e.jsxs)("div",{className:"annotation-content",children:["\u5185\u5BB9:",(0,e.jsx)(Tn.Z,{title:(r==null?void 0:r.content)||"",children:(0,e.jsx)("span",{className:"annotation-content-text",children:r.content})})]}),(0,e.jsx)("div",{className:"annotation-comment",children:(0,e.jsx)(vt.Z.TextArea,{rows:2,value:r.comment||"",onChange:function(i){var b;return P(r.id,(i==null||(b=i.target)===null||b===void 0?void 0:b.value)||"")},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9...",disabled:F,onClick:function(i){return i.stopPropagation()}})})]},r.id)})})})]})},oa=ia,la=function(n){var t=n.icon,c=n.active,l=c===void 0?!1:c,h=n.disabled,s=h===void 0?!1:h,F=n.onClick;return(0,e.jsx)("div",{className:"annotation-tool-button ".concat(l?"active":""," ").concat(s?"disabled":""),onClick:function(){s||F()},children:(0,e.jsx)("span",{children:t})})},$e=la,sa=function(n){var t=n.activeTool,c=n.activeColor,l=n.activeLineStyle,h=l===void 0?"solid":l,s=n.onToolSelect,F=n.onColorChange,T=n.onLineStyleChange,x=["#FFFF00","#FF0000","#00FF00","#0000FF","#FF00FF","#00FFFF","#FFA500","#000000","#FFFFFF","#888888"],U=function($,P){F(P)};return(0,e.jsx)("div",{className:"annotation-toolbar-box",children:(0,e.jsxs)("div",{className:"annotation-tools",children:[(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Nn.Z,{}),active:t==="highlight",disabled:!0,onClick:function(){return s("highlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u9AD8\u4EAE"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Ln.Z,{}),active:t==="strikethrough",disabled:!0,onClick:function(){return s("strikethrough")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5220\u9664\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Mn.Z,{}),active:t==="underline",disabled:!0,onClick:function(){return s("underline")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u4E0B\u5212\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Zn.Z,{}),active:t==="text",onClick:function(){return s("text")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u6587\u672C"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Bn.Z,{}),active:t==="rectangle",onClick:function(){return s("rectangle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u77E9\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Rn.Z,{style:{transform:"rotate(45deg)"}}),active:t==="circle",onClick:function(){return s("circle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5706\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)($t.Z,{}),active:t==="ellipse",onClick:function(){return s("ellipse")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u692D\u5706"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Yn.Z,{}),active:t==="freedraw",onClick:function(){return s("freedraw")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u7ED8\u5236"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Un.Z,{}),active:t==="freehighlight",onClick:function(){return s("freehighlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u9AD8\u4EAE"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(On.Z,{}),active:t==="signature",onClick:function(){return s("signature")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u7B7E\u540D"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)($t.Z,{style:{color:"#ff4d4f"}}),active:t==="stamp",onClick:function(){return s("stamp")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u76D6\u7AE0"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(In.Z,{}),active:h==="solid",onClick:function(){return T("solid")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5B9E\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Hn.Z,{}),active:h==="dashed",onClick:function(){return T("dashed")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u865A\u7EBF"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsx)("div",{className:"tool-group",children:(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Bt.Z,{value:c,size:"small",className:"color-picker",format:"hex",arrow:!1,placement:"bottomRight",presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:x}],onChange:U}),(0,e.jsx)("span",{className:"tool-name",children:"\u989C\u8272\u9009\u62E9"})]})})]})})},ca=sa,ua=function(n){var t=n.fileUrl,c=n.fileName,l=n.annotations,h=n.currentPage,s=n.numPages,F=n.scale,T=n.sidebarVisible,x=n.readOnly,U=n.pdfLayerRef,u=n.toggleSidebar,$=n.setCurrentPage,P=n.zoomOut,w=n.zoomIn,r=n.onSave,g=(0,v.useState)(!1),i=te()(g,2),b=i[0],H=i[1],C=(0,v.useState)(""),fe=te()(C,2),L=fe[0],R=fe[1],J=function(){var A=ze()(we()().mark(function d(){var y,j,Z,X,m,re;return we()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(p.prev=0,!r){p.next=28;break}if(typeof t!="string"){p.next=26;break}if(!t.startsWith("data:")){p.next=11;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);y=new Blob([X],{type:"application/pdf"}),p.next=24;break;case 11:if(!t.startsWith("http")){p.next=24;break}return p.prev=12,p.next=15,fetch(t);case 15:return re=p.sent,p.next=18,re.blob();case 18:y=p.sent,p.next=24;break;case 21:p.prev=21,p.t0=p.catch(12),console.log("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",p.t0);case 24:p.next=27;break;case 26:(t instanceof Blob||t instanceof File)&&(y=t);case 27:r(l,y);case 28:ie.ZP.success("\u6279\u6CE8\u5DF2\u4FDD\u5B58"),p.next=34;break;case 31:p.prev=31,p.t1=p.catch(0),ie.ZP.error("\u4FDD\u5B58\u6279\u6CE8\u5931\u8D25");case 34:case"end":return p.stop()}},d,null,[[0,31],[12,21]])}));return function(){return A.apply(this,arguments)}}(),G=function(){var A=ze()(we()().mark(function d(y,j){var Z,X,m,re,oe,p,Y,O,D,q,Q,z,ke,Pe,Ue,Ze,Oe;return we()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:if(he.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u5904\u7406PDF\u9875\u9762...",key:y}),U.current){he.next=5;break}return ie.ZP.error({content:"\u65E0\u6CD5\u83B7\u53D6PDF\u5185\u5BB9",key:y}),he.abrupt("return");case 5:return Z=h,X=document.querySelector(".pdf-annotation-main"),m=X||null,re=(m==null?void 0:m.scrollTop)||0,H(!0),R("\u51C6\u5907\u4E2D..."),he.prev=11,he.next=14,N.e(120).then(N.t.bind(N,46020,23));case 14:oe=he.sent,p=oe.default,Y=[],O=1;case 18:if(!(O<=s)){he.next=65;break}return D="\u6B63\u5728\u5904\u7406\u7B2C ".concat(O," \u9875 / \u5171 ").concat(s," \u9875..."),R(D),$(O),he.next=24,new Promise(function(le){setTimeout(function(){le()},1e3)});case 24:if(he.prev=24,q=document.querySelectorAll(".pdf-page-container"),!(!q||q.length===0||!q[O-1])){he.next=29;break}return console.log("\u65E0\u6CD5\u627E\u5230\u7B2C ".concat(O," \u9875\u7684\u5BB9\u5668")),he.abrupt("continue",62);case 29:if(Q=q[O-1],z=Q.querySelector(".react-pdf__Page"),z){he.next=34;break}return console.log("\u65E0\u6CD5\u627E\u5230\u7B2C ".concat(O," \u9875\u7684PDF\u9875\u9762\u5143\u7D20")),he.abrupt("continue",62);case 34:if(ke=z.querySelector("canvas"),ke){he.next=38;break}return console.log("\u7B2C ".concat(O," \u9875\u7684PDF\u753B\u5E03\u672A\u627E\u5230")),he.abrupt("continue",62);case 38:if(Pe=U.current[O],Pe||console.log("\u7B2C ".concat(O," \u9875\u7684\u6279\u6CE8\u5C42\u672A\u627E\u5230")),Ue=document.createElement("canvas"),Ue.width=ke.width,Ue.height=ke.height,Ze=Ue.getContext("2d"),Ze){he.next=47;break}return console.error("\u65E0\u6CD5\u521B\u5EFAcanvas\u4E0A\u4E0B\u6587"),he.abrupt("continue",62);case 47:if(Ze.drawImage(ke,0,0),!Pe){he.next=53;break}return he.next=51,p(Pe,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:null,logging:!0});case 51:Oe=he.sent,Ze.drawImage(Oe,0,0,Ue.width,Ue.height);case 53:Y.push(Ue),he.next=60;break;case 56:return he.prev=56,he.t0=he.catch(24),console.log("\u6355\u83B7\u7B2C ".concat(O," \u9875\u65F6\u51FA\u9519:"),he.t0),he.abrupt("continue",62);case 60:return he.next=62,new Promise(function(le){setTimeout(function(){le()},500)});case 62:O++,he.next=18;break;case 65:return $(Z),m&&(m.scrollTop=re),he.next=69,j(Y);case 69:he.next=75;break;case 71:he.prev=71,he.t1=he.catch(11),console.error("\u5904\u7406PDF\u9875\u9762\u5931\u8D25:",he.t1),ie.ZP.error({content:"\u5904\u7406PDF\u9875\u9762\u5931\u8D25",key:y});case 75:return he.prev=75,H(!1),he.finish(75);case 78:he.next=85;break;case 80:he.prev=80,he.t2=he.catch(0),console.error("\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF:",he.t2),ie.ZP.error({content:"\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:y}),H(!1);case 85:case"end":return he.stop()}},d,null,[[0,80],[11,71,75,78],[24,56]])}));return function(y,j){return A.apply(this,arguments)}}(),M=function(){var A=ze()(we()().mark(function d(){var y,j,Z,X,m,re,oe,p,Y,O,D,q;return we()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(z.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u6253\u5370\u4E2D...",key:"printLoading"}),y=null,typeof t!="string"){z.next=29;break}if(!t.startsWith("data:")){z.next=12;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);y=new Blob([X],{type:"application/pdf"}),z.next=27;break;case 12:if(!t.startsWith("http")){z.next=27;break}return z.prev=13,z.next=16,fetch(t);case 16:return re=z.sent,z.next=19,re.blob();case 19:y=z.sent,z.next=27;break;case 22:return z.prev=22,z.t0=z.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",z.t0),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"printLoading"}),z.abrupt("return");case 27:z.next=30;break;case 29:t instanceof Blob?y=t:t instanceof File&&(y=new Blob([t],{type:t.type}));case 30:if(y){z.next=33;break}return ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"printLoading"}),z.abrupt("return");case 33:oe=URL.createObjectURL(y),p=document.createElement("iframe"),p.style.position="absolute",p.style.width="0px",p.style.height="0px",p.style.border="0",p.style.left="-1000px",document.body.appendChild(p),Y=Date.now(),O=!1,D=!1,q=function ke(){if(!D)try{if(!document.body.contains(p)){D=!0,URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}if(O&&document.hasFocus()&&Date.now()-Y>1e3){D=!0,document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}setTimeout(ke,3e3)}catch(Pe){console.error("\u68C0\u67E5\u6253\u5370\u72B6\u6001\u5931\u8D25:",Pe),document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe)}},p.onload=function(){ie.ZP.success({content:"\u6587\u6863\u5DF2\u51C6\u5907\u597D\uFF0C\u6B63\u5728\u6253\u5F00\u6253\u5370\u5BF9\u8BDD\u6846...",key:"printLoading",duration:2}),setTimeout(function(){try{p.contentWindow?(p.contentWindow.focus(),p.contentWindow.print(),O=!0,setTimeout(q,1e3)):(ie.ZP.error({content:"\u6253\u5370\u5931\u8D25: \u65E0\u6CD5\u8BBF\u95EE\u6253\u5370\u7A97\u53E3",key:"printLoading"}),document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe))}catch(ke){console.error("\u6253\u5370\u5931\u8D25:",ke),document.body.contains(p)&&document.body.removeChild(p),URL.revokeObjectURL(oe),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25",key:"printLoading"})}},800)},p.src=oe,z.next=53;break;case 49:z.prev=49,z.t1=z.catch(0),console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",z.t1),ie.ZP.error({content:"\u6253\u5370\u51C6\u5907\u5931\u8D25",key:"printLoading"});case 53:case"end":return z.stop()}},d,null,[[0,49],[13,22]])}));return function(){return A.apply(this,arguments)}}(),f=function(d){var y;if(d==="original"){M();return}ie.ZP.loading({content:"\u51C6\u5907\u6253\u5370\u5185\u5BB9...",key:"printLoading"});var j=document.createElement("iframe");j.style.position="absolute",j.style.width="0px",j.style.height="0px",j.style.border="0",j.style.left="-1000px",j.style.display="none",document.body.appendChild(j);var Z=(y=j.contentWindow)===null||y===void 0?void 0:y.document;if(!Z){document.body.removeChild(j),ie.ZP.error({content:"\u521B\u5EFA\u6253\u5370\u6846\u67B6\u5931\u8D25",key:"printLoading"});return}Z.open(),Z.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>`.concat(c||"PDF\u6253\u5370",`</title>
          <meta charset="utf-8">
          <style>
            body {
              margin: 0;
              padding: 0;
              font-family: Arial, sans-serif;
            }
            .print-container {
              max-width: 100%;
              margin: 0;
              padding: 0;
            }
            .page-container {
              page-break-after: always;
              margin: 0;
              padding: 0;
              border: none;
              width: 100%;
              box-sizing: border-box;
            }
            .page-container:last-child {
              page-break-after: avoid;
              margin: 0;
            }
            img {
              max-width: 100%;
              display: block;
              width: 100%;
              margin: 0;
              padding: 0;
              box-shadow: none;
              border: none;
            }
            @media print {
              body {
                margin: 0;
                padding: 0;
              }
              .print-container {
                margin: 0;
                padding: 0;
              }
              .page-container {
                width: 100%;
                height: auto;
                page-break-after: always;
                margin: 0;
                padding: 0;
                border: none;
              }
              @page {
                margin: 0.5cm;
                size: auto;
              }
            }
          </style>
        </head>
        <body>
          <div class="print-container" id="print-container">
            <!-- \u9875\u9762\u5185\u5BB9\u5C06\u52A8\u6001\u63D2\u5165\u8FD9\u91CC -->
          </div>
        </body>
      </html>
    `)),Z.close();var X=Z.getElementById("print-container");if(!X){document.body.removeChild(j),ie.ZP.error({content:"\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25",key:"printLoading"});return}G("printLoading",function(){var m=ze()(we()().mark(function re(oe){return we()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(Y.prev=0,oe.length!==0){Y.next=5;break}return ie.ZP.error({content:"\u65E0\u6CD5\u6355\u83B7PDF\u9875\u9762",key:"printLoading"}),document.body.removeChild(j),Y.abrupt("return");case 5:oe.forEach(function(O,D){var q=Z.createElement("div");q.className="page-container",q.style.margin="0 auto";var Q=Z.createElement("img");Q.src=O.toDataURL("image/png",.95),Q.style.width="100%",Q.style.maxWidth="100%",Q.alt="\u9875\u9762 ".concat(D+1),q.appendChild(Q),X.appendChild(q)}),ie.ZP.success({content:"\u6253\u5370\u51C6\u5907\u5B8C\u6210\uFF0C\u6B63\u5728\u6253\u5F00\u6253\u5370\u5BF9\u8BDD\u6846...",key:"printLoading",duration:1}),setTimeout(function(){try{var O,D;(O=j.contentWindow)===null||O===void 0||O.focus(),(D=j.contentWindow)===null||D===void 0||D.print();var q=function(){document.body.contains(j)&&setTimeout(function(){document.body.contains(j)&&document.body.removeChild(j)},3e3)};if(j.contentWindow)if(j.contentWindow.matchMedia){var Q=j.contentWindow.matchMedia("print");Q.addEventListener("change",function(z){!z.matches&&document.body.contains(j)&&document.body.removeChild(j)})}else q();else q()}catch(z){console.error("\u6253\u5370\u8C03\u7528\u5931\u8D25:",z),document.body.contains(j)&&document.body.removeChild(j),ie.ZP.error({content:"\u6253\u5370\u8C03\u7528\u5931\u8D25",key:"printLoading"})}},500),Y.next=15;break;case 10:Y.prev=10,Y.t0=Y.catch(0),console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",Y.t0),document.body.contains(j)&&document.body.removeChild(j),ie.ZP.error({content:"\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25",key:"printLoading"});case 15:case"end":return Y.stop()}},re,null,[[0,10]])}));return function(re){return m.apply(this,arguments)}}())},W=function(){var A=ze()(we()().mark(function d(){return we()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:ie.ZP.loading({content:"\u6B63\u5728\u51C6\u5907\u4E0B\u8F7D...",key:"downloadLoading"}),G("downloadLoading",function(){var Z=ze()(we()().mark(function X(m){var re,oe,p,Y,O,D,q,Q,z,ke,Pe,Ue,Ze;return we()().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:if(Ae.prev=0,m.length!==0){Ae.next=4;break}return ie.ZP.error({content:"\u65E0\u6CD5\u6355\u83B7PDF\u9875\u9762",key:"downloadLoading"}),Ae.abrupt("return");case 4:return Ae.next=6,N.e(730).then(N.bind(N,84730));case 6:for(re=Ae.sent,oe=re.default,p=m[0],Y=p.width,O=p.height,D=Y>O?"landscape":"portrait",q=new oe({orientation:D,unit:"px",format:[Y,O],compress:!0,hotfixes:["px_scaling"],putOnlyUsedFonts:!0,floatPrecision:"smart"}),Q=.8,z="JPEG",ke=0;ke<m.length;ke++)Pe=m[ke],Ue=Pe.toDataURL("image/".concat(z.toLowerCase()),Q),ke>0&&q.addPage([Y,O]),q.addImage(Ue,z,0,0,Y,O,"page-".concat(ke+1),"FAST"),ie.ZP.loading({content:"\u6B63\u5728\u5904\u7406\u7B2C ".concat(ke+1," \u9875\uFF0C\u5171 ").concat(m.length," \u9875..."),key:"downloadLoading"});Ze=c||"document-with-annotations.pdf",Ze.toLowerCase().endsWith(".pdf")||(Ze+=".pdf");try{q.save(Ze),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"})}catch(he){console.error("\u4FDD\u5B58PDF\u6587\u4EF6\u5931\u8D25:",he),ie.ZP.error({content:"\u4FDD\u5B58PDF\u6587\u4EF6\u5931\u8D25",key:"downloadLoading"})}Ae.next=25;break;case 21:Ae.prev=21,Ae.t0=Ae.catch(0),console.error("\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25:",Ae.t0),ie.ZP.error({content:"\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25",key:"downloadLoading"});case 25:case"end":return Ae.stop()}},X,null,[[0,21]])}));return function(X){return Z.apply(this,arguments)}}()).catch(function(Z){console.error("\u6355\u83B7PDF\u5931\u8D25:",Z),ie.ZP.error({content:"\u6355\u83B7PDF\u5931\u8D25",key:"downloadLoading"})});case 2:case"end":return j.stop()}},d)}));return function(){return A.apply(this,arguments)}}(),V=function(){var A=ze()(we()().mark(function d(){var y,j,Z,X,m,re,oe,p,Y,O,D;return we()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(Q.prev=0,y=null,j=c||"document.pdf",typeof t!="string"){Q.next=30;break}if(!t.startsWith("data:")){Q.next=12;break}for(Z=t.split(",")[1],X=atob(Z),m=new Uint8Array(X.length),re=0;re<X.length;re++)m[re]=X.charCodeAt(re);y=new Blob([m],{type:"application/pdf"}),Q.next=28;break;case 12:if(!t.startsWith("http")){Q.next=28;break}return Q.prev=13,Q.next=16,fetch(t);case 16:return oe=Q.sent,Q.next=19,oe.blob();case 19:y=Q.sent,c||(p=t.split("/"),Y=p[p.length-1],Y&&Y.includes(".pdf")&&(j=Y)),Q.next=28;break;case 23:return Q.prev=23,Q.t0=Q.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",Q.t0),ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"downloadLoading"}),Q.abrupt("return");case 28:Q.next=31;break;case 30:t instanceof Blob?y=t:t instanceof File&&(y=new Blob([t],{type:t.type}),c||(j=t.name));case 31:if(y){Q.next=34;break}return ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"downloadLoading"}),Q.abrupt("return");case 34:O=URL.createObjectURL(y),D=document.createElement("a"),D.href=O,D.download=j,document.body.appendChild(D),D.click(),setTimeout(function(){document.body.removeChild(D),URL.revokeObjectURL(O),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"})},100),Q.next=47;break;case 43:Q.prev=43,Q.t1=Q.catch(0),console.error("\u4E0B\u8F7D\u539F\u59CBPDF\u5931\u8D25:",Q.t1),ie.ZP.error({content:"\u4E0B\u8F7D\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:"downloadLoading"});case 47:case"end":return Q.stop()}},d,null,[[0,43],[13,23]])}));return function(){return A.apply(this,arguments)}}(),B=function(d){rt.Z.info({title:d==="print"?"\u9009\u62E9\u6253\u5370\u7C7B\u578B":"\u9009\u62E9\u4E0B\u8F7D\u7C7B\u578B",icon:null,centered:!0,okText:"\u53D6\u6D88",content:(0,e.jsxs)("div",{className:"download-options",style:{marginTop:16,display:"flex",justifyContent:"center"},children:[l!=null&&l.length?(0,e.jsx)(ye.ZP,{type:"primary",style:{marginRight:16,height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){f("with-annotations");return}W()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u5E26\u6279\u6CE8\u7684PDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u5305\u542B\u6240\u6709\u6279\u6CE8\u6807\u8BB0)"})]})}):null,(0,e.jsx)(ye.ZP,{type:"primary",style:{height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){f("original");return}V()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u539F\u59CBPDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u4E0D\u542B\u6279\u6CE8)"})]})})]}),width:500})};return(0,e.jsxs)(e.Fragment,{children:[b&&(0,e.jsxs)("div",{className:"pdf-print-mask-box",children:[(0,e.jsx)("div",{className:"print-message",children:"\u6B63\u5728\u5904\u7406PDF\u6587\u4EF6\uFF0C\u8BF7\u52FF\u5173\u95ED\u6216\u64CD\u4F5C\u9875\u9762"}),(0,e.jsx)("div",{className:"print-progress",children:L})]}),(0,e.jsx)("div",{className:"pdf-annotation-header-box",children:(0,e.jsxs)("div",{className:"pdf-annotation-actions",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-sidebar",style:{cursor:"pointer"},onClick:function(){return u(!T)},children:T?(0,e.jsx)(on.Z,{className:"actions-sidebar-menu"}):(0,e.jsx)(an.Z,{className:"actions-sidebar-menu"})}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-option",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-page",children:"".concat(h," / ").concat(s)}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"pdf-annotation-actions-divider"}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-zoom",children:[(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(ln.Z,{}),onClick:P}),(0,e.jsxs)("span",{style:{margin:"0 8px"},children:[Math.round(F*100),"%"]}),(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(sn.Z,{}),onClick:w})]})]}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-save",children:[x?null:(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(zn.Z,{}),type:"text",onClick:J}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(cn.Z,{}),type:"text",onClick:function(){return B("download")}}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(Wn.Z,{}),type:"text",onClick:function(){return B("print")}})]})]})})]})},da=ua,en=new Set,ha=function(n){if(!en.has(n)){var t=n.querySelectorAll(".react-pdf__Page__textContent span, .react-pdf__Page__textContent div");t.forEach(function(s){var F=s;F.style.userSelect="text",F.style.webkitUserSelect="text",F.style.mozUserSelect="text",F.style.msUserSelect="text",F.style.cursor="text",F.style.position="relative",F.style.zIndex="2",F.style.color=F.style.color||"inherit",F.style.pointerEvents="auto"});var c=n.querySelectorAll("p, span, div:not(.konvajs-content):not([data-highlight-id])");c.forEach(function(s){var F=s;F.style.cursor="text",F.style.userSelect="text"});var l=n.querySelector(".react-pdf__Page__textContent");if(l){var h=l;h.style.userSelect="text",h.style.webkitUserSelect="text",h.style.mozUserSelect="text",h.style.msUserSelect="text",h.style.zIndex="2",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.right="0",h.style.bottom="0",h.style.pointerEvents="auto"}en.add(n)}},va=function(n){var t=n.pageNumber,c=n.scale,l=n.activeTool,h=n.activeColor,s=n.pdfLayerRef,F=n.annotations,T=n.onAnnotationAdd,x=n.onAnnotationRemove,U=n.onToolReset,u=n.readOnly,$=u===void 0?!1:u,P=n.zIndex,w=P===void 0?6:P,r=(0,v.useRef)(null),g=(0,v.useState)(!1),i=te()(g,2),b=i[0],H=i[1],C=(0,v.useState)(),fe=te()(C,2),L=fe[1],R=(0,v.useCallback)(function(){return L({})},[]);(0,v.useEffect)(function(){if(s.current){en.has(s.current)&&en.delete(s.current);var M=s.current.querySelectorAll(".web-highlighter-wrapper, [data-highlight-id]");M.forEach(function(W){try{W.remove()}catch(V){console.error("\u6E05\u7406\u73B0\u6709\u9AD8\u4EAE\u5931\u8D25:",V)}}),ha(s.current);try{if(r.current)try{r.current.dispose()}catch(W){console.error("\u6E05\u7406\u65E7\u9AD8\u4EAE\u5668\u5B9E\u4F8B\u5931\u8D25:",W)}var f=new(Vn())({$root:s.current,exceptSelectors:["canvas",".konvajs-content",".annotation-layer","[data-highlight-id]",".text-selection-preview"],wrapTag:"span",style:{className:"web-highlighter-selection",style:{display:"inline"}}});f.includeSelector=[".react-pdf__Page__textContent"],f.devicePixelRatio=window.devicePixelRatio||1,r.current=f,r.current.run()}catch(W){console.error("\u521D\u59CB\u5316web-highlighter\u5931\u8D25:",W)}return function(){if(r.current)try{r.current.dispose(),r.current=null}catch(W){console.error("\u6E05\u7406\u9AD8\u4EAE\u5668\u5931\u8D25:",W)}}}},[s,t]);var J=function(f,W,V){setTimeout(function(){try{var B=document.querySelectorAll('[data-highlight-id="'.concat(f,'"], .web-highlighter-selection[data-highlight-source="').concat(f,'"]'));B&&B.length>0&&B.forEach(function(A){var d=A;d.style.display="inline",d.style.position="relative",d.style.zIndex="5",d.style.pointerEvents="auto",W==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):W==="underline"?(d.style.textDecoration="underline",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):W==="highlight"&&(d.style.backgroundColor=V,d.style.opacity="0.3",d.style.mixBlendMode="multiply"),d.classList.add("pdf-text-".concat(W))})}catch(A){console.error("\u5E94\u7528\u6837\u5F0F\u5931\u8D25:",A)}},50)},G=function(){if(s.current){var f=s.current.querySelectorAll("[data-highlight-id]"),W=new Map;f.forEach(function(V){var B=V.getAttribute("data-highlight-id");if(B)if(W.has(B))try{V.remove()}catch(A){console.error("\u6E05\u7406\u91CD\u590D\u9AD8\u4EAE\u5931\u8D25:",A)}else W.set(B,!0)})}};return(0,v.useEffect)(function(){if(!(!r.current||$)){var M=function(V){var B=V.sources;if(!(!l||!B||B.length===0)){var A=B[0],d={id:A.id||Date.now().toString(),type:l,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:h,opacity:l==="highlight"?.3:1,text:A.text||"",rects:A.rects||[],highlightId:A.id};T(d),H(!1),J(A.id,l,h),R(),G(),U==null||U()}},f=function(V){var B=V.id;l||window.confirm("\u662F\u5426\u5220\u9664\u6B64\u6279\u6CE8\uFF1F")&&(r.current&&r.current.remove(B),x(B))};return r.current.on("selection:create",M),r.current.on("click",f),function(){r.current&&(r.current.off("selection:create",M),r.current.off("click",f))}}},[l,h,t,T,x,$,R,U]),(0,v.useEffect)(function(){if(!(!r.current||$)){var M=function(){var V;if(l){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var A=B.getRangeAt(0);(V=s.current)!==null&&V!==void 0&&V.contains(A.commonAncestorContainer)&&H(!0)}}},f=function(){var V;if(!(!l||!r.current)){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var A=B.getRangeAt(0);if((V=s.current)!==null&&V!==void 0&&V.contains(A.commonAncestorContainer)&&!b){var d=B.toString().trim();if(d){var y={className:"pdf-text-".concat(l)};switch(l){case"highlight":y=S()(S()({},y),{},{backgroundColor:h,opacity:.3,mixBlendMode:"multiply"});break;case"strikethrough":y=S()(S()({},y),{},{textDecoration:"line-through",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break;case"underline":y=S()(S()({},y),{},{textDecoration:"underline",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break}H(!0);try{if(typeof r.current.highlightSelection=="function"){var j,Z=r.current.highlightSelection(y);J(Z,l,h),(j=window.getSelection())===null||j===void 0||j.removeAllRanges(),R(),H(!1),G(),U==null||U()}}catch(X){console.error("\u9AD8\u4EAE\u9009\u533A\u5931\u8D25:",X),H(!1)}}}}}};return document.addEventListener("selectionchange",M),document.addEventListener("mouseup",f),function(){document.removeEventListener("selectionchange",M),document.removeEventListener("mouseup",f)}}},[l,h,s,$,R,b,U]),(0,v.useEffect)(function(){if(!(!r.current||!s.current)){G();var M=F.filter(function(f){return["highlight","strikethrough","underline"].includes(f.type)&&f.pageNumber===t});M.length!==0&&(M.forEach(function(f){try{if(!r.current||!s.current)return;var W=s.current.querySelector('[data-highlight-id="'.concat(f.id,'"]'));if(W){J(f.id,f.type,f.color);return}var V=f;if(typeof r.current.fromStore=="function"&&V.startMeta&&V.endMeta){var B=r.current.fromStore(V.startMeta,V.endMeta,f.text,f.id);J(B,f.type,f.color)}else f.rects&&f.rects.length>0&&f.rects.forEach(function(A){var d=document.createElement("span");d.className="web-highlighter-selection pdf-text-".concat(f.type),d.setAttribute("data-highlight-id",f.id),d.style.position="absolute",d.style.left="".concat(A.x*c,"px"),d.style.top="".concat(A.y*c,"px"),d.style.width="".concat(A.width*c,"px"),d.style.height="".concat(A.height*c,"px"),d.style.zIndex="5",f.type==="highlight"?(d.style.backgroundColor=f.color,d.style.opacity="0.3",d.style.mixBlendMode="multiply"):f.type==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=f.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):f.type==="underline"&&(d.style.textDecoration="underline",d.style.textDecorationColor=f.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"),s.current&&s.current.appendChild(d)})}catch(A){console.error("\u6062\u590D\u6279\u6CE8\u5931\u8D25:",A,f)}}),G())}},[F,t,s,c,R]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:$?"none":"auto",zIndex:w},className:"highlighter-layer-box",children:(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:$||!l?"none":"auto",zIndex:w+1,cursor:l?"text":"default"},className:"text-selection-layer"})})},fa=va,ga=Gn.Z.Dragger,pa=function(n){var t=n.type,c=n.visible,l=n.onSave,h=n.onCancel,s=(0,v.useState)([]),F=te()(s,2),T=F[0],x=F[1],U=(0,v.useState)(!1),u=te()(U,2),$=u[0],P=u[1],w=(0,v.useState)(null),r=te()(w,2),g=r[0],i=r[1],b=(0,v.useState)(t==="signature"?"#000000":"#ff0000"),H=te()(b,2),C=H[0],fe=H[1],L=(0,v.useState)(t==="signature"?2:4),R=te()(L,2),J=R[0],G=R[1],M=(0,v.useRef)(null),f=400,W=200,V=function(Y){P(!0);var O=Y.target.getStage().getPointerPosition();x([].concat(xe()(T),[{points:[O.x,O.y],stroke:C,strokeWidth:J}]))},B=function(Y){if($){var O=Y.target.getStage(),D=O.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),x([].concat(xe()(T.slice(0,-1)),[q]))}},A=function(){P(!1)},d=function(Y){Y.evt.preventDefault();var O=Y.target.getStage(),D=O.getPointerPosition();P(!0),x([].concat(xe()(T),[{points:[D.x,D.y],stroke:C,strokeWidth:J}]))},y=function(Y){if(Y.evt.preventDefault(),!!$){var O=Y.target.getStage(),D=O.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),x([].concat(xe()(T.slice(0,-1)),[q]))}},j=function(Y){Y.evt.preventDefault(),P(!1)},Z=function(){x([]),i(null)},X=function(){if(g){l(g);return}if(T.length===0){ie.ZP.warning("\u8BF7\u5148\u7ED8\u5236\u6216\u4E0A\u4F20\u56FE\u50CF");return}if(M.current){var Y=M.current.toDataURL();l(Y)}},m=function(Y,O){fe(O)},re=t==="signature"?["#000000","#0000FF","#FF0000","#008000"]:["#FF0000","#0000FF","#800000","#FF8C00"],oe=[{key:"draw",label:"\u624B\u7ED8",children:(0,e.jsxs)("div",{className:"signature-canvas-container",children:[(0,e.jsx)(me.Hf,{width:f,height:W,ref:M,onMouseDown:V,onMouseMove:B,onMouseUp:A,onTouchStart:d,onTouchMove:y,onTouchEnd:j,style:{border:"1px solid #ddd",borderRadius:4,background:"#fff"},children:(0,e.jsx)(me.mh,{children:T.map(function(p,Y){return(0,e.jsx)(me.x1,{points:p.points,stroke:p.stroke,strokeWidth:p.strokeWidth,tension:.5,lineCap:"round",lineJoin:"round"},Y)})})}),(0,e.jsxs)("div",{className:"signature-controls",children:[(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u989C\u8272:"}),(0,e.jsx)(Bt.Z,{value:C,onChange:m,presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:re}],size:"small",format:"hex"})]}),(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,e.jsx)("div",{className:"stroke-width-control",children:(0,e.jsxs)(Ve.ZP.Group,{value:J,onChange:function(Y){return G(Y.target.value)},buttonStyle:"solid",size:"small",children:[(0,e.jsx)(Ve.ZP.Button,{value:1,children:"\u7EC6"}),(0,e.jsx)(Ve.ZP.Button,{value:3,children:"\u4E2D"}),(0,e.jsx)(Ve.ZP.Button,{value:5,children:"\u7C97"})]})})]}),(0,e.jsxs)("div",{className:"action-buttons",children:[(0,e.jsx)(ye.ZP,{size:"middle",onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{size:"middle",type:"primary",onClick:X,children:"\u4FDD\u5B58"})]})]})]})},{key:"upload",label:"\u4E0A\u4F20",children:g?(0,e.jsxs)("div",{style:{textAlign:"center"},children:[(0,e.jsx)("img",{src:g,alt:"\u4E0A\u4F20\u7684\u56FE\u7247",style:{maxWidth:"100%",maxHeight:200,marginBottom:16,border:"1px solid #ddd",borderRadius:4}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ye.ZP,{onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{type:"primary",onClick:X,children:"\u4F7F\u7528\u6B64\u56FE\u7247"})]})]}):(0,e.jsxs)(ga,{accept:".png,.jpg,.jpeg",showUploadList:!1,beforeUpload:function(Y){var O=new FileReader;return O.onload=function(D){var q;(q=D.target)!==null&&q!==void 0&&q.result&&i(D.target.result)},O.readAsDataURL(Y),!1},multiple:!1,children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(Kn.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u5230\u6B64\u533A\u57DF\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u652F\u6301\u5355\u4E2A\u56FE\u7247\u4E0A\u4F20\uFF0C\u63A8\u8350\u4F7F\u7528\u900F\u660E\u80CC\u666F\u7684PNG\u56FE\u7247"})]})}];return(0,e.jsx)(rt.Z,{title:t==="signature"?"\u6DFB\u52A0\u7B7E\u540D":"\u6DFB\u52A0\u76D6\u7AE0",open:c,onCancel:h,footer:null,width:500,children:(0,e.jsx)(Qt.Z,{defaultActiveKey:"draw",items:oe})})},ma=pa,ya=function(n){var t=n.onSave,c=n.onCancel,l=n.visible,h=n.curTextNotePanelData,s=h===void 0?{}:h,F=Ye.Z.useForm(),T=te()(F,1),x=T[0],U=Ye.Z.useWatch(["backgroundColor"],x),u=["#FFFFA0","#A0E7E5","#FFC0CB","#FFCBA4","#D3D3D3","#C1FFC1","#FFFFFF"];(0,v.useEffect)(function(){l&&x.setFieldsValue({text:(s==null?void 0:s.text)||"",fontSize:(s==null?void 0:s.fontSize)||12,backgroundColor:(s==null?void 0:s.backgroundColor)||"#FFFFA0"})},[l,s]);var $=function(w){var r=w.text,g=w.fontSize,i=w.backgroundColor;t(r,g,i)};return(0,e.jsx)(rt.Z,{title:"\u6DFB\u52A0\u6587\u672C\u6279\u6CE8",open:l,onCancel:c,footer:[(0,e.jsx)(ye.ZP,{onClick:c,children:"\u53D6\u6D88"},"cancel"),(0,e.jsx)(ye.ZP,{type:"primary",onClick:function(){return x.submit()},children:"\u6DFB\u52A0\u6279\u6CE8"},"save")],width:500,children:(0,e.jsxs)(Ye.Z,{form:x,layout:"vertical",onFinish:$,children:[(0,e.jsx)(Ye.Z.Item,{name:"text",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C"}],children:(0,e.jsx)(vt.Z.TextArea,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C...",autoFocus:!0,style:{padding:"8px",borderRadius:"4px",backgroundColor:U}})}),(0,e.jsx)(Ye.Z.Item,{label:"\u5B57\u4F53\u5927\u5C0F",name:"fontSize",children:(0,e.jsx)(at.Z,{min:1,max:100,style:{width:"200px"},addonAfter:"px"})}),(0,e.jsx)(Ye.Z.Item,{label:"\u80CC\u666F\u989C\u8272",name:"backgroundColor",children:(0,e.jsx)(Bt.Z,{presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:u}],size:"middle",format:"hex",onChange:function(w){var r;x.setFieldValue("backgroundColor",w==null||(r=w.toHexString)===null||r===void 0?void 0:r.call(w))}})})]})})},xa=ya,ba=function(n){var t=n.fileUrl,c=n.numPages,l=n.currentPage,h=n.onPageChange,s=(0,v.useRef)(null),F=(0,v.useState)([]),T=te()(F,2),x=T[0],U=T[1],u=(0,v.useState)(!1),$=te()(u,2),P=$[0],w=$[1],r=(0,v.useState)(!1),g=te()(r,2),i=g[0],b=g[1],H=function(){w(!0);for(var J=[],G=1;G<=Math.min(c,20);G++)J.push(G);U(J),setTimeout(function(){return b(!0)},500)},C=(0,v.useCallback)(function(){if(!(!s.current||c===0||!i)){for(var R=s.current,J=R.scrollTop,G=R.clientHeight,M=5,f=150,W=Math.max(1,Math.floor(J/f)-M),V=Math.min(c,Math.ceil((J+G)/f)+M),B=[],A=W;A<=V;A++)B.push(A);!B.includes(l)&&l<=c&&B.push(l),U(B)}},[c,l,i]),fe=(0,v.useCallback)(function(R){R!==l&&h(R)},[l,h]);(0,v.useEffect)(function(){if(!(!s.current||!i)){C();var R=s.current,J=function(){requestAnimationFrame(C)};return R.addEventListener("scroll",J),function(){R==null||R.removeEventListener("scroll",J)}}},[C,i]),(0,v.useEffect)(function(){if(s.current&&l&&P&&i){var R=150,J=(l-1)*R,G=s.current,M=G.scrollTop,f=G.clientHeight;(J<M||J>M+f-R)&&G.scrollTo({top:J-f/2+R/2,behavior:"smooth"})}},[l,P,i]);var L=function(){if(!P)return(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7DPDF\u7F29\u7565\u56FE..."});for(var J=[],G=function(W){var V=x.includes(W);J.push((0,e.jsxs)("div",{className:"thumbnail-item ".concat(W===l?"active":""),onClick:function(){return fe(W)},style:{cursor:"pointer"},children:[(0,e.jsx)("div",{className:"thumbnail-page-number",children:W}),(0,e.jsx)("div",{className:"thumbnail-container",children:V&&(0,e.jsx)(Zt.Z,{pageNumber:W,width:100,renderTextLayer:!1,renderAnnotationLayer:!1,loading:null})})]},W))},M=1;M<=c;M++)G(M);return J.push((0,e.jsx)("div",{style:{height:"20px",flexShrink:0}},"bottom-space")),J};return(0,e.jsx)("div",{className:"thumbnail-preview-box",children:(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:H,loading:(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7D\u6587\u6863\u4E2D..."}),error:(0,e.jsx)("div",{className:"thumbnail-error",children:"PDF\u52A0\u8F7D\u5931\u8D25"}),children:(0,e.jsx)("div",{className:"thumbnail-list",ref:s,children:L()})})})},Ca=ba;Dn().showWarnings=!1;var tn={BASE:6,TOP:9};Lt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Lt.i8,"/pdf.worker.min.mjs");var Sa=function(n){var t=n.fileUrl,c=n.fileName,l=n.readOnly,h=l===void 0?!1:l,s=n.style,F=s===void 0?{}:s,T=n.className,x=T===void 0?"":T,U=n.annotationList,u=U===void 0?[]:U,$=n.onSave,P=(0,v.useState)(0),w=te()(P,2),r=w[0],g=w[1],i=(0,v.useState)(1),b=te()(i,2),H=b[0],C=b[1],fe=(0,v.useState)(1),L=te()(fe,2),R=L[0],J=L[1],G=(0,v.useState)({width:0,height:0}),M=te()(G,2),f=M[0],W=M[1],V=(0,v.useState)(null),B=te()(V,2),A=B[0],d=B[1],y=(0,v.useState)("#FFFF00"),j=te()(y,2),Z=j[0],X=j[1],m=(0,v.useState)("solid"),re=te()(m,2),oe=re[0],p=re[1],Y=(0,v.useState)(!1),O=te()(Y,2),D=O[0],q=O[1],Q=(0,v.useState)(!1),z=te()(Q,2),ke=z[0],Pe=z[1],Ue=(0,v.useState)({}),Ze=te()(Ue,2),Oe=Ze[0],Ae=Ze[1],he=(0,v.useState)("thumbnails"),le=te()(he,2),a=le[0],o=le[1],I=(0,v.useState)(!0),E=te()(I,2),k=E[0],K=E[1],ce=(0,v.useRef)(null),ee=(0,v.useRef)({}),ne=(0,v.useRef)({}),se=(0,v.useRef)(null),de=ta(u),ve=de.annotations,De=de.addAnnotation,Ce=de.updateAnnotation,je=de.removeAnnotation,Ee=function(){var _=[".highlight-container","[data-highlight-id]",".custom-pdf-highlight",".web-highlighter-selection",".web-highlighter-wrapper"];_.forEach(function(be){document.querySelectorAll(be).forEach(function(Se){try{if(Se.textContent)if(Se.parentNode&&Se.parentNode!==document.body){var Fe=Se.textContent,Le=document.createTextNode(Fe);Se.parentNode.replaceChild(Le,Se)}else Se.remove();else Se.remove()}catch(Me){console.error("\u6E05\u7406\u9AD8\u4EAE\u5143\u7D20\u5931\u8D25:",Me)}})});try{document.querySelectorAll("style[data-highlight-style]").forEach(function(be){be.remove()});var ge=document.querySelector(".react-pdf__Page__textContent");ge&&ge.querySelectorAll("span, div").forEach(function(be){be.style.userSelect="text",be.style.webkitUserSelect="text",be.style.pointerEvents="auto"})}catch(be){console.error("\u6E05\u7406web-highlighter\u5143\u7D20\u5931\u8D25:",be)}},Je=(0,v.useCallback)(function(){if(!(!se.current||!ne.current)){var ue=se.current,_=ue.scrollTop,ge=H,be=1/0;Object.entries(ne.current).forEach(function(Se){var Fe=te()(Se,2),Le=Fe[0],Me=Fe[1];if(Me){var tt=Me.offsetTop,Ie=Math.abs(tt-_);Ie<be&&(be=Ie,ge=parseInt(Le))}}),ge!==H&&C(ge)}},[H]);(0,v.useEffect)(function(){var ue=se.current;if(ue){var _=!1,ge=function(){_||(requestAnimationFrame(function(){Je(),_=!1}),_=!0)};return ue.addEventListener("scroll",ge,{passive:!0}),function(){ue.removeEventListener("scroll",ge)}}},[Je]);var gt=(0,v.useCallback)(function(ue){ee.current&&Ee(),C(ue);var _=ne.current[ue];_&&se.current&&se.current.scrollTo({top:_.offsetTop,behavior:"smooth"})},[]),yt=function(_){var ge=_.numPages;g(ge)},lt=function(_){var ge=_.getViewport({scale:1});W({width:ge.width,height:ge.height})},st=function(_){p(_)},xt=function(_){d(_),(_==="signature"||_==="stamp")&&q(!0),_==="text"&&(Pe(!0),Ae({}))},bt=function(_,ge){!f.width||!f.height||(De({id:"add-"+et(),type:ge,pageNumber:H,x:f.width/4,y:f.height/4,width:f.width/2,height:ge==="signature"?f.height/8:f.width/4,imageData:_,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#000000",opacity:1}),q(!1),d(null))},Ct=function(_,ge,be){if(!(!f.width||!f.height)){var Se=function(At,qe){var ct=document.createElement("canvas"),We=ct.getContext("2d");if(!We)return{width:200,height:100};We.font="".concat(qe,"px Arial");for(var ut=f.width*.8,dt=At.split(""),Re=[],Te="",He=0;He<dt.length;He++){var It=dt[He],Ht=Te+It,dn=We.measureText(Ht);dn.width>ut&&Te.length>0?(Re.push(Te),Te=It):Te=Ht}Te.length>0&&Re.push(Te);for(var hn=qe*1.5,vn=Math.max(Re.length*hn+16,40),Pt=0,Ft=0,zt=Re;Ft<zt.length;Ft++){var fn=zt[Ft],gn=We.measureText(fn).width;Pt=Math.max(Pt,gn)}return{width:Math.min(Math.max(Pt+16,100),ut),height:vn}};if(Oe!=null&&Oe.id){var Fe=Se(_,ge),Le=Fe.width,Me=Fe.height;Ce(Oe.id,{text:_,fontSize:ge,backgroundColor:be,width:Le,height:Me,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})}else{var tt=Se(_,ge),Ie=tt.width,kt=tt.height,wt={id:"add-"+et(),type:"text",pageNumber:H,x:(f.width-Ie)/2,y:f.height/4,width:Ie,height:kt,text:_,fontSize:ge,backgroundColor:be,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#333333",opacity:1};De(wt)}Pe(!1),d(null),Ae({})}},St=function(){return J(R*1.2)},pt=function(){return J(R/1.2)},jt=function(){K(!k)},Dt=function(_){["rectangle","circle","ellipse","freedraw","freehighlight"].includes(_.type)?De(S()(S()({},_),{},{lineStyle:oe})):De(_)},mt=(0,v.useCallback)(function(ue){return{current:ee.current[ue]||null}},[]),Be=function(){for(var _=[],ge=function(Fe){_.push((0,e.jsxs)("div",{className:"pdf-page-container",style:{position:"relative",marginBottom:"10px"},ref:function(Me){Me&&(ne.current[Fe]=Me)},children:[(0,e.jsx)(Zt.Z,{pageNumber:Fe,width:f.width,scale:R,renderTextLayer:!0,renderAnnotationLayer:!1,onLoadSuccess:function(Me){return lt(Me)},loading:null}),(0,e.jsxs)("div",{ref:function(Me){Me&&(ee.current[Fe]=Me)},className:"pdf-layer",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[(0,e.jsx)(fa,{pageNumber:Fe,scale:R,activeTool:["highlight","strikethrough","underline"].includes(A)?A:null,activeColor:Z,pdfLayerRef:mt(Fe),annotations:ve.filter(function(Le){return Le.pageNumber===Fe}),onAnnotationAdd:De,onAnnotationRemove:je,onAnnotationUpdate:Ce,onToolReset:function(){return d(null)},readOnly:h,zIndex:["highlight","strikethrough","underline"].includes(A)?tn.TOP:tn.BASE}),(0,e.jsx)(aa,{pageNumber:Fe,scale:R,width:f.width,height:f.height,activeTool:["highlight","strikethrough","underline"].includes(A)?null:A,activeColor:Z,activeLineStyle:oe,annotations:ve.filter(function(Le){return Le.pageNumber===Fe}),readOnly:h,zIndex:["highlight","strikethrough","underline"].includes(A)?tn.BASE:tn.TOP,onAnnotationAdd:Dt,onAnnotationUpdate:Ce,onAnnotationRemove:je,onToolReset:function(){return d(null)},setShowTextNotePanel:Pe,setTextNotePanelData:Ae})]})]},Fe))},be=1;be<=r;be++)ge(be);return _};return(0,e.jsxs)("div",{className:"pdf-annotation-container-box ".concat(x),style:F,ref:ce,children:[(0,e.jsx)(da,{fileUrl:t,fileName:c,annotations:xe()(ve),currentPage:H,numPages:r,readOnly:h,pdfLayerRef:ee,scale:R,sidebarVisible:k,toggleSidebar:jt,setCurrentPage:C,zoomOut:pt,zoomIn:St,onSave:$}),h?null:(0,e.jsx)(ca,{activeTool:A,activeColor:Z,activeLineStyle:oe,onToolSelect:xt,onColorChange:X,onLineStyleChange:st}),(0,e.jsxs)("div",{className:"pdf-annotation-content",children:[(0,e.jsx)("div",{className:"pdf-annotation-sidebar ".concat(k?"visible":"hidden"),children:(0,e.jsx)(Qt.Z,{activeKey:a,onChange:function(_){return o(_)},items:[{key:"thumbnails",label:"\u9875\u9762\u9884\u89C8",children:(0,e.jsx)(Ca,{fileUrl:t,numPages:r,currentPage:H,onPageChange:gt})},{key:"annotations",label:"\u6279\u6CE8\u5217\u8868",children:(0,e.jsx)(oa,{annotations:ve==null?void 0:ve.filter(function(ue){return ue.pageNumber===H}),currentPage:H,pdfLayerRef:mt(H),scale:R,handlePageChange:gt,onAnnotationDelete:je,onAnnotationUpdate:Ce,readOnly:h})}]})}),(0,e.jsx)("div",{className:"pdf-annotation-main",ref:se,style:{overflowY:"auto",height:"100%"},children:(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:yt,loading:(0,e.jsxs)("div",{className:"pdf-loading",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"0 0 1024 1024",width:"48",height:"48",fill:"#1677ff",children:[(0,e.jsx)("path",{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}),(0,e.jsx)("path",{d:"M304 544h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0-144h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 288h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"14px",fontWeight:500,textAlign:"center"},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]}),error:(0,e.jsxs)("div",{className:"pdf-error",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"64 64 896 896",width:"48",height:"48",fill:"#ff4d4f",children:[(0,e.jsx)("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}),(0,e.jsx)("path",{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"16px",fontWeight:500,marginBottom:"8px"},children:"\u52A0\u8F7DPDF\u5931\u8D25"}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.65)",fontSize:"14px"},children:"\u8BF7\u68C0\u67E5\u6587\u4EF6\u683C\u5F0F\u6216\u7F51\u7EDC\u8FDE\u63A5\u540E\u91CD\u8BD5"})]}),children:Be()})})]}),D&&A&&(0,e.jsx)(ma,{visible:D,type:A,onSave:function(_){return bt(_,A)},onCancel:function(){q(!1),d(null)}}),ke&&(0,e.jsx)(xa,{onSave:Ct,onCancel:function(){Pe(!1),d(null),Ae({})},visible:ke,curTextNotePanelData:Oe})]})},ja=Sa}}]);
