"use strict";(self.webpackChunkpangcg_components=self.webpackChunkpangcg_components||[]).push([[368],{53002:function(pn,ht,N){N.r(ht),N.d(ht,{ErrorBoundaryContext:function(){return nt}});var Rt=N(67294),nt=(0,Rt.createContext)(null)},51447:function(pn,ht,N){N.r(ht),N.d(ht,{default:function(){return Kt},useErrorBoundary:function(){return Gt}});var Rt=N(56690),nt=N.n(Rt),nn=N(89728),w=N.n(nn),rn=N(66115),Et=N.n(rn),Tt=N(61655),Ye=N.n(Tt),vt=N(26389),Wt=N.n(vt),at=N(67294),Yt=N(53002),Ve={didCatch:!1,error:null};function Vt(){var it=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ot=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return it.length!==ot.length||it.some(function(ye,f){return!Object.is(ye,ot[f])})}var Kt=function(it){Ye()(ye,it);var ot=Wt()(ye);function ye(f){var Ne;return nt()(this,ye),Ne=ot.call(this,f),Ne.resetErrorBoundary=Ne.resetErrorBoundary.bind(Et()(Ne)),Ne.state=Ve,Ne}return w()(ye,[{key:"resetErrorBoundary",value:function(){var Ne=this.state.error;if(Ne!==null){for(var xe,Ke,Ge=arguments.length,e=new Array(Ge),_e=0;_e<Ge;_e++)e[_e]=arguments[_e];(xe=(Ke=this.props).onReset)===null||xe===void 0||xe.call(Ke,{args:e,reason:"imperative-api"}),this.setState(Ve)}}},{key:"componentDidCatch",value:function(Ne,xe){var Ke,Ge;(Ke=this.props)===null||Ke===void 0||(Ge=Ke.onError)===null||Ge===void 0||Ge.call(Ke,Ne,xe)}},{key:"componentDidUpdate",value:function(Ne,xe){var Ke=this.state.didCatch,Ge=this.props.resetKeys;if(Ke&&xe.error!==null&&Vt(Ne.resetKeys,Ge)){var e,_e;(e=(_e=this.props).onReset)===null||e===void 0||e.call(_e,{next:Ge,prev:Ne.resetKeys,reason:"keys"}),this.setState(Ve)}}},{key:"render",value:function(){var Ne=this.props,xe=Ne.children,Ke=Ne.fallbackRender,Ge=Ne.FallbackComponent,e=Ne.fallback,_e=this.state,Jt=_e.didCatch,Ut=_e.error,Nt=xe;if(Jt){var Xt={error:Ut,resetErrorBoundary:this.resetErrorBoundary};if(typeof Ke=="function")Nt=Ke(Xt);else if(Ge)Nt=(0,at.createElement)(Ge,Xt);else if(e!==void 0)Nt=e;else throw console.error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop"),Ut}return(0,at.createElement)(Yt.ErrorBoundaryContext.Provider,{value:{didCatch:Jt,error:Ut,resetErrorBoundary:this.resetErrorBoundary}},Nt)}}],[{key:"getDerivedStateFromError",value:function(Ne){return{didCatch:!0,error:Ne}}}]),ye}(at.Component);function Gt(){var it=at.useContext(Yt.ErrorBoundaryContext);if(it===null)throw new Error("useErrorBoundary must be used within an ErrorBoundary");return it}},28063:function(pn,ht,N){N.r(ht),N.d(ht,{DragSortSingleTable:function(){return sr},DragSortTreeTable:function(){return gr},EMAIL_PATTERN:function(){return kn},EMAIL_PATTERN_S:function(){return Fn},EditFormTable:function(){return Nt},EditFormTreeTable:function(){return er},ErrorBoundary:function(){return jn.default},ID_CARD_PATTERN:function(){return An},PHONE_NUMBER_PATTERN:function(){return Pn},PdfAnnotationExtension:function(){return ea},PdfAnnotationScroll:function(){return ja},PdfPreview:function(){return xr},URL_PATTERN:function(){return Pr},generateUUID:function(){return et},isEmail:function(){return Sr},isEmails:function(){return Er},isEmpty:function(){return Dr},isIDCard:function(){return kr},isNumeric:function(){return wr},isPhoneNumber:function(){return Ar},isURL:function(){return Fr},useEditFormTable:function(){return Ge},useEditFormTreeTable:function(){return Qn},useErrorBoundary:function(){return jn.useErrorBoundary}});var Rt=N(38416),nt=N.n(Rt),nn=N(42122),w=N.n(nn),rn=N(70215),Et=N.n(rn),Tt=N(58610),Ye=N(40741),vt=N(55102),Wt=N(34041),at=N(13457),Yt=N(84567),Ve=N(55742),Vt=N(72269),Kt=N(68351),Gt=N(68968),it=N(85679),ot=N(98644),ye=N(83622),f=N(67294),Ne=N(861),xe=N.n(Ne),Ke=function(n){var t=n,c=function(b,R){var u=(t==null?void 0:t.getFieldValue(b))||[];u.push(w()({},R)),t.setFieldValue(b,u)},l=function(b,R){var u=(t==null?void 0:t.getFieldValue(b))||[],J=u==null?void 0:u.filter(function(M,y){return y!==R});t.setFieldValue(b,xe()(J))},h=function(b,R,u){t.setFieldValue([b,R],w()({},u))},s=function(b,R,u,J){t.setFieldValue([b,R,u],J)},F=function(b,R,u){var J=(t==null?void 0:t.getFieldValue(b))||[];J[R]=w()({},u),t.setFieldValue(b,xe()(J))};return{addRecord:c,deleteRecord:l,updateRecord:h,updateRecordField:s,updateFormList:F}},Ge=Ke,e=N(85893),_e=["formListProps","recordCreatorProps","columns","rowKey"],Jt=Tt.default.RangePicker,Ut=function(n){var t=n.formListProps,c=n.recordCreatorProps,l=c===void 0?{creatorButtonShow:!1}:c,h=n.columns,s=n.rowKey,F=s===void 0?"id":s,T=Et()(n,_e),b=Ye.Z.useFormInstance(),R=function(M,y){switch(M){case"input":return(0,e.jsx)(vt.Z,w()({},y));case"select":return(0,e.jsx)(Wt.default,w()({},y));case"datePicker":return(0,e.jsx)(Tt.default,w()({},y));case"rangePicker":return(0,e.jsx)(Jt,w()({},y));case"inputNumber":return(0,e.jsx)(at.Z,w()({},y));case"checkbox":return(0,e.jsx)(Yt.Z,w()({},y));case"radio":return(0,e.jsx)(Ve.ZP,w()({},y));case"switch":return(0,e.jsx)(Vt.Z,w()({},y));case"timePicker":return(0,e.jsx)(Kt.Z,w()({},y));case"treeSelect":return(0,e.jsx)(Gt.Z,w()({},y));case"cascader":return(0,e.jsx)(it.Z,w()({},y));default:return null}},u=function(){var M=b.getFieldValue(t.name)||[];return h.map(function(y){var i=y.dataIndex,p=y.componentType,r=p===void 0?"text":p,C=y.componentProps,O=y.formItemProps,S=y.renderFormItem,ve=S===void 0?void 0:S;return w()(w()({},y),{},{render:function(H,$,K){var k=(M==null?void 0:M[K])||{};if((y==null?void 0:y.customRender)instanceof Function)return y.customRender({text:(k==null?void 0:k[i])||void 0,record:k,index:K},b);if((y==null?void 0:y.render)instanceof Function)return y.render((k==null?void 0:k[i])||"",k,K);if(r!=="text"||ve instanceof Function){var v=(O==null?void 0:O.valuePropName)||function(){switch(r){case"switch":case"checkbox":return"checked";default:return"value"}}();return(0,e.jsx)(Ye.Z.Item,w()(w()({},O),{},{valuePropName:v,name:[K,i],style:{marginBottom:0},children:ve&&ve instanceof Function?ve():R(r,C)}))}else if(r==="text"){var z;return(k==null||(z=k[i])===null||z===void 0?void 0:z.toString())||""}}})})};return(0,e.jsx)(Ye.Z.List,w()(w()({},t||{}),{},{children:function(M,y){var i=y.add;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.Z,w()(w()({},T||{}),{},{columns:u(),rowKey:function(r){var C,O=b.getFieldValue(t.name)||[],S=r.name;return O==null||(C=O[S])===null||C===void 0?void 0:C[F]},dataSource:M,pagination:!1})),l!=null&&l.creatorButtonShow?(0,e.jsx)("div",{style:{marginTop:24},children:(0,e.jsx)(ye.ZP,w()(w()({},(l==null?void 0:l.buttonProps)||{type:"dashed",block:!0}),{},{onClick:function(){var r,C=l!=null&&l.record?l==null?void 0:l.record():{};i(w()(w()({},C),{},nt()({},"".concat(F),(C==null||(r=C[F])===null||r===void 0?void 0:r.toString())||"add-".concat(et()))))},children:(l==null?void 0:l.creatorButtonText)||"\u65B0\u589E\u4E00\u884C"}))}):null]})}}))},Nt=Ut,Xt=N(96486),Xn=function(n){var t=n,c=function(T,b){var R=(t==null?void 0:t.getFieldValue(T))||[];R.push(w()(w()({},b||{}),{},{_key:"add-"+et()})),t.setFieldValue(T,R)},l=function(T,b,R){var u=(t==null?void 0:t.getFieldValue(T))||[],J=function y(i){return i.map(function(p){var r,C;return(b==null?void 0:b.toString())===(p==null||(r=p._key)===null||r===void 0?void 0:r.toString())?w()(w()({},p),{},{children:[].concat(xe()((p==null?void 0:p.children)||[]),[w()(w()({},R||{}),{},{_key:et()})])}):Array.isArray(p==null?void 0:p.children)&&p!==null&&p!==void 0&&(C=p.children)!==null&&C!==void 0&&C.length?w()(w()({},p),{},{children:y(p.children)}):p})},M=J(u);t.setFieldValue(T,M)},h=function(T,b){var R=(t==null?void 0:t.getFieldValue(T))||[],u=function M(y){return y.filter(function(i){var p,r;return((p=i._key)===null||p===void 0?void 0:p.toString())===(b==null?void 0:b.toString())?!1:(Array.isArray(i==null?void 0:i.children)&&i!==null&&i!==void 0&&(r=i.children)!==null&&r!==void 0&&r.length&&(i.children=M(i.children)),!0)})},J=u(R);t.setFieldValue(T,J)},s=function(T,b,R){var u=(t==null?void 0:t.getFieldValue(T))||[],J=function y(i){return i.map(function(p){var r,C;if((b==null?void 0:b.toString())===(p==null||(r=p._key)===null||r===void 0?void 0:r.toString())){var O;return w()(w()({},p),w()(w()({},R),{},{_key:(p==null||(O=p._key)===null||O===void 0?void 0:O.toString())||et()}))}return Array.isArray(p==null?void 0:p.children)&&p!==null&&p!==void 0&&(C=p.children)!==null&&C!==void 0&&C.length&&(p.children=y(p.children)),p})},M=J(u);t.setFieldValue(T,M)};return{addRootRecord:c,addChildRecord:l,deleteRecord:h,updateRecord:s}},Qn=Xn,$n=["formListProps","recordCreatorProps","columns","rowKey"],qn=Tt.default.RangePicker,_n=function(n){var t=n.formListProps,c=n.recordCreatorProps,l=c===void 0?{creatorButtonShow:!1}:c,h=n.columns,s=n.rowKey,F=s===void 0?"id":s,T=Et()(n,$n),b=Ye.Z.useFormInstance(),R=function(i,p){switch(i){case"input":return(0,e.jsx)(vt.Z,w()({},p));case"select":return(0,e.jsx)(Wt.default,w()({},p));case"datePicker":return(0,e.jsx)(Tt.default,w()({},p));case"rangePicker":return(0,e.jsx)(qn,w()({},p));case"inputNumber":return(0,e.jsx)(at.Z,w()({},p));case"checkbox":return(0,e.jsx)(Yt.Z,w()({},p));case"radio":return(0,e.jsx)(Ve.ZP,w()({},p));case"switch":return(0,e.jsx)(Vt.Z,w()({},p));case"timePicker":return(0,e.jsx)(Kt.Z,w()({},p));case"treeSelect":return(0,e.jsx)(Gt.Z,w()({},p));default:return null}},u=function(){return h.map(function(i){var p=i.dataIndex,r=i.componentType,C=r===void 0?"text":r,O=i.componentProps,S=i.formItemProps,ve=i.renderFormItem,L=ve===void 0?void 0:ve;return w()(w()({},i),{},{render:function($,K,k){var v=(0,Xt.cloneDeep)(w()({},K));if((i==null?void 0:i.customRender)instanceof Function)return i.customRender({text:(v==null?void 0:v[p])||void 0,record:v,index:k},b);if((i==null?void 0:i.render)instanceof Function){var z;return i.render((v==null||(z=v[p])===null||z===void 0?void 0:z.toString())||"",v,k)}else if(C!=="text"||L instanceof Function){var V=(S==null?void 0:S.valuePropName)||function(){switch(C){case"switch":case"checkbox":return"checked";default:return"value"}}();return(0,e.jsx)(Ye.Z.Item,w()(w()({},S),{},{valuePropName:V,name:[].concat(xe()(K.fieldKey),[p]),style:{marginBottom:0},children:L&&L instanceof Function?L():R(C,O)}))}else if(C==="text"){var B;return(v==null||(B=v[p])===null||B===void 0?void 0:B.toString())||""}}})})},J=function(i){var p,r=l.record,C=r&&r instanceof Function?r():nt()(nt()({},"".concat(F),"add-".concat(et())),"children",null),O=w()(w()({},C),{},nt()(nt()({},"".concat(F),(C==null||(p=C[F])===null||p===void 0?void 0:p.toString())||"add-".concat(et())),"children",null));i(w()({},O))},M=(0,f.useCallback)(function(y){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return y==null?void 0:y.map(function(p,r){var C,O=[].concat(xe()(i),[r]),S=b.getFieldValue([t.name].concat(xe()(O)));return S._key=(S==null||(C=S[F])===null||C===void 0?void 0:C.toString())||S._key||"add-".concat(et()),w()(w()({},S),{},{fieldKey:O,isListField:!0,children:S!=null&&S.children?M(Array(S.children.length).fill({}),[].concat(xe()(O),["children"])):void 0})})},[b,t.name]);return(0,e.jsx)(Ye.Z.List,w()(w()({},t||{}),{},{children:function(i,p){var r=p.add;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.Z,w()(w()({},T||{}),{},{dataSource:M(i),columns:u(),rowKey:function(O){return O==null?void 0:O._key},pagination:!1})),l!=null&&l.creatorButtonShow?(0,e.jsx)("div",{style:{marginTop:24},children:(0,e.jsx)(ye.ZP,w()(w()({},(l==null?void 0:l.buttonProps)||{type:"dashed",block:!0}),{},{onClick:function(){return J(r)},children:(l==null?void 0:l.creatorButtonText)||"\u6DFB\u52A0\u4E00\u884C"}))}):null]})}}))},er=_n,tr=N(27424),te=N.n(tr),mn=N(60887),yn=N(32339),ft=N(45587),xn=N(51329),bn=f.createContext({}),nr=function(n){var t=n.renderDragHandle,c=t===void 0?void 0:t,l=(0,f.useContext)(bn),h=l.setActivatorNodeRef,s=l.listeners;return(0,e.jsx)("div",w()(w()({style:{cursor:"move"},ref:h},s),{},{children:c||(0,e.jsx)(xn.Z,{})}))},rr=nr,Cn=N(24285),ar=function(n){var t=(0,ft.nB)({id:n["data-row-key"]}),c=t.attributes,l=t.listeners,h=t.transform,s=t.transition,F=t.isDragging,T=t.setNodeRef,b=t.setActivatorNodeRef,R=w()(w()({},n.style),{},{transform:Cn.ux.Translate.toString(h),transition:s},F?{position:"relative",zIndex:9999}:{}),u=(0,f.useMemo)(function(){return{setActivatorNodeRef:b,listeners:l}},[b,l]);return(0,e.jsx)(bn.Provider,{value:u,children:(0,e.jsx)("tr",w()(w()({},n),{},{ref:T,style:R},c))})},ir=ar,or=["rowKey","isDrag","initialDataSource","columns","renderDragHandle","onDragSortEnd"],lr=function(n){var t=n.rowKey,c=t===void 0?"id":t,l=n.isDrag,h=l===void 0?!0:l,s=n.initialDataSource,F=s===void 0?[]:s,T=n.columns,b=n.renderDragHandle,R=b===void 0?void 0:b,u=n.onDragSortEnd,J=Et()(n,or),M=f.useState([]),y=te()(M,2),i=y[0],p=y[1];(0,f.useEffect)(function(){Array.isArray(F)&&p(xe()(F))},[F]);var r=function(ve){return typeof c=="function"?c(ve):String(ve[c])},C=function(ve){var L=ve.active,H=ve.over;H&&L.id!==H.id&&p(function($){var K=$.findIndex(function(z){return r(z)===(L==null?void 0:L.id)}),k=$.findIndex(function(z){return r(z)===(H==null?void 0:H.id)}),v=(0,ft.Rp)($,K,k);return u==null||u(v),v})},O=(0,f.useMemo)(function(){var S=xe()(T);return h&&S.unshift({key:"sort",align:"center",width:80,render:function(){return(0,e.jsx)(rr,{renderDragHandle:R})}}),S},[T,h]);return(0,e.jsx)(mn.LB,{modifiers:[yn.DL],onDragEnd:C,children:(0,e.jsx)(ft.Fo,{items:i.map(function(S){return r(S)}),strategy:ft.qw,children:(0,e.jsx)(ot.Z,w()(w()({},J),{},{rowKey:c,columns:O,dataSource:i,components:h?{body:{row:ir}}:void 0}))})})},sr=lr,Sn=f.createContext({}),cr=function(n){var t=n.renderDragHandle,c=t===void 0?void 0:t,l=(0,f.useContext)(Sn),h=l.setActivatorNodeRef,s=l.listeners;return(0,e.jsx)("div",w()(w()({style:{cursor:"move"},ref:h},s),{},{children:c||(0,e.jsx)(xn.Z,{})}))},ur=cr,dr=function(n){var t=n["data-parent-id"],c=n["data-row-key"],l=(0,ft.nB)({id:c,data:{parentId:t}}),h=l.attributes,s=l.listeners,F=l.transform,T=l.transition,b=l.isDragging,R=l.setNodeRef,u=l.setActivatorNodeRef,J=w()(w()(w()({},n.style),{},{transform:Cn.ux.Translate.toString(F),transition:T},b?{position:"relative",zIndex:9999}:{}),{},{cursor:"pointer"}),M=(0,f.useMemo)(function(){return{setActivatorNodeRef:u,listeners:s,parentId:t}},[u,s,t]);return(0,e.jsx)(Sn.Provider,{value:M,children:(0,e.jsx)("tr",w()(w()({},n),{},{ref:R,style:J},h))})},hr=dr,vr=["onDragSortEnd","isDrag","initialDataSource","columns","renderDragHandle","rowKey","childrenColumnName","parentIdKey"],fr=function(n){var t=n.onDragSortEnd,c=n.isDrag,l=c===void 0?!0:c,h=n.initialDataSource,s=h===void 0?[]:h,F=n.columns,T=n.renderDragHandle,b=T===void 0?void 0:T,R=n.rowKey,u=R===void 0?"id":R,J=n.childrenColumnName,M=J===void 0?"children":J,y=n.parentIdKey,i=y===void 0?"parentId":y,p=Et()(n,vr),r=f.useState([]),C=te()(r,2),O=C[0],S=C[1];(0,f.useEffect)(function(){Array.isArray(s)&&S(xe()(s))},[s]);var ve=function(d){return typeof u=="function"?u(d):String(d[u])},L=function(d){return d[i]?String(d[i]):null},H=function P(d,x,j){var Z=d.findIndex(function(m){return ve(m)===x}),X=d.findIndex(function(m){return ve(m)===j});return Z!==-1&&X!==-1?(0,ft.Rp)(d,Z,X):d.map(function(m){var re=m[M];return Array.isArray(re)&&re.length>0?w()(w()({},m),{},nt()({},M,P(re,x,j))):m})},$=function(d){var x=d.active,j=d.over;if(j&&x.id!==j.id){var Z,X,m=(Z=x.data.current)===null||Z===void 0?void 0:Z.parentId,re=(X=j.data.current)===null||X===void 0?void 0:X.parentId;if(m!==re)return;S(function(oe){var g=H(oe,x.id,j.id);return t==null||t(g),g})}},K=function P(d){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return d.map(function(j){var Z=j[M],X=w()({},j);return X[i]=x,Array.isArray(Z)&&Z.length>0&&(X[M]=P(Z,String(ve(j)))),X})},k=(0,f.useMemo)(function(){return K(O)},[O]),v=function P(d){var x=[];return d.forEach(function(j){x.push(ve(j));var Z=j[M];Array.isArray(Z)&&Z.length>0&&(x=[].concat(xe()(x),xe()(P(Z))))}),x},z=(0,f.useMemo)(function(){var P=xe()(F);return l&&P.unshift({key:"sort",title:"\u6392\u5E8F",width:60,fixed:"left",render:function(){return(0,e.jsx)(ur,{renderDragHandle:b})}}),P},[F,l,p.rowSelection]),V=l?function(P){return{"data-parent-id":L(P)}}:void 0,B=(0,f.useMemo)(function(){return v(k)},[k]);return(0,e.jsx)(mn.LB,{modifiers:[yn.DL],onDragEnd:$,children:(0,e.jsx)(ft.Fo,{items:B,strategy:ft.qw,children:(0,e.jsx)(ot.Z,w()(w()({},p),{},{rowKey:u,columns:z,dataSource:k,components:l?{body:{row:hr}}:void 0,onRow:V,expandable:w()(w()({},(p==null?void 0:p.expandable)||{}),{},{expandIconColumnIndex:l&&(p!=null&&p.rowSelection)?3:l?1:0})}))})})},gr=fr,jn=N(51447),pr=N(17061),we=N.n(pr),mr=N(17156),ze=N.n(mr),an=N(19944),on=N(84477),ln=N(52514),sn=N(89514),cn=N(69753),ie=N(45360),un=N(57381),Xe=N(96074),Lt=N(28541),Mt=N(16085),Zt=N(95327);Lt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Lt.i8,"/pdf.worker.min.mjs");var yr=function(n){var t=n.fileUrl,c=n.fileName,l=c===void 0?"\u6587\u4EF6\u9884\u89C8":c,h=n.className,s=h===void 0?"":h,F=n.style,T=F===void 0?{}:F,b=(0,f.useState)(null),R=te()(b,2),u=R[0],J=R[1],M=(0,f.useState)(1),y=te()(M,2),i=y[0],p=y[1],r=(0,f.useState)(1),C=te()(r,2),O=C[0],S=C[1],ve=(0,f.useState)(!0),L=te()(ve,2),H=L[0],$=L[1],K=(0,f.useState)(null),k=te()(K,2),v=k[0],z=k[1],V=(0,f.useState)(l),B=te()(V,2),P=B[0],d=B[1],x=(0,f.useState)(!1),j=te()(x,2),Z=j[0],X=j[1],m=(0,f.useState)(null),re=te()(m,2),oe=re[0],g=re[1],Y=(0,f.useRef)(null),U=(0,f.useRef)(null),D=(0,f.useRef)(null),q=function(E){return typeof File!="undefined"&&E instanceof File},Q=function(E){return typeof Blob!="undefined"&&E instanceof Blob},W=function(){var I=ze()(we()().mark(function E(){var A,G;return we()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:A="",G=!0;try{typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://"))?(z(t),A=t.split("/").pop()||l):typeof t=="string"&&t.startsWith("data:")?z(t):Q(t)||q(t)?(z(t),A=q(t)&&t!==null&&t!==void 0&&t.name?t.name:l):(ie.ZP.error("\u4E0D\u652F\u6301\u7684\u6587\u4EF6\u683C\u5F0F"),G=!1),G&&d(A),$(!1)}catch(ne){console.error("\u5904\u7406\u6587\u4EF6\u65F6\u51FA\u9519:",ne),ie.ZP.error("\u65E0\u6CD5\u52A0\u8F7D\u6587\u4EF6"),$(!1)}case 3:case"end":return ee.stop()}},E)}));return function(){return I.apply(this,arguments)}}();(0,f.useEffect)(function(){$(!0),z(null),p(1),W()},[t,l]);var ke=function(E){var A=E.numPages;J(A),$(!1)},Pe=function(){},Ue=function(E){if(!(!Y.current||!u)){g("thumbnail");var A=Y.current,G=A.scrollHeight,ce=G/(u||1),ee=(E-1)*ce;A.scrollTo({top:ee,behavior:"smooth"}),setTimeout(function(){g(null)},500)}},Ze=function(E){p(E+1),Ue(E+1)},Oe=function(){if(!(!U.current||!i||!u)){var E=U.current,A=E.clientHeight,G=E.scrollHeight,ce=G/(u||1),ee=(i-1)*ce-A/2+ce/2;E.scrollTo({top:Math.max(0,ee),behavior:"smooth"})}},Ae=function(){S(O*1.2)},he=function(){S(O/1.2)},le=function(){try{if(typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://")))window.open(t,"_blank");else if(typeof t=="string"&&t.startsWith("data:")){var E=document.createElement("a");E.href=t,E.download=P||"document.pdf",E.click()}else if(Q(t)||q(t)){var A=URL.createObjectURL(t),G=document.createElement("a");G.href=A,G.download=P||"document.pdf",G.click(),setTimeout(function(){return URL.revokeObjectURL(A)},100)}}catch(ce){console.error("\u4E0B\u8F7D\u6587\u4EF6\u65F6\u51FA\u9519:",ce),ie.ZP.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25")}},a=function(){X(!Z)};(0,f.useEffect)(function(){var I=Y.current;if(!(!I||!u)){var E=function(){if(oe!=="thumbnail"){g("pdf");var ee=I.scrollTop,ne=I.scrollHeight,se=ne/u,de=Math.floor(ee/se)+1,fe=ee%se/se,De=fe>.5?de+1:de,Ce=Math.max(1,Math.min(De,u));Ce!==i&&p(Ce),D.current&&clearTimeout(D.current),D.current=setTimeout(function(){g(null)},150)}},A=null,G=function(){A||(A=setTimeout(function(){E(),A=null},50))};return I.addEventListener("scroll",G),function(){I.removeEventListener("scroll",G),A&&clearTimeout(A),D.current&&clearTimeout(D.current)}}},[u,i,oe]),(0,f.useEffect)(function(){oe==="pdf"&&Oe()},[i,oe]);var o=function(){return H||!v?(0,e.jsx)("div",{className:"document-preview-loading",children:(0,e.jsxs)("div",{className:"loading-container",children:[(0,e.jsx)(un.Z,{size:"large"}),(0,e.jsx)("div",{className:"loading-text",style:{marginTop:"16px",color:"rgba(0, 0, 0, 0.65)",fontSize:"14px",fontWeight:500},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pdf-controls",children:[(0,e.jsx)("div",{className:"pdf-controls-left",children:(0,e.jsx)(ye.ZP,{type:"text",icon:Z?(0,e.jsx)(an.Z,{}):(0,e.jsx)(on.Z,{}),onClick:a,className:"thumbnail-toggle-btn"})}),(0,e.jsxs)("div",{className:"pdf-controls-center",children:[(0,e.jsx)("div",{className:"page-indicator",children:"".concat(i," / ").concat(u||1)}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"page-divider"}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(ln.Z,{}),onClick:he}),(0,e.jsx)("span",{className:"zoom-indicator",children:"".concat(Math.round(O*100),"%")}),(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(sn.Z,{}),onClick:Ae})]})]}),(0,e.jsx)("div",{className:"pdf-controls-right",children:(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(cn.Z,{}),onClick:le,className:"download-btn"})})]}),(0,e.jsxs)("div",{className:"pdf-content-container",children:[(0,e.jsx)("div",{className:"pdf-thumbnails-container ".concat(Z?"collapsed":""),ref:U,children:u&&(0,e.jsx)(Mt.Z,{file:v,onLoadSuccess:Pe,loading:(0,e.jsx)(un.Z,{size:"small"}),children:Array.from(new Array(u),function(E,A){return(0,e.jsxs)("div",{className:"pdf-thumbnail ".concat(i===A+1?"active":""),onClick:function(){return Ze(A)},children:[(0,e.jsx)(Zt.Z,{pageNumber:A+1,scale:.15,renderTextLayer:!1,renderAnnotationLayer:!1}),(0,e.jsx)("div",{className:"thumbnail-page-number",children:A+1})]},"thumbnail-".concat(A))})})}),(0,e.jsx)("div",{className:"pdf-container",ref:Y,children:(0,e.jsx)(Mt.Z,{file:v,onLoadSuccess:ke,onLoadError:function(A){console.error("Error loading PDF:",A),ie.ZP.error("\u65E0\u6CD5\u52A0\u8F7DPDF\u6587\u4EF6"),$(!1)},loading:(0,e.jsx)(un.Z,{size:"large"}),children:Array.from(new Array(u),function(E,A){return(0,e.jsx)("div",{className:"pdf-page-wrapper",id:"pdf-page-".concat(A+1),children:(0,e.jsx)(Zt.Z,{pageNumber:A+1,scale:O,renderTextLayer:!1,renderAnnotationLayer:!1},"page-".concat(A))},"page-wrapper-".concat(A))})})})]})]})};return(0,e.jsx)("div",{className:"document-preview-container ".concat(s),style:T?w()({},T):void 0,children:o()})},xr=yr,Qt=N(11941),br=N(27484),pe=N.n(br),Cr=N(20185),Dn=N.n(Cr),Da=N(97679),ka=N(22115);function et(){var ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=new Uint8Array(32);return crypto.getRandomValues(n),Array.from(n).map(function(t){return ae[t%ae.length]}).join("")}var kn=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;function Sr(ae){return kn.test(ae)}var jr=N(18698),wn=N.n(jr);function Dr(ae){return ae==null?!0:typeof ae=="string"?ae.trim().length===0:Array.isArray(ae)?ae.length===0:wn()(ae)==="object"?Object.keys(ae).length===0:!1}var An=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;function kr(ae){if(!An.test(ae))return!1;if(ae.length===18){var n=parseInt(ae.substr(6,4)),t=parseInt(ae.substr(10,2)),c=parseInt(ae.substr(12,2)),l=new Date(n,t-1,c);return l.getFullYear()===n&&l.getMonth()+1===t&&l.getDate()===c}return!0}function wr(ae){return!isNaN(parseFloat(ae))&&isFinite(Number(ae))}var Pn=/^1[3-9]\d{9}$/;function Ar(ae){return Pn.test(ae)}var Pr=/^https?:\/\/([a-zA-Z0-9][a-zA-Z0-9-]*\.)*[a-zA-Z0-9][a-zA-Z0-9-]*\.[a-zA-Z]{2,}(:\d{1,5})?(\/[a-zA-Z0-9\-._~:/?#[\]@!$&'()*+,;=]*)?$/;function Fr(ae){if(typeof ae!="string"||!ae.trim())return!1;var n=ae.trim(),t;try{t=new URL(n)}catch(s){return!1}if(!["http:","https:"].includes(t.protocol))return!1;var c=t.hostname;if(/\s/.test(c)||c.startsWith(".")||c.endsWith(".")||/\.\./.test(c))return!1;var l=c.split(".").pop();if(!l||l.length<2)return!1;if(t.port){var h=Number(t.port);if(isNaN(h)||h<=0||h>65535)return!1}return!0}var Fn=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;function Er(ae){return Fn.test(ae)}var Tr=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=(0,f.useState)(n),c=te()(t,2),l=c[0],h=c[1],s=(0,f.useCallback)(function(M){h(function(y){return[].concat(xe()(y),[M])})},[]),F=(0,f.useCallback)(function(M,y){h(function(i){return i.map(function(p){return p.id===M?w()(w()(w()({},p),y),{},{modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}):p})})},[]),T=(0,f.useCallback)(function(M){h(function(y){return y.filter(function(i){return i.id!==M})})},[]),b=(0,f.useCallback)(function(){h([])},[]),R=(0,f.useCallback)(function(M){return l.filter(function(y){return y.pageNumber===M})},[l]),u=(0,f.useCallback)(function(M){return l.filter(function(y){return y.type===M})},[l]),J=(0,f.useCallback)(function(M){h(M)},[]);return{annotations:l,addAnnotation:s,updateAnnotation:F,removeAnnotation:T,clearAnnotations:b,getAnnotationsByPage:R,getAnnotationsByType:u,importAnnotations:J}},me=N(32237),Nr=function(n,t,c){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Arial",h=document.createElement("canvas"),s=h.getContext("2d");if(!s)return{width:200,height:100};s.font="".concat(t,"px ").concat(l);for(var F=n.split(" "),T=[],b=F[0]||"",R=1;R<F.length;R++){var u=F[R],J=s.measureText(b+" "+u).width;J<c?b+=" "+u:(T.push(b),b=u)}T.push(b);for(var M=t*1.2,y=T.length*M+16,i=0,p=0,r=T;p<r.length;p++){var C=r[p],O=s.measureText(C).width;i=Math.max(i,O)}return{width:Math.min(i+16,c),height:y}},Lr=function(n){var t=n.pageNumber,c=n.scale,l=n.width,h=n.height,s=n.activeTool,F=n.activeColor,T=n.activeLineStyle,b=n.annotations,R=n.readOnly,u=R===void 0?!1:R,J=n.zIndex,M=J===void 0?5:J,y=n.onAnnotationAdd,i=n.onAnnotationUpdate,p=n.onAnnotationRemove,r=n.onToolReset,C=n.setShowTextNotePanel,O=n.setTextNotePanelData,S=(0,f.useRef)(null),ve=(0,f.useRef)(null),L=(0,f.useRef)(null),H=(0,f.useState)(null),$=te()(H,2),K=$[0],k=$[1],v=(0,f.useState)(!1),z=te()(v,2),V=z[0],B=z[1],P=(0,f.useState)(null),d=te()(P,2),x=d[0],j=d[1],Z=(0,f.useState)(null),X=te()(Z,2),m=X[0],re=X[1],oe=b.filter(function(le){return["rectangle","circle","ellipse"].includes(le.type)}),g=b.filter(function(le){return["freedraw","freehighlight"].includes(le.type)}),Y=b.filter(function(le){return["signature","stamp"].includes(le.type)}),U=b.filter(function(le){return le.type==="text"}),D=function(a){if(K){var o=a.target,I=o.id(),E=o.scaleX(),A=o.scaleY();try{var G=b.find(function(He){return He.id===I});if(!G)return;var ce,ee=[];switch(G.type){case"rectangle":{var ne=o.width()*E,se=o.height()*A,de=o.x(),fe=o.y();i(I,{x:de,y:fe,width:ne,height:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"circle":{var De=o.width()*E,Ce=o.height()*A,je=Math.max(De,Ce)/2,Ee=o.x(),Je=o.y(),gt=Ee-je,yt=Je-je;i(I,{x:gt,y:yt,width:je*2,height:je*2,radius:je,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"ellipse":{var lt=o.width()*E,st=o.height()*A,xt=o.x(),bt=o.y(),Ct=xt-lt/2,St=bt-st/2;i(I,{x:Ct,y:St,width:lt,height:st,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"signature":case"stamp":{var pt=o.width()*E,jt=o.height()*A,Dt=o.x(),mt=o.y();i(I,{x:Dt,y:mt,width:pt,height:jt,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"freedraw":case"freehighlight":{ce=G;var Be=xe()(ce.points);try{for(var ue=1/0,_=1/0,ge=-1/0,be=-1/0,Se=0;Se<Be.length;Se+=2)ue=Math.min(ue,Be[Se]),ge=Math.max(ge,Be[Se]),_=Math.min(_,Be[Se+1]),be=Math.max(be,Be[Se+1]);var Fe=(ue+ge)/2,Le=(_+be)/2,Me=o.x(),tt=o.y();ee=[];for(var Ie=0;Ie<Be.length;Ie+=2){var kt=Be[Ie]-Fe,wt=Be[Ie+1]-Le,Ot=Me+kt*E,At=tt+wt*A;ee.push(Ot,At)}i(I,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}),o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}catch(He){console.error("\u5904\u7406\u81EA\u7531\u7ED8\u5236/\u9AD8\u4EAE\u53D8\u6362\u65F6\u51FA\u9519:",He),o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}break}case"text":{var qe,ct=o.width()*E,We=o.height()*A,ut=o.x()/c,dt=o.y()/c;i(I,{x:ut,y:dt,width:ct/c,height:We/c,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});var Re=(qe=o.getStage())===null||qe===void 0?void 0:qe.findOne("#text-".concat(I));if(Re){var Te;Re.position({x:o.x()+4*c,y:o.y()+4*c}),Re.width((ct/c-8)*c),Re.height((We/c-8)*c),(Te=Re.getLayer())===null||Te===void 0||Te.batchDraw()}break}}}catch(He){console.error("\u66F4\u65B0\u6279\u6CE8\u5931\u8D25:",He)}o.scaleX(1),o.scaleY(1)}},q=function(a){if(!(u||!s)){var o=a.target===a.currentTarget;if(o){var I=S.current;if(I){var E=I.getPointerPosition();if(E){var A=E.x/c,G=E.y/c;switch(s){case"freedraw":case"freehighlight":{B(!0);var ce=s==="freedraw"?2:10,ee={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:s==="freedraw"?1:.5,points:[A,G],strokeWidth:ce,lineStyle:T};j(ee);break}case"rectangle":case"circle":case"ellipse":{var ne={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:1,x:A,y:G,width:0,height:0,strokeWidth:2,lineStyle:T};re(ne);break}case"text":{r&&r();break}default:break}}}}}},Q=function(a){if(!u){var o=a.target.getStage();if(o){var I=o.getPointerPosition();if(I){var E=I.x/c,A=I.y/c;if(V&&x&&j(w()(w()({},x),{},{points:[].concat(xe()(x.points),[E,A])})),m){var G=E-m.x,ce=A-m.y;re(w()(w()({},m),{},{width:G,height:ce,radius:Math.max(Math.abs(G||0),Math.abs(ce||0))/2}))}}}}},W=function(){if(!u&&(V&&x&&(x.points.length>4&&(y(x),r==null||r()),B(!1),j(null)),m)){if(Math.abs(m.width||0)>5&&Math.abs(m.height||0)>5){var a=m.width||0,o=m.height||0,I=a<0?m.x+a:m.x,E=o<0?m.y+o:m.y,A=Math.abs(a),G=Math.abs(o);y(w()(w()({},m),{},{x:I,y:E,width:A,height:G,radius:m.type==="circle"?Math.max(A,G)/2:void 0})),r==null||r()}re(null)}},ke=function(a){if(!u){var o=a.target.getStage();if(o){if(a.target===a.currentTarget){k(null);return}var I=a.target,E=I.id();s||k(E||null)}}},Pe=function(){return oe.map(function(a){var o=K===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;switch(a.type){case"rectangle":return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.UL,{id:a.id,x:a.x,y:a.y,width:a.width||0,height:a.height||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){i(a.id,{x:A.target.x(),y:A.target.y(),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"circle":return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.Cd,{id:a.id,x:a.x+(a.radius||0),y:a.y+(a.radius||0),radius:a.radius||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){var G=A.target.x(),ce=A.target.y(),ee=a.radius||0,ne=G-ee,se=ce-ee;i(a.id,{x:ne,y:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"ellipse":return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.Pj,{id:a.id,x:a.x+(a.width||0)/2,y:a.y+(a.height||0)/2,radiusX:(a.width||0)/2,radiusY:(a.height||0)/2,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){var G=A.target.x(),ce=A.target.y(),ee=a.width||0,ne=a.height||0,se=G-ee/2,de=ce-ne/2;i(a.id,{x:se,y:de,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);default:return null}})},Ue=function(){return g.map(function(a){var o=K===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.x1,{id:a.id,points:a.points,stroke:a.color,strokeWidth:a.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,globalCompositeOperation:a.type==="freehighlight"?"multiply":"source-over",listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){var G=A.target.x(),ce=A.target.y();A.target.position({x:0,y:0});for(var ee=xe()(a.points),ne=0;ne<ee.length;ne+=2)ee[ne]+=G,ee[ne+1]+=ce;i(a.id,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1})]},a.id)})},Ze=function(){return Y.map(function(a){var o=a.id,I=a.x,E=a.y,A=a.width,G=a.height,ce=a.imageData,ee=a.opacity,ne=K===a.id,se=new window.Image;return se.src=ce,(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.Ee,{id:o,x:I,y:E,width:A,height:G,image:se,opacity:ee,draggable:!u,onClick:function(){return!u&&k(o)},onTap:function(){return!u&&k(o)},onDragEnd:function(fe){i(o,{x:fe.target.x(),y:fe.target.y()})},onTransformEnd:D}),ne&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(fe,De){return De},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},o)})},Oe=function(){if(!x)return null;var a=x.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsx)(me.x1,{points:x.points,stroke:x.color,strokeWidth:x.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:x.opacity,dash:a,perfectDrawEnabled:!1,globalCompositeOperation:x.type==="freehighlight"?"multiply":"source-over",listening:!1})},Ae=function(){if(!m)return null;var a=m.lineStyle==="dashed"?[5,5]:void 0;switch(m.type){case"rectangle":return(0,e.jsx)(me.UL,{x:m.x,y:m.y,width:m.width||0,height:m.height||0,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});case"circle":{var o=m.radius||0;return(0,e.jsx)(me.Cd,{x:m.x+o,y:m.y+o,radius:o,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1})}case"ellipse":return(0,e.jsx)(me.Pj,{x:m.x+(m.width||0)/2,y:m.y+(m.height||0)/2,radiusX:Math.abs(m.width||0)/2,radiusY:Math.abs(m.height||0)/2,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});default:return null}},he=function(){var a;return U==null||(a=U.filter(function(o){return o.pageNumber===t}))===null||a===void 0?void 0:a.map(function(o){var I=K===o.id,E=l*.8,A=Nr(o.text||"",o.fontSize||16,E,"Arial"),G=o.width&&o.width>20?o.width:A.width/c,ce=o.height&&o.height>20?o.height:A.height/c;return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.UL,{id:o.id,x:o.x*c,y:o.y*c,width:G*c,height:ce*c,fill:o.backgroundColor||"#FFFFA0",opacity:.8,cornerRadius:4,stroke:I?"#1890ff":"transparent",strokeWidth:I?2:0,onDblClick:function(){k(o.id),C(!0),O(o)},onDblTap:function(){},draggable:!u,onDragMove:function(ne){var se,de=(se=ne.target.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(de){var fe;de.position({x:ne.target.x()+4*c,y:ne.target.y()+4*c}),(fe=de.getLayer())===null||fe===void 0||fe.batchDraw()}},onDragEnd:function(ne){i(o.id,{x:ne.target.x()/c,y:ne.target.y()/c,width:G,height:ce,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransform:function(ne){var se,de=ne.target,fe=(se=de.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(fe){var De,Ce=de.scaleX(),je=de.scaleY();fe.position({x:de.x()+4*c*Ce,y:de.y()+4*c*je}),fe.width(de.width()*Ce-8*c*Ce),fe.height(de.height()*je-8*c*je),(De=fe.getLayer())===null||De===void 0||De.batchDraw()}},onTransformEnd:D}),(0,e.jsx)(me.xv,{id:"text-".concat(o.id),x:(o.x+4)*c,y:(o.y+4)*c,width:(G-8)*c,height:(ce-8)*c,text:o.text,fontSize:(o.fontSize||16)*c,fontFamily:"Arial",fill:"#333333",wrap:"word",listening:!1}),I&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(ne,se){return se.width<50||se.height<30?ne:se}})]},o.id)})};return(0,f.useEffect)(function(){var le=function(o){(o.key==="Delete"||o.key==="Backspace")&&K&&!u&&(p(K),k(null))};return window.addEventListener("keydown",le),function(){window.removeEventListener("keydown",le)}},[K,p,u]),(0,f.useEffect)(function(){if(K&&L.current&&S.current){var le=S.current.findOne("#".concat(K));if(le){var a=b.find(function(Je){return Je.id===K});if(a&&!["freedraw","freehighlight"].includes(a.type)){var o,I;if((o=L.current)===null||o===void 0||o.nodes([le]),["signature","stamp"].includes(a.type)){var E,A,G;(E=L.current)===null||E===void 0||E.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(A=L.current)===null||A===void 0||A.rotateEnabled(!1),(G=L.current)===null||G===void 0||G.keepRatio(!0)}else if(a.type==="text"){var ce,ee,ne;(ce=L.current)===null||ce===void 0||ce.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(ee=L.current)===null||ee===void 0||ee.rotateEnabled(!1),(ne=L.current)===null||ne===void 0||ne.keepRatio(!1)}else{var se,de,fe;(se=L.current)===null||se===void 0||se.enabledAnchors(["top-left","top-center","top-right","middle-left","middle-right","bottom-left","bottom-center","bottom-right"]),(de=L.current)===null||de===void 0||de.rotateEnabled(!1),(fe=L.current)===null||fe===void 0||fe.keepRatio(a.type==="circle")}(I=L.current)===null||I===void 0||(I=I.getLayer())===null||I===void 0||I.batchDraw()}else{var De,Ce;(De=L.current)===null||De===void 0||De.nodes([]),(Ce=L.current)===null||Ce===void 0||(Ce=Ce.getLayer())===null||Ce===void 0||Ce.batchDraw()}}}else if(L.current){var je,Ee;(je=L.current)===null||je===void 0||je.nodes([]),(Ee=L.current)===null||Ee===void 0||(Ee=Ee.getLayer())===null||Ee===void 0||Ee.batchDraw()}},[K,b]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:u?"none":"auto",zIndex:M},className:"annotation-layer",children:(0,e.jsx)(me.Hf,{ref:S,width:l*c,height:h*c,scale:{x:c,y:c},onClick:ke,onMouseDown:q,onMouseMove:Q,onMouseUp:W,onTouchStart:q,onTouchMove:Q,onTouchEnd:W,style:{position:"absolute",top:0,left:0,pointerEvents:"all"},children:(0,e.jsxs)(me.mh,{ref:ve,children:[Pe(),Ue(),Ze(),he(),Oe(),Ae(),!u&&(0,e.jsx)(me.$T,{ref:L,rotateEnabled:!1,keepRatio:!1,borderDash:[6,2],borderStroke:"#1890ff",anchorStroke:"#1890ff",anchorFill:"#ffffff",anchorSize:8,boundBoxFunc:function(a,o){return o.width<5||o.height<5?a:o}})]})})})},Mr=Lr,En=N(82061),Tn=N(32983),Nn=N(83062),Zr=function(n){var t=n.annotations,c=n.currentPage,l=n.pdfLayerRef,h=n.scale,s=n.readOnly,F=s===void 0?!1:s,T=n.handlePageChange,b=n.onAnnotationSelect,R=n.onAnnotationDelete,u=n.onAnnotationUpdate,J=function(p){var r={highlight:"\u9AD8\u4EAE",strikethrough:"\u5220\u9664\u7EBF",underline:"\u4E0B\u5212\u7EBF",rectangle:"\u77E9\u5F62",circle:"\u5706\u5F62",ellipse:"\u692D\u5706",freedraw:"\u81EA\u7531\u7ED8\u5236",freehighlight:"\u81EA\u7531\u9AD8\u4EAE",signature:"\u7B7E\u540D",stamp:"\u76D6\u7AE0",text:"\u6587\u672C"};return r[p]||p},M=function(p,r){u&&u(p,{comment:r})},y=function i(p){var r=t.find(function(X){return X.id===p});if(r){if(r.pageNumber!==c){typeof T=="function"&&T(r.pageNumber),setTimeout(function(){return i(p)},500);return}if(l!=null&&l.current){var C={x:0,y:0,width:100,height:50};if("x"in r&&"y"in r)if(r.type==="circle"){var O=r.radius||0;C.x=r.x*h,C.y=r.y*h,C.width=O*2*h,C.height=O*2*h}else r.type==="ellipse"||r.type,C.x=r.x*h,C.y=r.y*h,"width"in r&&r.width&&(C.width=r.width*h),"height"in r&&r.height&&(C.height=r.height*h);var S=document.createElement("div");if(S.classList.add("annotation-highlight-selected"),S.style.position="absolute",S.style.left="".concat(C.x,"px"),S.style.top="".concat(C.y,"px"),S.style.width="".concat(C.width,"px"),S.style.height="".concat(C.height,"px"),r.type==="circle"||r.type==="ellipse")S.style.borderRadius="50%",S.style.border="2px solid ".concat(r.color||"#ff5500"),S.style.backgroundColor="transparent";else if(r.type==="rectangle")S.style.border="2px solid ".concat(r.color||"#ff5500"),S.style.backgroundColor="transparent";else if(r.type==="freedraw"||r.type==="freehighlight")if("points"in r&&r.points&&r.points.length>0){for(var ve=r.points,L=1/0,H=1/0,$=-1/0,K=-1/0,k=0;k<ve.length;k+=2){var v=ve[k]*h,z=ve[k+1]*h;L=Math.min(L,v),H=Math.min(H,z),$=Math.max($,v),K=Math.max(K,z)}var V=5;S.style.left="".concat(L-V,"px"),S.style.top="".concat(H-V,"px"),S.style.width="".concat($-L+V*2,"px"),S.style.height="".concat(K-H+V*2,"px"),S.style.border="2px solid ".concat(r.color||"#ff5500"),S.style.backgroundColor="transparent"}else S.style.transform="scale(1.2)",S.style.transformOrigin="center",S.style.backgroundColor="transparent";else["highlight","strikethrough","underline"].includes(r.type)&&(S.style.height="20px");l.current.appendChild(S);var B=l.current.parentElement;if(B){var P=C.x+parseInt(S.style.width,10)/2,d=C.y+parseInt(S.style.height,10)/2,x=l.current.getBoundingClientRect(),j=B.scrollTop||0,Z=B.scrollLeft||0;B.scrollTo({left:P+Z-x.width/2,top:d+j-x.height/2,behavior:"smooth"})}setTimeout(function(){l.current&&l.current.contains(S)&&l.current.removeChild(S)},3e3),typeof b=="function"&&b(p)}}};return(0,e.jsxs)("div",{className:"annotation-list-container",children:[(0,e.jsx)("div",{className:"annotation-list-header",children:(0,e.jsxs)("h4",{style:{margin:0},children:["\u6279\u6CE8\u5217\u8868 (\u7B2C ",c," \u9875)"]})}),(0,e.jsx)("div",{className:"annotation-list-content",children:t.length===0?(0,e.jsx)(Tn.Z,{description:"\u6682\u65E0\u6279\u6CE8"}):(0,e.jsx)("div",{className:"custom-annotation-list",children:t==null?void 0:t.map(function(i){return(0,e.jsxs)("div",{className:"custom-annotation-item",onClick:function(){return y(i.id)},children:[(0,e.jsxs)("div",{className:"annotation-header",children:[(0,e.jsxs)("div",{className:"annotation-type",children:[(0,e.jsx)("span",{className:"annotation-color-block",style:{backgroundColor:i.color}}),J(i.type)]}),!F&&(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(En.Z,{}),size:"small",danger:!0,onClick:function(r){r.stopPropagation(),R(i.id)}})]}),(0,e.jsxs)("div",{className:"annotation-date",children:["\u521B\u5EFA: ",(i==null?void 0:i.createdAt)||""]}),"content"in i&&(0,e.jsxs)("div",{className:"annotation-content",children:["\u5185\u5BB9:",(0,e.jsx)(Nn.Z,{title:(i==null?void 0:i.content)||"",children:(0,e.jsx)("span",{className:"annotation-content-text",children:i.content})})]}),(0,e.jsx)("div",{className:"annotation-comment",children:(0,e.jsx)(vt.Z.TextArea,{rows:2,value:i.comment||"",onChange:function(r){var C;return M(i.id,(r==null||(C=r.target)===null||C===void 0?void 0:C.value)||"")},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9...",disabled:F,onClick:function(r){return r.stopPropagation()}})})]},i.id)})})})]})},Br=Zr,Ln=N(51947),Mn=N(84646),Zn=N(90755),Bn=N(21082),Rn=N(64593),Yn=N(40666),$t=N(16801),Un=N(47389),On=N(69980),In=N(50797),Hn=N(52745),zn=N(63129),Bt=N(51663),Rr=function(n){var t=n.icon,c=n.active,l=c===void 0?!1:c,h=n.disabled,s=h===void 0?!1:h,F=n.onClick;return(0,e.jsx)("div",{className:"annotation-tool-button ".concat(l?"active":""," ").concat(s?"disabled":""),onClick:function(){s||F()},children:(0,e.jsx)("span",{children:t})})},Qe=Rr,Yr=function(n){var t=n.activeTool,c=n.activeColor,l=n.activeLineStyle,h=l===void 0?"solid":l,s=n.onToolSelect,F=n.onColorChange,T=n.onLineStyleChange,b=n.readOnly,R=b===void 0?!1:b,u=!!R;if(console.log("AnnotationToolbar\u63A5\u6536\u5230\u7684readOnly:",R,wn()(R),"isReadOnly =",u),u)return console.log("AnnotationToolbar \u4E0D\u6E32\u67D3\uFF0C\u56E0\u4E3A isReadOnly =",u),null;var J=["#FFFF00","#FF0000","#00FF00","#0000FF","#FF00FF","#00FFFF","#FFA500","#000000","#FFFFFF","#888888"],M=function(i,p){F(p)};return(0,e.jsx)("div",{className:"annotation-toolbar",children:(0,e.jsxs)("div",{className:"annotation-tools",children:[(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Ln.Z,{}),active:t==="highlight",disabled:!0,onClick:function(){return s("highlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u9AD8\u4EAE"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Mn.Z,{}),active:t==="strikethrough",disabled:!0,onClick:function(){return s("strikethrough")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5220\u9664\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Zn.Z,{}),active:t==="underline",disabled:!0,onClick:function(){return s("underline")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u4E0B\u5212\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Bn.Z,{}),active:t==="text",onClick:function(){return s("text")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u6587\u672C"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Rn.Z,{}),active:t==="rectangle",onClick:function(){return s("rectangle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u77E9\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Yn.Z,{style:{transform:"rotate(45deg)"}}),active:t==="circle",onClick:function(){return s("circle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5706\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)($t.Z,{}),active:t==="ellipse",onClick:function(){return s("ellipse")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u692D\u5706"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Un.Z,{}),active:t==="freedraw",onClick:function(){return s("freedraw")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u7ED8\u5236"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(On.Z,{}),active:t==="freehighlight",onClick:function(){return s("freehighlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u9AD8\u4EAE"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(In.Z,{}),active:t==="signature",onClick:function(){return s("signature")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u7B7E\u540D"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)($t.Z,{style:{color:"#ff4d4f"}}),active:t==="stamp",onClick:function(){return s("stamp")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u76D6\u7AE0"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(Hn.Z,{}),active:h==="solid",onClick:function(){return T("solid")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5B9E\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Qe,{icon:(0,e.jsx)(zn.Z,{}),active:h==="dashed",onClick:function(){return T("dashed")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u865A\u7EBF"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsx)("div",{className:"tool-group",children:(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Bt.Z,{value:c,size:"small",className:"color-picker",format:"hex",arrow:!1,placement:"bottomRight",presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:J}],onChange:M}),(0,e.jsx)("span",{className:"tool-name",children:"\u989C\u8272\u9009\u62E9"})]})})]})})},Ur=Yr,Wn=N(60219),Vn=N(30019),rt=N(85576),Or=function(n){var t=n.fileUrl,c=n.fileName,l=n.annotations,h=n.currentPage,s=n.numPages,F=n.scale,T=n.sidebarVisible,b=n.readOnly,R=n.pdfLayerRef,u=n.toggleSidebar,J=n.setCurrentPage,M=n.zoomOut,y=n.zoomIn,i=n.onSave,p=(0,f.useState)(!1),r=te()(p,2),C=r[0],O=r[1],S=(0,f.useState)(""),ve=te()(S,2),L=ve[0],H=ve[1],$=function(){var P=ze()(we()().mark(function d(){var x,j,Z,X,m,re;return we()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(g.prev=0,!i){g.next=28;break}if(typeof t!="string"){g.next=26;break}if(!t.startsWith("data:")){g.next=11;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);x=new Blob([X],{type:"application/pdf"}),g.next=24;break;case 11:if(!t.startsWith("http")){g.next=24;break}return g.prev=12,g.next=15,fetch(t);case 15:return re=g.sent,g.next=18,re.blob();case 18:x=g.sent,g.next=24;break;case 21:g.prev=21,g.t0=g.catch(12),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",g.t0);case 24:g.next=27;break;case 26:(t instanceof Blob||t instanceof File)&&(x=t);case 27:i(l,x);case 28:ie.ZP.success("\u6279\u6CE8\u5DF2\u4FDD\u5B58"),g.next=34;break;case 31:g.prev=31,g.t1=g.catch(0),ie.ZP.error("\u4FDD\u5B58\u6279\u6CE8\u5931\u8D25");case 34:case"end":return g.stop()}},d,null,[[0,31],[12,21]])}));return function(){return P.apply(this,arguments)}}(),K=function(){var P=ze()(we()().mark(function d(x,j){var Z,X,m,re,oe,g,Y;return we()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(D.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u5904\u7406PDF\u9875\u9762...",key:x}),R.current){D.next=5;break}return ie.ZP.error({content:"\u65E0\u6CD5\u83B7\u53D6PDF\u5185\u5BB9",key:x}),D.abrupt("return");case 5:return Z=h,O(!0),H("\u51C6\u5907\u4E2D..."),D.prev=8,D.next=11,N.e(120).then(N.t.bind(N,46020,23));case 11:X=D.sent,m=X.default,re=[],oe=1;case 15:if(!(oe<=s)){D.next=28;break}return g="\u6B63\u5728\u5904\u7406\u7B2C ".concat(oe," \u9875 / \u5171 ").concat(s," \u9875..."),H(g),J(oe),D.next=21,new Promise(function(q){setTimeout(function(){q()},1e3)});case 21:return D.next=23,m(R.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,ignoreElements:function(Q){var W;return((W=Q.classList)===null||W===void 0?void 0:W.contains("print-ignore"))||!1}});case 23:Y=D.sent,re.push(Y);case 25:oe++,D.next=15;break;case 28:return J(Z),D.next=31,j(re);case 31:D.next=37;break;case 33:D.prev=33,D.t0=D.catch(8),console.error("\u5904\u7406PDF\u9875\u9762\u5931\u8D25:",D.t0),ie.ZP.error({content:"\u5904\u7406PDF\u9875\u9762\u5931\u8D25",key:x});case 37:return D.prev=37,O(!1),D.finish(37);case 40:D.next=47;break;case 42:D.prev=42,D.t1=D.catch(0),console.error("\u6355\u83B7\u9875\u9762\u9519\u8BEF:",D.t1),ie.ZP.error({content:"\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:x}),O(!1);case 47:case"end":return D.stop()}},d,null,[[0,42],[8,33,37,40]])}));return function(x,j){return P.apply(this,arguments)}}(),k=function(){var P=ze()(we()().mark(function d(){var x,j,Z,X,m,re,oe,g,Y,U,D,q;return we()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(W.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u6253\u5370\u4E2D...",key:"printLoading"}),x=null,typeof t!="string"){W.next=29;break}if(!t.startsWith("data:")){W.next=12;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);x=new Blob([X],{type:"application/pdf"}),W.next=27;break;case 12:if(!t.startsWith("http")){W.next=27;break}return W.prev=13,W.next=16,fetch(t);case 16:return re=W.sent,W.next=19,re.blob();case 19:x=W.sent,W.next=27;break;case 22:return W.prev=22,W.t0=W.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",W.t0),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"printLoading"}),W.abrupt("return");case 27:W.next=30;break;case 29:t instanceof Blob?x=t:t instanceof File&&(x=new Blob([t],{type:t.type}));case 30:if(x){W.next=33;break}return ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"printLoading"}),W.abrupt("return");case 33:oe=URL.createObjectURL(x),g=document.createElement("iframe"),g.style.position="absolute",g.style.width="0px",g.style.height="0px",g.style.border="0",g.style.left="-1000px",document.body.appendChild(g),Y=Date.now(),U=!1,D=!1,q=function ke(){if(!D)try{if(!document.body.contains(g)){D=!0,URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}if(U&&document.hasFocus()&&Date.now()-Y>1e3){D=!0,document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}setTimeout(ke,3e3)}catch(Pe){console.error("\u68C0\u67E5\u6253\u5370\u72B6\u6001\u5931\u8D25:",Pe),document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe)}},g.onload=function(){ie.ZP.success({content:"\u6587\u6863\u5DF2\u51C6\u5907\u597D\uFF0C\u6B63\u5728\u6253\u5F00\u6253\u5370\u5BF9\u8BDD\u6846...",key:"printLoading",duration:2}),setTimeout(function(){try{g.contentWindow?(g.contentWindow.focus(),g.contentWindow.print(),U=!0,setTimeout(q,1e3)):(ie.ZP.error({content:"\u6253\u5370\u5931\u8D25: \u65E0\u6CD5\u8BBF\u95EE\u6253\u5370\u7A97\u53E3",key:"printLoading"}),document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe))}catch(ke){console.error("\u6253\u5370\u5931\u8D25:",ke),document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25",key:"printLoading"})}},800)},g.src=oe,W.next=53;break;case 49:W.prev=49,W.t1=W.catch(0),console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",W.t1),ie.ZP.error({content:"\u6253\u5370\u51C6\u5907\u5931\u8D25",key:"printLoading"});case 53:case"end":return W.stop()}},d,null,[[0,49],[13,22]])}));return function(){return P.apply(this,arguments)}}(),v=function(d){var x;if(d==="original"){k();return}var j=document.createElement("iframe");j.style.position="absolute",j.style.width="0px",j.style.height="0px",j.style.border="0",j.style.left="-1000px",document.body.appendChild(j);var Z=(x=j.contentWindow)===null||x===void 0?void 0:x.document;if(!Z){document.body.removeChild(j),ie.ZP.error("\u521B\u5EFA\u6253\u5370\u6846\u67B6\u5931\u8D25");return}Z.open(),Z.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>PDF\u6253\u5370</title>
          <style>
            body {
              margin: 0;
              padding: 0;
              font-family: Arial, sans-serif;
            }
            .print-container {
              max-width: 100%;
              margin: 0;
              padding: 0;
            }
            .page-container {
              page-break-after: always;
              margin: 0;
              padding: 0;
              border: none;
            }
            .page-container:last-child {
              page-break-after: avoid;
              margin: 0;
            }
            img {
              max-width: 100%;
              display: block;
              margin: 0;
              padding: 0;
              box-shadow: none;
              border: none;
            }
            @media print {
              body {
                margin: 0;
                padding: 0;
              }
              .print-container {
                margin: 0;
                padding: 0;
              }
              .page-container {
                width: 100%;
                height: auto;
                page-break-after: always;
                margin: 0;
                padding: 0;
                border: none;
              }
              @page {
                margin: 0;
              }
            }
          </style>
        </head>
        <body>
          <div class="print-container" id="print-container">
            <!-- \u9875\u9762\u5185\u5BB9\u5C06\u52A8\u6001\u63D2\u5165\u8FD9\u91CC -->
          </div>
        </body>
      </html>
    `),Z.close();var X=Z.getElementById("print-container");if(!X){document.body.removeChild(j),ie.ZP.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25");return}K("printLoading",function(){var m=ze()(we()().mark(function re(oe){return we()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:try{oe.forEach(function(U){var D=Z.createElement("div");D.className="page-container";var q=Z.createElement("img");q.src=U.toDataURL("image/png"),D.appendChild(q),X.appendChild(D)}),ie.ZP.success({content:"\u6253\u5370\u51C6\u5907\u5B8C\u6210",key:"printLoading",duration:1}),setTimeout(function(){try{var U,D;(U=j.contentWindow)===null||U===void 0||U.focus(),(D=j.contentWindow)===null||D===void 0||D.print(),setTimeout(function(){document.body.contains(j)&&document.body.removeChild(j)},1e3)}catch(q){console.error("\u6253\u5370\u8C03\u7528\u5931\u8D25:",q),document.body.removeChild(j),ie.ZP.error("\u6253\u5370\u8C03\u7528\u5931\u8D25")}},500)}catch(U){console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",U),document.body.removeChild(j),ie.ZP.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25")}case 1:case"end":return Y.stop()}},re)}));return function(re){return m.apply(this,arguments)}}())},z=function(){var P=ze()(we()().mark(function d(){return we()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:K("downloadLoading",function(){var Z=ze()(we()().mark(function X(m){var re,oe,g,Y,U,D,q;return we()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.prev=0,W.next=3,N.e(361).then(N.bind(N,36361));case 3:for(re=W.sent,oe=re.default,g=new oe({orientation:"portrait",unit:"px",format:[m[0].width/2,m[0].height/2]}),Y=0;Y<m.length;Y++)U=m[Y],D=U.toDataURL("image/jpeg",.85),Y>0&&g.addPage([U.width/2,U.height/2]),g.addImage(D,"JPEG",0,0,U.width/2,U.height/2);q=c||"document-with-annotations.pdf",g.save(q),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"}),W.next=16;break;case 12:W.prev=12,W.t0=W.catch(0),console.error("\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25:",W.t0),ie.ZP.error({content:"\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25",key:"downloadLoading"});case 16:case"end":return W.stop()}},X,null,[[0,12]])}));return function(X){return Z.apply(this,arguments)}}()).catch(function(Z){console.log("",Z),ie.ZP.error({content:"\u6355\u83B7PDF\u5931\u8D25",key:"downloadLoading"})});case 1:case"end":return j.stop()}},d)}));return function(){return P.apply(this,arguments)}}(),V=function(){var P=ze()(we()().mark(function d(){var x,j,Z,X,m,re,oe,g,Y,U,D;return we()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(Q.prev=0,x=null,j=c||"document.pdf",typeof t!="string"){Q.next=30;break}if(!t.startsWith("data:")){Q.next=12;break}for(Z=t.split(",")[1],X=atob(Z),m=new Uint8Array(X.length),re=0;re<X.length;re++)m[re]=X.charCodeAt(re);x=new Blob([m],{type:"application/pdf"}),Q.next=28;break;case 12:if(!t.startsWith("http")){Q.next=28;break}return Q.prev=13,Q.next=16,fetch(t);case 16:return oe=Q.sent,Q.next=19,oe.blob();case 19:x=Q.sent,c||(g=t.split("/"),Y=g[g.length-1],Y&&Y.includes(".pdf")&&(j=Y)),Q.next=28;break;case 23:return Q.prev=23,Q.t0=Q.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",Q.t0),ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"downloadLoading"}),Q.abrupt("return");case 28:Q.next=31;break;case 30:t instanceof Blob?x=t:t instanceof File&&(x=new Blob([t],{type:t.type}),c||(j=t.name));case 31:if(x){Q.next=34;break}return ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"downloadLoading"}),Q.abrupt("return");case 34:U=URL.createObjectURL(x),D=document.createElement("a"),D.href=U,D.download=j,document.body.appendChild(D),D.click(),setTimeout(function(){document.body.removeChild(D),URL.revokeObjectURL(U),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"})},100),Q.next=47;break;case 43:Q.prev=43,Q.t1=Q.catch(0),console.error("\u4E0B\u8F7D\u539F\u59CBPDF\u5931\u8D25:",Q.t1),ie.ZP.error({content:"\u4E0B\u8F7D\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:"downloadLoading"});case 47:case"end":return Q.stop()}},d,null,[[0,43],[13,23]])}));return function(){return P.apply(this,arguments)}}(),B=function(d){rt.Z.info({title:d==="print"?"\u9009\u62E9\u6253\u5370\u7C7B\u578B":"\u9009\u62E9\u4E0B\u8F7D\u7C7B\u578B",icon:null,centered:!0,okText:"\u53D6\u6D88",content:(0,e.jsxs)("div",{className:"download-options",style:{marginTop:16,display:"flex",justifyContent:"center"},children:[l!=null&&l.length?(0,e.jsx)(ye.ZP,{type:"primary",style:{marginRight:16,height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){v("with-annotations");return}z()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u5E26\u6279\u6CE8\u7684PDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u5305\u542B\u6240\u6709\u6279\u6CE8\u6807\u8BB0)"})]})}):null,(0,e.jsx)(ye.ZP,{type:"primary",style:{height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){v("original");return}V()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u539F\u59CBPDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u4E0D\u542B\u6279\u6CE8)"})]})})]}),width:500})};return(0,e.jsxs)(e.Fragment,{children:[C&&(0,e.jsxs)("div",{className:"pdf-print-mask",children:[(0,e.jsx)("div",{className:"print-message",children:"\u6B63\u5728\u5904\u7406PDF\u6587\u4EF6\uFF0C\u8BF7\u52FF\u5173\u95ED\u6216\u64CD\u4F5C\u9875\u9762"}),(0,e.jsx)("div",{className:"print-progress",children:L})]}),(0,e.jsx)("div",{className:"pdf-annotation-header",children:(0,e.jsxs)("div",{className:"pdf-annotation-actions",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-sidebar",style:{cursor:"pointer"},onClick:function(){return u(!T)},children:T?(0,e.jsx)(on.Z,{className:"actions-sidebar-menu"}):(0,e.jsx)(an.Z,{className:"actions-sidebar-menu"})}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-option",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-page",children:"".concat(h," / ").concat(s)}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"pdf-annotation-actions-divider"}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-zoom",children:[(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(ln.Z,{}),onClick:M}),(0,e.jsxs)("span",{style:{margin:"0 8px"},children:[Math.round(F*100),"%"]}),(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(sn.Z,{}),onClick:y})]})]}),!b&&(0,e.jsxs)("div",{className:"pdf-annotation-actions-save",children:[(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(Wn.Z,{}),type:"text",onClick:$}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(cn.Z,{}),type:"text",onClick:function(){return B("download")}}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(Vn.Z,{}),type:"text",onClick:function(){return B("print")}})]})]})})]})},Ir=Or,Hr=N(89724),Kn=N.n(Hr),qt=new Set,zr=function(n){if(!qt.has(n)){var t=n.querySelectorAll(".react-pdf__Page__textContent span, .react-pdf__Page__textContent div");t.forEach(function(s){var F=s;F.style.userSelect="text",F.style.webkitUserSelect="text",F.style.mozUserSelect="text",F.style.msUserSelect="text",F.style.cursor="text",F.style.position="relative",F.style.zIndex="2",F.style.color=F.style.color||"inherit",F.style.pointerEvents="auto"});var c=n.querySelectorAll("p, span, div:not(.konvajs-content):not([data-highlight-id])");c.forEach(function(s){var F=s;F.style.cursor="text",F.style.userSelect="text"});var l=n.querySelector(".react-pdf__Page__textContent");if(l){var h=l;h.style.userSelect="text",h.style.webkitUserSelect="text",h.style.mozUserSelect="text",h.style.msUserSelect="text",h.style.zIndex="2",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.right="0",h.style.bottom="0",h.style.pointerEvents="auto"}qt.add(n)}},Wr=function(n){var t=n.pageNumber,c=n.scale,l=n.activeTool,h=n.activeColor,s=n.pdfLayerRef,F=n.annotations,T=n.onAnnotationAdd,b=n.onAnnotationRemove,R=n.onToolReset,u=n.readOnly,J=u===void 0?!1:u,M=n.zIndex,y=M===void 0?6:M,i=(0,f.useRef)(null),p=(0,f.useState)(!1),r=te()(p,2),C=r[0],O=r[1],S=(0,f.useState)(),ve=te()(S,2),L=ve[1],H=(0,f.useCallback)(function(){return L({})},[]);(0,f.useEffect)(function(){if(s.current){qt.has(s.current)&&qt.delete(s.current);var k=s.current.querySelectorAll(".web-highlighter-wrapper, [data-highlight-id]");k.forEach(function(z){try{z.remove()}catch(V){console.error("\u6E05\u7406\u73B0\u6709\u9AD8\u4EAE\u5931\u8D25:",V)}}),zr(s.current);try{if(i.current)try{i.current.dispose()}catch(z){console.error("\u6E05\u7406\u65E7\u9AD8\u4EAE\u5668\u5B9E\u4F8B\u5931\u8D25:",z)}var v=new(Kn())({$root:s.current,exceptSelectors:["canvas",".konvajs-content",".annotation-layer","[data-highlight-id]",".text-selection-preview"],wrapTag:"span",style:{className:"web-highlighter-selection",style:{display:"inline"}}});v.includeSelector=[".react-pdf__Page__textContent"],v.devicePixelRatio=window.devicePixelRatio||1,i.current=v,i.current.run()}catch(z){console.error("\u521D\u59CB\u5316web-highlighter\u5931\u8D25:",z)}return function(){if(i.current)try{i.current.dispose(),i.current=null}catch(z){console.error("\u6E05\u7406\u9AD8\u4EAE\u5668\u5931\u8D25:",z)}}}},[s,t]);var $=function(v,z,V){setTimeout(function(){try{var B=document.querySelectorAll('[data-highlight-id="'.concat(v,'"], .web-highlighter-selection[data-highlight-source="').concat(v,'"]'));B&&B.length>0&&B.forEach(function(P){var d=P;d.style.display="inline",d.style.position="relative",d.style.zIndex="5",d.style.pointerEvents="auto",z==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):z==="underline"?(d.style.textDecoration="underline",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):z==="highlight"&&(d.style.backgroundColor=V,d.style.opacity="0.3",d.style.mixBlendMode="multiply"),d.classList.add("pdf-text-".concat(z))})}catch(P){console.error("\u5E94\u7528\u6837\u5F0F\u5931\u8D25:",P)}},50)},K=function(){if(s.current){var v=s.current.querySelectorAll("[data-highlight-id]"),z=new Map;v.forEach(function(V){var B=V.getAttribute("data-highlight-id");if(B)if(z.has(B))try{V.remove()}catch(P){console.error("\u6E05\u7406\u91CD\u590D\u9AD8\u4EAE\u5931\u8D25:",P)}else z.set(B,!0)})}};return(0,f.useEffect)(function(){if(!(!i.current||J)){var k=function(V){var B=V.sources;if(!(!l||!B||B.length===0)){var P=B[0],d={id:P.id||Date.now().toString(),type:l,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:h,opacity:l==="highlight"?.3:1,text:P.text||"",rects:P.rects||[],highlightId:P.id};T(d),O(!1),$(P.id,l,h),H(),K(),R==null||R()}},v=function(V){var B=V.id;l||window.confirm("\u662F\u5426\u5220\u9664\u6B64\u6279\u6CE8\uFF1F")&&(i.current&&i.current.remove(B),b(B))};return i.current.on("selection:create",k),i.current.on("click",v),function(){i.current&&(i.current.off("selection:create",k),i.current.off("click",v))}}},[l,h,t,T,b,J,H,R]),(0,f.useEffect)(function(){if(!(!i.current||J)){var k=function(){var V;if(l){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var P=B.getRangeAt(0);(V=s.current)!==null&&V!==void 0&&V.contains(P.commonAncestorContainer)&&O(!0)}}},v=function(){var V;if(!(!l||!i.current)){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var P=B.getRangeAt(0);if((V=s.current)!==null&&V!==void 0&&V.contains(P.commonAncestorContainer)&&!C){var d=B.toString().trim();if(d){var x={className:"pdf-text-".concat(l)};switch(l){case"highlight":x=w()(w()({},x),{},{backgroundColor:h,opacity:.3,mixBlendMode:"multiply"});break;case"strikethrough":x=w()(w()({},x),{},{textDecoration:"line-through",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break;case"underline":x=w()(w()({},x),{},{textDecoration:"underline",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break}O(!0);try{if(typeof i.current.highlightSelection=="function"){var j,Z=i.current.highlightSelection(x);$(Z,l,h),(j=window.getSelection())===null||j===void 0||j.removeAllRanges(),H(),O(!1),K(),R==null||R()}}catch(X){console.error("\u9AD8\u4EAE\u9009\u533A\u5931\u8D25:",X),O(!1)}}}}}};return document.addEventListener("selectionchange",k),document.addEventListener("mouseup",v),function(){document.removeEventListener("selectionchange",k),document.removeEventListener("mouseup",v)}}},[l,h,s,J,H,C,R]),(0,f.useEffect)(function(){if(!(!i.current||!s.current)){K();var k=F.filter(function(v){return["highlight","strikethrough","underline"].includes(v.type)&&v.pageNumber===t});k.length!==0&&(k.forEach(function(v){try{if(!i.current||!s.current)return;var z=s.current.querySelector('[data-highlight-id="'.concat(v.id,'"]'));if(z){$(v.id,v.type,v.color);return}var V=v;if(typeof i.current.fromStore=="function"&&V.startMeta&&V.endMeta){var B=i.current.fromStore(V.startMeta,V.endMeta,v.text,v.id);$(B,v.type,v.color)}else v.rects&&v.rects.length>0&&v.rects.forEach(function(P){var d=document.createElement("span");d.className="web-highlighter-selection pdf-text-".concat(v.type),d.setAttribute("data-highlight-id",v.id),d.style.position="absolute",d.style.left="".concat(P.x*c,"px"),d.style.top="".concat(P.y*c,"px"),d.style.width="".concat(P.width*c,"px"),d.style.height="".concat(P.height*c,"px"),d.style.zIndex="5",v.type==="highlight"?(d.style.backgroundColor=v.color,d.style.opacity="0.3",d.style.mixBlendMode="multiply"):v.type==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=v.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):v.type==="underline"&&(d.style.textDecoration="underline",d.style.textDecorationColor=v.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"),s.current&&s.current.appendChild(d)})}catch(P){console.error("\u6062\u590D\u6279\u6CE8\u5931\u8D25:",P,v)}}),K())}},[F,t,s,c,H]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:J?"none":"auto",zIndex:y},className:"highlighter-layer",children:(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:J||!l?"none":"auto",zIndex:y+1,cursor:l?"text":"default"},className:"text-selection-layer"})})},Vr=Wr,Gn=N(64082),Jn=N(36457),Kr=Jn.Z.Dragger,Gr=function(n){var t=n.type,c=n.visible,l=n.onSave,h=n.onCancel,s=(0,f.useState)([]),F=te()(s,2),T=F[0],b=F[1],R=(0,f.useState)(!1),u=te()(R,2),J=u[0],M=u[1],y=(0,f.useState)(null),i=te()(y,2),p=i[0],r=i[1],C=(0,f.useState)(t==="signature"?"#000000":"#ff0000"),O=te()(C,2),S=O[0],ve=O[1],L=(0,f.useState)(t==="signature"?2:4),H=te()(L,2),$=H[0],K=H[1],k=(0,f.useRef)(null),v=400,z=200,V=function(Y){M(!0);var U=Y.target.getStage().getPointerPosition();b([].concat(xe()(T),[{points:[U.x,U.y],stroke:S,strokeWidth:$}]))},B=function(Y){if(J){var U=Y.target.getStage(),D=U.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),b([].concat(xe()(T.slice(0,-1)),[q]))}},P=function(){M(!1)},d=function(Y){Y.evt.preventDefault();var U=Y.target.getStage(),D=U.getPointerPosition();M(!0),b([].concat(xe()(T),[{points:[D.x,D.y],stroke:S,strokeWidth:$}]))},x=function(Y){if(Y.evt.preventDefault(),!!J){var U=Y.target.getStage(),D=U.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),b([].concat(xe()(T.slice(0,-1)),[q]))}},j=function(Y){Y.evt.preventDefault(),M(!1)},Z=function(){b([]),r(null)},X=function(){if(p){l(p);return}if(T.length===0){ie.ZP.warning("\u8BF7\u5148\u7ED8\u5236\u6216\u4E0A\u4F20\u56FE\u50CF");return}if(k.current){var Y=k.current.toDataURL();l(Y)}},m=function(Y,U){ve(U)},re=t==="signature"?["#000000","#0000FF","#FF0000","#008000"]:["#FF0000","#0000FF","#800000","#FF8C00"],oe=[{key:"draw",label:"\u624B\u7ED8",children:(0,e.jsxs)("div",{className:"signature-canvas-container",children:[(0,e.jsx)(me.Hf,{width:v,height:z,ref:k,onMouseDown:V,onMouseMove:B,onMouseUp:P,onTouchStart:d,onTouchMove:x,onTouchEnd:j,style:{border:"1px solid #ddd",borderRadius:4,background:"#fff"},children:(0,e.jsx)(me.mh,{children:T.map(function(g,Y){return(0,e.jsx)(me.x1,{points:g.points,stroke:g.stroke,strokeWidth:g.strokeWidth,tension:.5,lineCap:"round",lineJoin:"round"},Y)})})}),(0,e.jsxs)("div",{className:"signature-controls",children:[(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u989C\u8272:"}),(0,e.jsx)(Bt.Z,{value:S,onChange:m,presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:re}],size:"small",format:"hex"})]}),(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,e.jsx)("div",{className:"stroke-width-control",children:(0,e.jsxs)(Ve.ZP.Group,{value:$,onChange:function(Y){return K(Y.target.value)},buttonStyle:"solid",size:"small",children:[(0,e.jsx)(Ve.ZP.Button,{value:1,children:"\u7EC6"}),(0,e.jsx)(Ve.ZP.Button,{value:3,children:"\u4E2D"}),(0,e.jsx)(Ve.ZP.Button,{value:5,children:"\u7C97"})]})})]}),(0,e.jsxs)("div",{className:"action-buttons",children:[(0,e.jsx)(ye.ZP,{size:"middle",onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{size:"middle",type:"primary",onClick:X,children:"\u4FDD\u5B58"})]})]})]})},{key:"upload",label:"\u4E0A\u4F20",children:p?(0,e.jsxs)("div",{style:{textAlign:"center"},children:[(0,e.jsx)("img",{src:p,alt:"\u4E0A\u4F20\u7684\u56FE\u7247",style:{maxWidth:"100%",maxHeight:200,marginBottom:16,border:"1px solid #ddd",borderRadius:4}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ye.ZP,{onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{type:"primary",onClick:X,children:"\u4F7F\u7528\u6B64\u56FE\u7247"})]})]}):(0,e.jsxs)(Kr,{accept:".png,.jpg,.jpeg",showUploadList:!1,beforeUpload:function(Y){var U=new FileReader;return U.onload=function(D){var q;(q=D.target)!==null&&q!==void 0&&q.result&&r(D.target.result)},U.readAsDataURL(Y),!1},multiple:!1,children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(Gn.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u5230\u6B64\u533A\u57DF\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u652F\u6301\u5355\u4E2A\u56FE\u7247\u4E0A\u4F20\uFF0C\u63A8\u8350\u4F7F\u7528\u900F\u660E\u80CC\u666F\u7684PNG\u56FE\u7247"})]})}];return(0,e.jsx)(rt.Z,{title:t==="signature"?"\u6DFB\u52A0\u7B7E\u540D":"\u6DFB\u52A0\u76D6\u7AE0",open:c,onCancel:h,footer:null,width:500,children:(0,e.jsx)(Qt.Z,{defaultActiveKey:"draw",items:oe})})},Jr=Gr,Xr=function(n){var t=n.onSave,c=n.onCancel,l=n.visible,h=n.curTextNotePanelData,s=h===void 0?{}:h,F=Ye.Z.useForm(),T=te()(F,1),b=T[0],R=Ye.Z.useWatch(["backgroundColor"],b),u=["#FFFFA0","#A0E7E5","#FFC0CB","#FFCBA4","#D3D3D3","#C1FFC1","#FFFFFF"];(0,f.useEffect)(function(){l&&b.setFieldsValue({text:(s==null?void 0:s.text)||"",fontSize:(s==null?void 0:s.fontSize)||12,backgroundColor:(s==null?void 0:s.backgroundColor)||"#FFFFA0"})},[l,s]);var J=function(y){var i=y.text,p=y.fontSize,r=y.backgroundColor;t(i,p,r)};return(0,e.jsx)(rt.Z,{title:"\u6DFB\u52A0\u6587\u672C\u6279\u6CE8",open:l,onCancel:c,footer:[(0,e.jsx)(ye.ZP,{onClick:c,children:"\u53D6\u6D88"},"cancel"),(0,e.jsx)(ye.ZP,{type:"primary",onClick:function(){return b.submit()},children:"\u6DFB\u52A0\u6279\u6CE8"},"save")],width:500,children:(0,e.jsxs)(Ye.Z,{form:b,layout:"vertical",onFinish:J,children:[(0,e.jsx)(Ye.Z.Item,{name:"text",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C"}],children:(0,e.jsx)(vt.Z.TextArea,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C...",autoFocus:!0,style:{padding:"8px",borderRadius:"4px",backgroundColor:R}})}),(0,e.jsx)(Ye.Z.Item,{label:"\u5B57\u4F53\u5927\u5C0F",name:"fontSize",children:(0,e.jsx)(at.Z,{min:1,max:100,style:{width:"200px"},addonAfter:"px"})}),(0,e.jsx)(Ye.Z.Item,{label:"\u80CC\u666F\u989C\u8272",name:"backgroundColor",children:(0,e.jsx)(Bt.Z,{presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:u}],size:"middle",format:"hex",onChange:function(y){var i;b.setFieldValue("backgroundColor",y==null||(i=y.toHexString)===null||i===void 0?void 0:i.call(y))}})})]})})},Qr=Xr,$r=function(n){var t=n.fileUrl,c=n.numPages,l=n.currentPage,h=n.onPageChange,s=(0,f.useRef)(null),F=(0,f.useState)([]),T=te()(F,2),b=T[0],R=T[1],u=(0,f.useState)(!1),J=te()(u,2),M=J[0],y=J[1],i=(0,f.useState)(!1),p=te()(i,2),r=p[0],C=p[1],O=function(){y(!0);for(var H=[],$=1;$<=Math.min(c,20);$++)H.push($);R(H),setTimeout(function(){return C(!0)},500)},S=(0,f.useCallback)(function(){if(!(!s.current||c===0||!r)){for(var L=s.current,H=L.scrollTop,$=L.clientHeight,K=5,k=150,v=Math.max(1,Math.floor(H/k)-K),z=Math.min(c,Math.ceil((H+$)/k)+K),V=[],B=v;B<=z;B++)V.push(B);!V.includes(l)&&l<=c&&V.push(l),R(V)}},[c,l,r]);(0,f.useEffect)(function(){if(!(!s.current||!r)){S();var L=s.current,H=function(){requestAnimationFrame(S)};return L.addEventListener("scroll",H),function(){L==null||L.removeEventListener("scroll",H)}}},[S,r]);var ve=function(){if(!M)return(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7DPDF\u7F29\u7565\u56FE..."});for(var H=[],$=function(v){var z=b.includes(v);H.push((0,e.jsxs)("div",{className:"thumbnail-item ".concat(v===l?"active":""),onClick:function(){return h(v)},children:[(0,e.jsx)("div",{className:"thumbnail-page-number",children:v}),(0,e.jsx)("div",{className:"thumbnail-container",children:z&&(0,e.jsx)(Zt.Z,{pageNumber:v,width:100,renderTextLayer:!1,renderAnnotationLayer:!1,loading:null})})]},v))},K=1;K<=c;K++)$(K);return H.push((0,e.jsx)("div",{style:{height:"20px",flexShrink:0}},"bottom-space")),H};return(0,f.useEffect)(function(){if(s.current&&l&&M&&r){var L=150,H=(l-1)*L,$=s.current,K=$.scrollTop,k=$.clientHeight;(H<K||H>K+k-L)&&$.scrollTo({top:H-k/2+L/2,behavior:"smooth"})}},[l,M,r]),(0,e.jsx)("div",{className:"thumbnail-preview",children:(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:O,loading:(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7D\u6587\u6863\u4E2D..."}),error:(0,e.jsx)("div",{className:"thumbnail-error",children:"PDF\u52A0\u8F7D\u5931\u8D25"}),children:(0,e.jsx)("div",{className:"thumbnail-list",ref:s,children:ve()})})})},qr=$r;Dn().showWarnings=!1;var _t={BASE:6,TOP:9};Lt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Lt.i8,"/pdf.worker.min.mjs");var _r=function(n){var t=n.fileUrl,c=n.fileName,l=n.onSave,h=n.readOnly,s=h===void 0?!1:h,F=n.style,T=F===void 0?{}:F,b=n.className,R=b===void 0?"":b,u=n.annotationList,J=u===void 0?[]:u,M=(0,f.useState)(0),y=te()(M,2),i=y[0],p=y[1],r=(0,f.useState)(1),C=te()(r,2),O=C[0],S=C[1],ve=(0,f.useState)(1),L=te()(ve,2),H=L[0],$=L[1],K=(0,f.useState)({width:0,height:0}),k=te()(K,2),v=k[0],z=k[1],V=(0,f.useState)(!0),B=te()(V,2),P=B[0],d=B[1],x=(0,f.useState)(null),j=te()(x,2),Z=j[0],X=j[1],m=(0,f.useState)("#FFFF00"),re=te()(m,2),oe=re[0],g=re[1],Y=(0,f.useState)("solid"),U=te()(Y,2),D=U[0],q=U[1],Q=(0,f.useState)(!1),W=te()(Q,2),ke=W[0],Pe=W[1],Ue=(0,f.useState)(!1),Ze=te()(Ue,2),Oe=Ze[0],Ae=Ze[1],he=(0,f.useState)({}),le=te()(he,2),a=le[0],o=le[1],I=(0,f.useState)("thumbnails"),E=te()(I,2),A=E[0],G=E[1],ce=(0,f.useState)(!0),ee=te()(ce,2),ne=ee[0],se=ee[1],de=(0,f.useRef)(null),fe=(0,f.useRef)(null),De=Tr(J),Ce=De.annotations,je=De.addAnnotation,Ee=De.updateAnnotation,Je=De.removeAnnotation,gt=(0,f.useRef)(null),yt=function(){var _=[".highlight-container","[data-highlight-id]",".custom-pdf-highlight",".web-highlighter-selection",".web-highlighter-wrapper"];_.forEach(function(be){document.querySelectorAll(be).forEach(function(Se){try{if(Se.textContent)if(Se.parentNode&&Se.parentNode!==document.body){var Fe=Se.textContent,Le=document.createTextNode(Fe);Se.parentNode.replaceChild(Le,Se)}else Se.remove();else Se.remove()}catch(Me){console.error("\u6E05\u7406\u9AD8\u4EAE\u5143\u7D20\u5931\u8D25:",Me)}})});try{document.querySelectorAll("style[data-highlight-style]").forEach(function(be){be.remove()});var ge=document.querySelector(".react-pdf__Page__textContent");ge&&ge.querySelectorAll("span, div").forEach(function(be){be.style.userSelect="text",be.style.webkitUserSelect="text",be.style.pointerEvents="auto"})}catch(be){console.error("\u6E05\u7406web-highlighter\u5143\u7D20\u5931\u8D25:",be)}},lt=function(_){var ge=_.numPages;p(ge),d(!1)},st=function(_){var ge=_.getViewport({scale:1});z({width:ge.width,height:ge.height})},xt=function(_){q(_)},bt=function(_){X(_),(_==="signature"||_==="stamp")&&Pe(!0),_==="text"&&(Ae(!0),o({}))},Ct=function(_,ge){!v.width||!v.height||(je({id:"add-"+et(),type:ge,pageNumber:O,x:v.width/4,y:v.height/4,width:v.width/2,height:ge==="signature"?v.height/8:v.width/4,imageData:_,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#000000",opacity:1}),Pe(!1),X(null))},St=function(_,ge,be){if(!(!v.width||!v.height)){var Se=function(At,qe){var ct=document.createElement("canvas"),We=ct.getContext("2d");if(!We)return{width:200,height:100};We.font="".concat(qe,"px Arial");for(var ut=v.width*.8,dt=At.split(""),Re=[],Te="",He=0;He<dt.length;He++){var It=dt[He],Ht=Te+It,dn=We.measureText(Ht);dn.width>ut&&Te.length>0?(Re.push(Te),Te=It):Te=Ht}Te.length>0&&Re.push(Te);for(var hn=qe*1.5,vn=Math.max(Re.length*hn+16,40),Pt=0,Ft=0,zt=Re;Ft<zt.length;Ft++){var fn=zt[Ft],gn=We.measureText(fn).width;Pt=Math.max(Pt,gn)}return{width:Math.min(Math.max(Pt+16,100),ut),height:vn}};if(a!=null&&a.id){var Fe=Se(_,ge),Le=Fe.width,Me=Fe.height;Ee(a.id,{text:_,fontSize:ge,backgroundColor:be,width:Le,height:Me,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})}else{var tt=Se(_,ge),Ie=tt.width,kt=tt.height,wt={id:"add-"+et(),type:"text",pageNumber:O,x:(v.width-Ie)/2,y:v.height/4,width:Ie,height:kt,text:_,fontSize:ge,backgroundColor:be,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#333333",opacity:1};je(wt)}Ae(!1),X(null),o({})}},pt=function(_){fe.current&&yt(),S(_)},jt=function(){return $(H*1.2)},Dt=function(){return $(H/1.2)},mt=function(){se(!ne)},Be=function(_){["rectangle","circle","ellipse","freedraw","freehighlight"].includes(_.type)?je(w()(w()({},_),{},{lineStyle:D})):je(_)};return(0,e.jsxs)("div",{className:"pdf-annotation-container ".concat(R),style:T,ref:de,children:[(0,e.jsx)(Ir,{fileUrl:t,fileName:c,annotations:xe()(Ce),currentPage:O,numPages:i,readOnly:s,pdfLayerRef:fe,scale:H,sidebarVisible:ne,toggleSidebar:mt,setCurrentPage:S,zoomOut:Dt,zoomIn:jt,onSave:l}),s?null:(0,e.jsx)(Ur,{activeTool:Z,activeColor:oe,activeLineStyle:D,onToolSelect:bt,onColorChange:g,onLineStyleChange:xt,readOnly:s}),(0,e.jsxs)("div",{className:"pdf-annotation-content",children:[(0,e.jsx)("div",{className:"pdf-annotation-sidebar ".concat(ne?"visible":"hidden"),children:(0,e.jsx)(Qt.Z,{activeKey:A,onChange:function(_){return G(_)},items:[{key:"thumbnails",label:"\u9875\u9762\u9884\u89C8",children:(0,e.jsx)(qr,{fileUrl:t,numPages:i,currentPage:O,onPageChange:pt})},{key:"annotations",label:"\u6279\u6CE8\u5217\u8868",children:(0,e.jsx)(Br,{annotations:Ce==null?void 0:Ce.filter(function(ue){return ue.pageNumber===O}),currentPage:O,pdfLayerRef:fe,scale:H,handlePageChange:pt,onAnnotationDelete:Je,onAnnotationUpdate:Ee,readOnly:s})}]})}),(0,e.jsx)("div",{className:"pdf-annotation-main",children:(0,e.jsxs)("div",{className:"pdf-viewer",ref:fe,children:[(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:lt,loading:(0,e.jsxs)("div",{className:"pdf-loading",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"0 0 1024 1024",width:"48",height:"48",fill:"#1677ff",children:[(0,e.jsx)("path",{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}),(0,e.jsx)("path",{d:"M304 544h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0-144h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 288h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"14px",fontWeight:500,textAlign:"center"},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]}),error:(0,e.jsxs)("div",{className:"pdf-error",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"64 64 896 896",width:"48",height:"48",fill:"#ff4d4f",children:[(0,e.jsx)("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}),(0,e.jsx)("path",{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"16px",fontWeight:500,marginBottom:"8px"},children:"\u52A0\u8F7DPDF\u5931\u8D25"}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.65)",fontSize:"14px"},children:"\u8BF7\u68C0\u67E5\u6587\u4EF6\u683C\u5F0F\u6216\u7F51\u7EDC\u8FDE\u63A5\u540E\u91CD\u8BD5"})]}),children:(0,e.jsx)(Zt.Z,{pageNumber:O,scale:H,onLoadSuccess:st,renderTextLayer:!0,renderAnnotationLayer:!0,inputRef:gt})}),!P&&v.width>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Vr,{pageNumber:O,scale:H,activeTool:["highlight","strikethrough","underline"].includes(Z)?Z:null,activeColor:oe,pdfLayerRef:fe,annotations:Ce.filter(function(ue){return ue.pageNumber===O}),onAnnotationAdd:je,onAnnotationRemove:Je,onAnnotationUpdate:Ee,onToolReset:function(){return X(null)},readOnly:s,zIndex:["highlight","strikethrough","underline"].includes(Z)?_t.TOP:_t.BASE}),(0,e.jsx)(Mr,{pageNumber:O,scale:H,width:v.width,height:v.height,activeTool:["highlight","strikethrough","underline"].includes(Z)?null:Z,activeColor:oe,activeLineStyle:D,annotations:Ce.filter(function(ue){return ue.pageNumber===O}),readOnly:s,zIndex:["highlight","strikethrough","underline"].includes(Z)?_t.BASE:_t.TOP,onAnnotationAdd:Be,onAnnotationUpdate:Ee,onAnnotationRemove:Je,onToolReset:function(){return X(null)},setShowTextNotePanel:Ae,setTextNotePanelData:o})]})]})})]}),ke&&Z&&(0,e.jsx)(Jr,{visible:ke,type:Z,onSave:function(_){return Ct(_,Z)},onCancel:function(){Pe(!1),X(null)}}),Oe&&(0,e.jsx)(Qr,{onSave:St,onCancel:function(){Ae(!1),X(null),o({})},visible:Oe,curTextNotePanelData:a})]})},ea=_r,ta=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=(0,f.useState)(n),c=te()(t,2),l=c[0],h=c[1],s=(0,f.useCallback)(function(M){h(function(y){return[].concat(xe()(y),[M])})},[]),F=(0,f.useCallback)(function(M,y){h(function(i){return i.map(function(p){return p.id===M?w()(w()(w()({},p),y),{},{modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}):p})})},[]),T=(0,f.useCallback)(function(M){h(function(y){return y.filter(function(i){return i.id!==M})})},[]),b=(0,f.useCallback)(function(){h([])},[]),R=(0,f.useCallback)(function(M){return l.filter(function(y){return y.pageNumber===M})},[l]),u=(0,f.useCallback)(function(M){return l.filter(function(y){return y.type===M})},[l]),J=(0,f.useCallback)(function(M){h(M)},[]);return{annotations:l,addAnnotation:s,updateAnnotation:F,removeAnnotation:T,clearAnnotations:b,getAnnotationsByPage:R,getAnnotationsByType:u,importAnnotations:J}},na=function(n,t,c){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Arial",h=document.createElement("canvas"),s=h.getContext("2d");if(!s)return{width:200,height:100};s.font="".concat(t,"px ").concat(l);for(var F=n.split(" "),T=[],b=F[0]||"",R=1;R<F.length;R++){var u=F[R],J=s.measureText(b+" "+u).width;J<c?b+=" "+u:(T.push(b),b=u)}T.push(b);for(var M=t*1.2,y=T.length*M+16,i=0,p=0,r=T;p<r.length;p++){var C=r[p],O=s.measureText(C).width;i=Math.max(i,O)}return{width:Math.min(i+16,c),height:y}},ra=function(n){var t=n.pageNumber,c=n.scale,l=n.width,h=n.height,s=n.activeTool,F=n.activeColor,T=n.activeLineStyle,b=n.annotations,R=n.readOnly,u=R===void 0?!1:R,J=n.zIndex,M=J===void 0?5:J,y=n.onAnnotationAdd,i=n.onAnnotationUpdate,p=n.onAnnotationRemove,r=n.onToolReset,C=n.setShowTextNotePanel,O=n.setTextNotePanelData,S=(0,f.useRef)(null),ve=(0,f.useRef)(null),L=(0,f.useRef)(null),H=(0,f.useState)(null),$=te()(H,2),K=$[0],k=$[1],v=(0,f.useState)(!1),z=te()(v,2),V=z[0],B=z[1],P=(0,f.useState)(null),d=te()(P,2),x=d[0],j=d[1],Z=(0,f.useState)(null),X=te()(Z,2),m=X[0],re=X[1],oe=b.filter(function(le){return["rectangle","circle","ellipse"].includes(le.type)}),g=b.filter(function(le){return["freedraw","freehighlight"].includes(le.type)}),Y=b.filter(function(le){return["signature","stamp"].includes(le.type)}),U=b.filter(function(le){return le.type==="text"}),D=function(a){if(K){var o=a.target,I=o.id(),E=o.scaleX(),A=o.scaleY();try{var G=b.find(function(He){return He.id===I});if(!G)return;var ce,ee=[];switch(G.type){case"rectangle":{var ne=o.width()*E,se=o.height()*A,de=o.x(),fe=o.y();i(I,{x:de,y:fe,width:ne,height:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"circle":{var De=o.width()*E,Ce=o.height()*A,je=Math.max(De,Ce)/2,Ee=o.x(),Je=o.y(),gt=Ee-je,yt=Je-je;i(I,{x:gt,y:yt,width:je*2,height:je*2,radius:je,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"ellipse":{var lt=o.width()*E,st=o.height()*A,xt=o.x(),bt=o.y(),Ct=xt-lt/2,St=bt-st/2;i(I,{x:Ct,y:St,width:lt,height:st,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"signature":case"stamp":{var pt=o.width()*E,jt=o.height()*A,Dt=o.x(),mt=o.y();i(I,{x:Dt,y:mt,width:pt,height:jt,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});break}case"freedraw":case"freehighlight":{ce=G;var Be=xe()(ce.points);try{for(var ue=1/0,_=1/0,ge=-1/0,be=-1/0,Se=0;Se<Be.length;Se+=2)ue=Math.min(ue,Be[Se]),ge=Math.max(ge,Be[Se]),_=Math.min(_,Be[Se+1]),be=Math.max(be,Be[Se+1]);var Fe=(ue+ge)/2,Le=(_+be)/2,Me=o.x(),tt=o.y();ee=[];for(var Ie=0;Ie<Be.length;Ie+=2){var kt=Be[Ie]-Fe,wt=Be[Ie+1]-Le,Ot=Me+kt*E,At=tt+wt*A;ee.push(Ot,At)}i(I,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")}),o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}catch(He){o.scaleX(1),o.scaleY(1),o.position({x:0,y:0})}break}case"text":{var qe,ct=o.width()*E,We=o.height()*A,ut=o.x()/c,dt=o.y()/c;i(I,{x:ut,y:dt,width:ct/c,height:We/c,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")});var Re=(qe=o.getStage())===null||qe===void 0?void 0:qe.findOne("#text-".concat(I));if(Re){var Te;Re.position({x:o.x()+4*c,y:o.y()+4*c}),Re.width((ct/c-8)*c),Re.height((We/c-8)*c),(Te=Re.getLayer())===null||Te===void 0||Te.batchDraw()}break}}}catch(He){console.log("\u66F4\u65B0\u6279\u6CE8\u5931\u8D25:",He)}o.scaleX(1),o.scaleY(1)}},q=function(a){if(!(u||!s)){var o=a.target===a.currentTarget;if(o){var I=S.current;if(I){var E=I.getPointerPosition();if(E){var A=E.x/c,G=E.y/c;switch(s){case"freedraw":case"freehighlight":{B(!0);var ce=s==="freedraw"?2:10,ee={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:s==="freedraw"?1:.5,points:[A,G],strokeWidth:ce,lineStyle:T};j(ee);break}case"rectangle":case"circle":case"ellipse":{var ne={id:Date.now().toString(),type:s,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:F,opacity:1,x:A,y:G,width:0,height:0,strokeWidth:2,lineStyle:T};re(ne);break}case"text":{r&&r();break}default:break}}}}}},Q=function(a){if(!u){var o=a.target.getStage();if(o){var I=o.getPointerPosition();if(I){var E=I.x/c,A=I.y/c;if(V&&x&&j(w()(w()({},x),{},{points:[].concat(xe()(x.points),[E,A])})),m){var G=E-m.x,ce=A-m.y;re(w()(w()({},m),{},{width:G,height:ce,radius:Math.max(Math.abs(G||0),Math.abs(ce||0))/2}))}}}}},W=function(){if(!u&&(V&&x&&(x.points.length>4&&(y(x),r==null||r()),B(!1),j(null)),m)){if(Math.abs(m.width||0)>5&&Math.abs(m.height||0)>5){var a=m.width||0,o=m.height||0,I=a<0?m.x+a:m.x,E=o<0?m.y+o:m.y,A=Math.abs(a),G=Math.abs(o);y(w()(w()({},m),{},{x:I,y:E,width:A,height:G,radius:m.type==="circle"?Math.max(A,G)/2:void 0})),r==null||r()}re(null)}},ke=function(a){if(!u){var o=a.target.getStage();if(o){if(a.target===a.currentTarget){k(null);return}var I=a.target,E=I.id();s||k(E||null)}}},Pe=function(){return oe.map(function(a){var o=K===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;switch(a.type){case"rectangle":return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.UL,{id:a.id,x:a.x,y:a.y,width:a.width||0,height:a.height||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){i(a.id,{x:A.target.x(),y:A.target.y(),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"circle":return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.Cd,{id:a.id,x:a.x+(a.radius||0),y:a.y+(a.radius||0),radius:a.radius||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){var G=A.target.x(),ce=A.target.y(),ee=a.radius||0,ne=G-ee,se=ce-ee;i(a.id,{x:ne,y:se,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"ellipse":return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.Pj,{id:a.id,x:a.x+(a.width||0)/2,y:a.y+(a.height||0)/2,radiusX:(a.width||0)/2,radiusY:(a.height||0)/2,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){var G=A.target.x(),ce=A.target.y(),ee=a.width||0,ne=a.height||0,se=G-ee/2,de=ce-ne/2;i(a.id,{x:se,y:de,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);default:return null}})},Ue=function(){return g.map(function(a){var o=K===a.id,I=a.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.x1,{id:a.id,points:a.points,stroke:a.color,strokeWidth:a.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:a.opacity,dash:I,perfectDrawEnabled:!1,globalCompositeOperation:a.type==="freehighlight"?"multiply":"source-over",listening:!u,onClick:function(){return!u&&k(a.id)},onTap:function(){return!u&&k(a.id)},draggable:!u,onDragEnd:function(A){var G=A.target.x(),ce=A.target.y();A.target.position({x:0,y:0});for(var ee=xe()(a.points),ne=0;ne<ee.length;ne+=2)ee[ne]+=G,ee[ne+1]+=ce;i(a.id,{points:ee,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:D}),o&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(A,G){return G},rotateEnabled:!1})]},a.id)})},Ze=function(){return Y.map(function(a){var o=a.id,I=a.x,E=a.y,A=a.width,G=a.height,ce=a.imageData,ee=a.opacity,ne=K===a.id,se=new window.Image;return se.src=ce,(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.Ee,{id:o,x:I,y:E,width:A,height:G,image:se,opacity:ee,draggable:!u,onClick:function(){return!u&&k(o)},onTap:function(){return!u&&k(o)},onDragEnd:function(fe){i(o,{x:fe.target.x(),y:fe.target.y()})},onTransformEnd:D}),ne&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(fe,De){return De},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},o)})},Oe=function(){if(!x)return null;var a=x.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsx)(me.x1,{points:x.points,stroke:x.color,strokeWidth:x.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:x.opacity,dash:a,perfectDrawEnabled:!1,globalCompositeOperation:x.type==="freehighlight"?"multiply":"source-over",listening:!1})},Ae=function(){if(!m)return null;var a=m.lineStyle==="dashed"?[5,5]:void 0;switch(m.type){case"rectangle":return(0,e.jsx)(me.UL,{x:m.x,y:m.y,width:m.width||0,height:m.height||0,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});case"circle":{var o=m.radius||0;return(0,e.jsx)(me.Cd,{x:m.x+o,y:m.y+o,radius:o,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1})}case"ellipse":return(0,e.jsx)(me.Pj,{x:m.x+(m.width||0)/2,y:m.y+(m.height||0)/2,radiusX:Math.abs(m.width||0)/2,radiusY:Math.abs(m.height||0)/2,stroke:m.color,strokeWidth:m.strokeWidth||2,opacity:m.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});default:return null}},he=function(){var a;return U==null||(a=U.filter(function(o){return o.pageNumber===t}))===null||a===void 0?void 0:a.map(function(o){var I=K===o.id,E=l*.8,A=na(o.text||"",o.fontSize||16,E,"Arial"),G=o.width&&o.width>20?o.width:A.width/c,ce=o.height&&o.height>20?o.height:A.height/c;return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(me.UL,{id:o.id,x:o.x*c,y:o.y*c,width:G*c,height:ce*c,fill:o.backgroundColor||"#FFFFA0",opacity:.8,cornerRadius:4,stroke:I?"#1890ff":"transparent",strokeWidth:I?2:0,onDblClick:function(){k(o.id),C(!0),O(o)},onDblTap:function(){},draggable:!u,onDragMove:function(ne){var se,de=(se=ne.target.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(de){var fe;de.position({x:ne.target.x()+4*c,y:ne.target.y()+4*c}),(fe=de.getLayer())===null||fe===void 0||fe.batchDraw()}},onDragEnd:function(ne){i(o.id,{x:ne.target.x()/c,y:ne.target.y()/c,width:G,height:ce,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})},onTransform:function(ne){var se,de=ne.target,fe=(se=de.getStage())===null||se===void 0?void 0:se.findOne("#text-".concat(o.id));if(fe){var De,Ce=de.scaleX(),je=de.scaleY();fe.position({x:de.x()+4*c*Ce,y:de.y()+4*c*je}),fe.width(de.width()*Ce-8*c*Ce),fe.height(de.height()*je-8*c*je),(De=fe.getLayer())===null||De===void 0||De.batchDraw()}},onTransformEnd:D}),(0,e.jsx)(me.xv,{id:"text-".concat(o.id),x:(o.x+4)*c,y:(o.y+4)*c,width:(G-8)*c,height:(ce-8)*c,text:o.text,fontSize:(o.fontSize||16)*c,fontFamily:"Arial",fill:"#333333",wrap:"word",listening:!1}),I&&!u&&(0,e.jsx)(me.$T,{ref:L,boundBoxFunc:function(ne,se){return se.width<50||se.height<30?ne:se}})]},o.id)})};return(0,f.useEffect)(function(){var le=function(o){(o.key==="Delete"||o.key==="Backspace")&&K&&!u&&(p(K),k(null))};return window.addEventListener("keydown",le),function(){window.removeEventListener("keydown",le)}},[K,p,u]),(0,f.useEffect)(function(){if(K&&L.current&&S.current){var le=S.current.findOne("#".concat(K));if(le){var a=b.find(function(Je){return Je.id===K});if(a&&!["freedraw","freehighlight"].includes(a.type)){var o,I;if((o=L.current)===null||o===void 0||o.nodes([le]),["signature","stamp"].includes(a.type)){var E,A,G;(E=L.current)===null||E===void 0||E.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(A=L.current)===null||A===void 0||A.rotateEnabled(!1),(G=L.current)===null||G===void 0||G.keepRatio(!0)}else if(a.type==="text"){var ce,ee,ne;(ce=L.current)===null||ce===void 0||ce.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(ee=L.current)===null||ee===void 0||ee.rotateEnabled(!1),(ne=L.current)===null||ne===void 0||ne.keepRatio(!1)}else{var se,de,fe;(se=L.current)===null||se===void 0||se.enabledAnchors(["top-left","top-center","top-right","middle-left","middle-right","bottom-left","bottom-center","bottom-right"]),(de=L.current)===null||de===void 0||de.rotateEnabled(!1),(fe=L.current)===null||fe===void 0||fe.keepRatio(a.type==="circle")}(I=L.current)===null||I===void 0||(I=I.getLayer())===null||I===void 0||I.batchDraw()}else{var De,Ce;(De=L.current)===null||De===void 0||De.nodes([]),(Ce=L.current)===null||Ce===void 0||(Ce=Ce.getLayer())===null||Ce===void 0||Ce.batchDraw()}}}else if(L.current){var je,Ee;(je=L.current)===null||je===void 0||je.nodes([]),(Ee=L.current)===null||Ee===void 0||(Ee=Ee.getLayer())===null||Ee===void 0||Ee.batchDraw()}},[K,b]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:u?"none":"auto",zIndex:M},className:"annotation-layer",children:(0,e.jsx)(me.Hf,{ref:S,width:l*c,height:h*c,scale:{x:c,y:c},onClick:ke,onMouseDown:q,onMouseMove:Q,onMouseUp:W,onTouchStart:q,onTouchMove:Q,onTouchEnd:W,style:{position:"absolute",top:0,left:0,pointerEvents:"all"},children:(0,e.jsxs)(me.mh,{ref:ve,children:[Pe(),Ue(),Ze(),he(),Oe(),Ae(),!u&&(0,e.jsx)(me.$T,{ref:L,rotateEnabled:!1,keepRatio:!1,borderDash:[6,2],borderStroke:"#1890ff",anchorStroke:"#1890ff",anchorFill:"#ffffff",anchorSize:8,boundBoxFunc:function(a,o){return o.width<5||o.height<5?a:o}})]})})})},aa=ra,ia=function(n){var t=n.annotations,c=n.currentPage,l=n.pdfLayerRef,h=n.scale,s=n.readOnly,F=s===void 0?!1:s,T=n.handlePageChange,b=n.onAnnotationSelect,R=n.onAnnotationDelete,u=n.onAnnotationUpdate,J=function(p){var r={highlight:"\u9AD8\u4EAE",strikethrough:"\u5220\u9664\u7EBF",underline:"\u4E0B\u5212\u7EBF",rectangle:"\u77E9\u5F62",circle:"\u5706\u5F62",ellipse:"\u692D\u5706",freedraw:"\u81EA\u7531\u7ED8\u5236",freehighlight:"\u81EA\u7531\u9AD8\u4EAE",signature:"\u7B7E\u540D",stamp:"\u76D6\u7AE0",text:"\u6587\u672C"};return r[p]||p},M=function(p,r){u&&u(p,{comment:r})},y=function(p){var r=t.find(function(X){return X.id===p});if(r&&(r.pageNumber!==c&&T(r.pageNumber),l!=null&&l.current)){var C={x:0,y:0,width:100,height:50};if("x"in r&&"y"in r)if(r.type==="circle"){var O=r.radius||0;C.x=r.x*h,C.y=r.y*h,C.width=O*2*h,C.height=O*2*h}else r.type==="ellipse"||r.type,C.x=r.x*h,C.y=r.y*h,"width"in r&&r.width&&(C.width=r.width*h),"height"in r&&r.height&&(C.height=r.height*h);var S=document.createElement("div");if(S.classList.add("annotation-highlight-selected"),S.style.position="absolute",S.style.left="".concat(C.x,"px"),S.style.top="".concat(C.y,"px"),S.style.width="".concat(C.width,"px"),S.style.height="".concat(C.height,"px"),r.type==="circle"||r.type==="ellipse")S.style.borderRadius="50%",S.style.border="2px solid ".concat(r.color||"#ff5500"),S.style.backgroundColor="transparent";else if(r.type==="rectangle")S.style.border="2px solid ".concat(r.color||"#ff5500"),S.style.backgroundColor="transparent";else if(r.type==="freedraw"||r.type==="freehighlight")if("points"in r&&r.points&&r.points.length>0){for(var ve=r.points,L=1/0,H=1/0,$=-1/0,K=-1/0,k=0;k<ve.length;k+=2){var v=ve[k]*h,z=ve[k+1]*h;L=Math.min(L,v),H=Math.min(H,z),$=Math.max($,v),K=Math.max(K,z)}var V=5;S.style.left="".concat(L-V,"px"),S.style.top="".concat(H-V,"px"),S.style.width="".concat($-L+V*2,"px"),S.style.height="".concat(K-H+V*2,"px"),S.style.border="2px solid ".concat(r.color||"#ff5500"),S.style.backgroundColor="transparent"}else S.style.transform="scale(1.2)",S.style.transformOrigin="center",S.style.backgroundColor="transparent";else["highlight","strikethrough","underline"].includes(r.type)&&(S.style.height="20px");l.current.appendChild(S);var B=l.current.parentElement;if(B){var P=C.x+parseInt(S.style.width,10)/2,d=C.y+parseInt(S.style.height,10)/2,x=l.current.getBoundingClientRect(),j=B.scrollTop||0,Z=B.scrollLeft||0;B.scrollTo({left:P+Z-x.width/2,top:d+j-x.height/2,behavior:"smooth"})}setTimeout(function(){l.current&&l.current.contains(S)&&l.current.removeChild(S)},3e3),typeof b=="function"&&b(p)}};return(0,e.jsxs)("div",{className:"annotation-list-container-box",children:[(0,e.jsx)("div",{className:"annotation-list-header",children:(0,e.jsxs)("h4",{style:{margin:0},children:["\u6279\u6CE8\u5217\u8868 (\u7B2C ",c," \u9875)"]})}),(0,e.jsx)("div",{className:"annotation-list-content",children:t.length===0?(0,e.jsx)(Tn.Z,{description:"\u6682\u65E0\u6279\u6CE8"}):(0,e.jsx)("div",{className:"custom-annotation-list",children:t==null?void 0:t.map(function(i){return(0,e.jsxs)("div",{className:"custom-annotation-item",onClick:function(){return y(i.id)},children:[(0,e.jsxs)("div",{className:"annotation-header",children:[(0,e.jsxs)("div",{className:"annotation-type",children:[(0,e.jsx)("span",{className:"annotation-color-block",style:{backgroundColor:i.color}}),J(i.type)]}),!F&&(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(En.Z,{}),size:"small",danger:!0,onClick:function(r){r.stopPropagation(),R(i.id)}})]}),(0,e.jsxs)("div",{className:"annotation-date",children:["\u521B\u5EFA: ",(i==null?void 0:i.createdAt)||""]}),"content"in i&&(0,e.jsxs)("div",{className:"annotation-content",children:["\u5185\u5BB9:",(0,e.jsx)(Nn.Z,{title:(i==null?void 0:i.content)||"",children:(0,e.jsx)("span",{className:"annotation-content-text",children:i.content})})]}),(0,e.jsx)("div",{className:"annotation-comment",children:(0,e.jsx)(vt.Z.TextArea,{rows:2,value:i.comment||"",onChange:function(r){var C;return M(i.id,(r==null||(C=r.target)===null||C===void 0?void 0:C.value)||"")},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9...",disabled:F,onClick:function(r){return r.stopPropagation()}})})]},i.id)})})})]})},oa=ia,la=function(n){var t=n.icon,c=n.active,l=c===void 0?!1:c,h=n.disabled,s=h===void 0?!1:h,F=n.onClick;return(0,e.jsx)("div",{className:"annotation-tool-button ".concat(l?"active":""," ").concat(s?"disabled":""),onClick:function(){s||F()},children:(0,e.jsx)("span",{children:t})})},$e=la,sa=function(n){var t=n.activeTool,c=n.activeColor,l=n.activeLineStyle,h=l===void 0?"solid":l,s=n.onToolSelect,F=n.onColorChange,T=n.onLineStyleChange,b=["#FFFF00","#FF0000","#00FF00","#0000FF","#FF00FF","#00FFFF","#FFA500","#000000","#FFFFFF","#888888"],R=function(J,M){F(M)};return(0,e.jsx)("div",{className:"annotation-toolbar-box",children:(0,e.jsxs)("div",{className:"annotation-tools",children:[(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Ln.Z,{}),active:t==="highlight",disabled:!0,onClick:function(){return s("highlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u9AD8\u4EAE"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Mn.Z,{}),active:t==="strikethrough",disabled:!0,onClick:function(){return s("strikethrough")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5220\u9664\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Zn.Z,{}),active:t==="underline",disabled:!0,onClick:function(){return s("underline")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u4E0B\u5212\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Bn.Z,{}),active:t==="text",onClick:function(){return s("text")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u6587\u672C"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Rn.Z,{}),active:t==="rectangle",onClick:function(){return s("rectangle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u77E9\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Yn.Z,{style:{transform:"rotate(45deg)"}}),active:t==="circle",onClick:function(){return s("circle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5706\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)($t.Z,{}),active:t==="ellipse",onClick:function(){return s("ellipse")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u692D\u5706"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Un.Z,{}),active:t==="freedraw",onClick:function(){return s("freedraw")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u7ED8\u5236"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(On.Z,{}),active:t==="freehighlight",onClick:function(){return s("freehighlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u9AD8\u4EAE"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(In.Z,{}),active:t==="signature",onClick:function(){return s("signature")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u7B7E\u540D"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)($t.Z,{style:{color:"#ff4d4f"}}),active:t==="stamp",onClick:function(){return s("stamp")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u76D6\u7AE0"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(Hn.Z,{}),active:h==="solid",onClick:function(){return T("solid")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5B9E\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)($e,{icon:(0,e.jsx)(zn.Z,{}),active:h==="dashed",onClick:function(){return T("dashed")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u865A\u7EBF"})]})]}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsx)("div",{className:"tool-group",children:(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Bt.Z,{value:c,size:"small",className:"color-picker",format:"hex",arrow:!1,placement:"bottomRight",presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:b}],onChange:R}),(0,e.jsx)("span",{className:"tool-name",children:"\u989C\u8272\u9009\u62E9"})]})})]})})},ca=sa,ua=function(n){var t=n.fileUrl,c=n.fileName,l=n.annotations,h=n.currentPage,s=n.numPages,F=n.scale,T=n.sidebarVisible,b=n.readOnly,R=n.pdfLayerRef,u=n.toggleSidebar,J=n.setCurrentPage,M=n.zoomOut,y=n.zoomIn,i=n.onSave,p=(0,f.useState)(!1),r=te()(p,2),C=r[0],O=r[1],S=(0,f.useState)(""),ve=te()(S,2),L=ve[0],H=ve[1],$=function(){var P=ze()(we()().mark(function d(){var x,j,Z,X,m,re;return we()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(g.prev=0,!i){g.next=28;break}if(typeof t!="string"){g.next=26;break}if(!t.startsWith("data:")){g.next=11;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);x=new Blob([X],{type:"application/pdf"}),g.next=24;break;case 11:if(!t.startsWith("http")){g.next=24;break}return g.prev=12,g.next=15,fetch(t);case 15:return re=g.sent,g.next=18,re.blob();case 18:x=g.sent,g.next=24;break;case 21:g.prev=21,g.t0=g.catch(12),console.log("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",g.t0);case 24:g.next=27;break;case 26:(t instanceof Blob||t instanceof File)&&(x=t);case 27:i(l,x);case 28:ie.ZP.success("\u6279\u6CE8\u5DF2\u4FDD\u5B58"),g.next=34;break;case 31:g.prev=31,g.t1=g.catch(0),ie.ZP.error("\u4FDD\u5B58\u6279\u6CE8\u5931\u8D25");case 34:case"end":return g.stop()}},d,null,[[0,31],[12,21]])}));return function(){return P.apply(this,arguments)}}(),K=function(){var P=ze()(we()().mark(function d(x,j){var Z,X,m,re,oe,g,Y,U,D,q,Q,W,ke,Pe,Ue,Ze,Oe;return we()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:if(he.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u5904\u7406PDF\u9875\u9762...",key:x}),R.current){he.next=5;break}return ie.ZP.error({content:"\u65E0\u6CD5\u83B7\u53D6PDF\u5185\u5BB9",key:x}),he.abrupt("return");case 5:return Z=h,X=document.querySelector(".pdf-annotation-main"),m=X||null,re=(m==null?void 0:m.scrollTop)||0,O(!0),H("\u51C6\u5907\u4E2D..."),he.prev=11,he.next=14,N.e(120).then(N.t.bind(N,46020,23));case 14:oe=he.sent,g=oe.default,Y=[],U=1;case 18:if(!(U<=s)){he.next=65;break}return D="\u6B63\u5728\u5904\u7406\u7B2C ".concat(U," \u9875 / \u5171 ").concat(s," \u9875..."),H(D),J(U),he.next=24,new Promise(function(le){setTimeout(function(){le()},1e3)});case 24:if(he.prev=24,q=document.querySelectorAll(".pdf-page-container"),!(!q||q.length===0||!q[U-1])){he.next=29;break}return console.log("\u65E0\u6CD5\u627E\u5230\u7B2C ".concat(U," \u9875\u7684\u5BB9\u5668")),he.abrupt("continue",62);case 29:if(Q=q[U-1],W=Q.querySelector(".react-pdf__Page"),W){he.next=34;break}return console.log("\u65E0\u6CD5\u627E\u5230\u7B2C ".concat(U," \u9875\u7684PDF\u9875\u9762\u5143\u7D20")),he.abrupt("continue",62);case 34:if(ke=W.querySelector("canvas"),ke){he.next=38;break}return console.log("\u7B2C ".concat(U," \u9875\u7684PDF\u753B\u5E03\u672A\u627E\u5230")),he.abrupt("continue",62);case 38:if(Pe=R.current[U],Pe||console.log("\u7B2C ".concat(U," \u9875\u7684\u6279\u6CE8\u5C42\u672A\u627E\u5230")),Ue=document.createElement("canvas"),Ue.width=ke.width,Ue.height=ke.height,Ze=Ue.getContext("2d"),Ze){he.next=47;break}return console.error("\u65E0\u6CD5\u521B\u5EFAcanvas\u4E0A\u4E0B\u6587"),he.abrupt("continue",62);case 47:if(Ze.drawImage(ke,0,0),!Pe){he.next=53;break}return he.next=51,g(Pe,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:null,logging:!0});case 51:Oe=he.sent,Ze.drawImage(Oe,0,0,Ue.width,Ue.height);case 53:Y.push(Ue),he.next=60;break;case 56:return he.prev=56,he.t0=he.catch(24),console.log("\u6355\u83B7\u7B2C ".concat(U," \u9875\u65F6\u51FA\u9519:"),he.t0),he.abrupt("continue",62);case 60:return he.next=62,new Promise(function(le){setTimeout(function(){le()},500)});case 62:U++,he.next=18;break;case 65:return J(Z),m&&(m.scrollTop=re),he.next=69,j(Y);case 69:he.next=75;break;case 71:he.prev=71,he.t1=he.catch(11),console.error("\u5904\u7406PDF\u9875\u9762\u5931\u8D25:",he.t1),ie.ZP.error({content:"\u5904\u7406PDF\u9875\u9762\u5931\u8D25",key:x});case 75:return he.prev=75,O(!1),he.finish(75);case 78:he.next=85;break;case 80:he.prev=80,he.t2=he.catch(0),console.error("\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF:",he.t2),ie.ZP.error({content:"\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:x}),O(!1);case 85:case"end":return he.stop()}},d,null,[[0,80],[11,71,75,78],[24,56]])}));return function(x,j){return P.apply(this,arguments)}}(),k=function(){var P=ze()(we()().mark(function d(){var x,j,Z,X,m,re,oe,g,Y,U,D,q;return we()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(W.prev=0,ie.ZP.loading({content:"\u51C6\u5907\u6253\u5370\u4E2D...",key:"printLoading"}),x=null,typeof t!="string"){W.next=29;break}if(!t.startsWith("data:")){W.next=12;break}for(j=t.split(",")[1],Z=atob(j),X=new Uint8Array(Z.length),m=0;m<Z.length;m++)X[m]=Z.charCodeAt(m);x=new Blob([X],{type:"application/pdf"}),W.next=27;break;case 12:if(!t.startsWith("http")){W.next=27;break}return W.prev=13,W.next=16,fetch(t);case 16:return re=W.sent,W.next=19,re.blob();case 19:x=W.sent,W.next=27;break;case 22:return W.prev=22,W.t0=W.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",W.t0),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"printLoading"}),W.abrupt("return");case 27:W.next=30;break;case 29:t instanceof Blob?x=t:t instanceof File&&(x=new Blob([t],{type:t.type}));case 30:if(x){W.next=33;break}return ie.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"printLoading"}),W.abrupt("return");case 33:oe=URL.createObjectURL(x),g=document.createElement("iframe"),g.style.position="absolute",g.style.width="0px",g.style.height="0px",g.style.border="0",g.style.left="-1000px",document.body.appendChild(g),Y=Date.now(),U=!1,D=!1,q=function ke(){if(!D)try{if(!document.body.contains(g)){D=!0,URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}if(U&&document.hasFocus()&&Date.now()-Y>1e3){D=!0,document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe),ie.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}setTimeout(ke,3e3)}catch(Pe){console.error("\u68C0\u67E5\u6253\u5370\u72B6\u6001\u5931\u8D25:",Pe),document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe)}},g.onload=function(){ie.ZP.success({content:"\u6587\u6863\u5DF2\u51C6\u5907\u597D\uFF0C\u6B63\u5728\u6253\u5F00\u6253\u5370\u5BF9\u8BDD\u6846...",key:"printLoading",duration:2}),setTimeout(function(){try{g.contentWindow?(g.contentWindow.focus(),g.contentWindow.print(),U=!0,setTimeout(q,1e3)):(ie.ZP.error({content:"\u6253\u5370\u5931\u8D25: \u65E0\u6CD5\u8BBF\u95EE\u6253\u5370\u7A97\u53E3",key:"printLoading"}),document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe))}catch(ke){console.error("\u6253\u5370\u5931\u8D25:",ke),document.body.contains(g)&&document.body.removeChild(g),URL.revokeObjectURL(oe),ie.ZP.error({content:"\u6253\u5370\u5931\u8D25",key:"printLoading"})}},800)},g.src=oe,W.next=53;break;case 49:W.prev=49,W.t1=W.catch(0),console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",W.t1),ie.ZP.error({content:"\u6253\u5370\u51C6\u5907\u5931\u8D25",key:"printLoading"});case 53:case"end":return W.stop()}},d,null,[[0,49],[13,22]])}));return function(){return P.apply(this,arguments)}}(),v=function(d){var x;if(d==="original"){k();return}ie.ZP.loading({content:"\u51C6\u5907\u6253\u5370\u5185\u5BB9...",key:"printLoading"});var j=document.createElement("iframe");j.style.position="absolute",j.style.width="0px",j.style.height="0px",j.style.border="0",j.style.left="-1000px",j.style.display="none",document.body.appendChild(j);var Z=(x=j.contentWindow)===null||x===void 0?void 0:x.document;if(!Z){document.body.removeChild(j),ie.ZP.error({content:"\u521B\u5EFA\u6253\u5370\u6846\u67B6\u5931\u8D25",key:"printLoading"});return}Z.open(),Z.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>`.concat(c||"PDF\u6253\u5370",`</title>
          <meta charset="utf-8">
          <style>
            body {
              margin: 0;
              padding: 0;
              font-family: Arial, sans-serif;
            }
            .print-container {
              max-width: 100%;
              margin: 0;
              padding: 0;
            }
            .page-container {
              page-break-after: always;
              margin: 0;
              padding: 0;
              border: none;
              width: 100%;
              box-sizing: border-box;
            }
            .page-container:last-child {
              page-break-after: avoid;
              margin: 0;
            }
            img {
              max-width: 100%;
              display: block;
              width: 100%;
              margin: 0;
              padding: 0;
              box-shadow: none;
              border: none;
            }
            @media print {
              body {
                margin: 0;
                padding: 0;
              }
              .print-container {
                margin: 0;
                padding: 0;
              }
              .page-container {
                width: 100%;
                height: auto;
                page-break-after: always;
                margin: 0;
                padding: 0;
                border: none;
              }
              @page {
                margin: 0.5cm;
                size: auto;
              }
            }
          </style>
        </head>
        <body>
          <div class="print-container" id="print-container">
            <!-- \u9875\u9762\u5185\u5BB9\u5C06\u52A8\u6001\u63D2\u5165\u8FD9\u91CC -->
          </div>
        </body>
      </html>
    `)),Z.close();var X=Z.getElementById("print-container");if(!X){document.body.removeChild(j),ie.ZP.error({content:"\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25",key:"printLoading"});return}K("printLoading",function(){var m=ze()(we()().mark(function re(oe){return we()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(Y.prev=0,oe.length!==0){Y.next=5;break}return ie.ZP.error({content:"\u65E0\u6CD5\u6355\u83B7PDF\u9875\u9762",key:"printLoading"}),document.body.removeChild(j),Y.abrupt("return");case 5:oe.forEach(function(U,D){var q=Z.createElement("div");q.className="page-container",q.style.margin="0 auto";var Q=Z.createElement("img");Q.src=U.toDataURL("image/png",.95),Q.style.width="100%",Q.style.maxWidth="100%",Q.alt="\u9875\u9762 ".concat(D+1),q.appendChild(Q),X.appendChild(q)}),ie.ZP.success({content:"\u6253\u5370\u51C6\u5907\u5B8C\u6210\uFF0C\u6B63\u5728\u6253\u5F00\u6253\u5370\u5BF9\u8BDD\u6846...",key:"printLoading",duration:1}),setTimeout(function(){try{var U,D;(U=j.contentWindow)===null||U===void 0||U.focus(),(D=j.contentWindow)===null||D===void 0||D.print();var q=function(){document.body.contains(j)&&setTimeout(function(){document.body.contains(j)&&document.body.removeChild(j)},3e3)};if(j.contentWindow)if(j.contentWindow.matchMedia){var Q=j.contentWindow.matchMedia("print");Q.addEventListener("change",function(W){!W.matches&&document.body.contains(j)&&document.body.removeChild(j)})}else q();else q()}catch(W){console.error("\u6253\u5370\u8C03\u7528\u5931\u8D25:",W),document.body.contains(j)&&document.body.removeChild(j),ie.ZP.error({content:"\u6253\u5370\u8C03\u7528\u5931\u8D25",key:"printLoading"})}},500),Y.next=15;break;case 10:Y.prev=10,Y.t0=Y.catch(0),console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",Y.t0),document.body.contains(j)&&document.body.removeChild(j),ie.ZP.error({content:"\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25",key:"printLoading"});case 15:case"end":return Y.stop()}},re,null,[[0,10]])}));return function(re){return m.apply(this,arguments)}}())},z=function(){var P=ze()(we()().mark(function d(){return we()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:ie.ZP.loading({content:"\u6B63\u5728\u51C6\u5907\u4E0B\u8F7D...",key:"downloadLoading"}),K("downloadLoading",function(){var Z=ze()(we()().mark(function X(m){var re,oe,g,Y,U,D,q,Q,W,ke,Pe,Ue,Ze;return we()().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:if(Ae.prev=0,m.length!==0){Ae.next=4;break}return ie.ZP.error({content:"\u65E0\u6CD5\u6355\u83B7PDF\u9875\u9762",key:"downloadLoading"}),Ae.abrupt("return");case 4:return Ae.next=6,N.e(361).then(N.bind(N,36361));case 6:for(re=Ae.sent,oe=re.default,g=m[0],Y=g.width,U=g.height,D=Y>U?"landscape":"portrait",q=new oe({orientation:D,unit:"px",format:[Y,U],compress:!0,hotfixes:["px_scaling"],putOnlyUsedFonts:!0,floatPrecision:"smart"}),Q=.8,W="JPEG",ke=0;ke<m.length;ke++)Pe=m[ke],Ue=Pe.toDataURL("image/".concat(W.toLowerCase()),Q),ke>0&&q.addPage([Y,U]),q.addImage(Ue,W,0,0,Y,U,"page-".concat(ke+1),"FAST"),ie.ZP.loading({content:"\u6B63\u5728\u5904\u7406\u7B2C ".concat(ke+1," \u9875\uFF0C\u5171 ").concat(m.length," \u9875..."),key:"downloadLoading"});Ze=c||"document-with-annotations.pdf",Ze.toLowerCase().endsWith(".pdf")||(Ze+=".pdf");try{q.save(Ze),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"})}catch(he){console.error("\u4FDD\u5B58PDF\u6587\u4EF6\u5931\u8D25:",he),ie.ZP.error({content:"\u4FDD\u5B58PDF\u6587\u4EF6\u5931\u8D25",key:"downloadLoading"})}Ae.next=25;break;case 21:Ae.prev=21,Ae.t0=Ae.catch(0),console.error("\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25:",Ae.t0),ie.ZP.error({content:"\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25",key:"downloadLoading"});case 25:case"end":return Ae.stop()}},X,null,[[0,21]])}));return function(X){return Z.apply(this,arguments)}}()).catch(function(Z){console.error("\u6355\u83B7PDF\u5931\u8D25:",Z),ie.ZP.error({content:"\u6355\u83B7PDF\u5931\u8D25",key:"downloadLoading"})});case 2:case"end":return j.stop()}},d)}));return function(){return P.apply(this,arguments)}}(),V=function(){var P=ze()(we()().mark(function d(){var x,j,Z,X,m,re,oe,g,Y,U,D;return we()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(Q.prev=0,x=null,j=c||"document.pdf",typeof t!="string"){Q.next=30;break}if(!t.startsWith("data:")){Q.next=12;break}for(Z=t.split(",")[1],X=atob(Z),m=new Uint8Array(X.length),re=0;re<X.length;re++)m[re]=X.charCodeAt(re);x=new Blob([m],{type:"application/pdf"}),Q.next=28;break;case 12:if(!t.startsWith("http")){Q.next=28;break}return Q.prev=13,Q.next=16,fetch(t);case 16:return oe=Q.sent,Q.next=19,oe.blob();case 19:x=Q.sent,c||(g=t.split("/"),Y=g[g.length-1],Y&&Y.includes(".pdf")&&(j=Y)),Q.next=28;break;case 23:return Q.prev=23,Q.t0=Q.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",Q.t0),ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"downloadLoading"}),Q.abrupt("return");case 28:Q.next=31;break;case 30:t instanceof Blob?x=t:t instanceof File&&(x=new Blob([t],{type:t.type}),c||(j=t.name));case 31:if(x){Q.next=34;break}return ie.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"downloadLoading"}),Q.abrupt("return");case 34:U=URL.createObjectURL(x),D=document.createElement("a"),D.href=U,D.download=j,document.body.appendChild(D),D.click(),setTimeout(function(){document.body.removeChild(D),URL.revokeObjectURL(U),ie.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"})},100),Q.next=47;break;case 43:Q.prev=43,Q.t1=Q.catch(0),console.error("\u4E0B\u8F7D\u539F\u59CBPDF\u5931\u8D25:",Q.t1),ie.ZP.error({content:"\u4E0B\u8F7D\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:"downloadLoading"});case 47:case"end":return Q.stop()}},d,null,[[0,43],[13,23]])}));return function(){return P.apply(this,arguments)}}(),B=function(d){rt.Z.info({title:d==="print"?"\u9009\u62E9\u6253\u5370\u7C7B\u578B":"\u9009\u62E9\u4E0B\u8F7D\u7C7B\u578B",icon:null,centered:!0,okText:"\u53D6\u6D88",content:(0,e.jsxs)("div",{className:"download-options",style:{marginTop:16,display:"flex",justifyContent:"center"},children:[l!=null&&l.length?(0,e.jsx)(ye.ZP,{type:"primary",style:{marginRight:16,height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){v("with-annotations");return}z()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u5E26\u6279\u6CE8\u7684PDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u5305\u542B\u6240\u6709\u6279\u6CE8\u6807\u8BB0)"})]})}):null,(0,e.jsx)(ye.ZP,{type:"primary",style:{height:60,fontSize:16,width:180},onClick:function(){if(rt.Z.destroyAll(),d==="print"){v("original");return}V()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(d==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u539F\u59CBPDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u4E0D\u542B\u6279\u6CE8)"})]})})]}),width:500})};return(0,e.jsxs)(e.Fragment,{children:[C&&(0,e.jsxs)("div",{className:"pdf-print-mask-box",children:[(0,e.jsx)("div",{className:"print-message",children:"\u6B63\u5728\u5904\u7406PDF\u6587\u4EF6\uFF0C\u8BF7\u52FF\u5173\u95ED\u6216\u64CD\u4F5C\u9875\u9762"}),(0,e.jsx)("div",{className:"print-progress",children:L})]}),(0,e.jsx)("div",{className:"pdf-annotation-header-box",children:(0,e.jsxs)("div",{className:"pdf-annotation-actions",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-sidebar",style:{cursor:"pointer"},onClick:function(){return u(!T)},children:T?(0,e.jsx)(on.Z,{className:"actions-sidebar-menu"}):(0,e.jsx)(an.Z,{className:"actions-sidebar-menu"})}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-option",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-page",children:"".concat(h," / ").concat(s)}),(0,e.jsx)(Xe.Z,{type:"vertical",className:"pdf-annotation-actions-divider"}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-zoom",children:[(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(ln.Z,{}),onClick:M}),(0,e.jsxs)("span",{style:{margin:"0 8px"},children:[Math.round(F*100),"%"]}),(0,e.jsx)(ye.ZP,{type:"text",icon:(0,e.jsx)(sn.Z,{}),onClick:y})]})]}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-save",children:[b?null:(0,e.jsx)(ye.ZP,{icon:(0,e.jsx)(Wn.Z,{}),type:"text",onClick:$}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(cn.Z,{}),type:"text",onClick:function(){return B("download")}}),(0,e.jsx)(ye.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(Vn.Z,{}),type:"text",onClick:function(){return B("print")}})]})]})})]})},da=ua,en=new Set,ha=function(n){if(!en.has(n)){var t=n.querySelectorAll(".react-pdf__Page__textContent span, .react-pdf__Page__textContent div");t.forEach(function(s){var F=s;F.style.userSelect="text",F.style.webkitUserSelect="text",F.style.mozUserSelect="text",F.style.msUserSelect="text",F.style.cursor="text",F.style.position="relative",F.style.zIndex="2",F.style.color=F.style.color||"inherit",F.style.pointerEvents="auto"});var c=n.querySelectorAll("p, span, div:not(.konvajs-content):not([data-highlight-id])");c.forEach(function(s){var F=s;F.style.cursor="text",F.style.userSelect="text"});var l=n.querySelector(".react-pdf__Page__textContent");if(l){var h=l;h.style.userSelect="text",h.style.webkitUserSelect="text",h.style.mozUserSelect="text",h.style.msUserSelect="text",h.style.zIndex="2",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.right="0",h.style.bottom="0",h.style.pointerEvents="auto"}en.add(n)}},va=function(n){var t=n.pageNumber,c=n.scale,l=n.activeTool,h=n.activeColor,s=n.pdfLayerRef,F=n.annotations,T=n.onAnnotationAdd,b=n.onAnnotationRemove,R=n.onToolReset,u=n.readOnly,J=u===void 0?!1:u,M=n.zIndex,y=M===void 0?6:M,i=(0,f.useRef)(null),p=(0,f.useState)(!1),r=te()(p,2),C=r[0],O=r[1],S=(0,f.useState)(),ve=te()(S,2),L=ve[1],H=(0,f.useCallback)(function(){return L({})},[]);(0,f.useEffect)(function(){if(s.current){en.has(s.current)&&en.delete(s.current);var k=s.current.querySelectorAll(".web-highlighter-wrapper, [data-highlight-id]");k.forEach(function(z){try{z.remove()}catch(V){console.error("\u6E05\u7406\u73B0\u6709\u9AD8\u4EAE\u5931\u8D25:",V)}}),ha(s.current);try{if(i.current)try{i.current.dispose()}catch(z){console.error("\u6E05\u7406\u65E7\u9AD8\u4EAE\u5668\u5B9E\u4F8B\u5931\u8D25:",z)}var v=new(Kn())({$root:s.current,exceptSelectors:["canvas",".konvajs-content",".annotation-layer","[data-highlight-id]",".text-selection-preview"],wrapTag:"span",style:{className:"web-highlighter-selection",style:{display:"inline"}}});v.includeSelector=[".react-pdf__Page__textContent"],v.devicePixelRatio=window.devicePixelRatio||1,i.current=v,i.current.run()}catch(z){console.error("\u521D\u59CB\u5316web-highlighter\u5931\u8D25:",z)}return function(){if(i.current)try{i.current.dispose(),i.current=null}catch(z){console.error("\u6E05\u7406\u9AD8\u4EAE\u5668\u5931\u8D25:",z)}}}},[s,t]);var $=function(v,z,V){setTimeout(function(){try{var B=document.querySelectorAll('[data-highlight-id="'.concat(v,'"], .web-highlighter-selection[data-highlight-source="').concat(v,'"]'));B&&B.length>0&&B.forEach(function(P){var d=P;d.style.display="inline",d.style.position="relative",d.style.zIndex="5",d.style.pointerEvents="auto",z==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):z==="underline"?(d.style.textDecoration="underline",d.style.textDecorationColor=V,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):z==="highlight"&&(d.style.backgroundColor=V,d.style.opacity="0.3",d.style.mixBlendMode="multiply"),d.classList.add("pdf-text-".concat(z))})}catch(P){console.error("\u5E94\u7528\u6837\u5F0F\u5931\u8D25:",P)}},50)},K=function(){if(s.current){var v=s.current.querySelectorAll("[data-highlight-id]"),z=new Map;v.forEach(function(V){var B=V.getAttribute("data-highlight-id");if(B)if(z.has(B))try{V.remove()}catch(P){console.error("\u6E05\u7406\u91CD\u590D\u9AD8\u4EAE\u5931\u8D25:",P)}else z.set(B,!0)})}};return(0,f.useEffect)(function(){if(!(!i.current||J)){var k=function(V){var B=V.sources;if(!(!l||!B||B.length===0)){var P=B[0],d={id:P.id||Date.now().toString(),type:l,pageNumber:t,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:h,opacity:l==="highlight"?.3:1,text:P.text||"",rects:P.rects||[],highlightId:P.id};T(d),O(!1),$(P.id,l,h),H(),K(),R==null||R()}},v=function(V){var B=V.id;l||window.confirm("\u662F\u5426\u5220\u9664\u6B64\u6279\u6CE8\uFF1F")&&(i.current&&i.current.remove(B),b(B))};return i.current.on("selection:create",k),i.current.on("click",v),function(){i.current&&(i.current.off("selection:create",k),i.current.off("click",v))}}},[l,h,t,T,b,J,H,R]),(0,f.useEffect)(function(){if(!(!i.current||J)){var k=function(){var V;if(l){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var P=B.getRangeAt(0);(V=s.current)!==null&&V!==void 0&&V.contains(P.commonAncestorContainer)&&O(!0)}}},v=function(){var V;if(!(!l||!i.current)){var B=window.getSelection();if(!(!B||B.isCollapsed||B.rangeCount===0)){var P=B.getRangeAt(0);if((V=s.current)!==null&&V!==void 0&&V.contains(P.commonAncestorContainer)&&!C){var d=B.toString().trim();if(d){var x={className:"pdf-text-".concat(l)};switch(l){case"highlight":x=w()(w()({},x),{},{backgroundColor:h,opacity:.3,mixBlendMode:"multiply"});break;case"strikethrough":x=w()(w()({},x),{},{textDecoration:"line-through",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break;case"underline":x=w()(w()({},x),{},{textDecoration:"underline",textDecorationColor:h,textDecorationThickness:"2px",backgroundColor:"transparent"});break}O(!0);try{if(typeof i.current.highlightSelection=="function"){var j,Z=i.current.highlightSelection(x);$(Z,l,h),(j=window.getSelection())===null||j===void 0||j.removeAllRanges(),H(),O(!1),K(),R==null||R()}}catch(X){console.error("\u9AD8\u4EAE\u9009\u533A\u5931\u8D25:",X),O(!1)}}}}}};return document.addEventListener("selectionchange",k),document.addEventListener("mouseup",v),function(){document.removeEventListener("selectionchange",k),document.removeEventListener("mouseup",v)}}},[l,h,s,J,H,C,R]),(0,f.useEffect)(function(){if(!(!i.current||!s.current)){K();var k=F.filter(function(v){return["highlight","strikethrough","underline"].includes(v.type)&&v.pageNumber===t});k.length!==0&&(k.forEach(function(v){try{if(!i.current||!s.current)return;var z=s.current.querySelector('[data-highlight-id="'.concat(v.id,'"]'));if(z){$(v.id,v.type,v.color);return}var V=v;if(typeof i.current.fromStore=="function"&&V.startMeta&&V.endMeta){var B=i.current.fromStore(V.startMeta,V.endMeta,v.text,v.id);$(B,v.type,v.color)}else v.rects&&v.rects.length>0&&v.rects.forEach(function(P){var d=document.createElement("span");d.className="web-highlighter-selection pdf-text-".concat(v.type),d.setAttribute("data-highlight-id",v.id),d.style.position="absolute",d.style.left="".concat(P.x*c,"px"),d.style.top="".concat(P.y*c,"px"),d.style.width="".concat(P.width*c,"px"),d.style.height="".concat(P.height*c,"px"),d.style.zIndex="5",v.type==="highlight"?(d.style.backgroundColor=v.color,d.style.opacity="0.3",d.style.mixBlendMode="multiply"):v.type==="strikethrough"?(d.style.textDecoration="line-through",d.style.textDecorationColor=v.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"):v.type==="underline"&&(d.style.textDecoration="underline",d.style.textDecorationColor=v.color,d.style.textDecorationThickness="2px",d.style.backgroundColor="transparent"),s.current&&s.current.appendChild(d)})}catch(P){console.error("\u6062\u590D\u6279\u6CE8\u5931\u8D25:",P,v)}}),K())}},[F,t,s,c,H]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:J?"none":"auto",zIndex:y},className:"highlighter-layer-box",children:(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:J||!l?"none":"auto",zIndex:y+1,cursor:l?"text":"default"},className:"text-selection-layer"})})},fa=va,ga=Jn.Z.Dragger,pa=function(n){var t=n.type,c=n.visible,l=n.onSave,h=n.onCancel,s=(0,f.useState)([]),F=te()(s,2),T=F[0],b=F[1],R=(0,f.useState)(!1),u=te()(R,2),J=u[0],M=u[1],y=(0,f.useState)(null),i=te()(y,2),p=i[0],r=i[1],C=(0,f.useState)(t==="signature"?"#000000":"#ff0000"),O=te()(C,2),S=O[0],ve=O[1],L=(0,f.useState)(t==="signature"?2:4),H=te()(L,2),$=H[0],K=H[1],k=(0,f.useRef)(null),v=400,z=200,V=function(Y){M(!0);var U=Y.target.getStage().getPointerPosition();b([].concat(xe()(T),[{points:[U.x,U.y],stroke:S,strokeWidth:$}]))},B=function(Y){if(J){var U=Y.target.getStage(),D=U.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),b([].concat(xe()(T.slice(0,-1)),[q]))}},P=function(){M(!1)},d=function(Y){Y.evt.preventDefault();var U=Y.target.getStage(),D=U.getPointerPosition();M(!0),b([].concat(xe()(T),[{points:[D.x,D.y],stroke:S,strokeWidth:$}]))},x=function(Y){if(Y.evt.preventDefault(),!!J){var U=Y.target.getStage(),D=U.getPointerPosition(),q=T[T.length-1];q.points=q.points.concat([D.x,D.y]),b([].concat(xe()(T.slice(0,-1)),[q]))}},j=function(Y){Y.evt.preventDefault(),M(!1)},Z=function(){b([]),r(null)},X=function(){if(p){l(p);return}if(T.length===0){ie.ZP.warning("\u8BF7\u5148\u7ED8\u5236\u6216\u4E0A\u4F20\u56FE\u50CF");return}if(k.current){var Y=k.current.toDataURL();l(Y)}},m=function(Y,U){ve(U)},re=t==="signature"?["#000000","#0000FF","#FF0000","#008000"]:["#FF0000","#0000FF","#800000","#FF8C00"],oe=[{key:"draw",label:"\u624B\u7ED8",children:(0,e.jsxs)("div",{className:"signature-canvas-container",children:[(0,e.jsx)(me.Hf,{width:v,height:z,ref:k,onMouseDown:V,onMouseMove:B,onMouseUp:P,onTouchStart:d,onTouchMove:x,onTouchEnd:j,style:{border:"1px solid #ddd",borderRadius:4,background:"#fff"},children:(0,e.jsx)(me.mh,{children:T.map(function(g,Y){return(0,e.jsx)(me.x1,{points:g.points,stroke:g.stroke,strokeWidth:g.strokeWidth,tension:.5,lineCap:"round",lineJoin:"round"},Y)})})}),(0,e.jsxs)("div",{className:"signature-controls",children:[(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u989C\u8272:"}),(0,e.jsx)(Bt.Z,{value:S,onChange:m,presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:re}],size:"small",format:"hex"})]}),(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,e.jsx)("div",{className:"stroke-width-control",children:(0,e.jsxs)(Ve.ZP.Group,{value:$,onChange:function(Y){return K(Y.target.value)},buttonStyle:"solid",size:"small",children:[(0,e.jsx)(Ve.ZP.Button,{value:1,children:"\u7EC6"}),(0,e.jsx)(Ve.ZP.Button,{value:3,children:"\u4E2D"}),(0,e.jsx)(Ve.ZP.Button,{value:5,children:"\u7C97"})]})})]}),(0,e.jsxs)("div",{className:"action-buttons",children:[(0,e.jsx)(ye.ZP,{size:"middle",onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{size:"middle",type:"primary",onClick:X,children:"\u4FDD\u5B58"})]})]})]})},{key:"upload",label:"\u4E0A\u4F20",children:p?(0,e.jsxs)("div",{style:{textAlign:"center"},children:[(0,e.jsx)("img",{src:p,alt:"\u4E0A\u4F20\u7684\u56FE\u7247",style:{maxWidth:"100%",maxHeight:200,marginBottom:16,border:"1px solid #ddd",borderRadius:4}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ye.ZP,{onClick:Z,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ye.ZP,{type:"primary",onClick:X,children:"\u4F7F\u7528\u6B64\u56FE\u7247"})]})]}):(0,e.jsxs)(ga,{accept:".png,.jpg,.jpeg",showUploadList:!1,beforeUpload:function(Y){var U=new FileReader;return U.onload=function(D){var q;(q=D.target)!==null&&q!==void 0&&q.result&&r(D.target.result)},U.readAsDataURL(Y),!1},multiple:!1,children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(Gn.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u5230\u6B64\u533A\u57DF\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u652F\u6301\u5355\u4E2A\u56FE\u7247\u4E0A\u4F20\uFF0C\u63A8\u8350\u4F7F\u7528\u900F\u660E\u80CC\u666F\u7684PNG\u56FE\u7247"})]})}];return(0,e.jsx)(rt.Z,{title:t==="signature"?"\u6DFB\u52A0\u7B7E\u540D":"\u6DFB\u52A0\u76D6\u7AE0",open:c,onCancel:h,footer:null,width:500,children:(0,e.jsx)(Qt.Z,{defaultActiveKey:"draw",items:oe})})},ma=pa,ya=function(n){var t=n.onSave,c=n.onCancel,l=n.visible,h=n.curTextNotePanelData,s=h===void 0?{}:h,F=Ye.Z.useForm(),T=te()(F,1),b=T[0],R=Ye.Z.useWatch(["backgroundColor"],b),u=["#FFFFA0","#A0E7E5","#FFC0CB","#FFCBA4","#D3D3D3","#C1FFC1","#FFFFFF"];(0,f.useEffect)(function(){l&&b.setFieldsValue({text:(s==null?void 0:s.text)||"",fontSize:(s==null?void 0:s.fontSize)||12,backgroundColor:(s==null?void 0:s.backgroundColor)||"#FFFFA0"})},[l,s]);var J=function(y){var i=y.text,p=y.fontSize,r=y.backgroundColor;t(i,p,r)};return(0,e.jsx)(rt.Z,{title:"\u6DFB\u52A0\u6587\u672C\u6279\u6CE8",open:l,onCancel:c,footer:[(0,e.jsx)(ye.ZP,{onClick:c,children:"\u53D6\u6D88"},"cancel"),(0,e.jsx)(ye.ZP,{type:"primary",onClick:function(){return b.submit()},children:"\u6DFB\u52A0\u6279\u6CE8"},"save")],width:500,children:(0,e.jsxs)(Ye.Z,{form:b,layout:"vertical",onFinish:J,children:[(0,e.jsx)(Ye.Z.Item,{name:"text",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C"}],children:(0,e.jsx)(vt.Z.TextArea,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C...",autoFocus:!0,style:{padding:"8px",borderRadius:"4px",backgroundColor:R}})}),(0,e.jsx)(Ye.Z.Item,{label:"\u5B57\u4F53\u5927\u5C0F",name:"fontSize",children:(0,e.jsx)(at.Z,{min:1,max:100,style:{width:"200px"},addonAfter:"px"})}),(0,e.jsx)(Ye.Z.Item,{label:"\u80CC\u666F\u989C\u8272",name:"backgroundColor",children:(0,e.jsx)(Bt.Z,{presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:u}],size:"middle",format:"hex",onChange:function(y){var i;b.setFieldValue("backgroundColor",y==null||(i=y.toHexString)===null||i===void 0?void 0:i.call(y))}})})]})})},xa=ya,ba=function(n){var t=n.fileUrl,c=n.numPages,l=n.currentPage,h=n.onPageChange,s=(0,f.useRef)(null),F=(0,f.useState)([]),T=te()(F,2),b=T[0],R=T[1],u=(0,f.useState)(!1),J=te()(u,2),M=J[0],y=J[1],i=(0,f.useState)(!1),p=te()(i,2),r=p[0],C=p[1],O=function(){y(!0);for(var $=[],K=1;K<=Math.min(c,20);K++)$.push(K);R($),setTimeout(function(){return C(!0)},500)},S=(0,f.useCallback)(function(){if(!(!s.current||c===0||!r)){for(var H=s.current,$=H.scrollTop,K=H.clientHeight,k=5,v=150,z=Math.max(1,Math.floor($/v)-k),V=Math.min(c,Math.ceil(($+K)/v)+k),B=[],P=z;P<=V;P++)B.push(P);!B.includes(l)&&l<=c&&B.push(l),R(B)}},[c,l,r]),ve=(0,f.useCallback)(function(H){if(console.log("\u7F29\u7565\u56FE\u70B9\u51FB",{pageNumber:H,currentPage:l}),H===l){console.log("\u8DF3\u8FC7\u76F8\u540C\u9875\u9762");return}console.log("\u89E6\u53D1\u9875\u9762\u5207\u6362"),h(H)},[l,h]);(0,f.useEffect)(function(){if(!(!s.current||!r)){S();var H=s.current,$=function(){requestAnimationFrame(S)};return H.addEventListener("scroll",$),function(){H==null||H.removeEventListener("scroll",$)}}},[S,r]),(0,f.useEffect)(function(){if(s.current&&l&&M&&r){var H=150,$=(l-1)*H,K=s.current,k=K.scrollTop,v=K.clientHeight;($<k||$>k+v-H)&&K.scrollTo({top:$-v/2+H/2,behavior:"smooth"})}},[l,M,r]);var L=function(){if(!M)return(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7DPDF\u7F29\u7565\u56FE..."});for(var $=[],K=function(z){var V=b.includes(z);$.push((0,e.jsxs)("div",{className:"thumbnail-item ".concat(z===l?"active":""),onClick:function(){return ve(z)},style:{cursor:"pointer"},children:[(0,e.jsx)("div",{className:"thumbnail-page-number",children:z}),(0,e.jsx)("div",{className:"thumbnail-container",children:V&&(0,e.jsx)(Zt.Z,{pageNumber:z,width:100,renderTextLayer:!1,renderAnnotationLayer:!1,loading:null})})]},z))},k=1;k<=c;k++)K(k);return $.push((0,e.jsx)("div",{style:{height:"20px",flexShrink:0}},"bottom-space")),$};return(0,e.jsx)("div",{className:"thumbnail-preview-box",children:(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:O,loading:(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7D\u6587\u6863\u4E2D..."}),error:(0,e.jsx)("div",{className:"thumbnail-error",children:"PDF\u52A0\u8F7D\u5931\u8D25"}),children:(0,e.jsx)("div",{className:"thumbnail-list",ref:s,children:L()})})})},Ca=ba;Dn().showWarnings=!1;var tn={BASE:6,TOP:9};Lt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Lt.i8,"/pdf.worker.min.mjs");var Sa=function(n){var t=n.fileUrl,c=n.fileName,l=n.readOnly,h=l===void 0?!1:l,s=n.style,F=s===void 0?{}:s,T=n.className,b=T===void 0?"":T,R=n.annotationList,u=R===void 0?[]:R,J=n.onSave;console.log("readOnly",h);var M=(0,f.useState)(0),y=te()(M,2),i=y[0],p=y[1],r=(0,f.useState)(1),C=te()(r,2),O=C[0],S=C[1],ve=(0,f.useState)(1),L=te()(ve,2),H=L[0],$=L[1],K=(0,f.useState)({width:0,height:0}),k=te()(K,2),v=k[0],z=k[1],V=(0,f.useState)(null),B=te()(V,2),P=B[0],d=B[1],x=(0,f.useState)("#FFFF00"),j=te()(x,2),Z=j[0],X=j[1],m=(0,f.useState)("solid"),re=te()(m,2),oe=re[0],g=re[1],Y=(0,f.useState)(!1),U=te()(Y,2),D=U[0],q=U[1],Q=(0,f.useState)(!1),W=te()(Q,2),ke=W[0],Pe=W[1],Ue=(0,f.useState)({}),Ze=te()(Ue,2),Oe=Ze[0],Ae=Ze[1],he=(0,f.useState)("thumbnails"),le=te()(he,2),a=le[0],o=le[1],I=(0,f.useState)(!0),E=te()(I,2),A=E[0],G=E[1],ce=(0,f.useRef)(null),ee=(0,f.useRef)({}),ne=(0,f.useRef)({}),se=(0,f.useRef)(null),de=ta(u),fe=de.annotations,De=de.addAnnotation,Ce=de.updateAnnotation,je=de.removeAnnotation,Ee=function(){var _=[".highlight-container","[data-highlight-id]",".custom-pdf-highlight",".web-highlighter-selection",".web-highlighter-wrapper"];_.forEach(function(be){document.querySelectorAll(be).forEach(function(Se){try{if(Se.textContent)if(Se.parentNode&&Se.parentNode!==document.body){var Fe=Se.textContent,Le=document.createTextNode(Fe);Se.parentNode.replaceChild(Le,Se)}else Se.remove();else Se.remove()}catch(Me){console.error("\u6E05\u7406\u9AD8\u4EAE\u5143\u7D20\u5931\u8D25:",Me)}})});try{document.querySelectorAll("style[data-highlight-style]").forEach(function(be){be.remove()});var ge=document.querySelector(".react-pdf__Page__textContent");ge&&ge.querySelectorAll("span, div").forEach(function(be){be.style.userSelect="text",be.style.webkitUserSelect="text",be.style.pointerEvents="auto"})}catch(be){console.error("\u6E05\u7406web-highlighter\u5143\u7D20\u5931\u8D25:",be)}},Je=(0,f.useCallback)(function(){if(!(!se.current||!ne.current)){var ue=se.current,_=ue.scrollTop,ge=O,be=1/0;Object.entries(ne.current).forEach(function(Se){var Fe=te()(Se,2),Le=Fe[0],Me=Fe[1];if(Me){var tt=Me.offsetTop,Ie=Math.abs(tt-_);Ie<be&&(be=Ie,ge=parseInt(Le))}}),ge!==O&&S(ge)}},[O]);(0,f.useEffect)(function(){var ue=se.current;if(ue){var _=!1,ge=function(){_||(requestAnimationFrame(function(){Je(),_=!1}),_=!0)};return ue.addEventListener("scroll",ge,{passive:!0}),function(){ue.removeEventListener("scroll",ge)}}},[Je]);var gt=(0,f.useCallback)(function(ue){ee.current&&Ee(),S(ue);var _=ne.current[ue];_&&se.current&&se.current.scrollTo({top:_.offsetTop,behavior:"smooth"})},[]),yt=function(_){var ge=_.numPages;p(ge)},lt=function(_){var ge=_.getViewport({scale:1});z({width:ge.width,height:ge.height})},st=function(_){g(_)},xt=function(_){d(_),(_==="signature"||_==="stamp")&&q(!0),_==="text"&&(Pe(!0),Ae({}))},bt=function(_,ge){!v.width||!v.height||(De({id:"add-"+et(),type:ge,pageNumber:O,x:v.width/4,y:v.height/4,width:v.width/2,height:ge==="signature"?v.height/8:v.width/4,imageData:_,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#000000",opacity:1}),q(!1),d(null))},Ct=function(_,ge,be){if(!(!v.width||!v.height)){var Se=function(At,qe){var ct=document.createElement("canvas"),We=ct.getContext("2d");if(!We)return{width:200,height:100};We.font="".concat(qe,"px Arial");for(var ut=v.width*.8,dt=At.split(""),Re=[],Te="",He=0;He<dt.length;He++){var It=dt[He],Ht=Te+It,dn=We.measureText(Ht);dn.width>ut&&Te.length>0?(Re.push(Te),Te=It):Te=Ht}Te.length>0&&Re.push(Te);for(var hn=qe*1.5,vn=Math.max(Re.length*hn+16,40),Pt=0,Ft=0,zt=Re;Ft<zt.length;Ft++){var fn=zt[Ft],gn=We.measureText(fn).width;Pt=Math.max(Pt,gn)}return{width:Math.min(Math.max(Pt+16,100),ut),height:vn}};if(Oe!=null&&Oe.id){var Fe=Se(_,ge),Le=Fe.width,Me=Fe.height;Ce(Oe.id,{text:_,fontSize:ge,backgroundColor:be,width:Le,height:Me,modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss")})}else{var tt=Se(_,ge),Ie=tt.width,kt=tt.height,wt={id:"add-"+et(),type:"text",pageNumber:O,x:(v.width-Ie)/2,y:v.height/4,width:Ie,height:kt,text:_,fontSize:ge,backgroundColor:be,createdAt:pe()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:pe()().format("YYYY-MM-DD HH:mm:ss"),color:"#333333",opacity:1};De(wt)}Pe(!1),d(null),Ae({})}},St=function(){return $(H*1.2)},pt=function(){return $(H/1.2)},jt=function(){G(!A)},Dt=function(_){["rectangle","circle","ellipse","freedraw","freehighlight"].includes(_.type)?De(w()(w()({},_),{},{lineStyle:oe})):De(_)},mt=(0,f.useCallback)(function(ue){return{current:ee.current[ue]||null}},[]),Be=function(){for(var _=[],ge=function(Fe){_.push((0,e.jsxs)("div",{className:"pdf-page-container",style:{position:"relative",marginBottom:"10px"},ref:function(Me){Me&&(ne.current[Fe]=Me)},children:[(0,e.jsx)(Zt.Z,{pageNumber:Fe,width:v.width,scale:H,renderTextLayer:!0,renderAnnotationLayer:!1,onLoadSuccess:function(Me){return lt(Me)},loading:null}),(0,e.jsxs)("div",{ref:function(Me){Me&&(ee.current[Fe]=Me)},className:"pdf-layer",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[(0,e.jsx)(fa,{pageNumber:Fe,scale:H,activeTool:["highlight","strikethrough","underline"].includes(P)?P:null,activeColor:Z,pdfLayerRef:mt(Fe),annotations:fe.filter(function(Le){return Le.pageNumber===Fe}),onAnnotationAdd:De,onAnnotationRemove:je,onAnnotationUpdate:Ce,onToolReset:function(){return d(null)},readOnly:h,zIndex:["highlight","strikethrough","underline"].includes(P)?tn.TOP:tn.BASE}),(0,e.jsx)(aa,{pageNumber:Fe,scale:H,width:v.width,height:v.height,activeTool:["highlight","strikethrough","underline"].includes(P)?null:P,activeColor:Z,activeLineStyle:oe,annotations:fe.filter(function(Le){return Le.pageNumber===Fe}),readOnly:h,zIndex:["highlight","strikethrough","underline"].includes(P)?tn.BASE:tn.TOP,onAnnotationAdd:Dt,onAnnotationUpdate:Ce,onAnnotationRemove:je,onToolReset:function(){return d(null)},setShowTextNotePanel:Pe,setTextNotePanelData:Ae})]})]},Fe))},be=1;be<=i;be++)ge(be);return _};return(0,e.jsxs)("div",{className:"pdf-annotation-container-box ".concat(b),style:F,ref:ce,children:[(0,e.jsx)(da,{fileUrl:t,fileName:c,annotations:xe()(fe),currentPage:O,numPages:i,readOnly:h,pdfLayerRef:ee,scale:H,sidebarVisible:A,toggleSidebar:jt,setCurrentPage:S,zoomOut:pt,zoomIn:St,onSave:J}),h?null:(0,e.jsx)(ca,{activeTool:P,activeColor:Z,activeLineStyle:oe,onToolSelect:xt,onColorChange:X,onLineStyleChange:st}),(0,e.jsxs)("div",{className:"pdf-annotation-content",children:[(0,e.jsx)("div",{className:"pdf-annotation-sidebar ".concat(A?"visible":"hidden"),children:(0,e.jsx)(Qt.Z,{activeKey:a,onChange:function(_){return o(_)},items:[{key:"thumbnails",label:"\u9875\u9762\u9884\u89C8",children:(0,e.jsx)(Ca,{fileUrl:t,numPages:i,currentPage:O,onPageChange:gt})},{key:"annotations",label:"\u6279\u6CE8\u5217\u8868",children:(0,e.jsx)(oa,{annotations:fe==null?void 0:fe.filter(function(ue){return ue.pageNumber===O}),currentPage:O,pdfLayerRef:mt(O),scale:H,handlePageChange:gt,onAnnotationDelete:je,onAnnotationUpdate:Ce,readOnly:h})}]})}),(0,e.jsx)("div",{className:"pdf-annotation-main",ref:se,style:{overflowY:"auto",height:"100%"},children:(0,e.jsx)(Mt.Z,{file:t,onLoadSuccess:yt,loading:(0,e.jsxs)("div",{className:"pdf-loading",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"0 0 1024 1024",width:"48",height:"48",fill:"#1677ff",children:[(0,e.jsx)("path",{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}),(0,e.jsx)("path",{d:"M304 544h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0-144h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 288h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"14px",fontWeight:500,textAlign:"center"},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]}),error:(0,e.jsxs)("div",{className:"pdf-error",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"64 64 896 896",width:"48",height:"48",fill:"#ff4d4f",children:[(0,e.jsx)("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}),(0,e.jsx)("path",{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"16px",fontWeight:500,marginBottom:"8px"},children:"\u52A0\u8F7DPDF\u5931\u8D25"}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.65)",fontSize:"14px"},children:"\u8BF7\u68C0\u67E5\u6587\u4EF6\u683C\u5F0F\u6216\u7F51\u7EDC\u8FDE\u63A5\u540E\u91CD\u8BD5"})]}),children:Be()})})]}),D&&P&&(0,e.jsx)(ma,{visible:D,type:P,onSave:function(_){return bt(_,P)},onCancel:function(){q(!1),d(null)}}),ke&&(0,e.jsx)(xa,{onSave:Ct,onCancel:function(){Pe(!1),d(null),Ae({})},visible:ke,curTextNotePanelData:Oe})]})},ja=Sa}}]);
