"use strict";(self.webpackChunkpangcg_components=self.webpackChunkpangcg_components||[]).push([[296],{53002:function(hn,Ge,u){u.r(Ge),u.d(Ge,{ErrorBoundaryContext:function(){return it}});var vt=u(67294),it=(0,vt.createContext)(null)},51447:function(hn,Ge,u){u.r(Ge),u.d(Ge,{default:function(){return Ft},useErrorBoundary:function(){return kt}});var vt=u(56690),it=u.n(vt),Gt=u(89728),f=u.n(Gt),$t=u(66115),At=u.n($t),ot=u(61655),Ne=u.n(ot),lt=u(26389),Et=u.n(lt),$e=u(67294),ft=u(53002),We={didCatch:!1,error:null};function Pt(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Ie.length!==ve.length||Ie.some(function(v,He){return!Object.is(v,ve[He])})}var Ft=function(Ie){Ne()(v,Ie);var ve=Et()(v);function v(He){var _;return it()(this,v),_=ve.call(this,He),_.resetErrorBoundary=_.resetErrorBoundary.bind(At()(_)),_.state=We,_}return f()(v,[{key:"resetErrorBoundary",value:function(){var _=this.state.error;if(_!==null){for(var Oe,Le,e=arguments.length,Ue=new Array(e),Be=0;Be<e;Be++)Ue[Be]=arguments[Be];(Oe=(Le=this.props).onReset)===null||Oe===void 0||Oe.call(Le,{args:Ue,reason:"imperative-api"}),this.setState(We)}}},{key:"componentDidCatch",value:function(_,Oe){var Le,e;(Le=this.props)===null||Le===void 0||(e=Le.onError)===null||e===void 0||e.call(Le,_,Oe)}},{key:"componentDidUpdate",value:function(_,Oe){var Le=this.state.didCatch,e=this.props.resetKeys;if(Le&&Oe.error!==null&&Pt(_.resetKeys,e)){var Ue,Be;(Ue=(Be=this.props).onReset)===null||Ue===void 0||Ue.call(Be,{next:e,prev:_.resetKeys,reason:"keys"}),this.setState(We)}}},{key:"render",value:function(){var _=this.props,Oe=_.children,Le=_.fallbackRender,e=_.FallbackComponent,Ue=_.fallback,Be=this.state,Tt=Be.didCatch,gt=Be.error,_e=Oe;if(Tt){var wt={error:gt,resetErrorBoundary:this.resetErrorBoundary};if(typeof Le=="function")_e=Le(wt);else if(e)_e=(0,$e.createElement)(e,wt);else if(Ue!==void 0)_e=Ue;else throw console.error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop"),gt}return(0,$e.createElement)(ft.ErrorBoundaryContext.Provider,{value:{didCatch:Tt,error:gt,resetErrorBoundary:this.resetErrorBoundary}},_e)}}],[{key:"getDerivedStateFromError",value:function(_){return{didCatch:!0,error:_}}}]),v}($e.Component);function kt(){var Ie=$e.useContext(ft.ErrorBoundaryContext);if(Ie===null)throw new Error("useErrorBoundary must be used within an ErrorBoundary");return Ie}},94434:function(hn,Ge,u){u.r(Ge),u.d(Ge,{EMAIL_PATTERN:function(){return Cn},EMAIL_PATTERN_S:function(){return Dn},EditFormTable:function(){return gt},EditFormTreeTable:function(){return Ln},ErrorBoundary:function(){return vn.default},ID_CARD_PATTERN:function(){return jn},PHONE_NUMBER_PATTERN:function(){return Sn},PdfAnnotationExtension:function(){return Yr},PdfPreview:function(){return On},URL_PATTERN:function(){return kr},generateUUID:function(){return Ye},isEmail:function(){return jr},isEmails:function(){return wr},isEmpty:function(){return Ar},isIDCard:function(){return Er},isNumeric:function(){return Pr},isPhoneNumber:function(){return Fr},isURL:function(){return Tr},useEditFormTable:function(){return Le},useEditFormTreeTable:function(){return kn},useErrorBoundary:function(){return vn.useErrorBoundary}});var vt=u(38416),it=u.n(vt),Gt=u(42122),f=u.n(Gt),$t=u(70215),At=u.n($t),ot=u(27973),Ne=u(40741),lt=u(55102),Et=u(34041),$e=u(13457),ft=u(84567),We=u(55742),Pt=u(41637),Ft=u(68351),kt=u(68968),Ie=u(98644),ve=u(83622),v=u(67294),He=u(861),_=u.n(He),Oe=function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"id",l=i,o=function(A,h){var L,b=(l==null?void 0:l.getFieldValue(A))||[];b.push(f()(f()({},h||{}),{},it()({},t,(h==null||(L=h[t])===null||L===void 0?void 0:L.toString())||"add-".concat(Ye())))),l.setFieldValue(A,b)},g=function(A,h){var L=(l==null?void 0:l.getFieldValue(A))||[],b=L==null?void 0:L.filter(function(C,r){return r!==h});l.setFieldValue(A,_()(b))},d=function(A,h,L){l.setFieldValue([A,h],f()({},L))},k=function(A,h,L,b){l.setFieldValue([A,h,L],b)},T=function(A,h,L){var b=(l==null?void 0:l.getFieldValue(A))||[];b[h]=f()({},L),l.setFieldValue(A,_()(b))};return{addRecord:o,deleteRecord:g,updateRecord:d,updateRecordField:k,updateFormList:T}},Le=Oe,e=u(85893),Ue=["formListProps","recordCreatorProps","columns","rowKey"],Be=ot.default.RangePicker,Tt=function(i){var t=i.formListProps,l=i.recordCreatorProps,o=l===void 0?{creatorButtonShow:!1}:l,g=i.columns,d=i.rowKey,k=d===void 0?"id":d,T=At()(i,Ue),S=Ne.Z.useFormInstance(),A=function(b,C){switch(b){case"input":return(0,e.jsx)(lt.Z,f()({},C));case"select":return(0,e.jsx)(Et.default,f()({},C));case"datePicker":return(0,e.jsx)(ot.default,f()({},C));case"rangePicker":return(0,e.jsx)(Be,f()({},C));case"inputNumber":return(0,e.jsx)($e.Z,f()({},C));case"checkbox":return(0,e.jsx)(ft.Z,f()({},C));case"radio":return(0,e.jsx)(We.ZP,f()({},C));case"switch":return(0,e.jsx)(Pt.Z,f()({},C));case"timePicker":return(0,e.jsx)(Ft.Z,f()({},C));case"treeSelect":return(0,e.jsx)(kt.Z,f()({},C));default:return null}},h=function(){var b=S.getFieldValue(t.name)||[];return g.map(function(C){var r=C.dataIndex,s=C.componentType,n=s===void 0?"text":s,m=C.componentProps,y=C.formItemProps;return f()(f()({},C),{},{render:function(fe,N,Y){var B=(b==null?void 0:b[Y])||{};if((C==null?void 0:C.customRender)instanceof Function)return C.customRender({text:(B==null?void 0:B[r])||void 0,record:B,index:Y},S);if((C==null?void 0:C.render)instanceof Function)return C.render((B==null?void 0:B[r])||"",B,Y);if(n==="text"){var K;return(B==null||(K=B[r])===null||K===void 0?void 0:K.toString())||""}var E=(y==null?void 0:y.valuePropName)||function(){switch(n){case"switch":case"checkbox":return"checked";default:return"value"}}();return(0,e.jsx)(Ne.Z.Item,f()(f()({},y),{},{valuePropName:E,name:[Y,r],style:{marginBottom:0},children:A(n,m)}))}})})};return(0,e.jsx)(Ne.Z.List,f()(f()({},t||{}),{},{children:function(b,C){var r=C.add;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.Z,f()(f()({},T||{}),{},{columns:h(),rowKey:function(n){var m,y=S.getFieldValue(t.name)||[],D=n.name;return y==null||(m=y[D])===null||m===void 0?void 0:m[k]},dataSource:b,pagination:!1})),o!=null&&o.creatorButtonShow?(0,e.jsx)("div",{style:{marginTop:24},children:(0,e.jsx)(ve.ZP,f()(f()({},(o==null?void 0:o.buttonProps)||{type:"dashed",block:!0}),{},{onClick:function(){var n,m=o!=null&&o.record?o==null?void 0:o.record():{};r(f()(f()({},m),{},it()({},k,(m==null||(n=m[k])===null||n===void 0?void 0:n.toString())||"add-".concat(Ye()))))},children:(o==null?void 0:o.creatorButtonText)||"\u65B0\u589E\u4E00\u884C"}))}):null]})}}))},gt=Tt,_e=u(96486),wt=function(i){var t=i,l=function(T,S){var A=(t==null?void 0:t.getFieldValue(T))||[];A.push(f()(f()({},S||{}),{},{_key:Ye()})),t.setFieldValue(T,A)},o=function(T,S,A){var h=(t==null?void 0:t.getFieldValue(T))||[],L=function C(r){return r.map(function(s){var n,m;return(S==null?void 0:S.toString())===(s==null||(n=s._key)===null||n===void 0?void 0:n.toString())?f()(f()({},s),{},{children:[].concat(_()((s==null?void 0:s.children)||[]),[f()(f()({},A||{}),{},{_key:Ye()})])}):Array.isArray(s==null?void 0:s.children)&&s!==null&&s!==void 0&&(m=s.children)!==null&&m!==void 0&&m.length?f()(f()({},s),{},{children:C(s.children)}):s})},b=L(h);t.setFieldValue(T,b)},g=function(T,S){var A=(t==null?void 0:t.getFieldValue(T))||[],h=function b(C){return C.filter(function(r){var s,n;return((s=r._key)===null||s===void 0?void 0:s.toString())===(S==null?void 0:S.toString())?!1:(Array.isArray(r==null?void 0:r.children)&&r!==null&&r!==void 0&&(n=r.children)!==null&&n!==void 0&&n.length&&(r.children=b(r.children)),!0)})},L=h(A);t.setFieldValue(T,L)},d=function(T,S,A){var h=(t==null?void 0:t.getFieldValue(T))||[],L=function C(r){return r.map(function(s){var n,m;if((S==null?void 0:S.toString())===(s==null||(n=s._key)===null||n===void 0?void 0:n.toString())){var y;return f()(f()({},s),f()(f()({},A),{},{_key:(s==null||(y=s._key)===null||y===void 0?void 0:y.toString())||Ye()}))}return Array.isArray(s==null?void 0:s.children)&&s!==null&&s!==void 0&&(m=s.children)!==null&&m!==void 0&&m.length&&(s.children=C(s.children)),s})},b=L(h);t.setFieldValue(T,b)};return{addRootRecord:l,addChildRecord:o,deleteRecord:g,updateRecord:d}},kn=wt,Tn=["formListProps","recordCreatorProps","columns","dataSource","rowKey"],wn=ot.default.RangePicker,Nn=function(i){var t=i.formListProps,l=i.recordCreatorProps,o=l===void 0?{creatorButtonShow:!1}:l,g=i.columns,d=i.dataSource,k=i.rowKey,T=k===void 0?"id":k,S=At()(i,Tn),A=Ne.Z.useFormInstance();(0,v.useEffect)(function(){if(t.name&&d){var r=function n(m){m.forEach(function(y){var D,fe;y._key=(y==null||(D=y[T])===null||D===void 0?void 0:D.toString())||Ye(),Array.isArray(y==null?void 0:y.children)&&y!==null&&y!==void 0&&(fe=y.children)!==null&&fe!==void 0&&fe.length?n(y.children):y.children=null})},s=Array.isArray(d)?(0,_e.cloneDeep)(d):[];r(s),A==null||A.setFieldValue(t.name,s||[])}},[d,t]);var h=function(s,n){switch(s){case"input":return(0,e.jsx)(lt.Z,f()({},n));case"select":return(0,e.jsx)(Et.default,f()({},n));case"datePicker":return(0,e.jsx)(ot.default,f()({},n));case"rangePicker":return(0,e.jsx)(wn,f()({},n));case"inputNumber":return(0,e.jsx)($e.Z,f()({},n));case"checkbox":return(0,e.jsx)(ft.Z,f()({},n));case"radio":return(0,e.jsx)(We.ZP,f()({},n));case"switch":return(0,e.jsx)(Pt.Z,f()({},n));case"timePicker":return(0,e.jsx)(Ft.Z,f()({},n));case"treeSelect":return(0,e.jsx)(kt.Z,f()({},n));default:return null}},L=function(){return g.map(function(s){var n=s.dataIndex,m=s.componentType,y=m===void 0?"text":m,D=s.componentProps,fe=s.formItemProps;return f()(f()({},s),{},{render:function(Y,B,K){var E=(0,_e.cloneDeep)(f()({},B));if((s==null?void 0:s.customRender)instanceof Function)return s.customRender({text:(E==null?void 0:E[n])||void 0,record:E,index:K},A);if((s==null?void 0:s.render)instanceof Function){var p;return s.render((E==null||(p=E[n])===null||p===void 0?void 0:p.toString())||"",E,K)}else{if(y==="text"){var G;return(E==null||(G=E[n])===null||G===void 0?void 0:G.toString())||""}var W=(fe==null?void 0:fe.valuePropName)||function(){switch(y){case"switch":case"checkbox":return"checked";default:return"value"}}();return(0,e.jsx)(Ne.Z.Item,f()(f()({},fe),{},{valuePropName:W,name:[].concat(_()(B.fieldKey),[n]),style:{marginBottom:0},children:h(y,D)}))}}})})},b=function(s){var n,m=o!=null&&o.record?o==null?void 0:o.record():{},y=o!=null&&o.record?f()(f()({},m),{},{children:Array.isArray(m==null?void 0:m.children)&&m!==null&&m!==void 0&&(n=m.children)!==null&&n!==void 0&&n.length?m.children:null,_key:Ye()}):{_key:Ye(),children:null};s(f()({},y))},C=(0,v.useCallback)(function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return r==null?void 0:r.map(function(n,m){var y=[].concat(_()(s),[m]),D=A.getFieldValue([t.name].concat(_()(y)));return f()(f()({},D),{},{fieldKey:y,isListField:!0,children:D!=null&&D.children?C(Array(D.children.length).fill({}),[].concat(_()(y),["children"])):void 0})})},[A,t.name]);return(0,e.jsx)(Ne.Z.List,f()(f()({},t||{}),{},{children:function(s,n){var m=n.add;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.Z,f()(f()({},S||{}),{},{dataSource:C(s),columns:L(),rowKey:function(D){return D._key},pagination:!1})),o!=null&&o.creatorButtonShow?(0,e.jsx)("div",{style:{marginTop:24},children:(0,e.jsx)(ve.ZP,f()(f()({},(o==null?void 0:o.buttonProps)||{type:"dashed",block:!0}),{},{onClick:function(){return b(m)},children:(o==null?void 0:o.creatorButtonText)||"\u6DFB\u52A0\u4E00\u884C"}))}):null]})}}))},Ln=Nn,vn=u(51447),Mn=u(17061),Te=u.n(Mn),Zn=u(17156),Je=u.n(Zn),Bn=u(27424),Q=u.n(Bn),fn=u(19944),gn=u(84477),mn=u(52514),pn=u(89514),yn=u(69753),ae=u(45360),Jt=u(57381),st=u(96074),Nt=u(28541),Lt=u(16085),Mt=u(95327);Nt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Nt.i8,"/pdf.worker.min.mjs");var Rn=function(i){var t=i.fileUrl,l=i.fileName,o=l===void 0?"\u6587\u4EF6\u9884\u89C8":l,g=i.className,d=g===void 0?"":g,k=i.style,T=k===void 0?{}:k,S=(0,v.useState)(null),A=Q()(S,2),h=A[0],L=A[1],b=(0,v.useState)(1),C=Q()(b,2),r=C[0],s=C[1],n=(0,v.useState)(1),m=Q()(n,2),y=m[0],D=m[1],fe=(0,v.useState)(!0),N=Q()(fe,2),Y=N[0],B=N[1],K=(0,v.useState)(null),E=Q()(K,2),p=E[0],G=E[1],W=(0,v.useState)(o),I=Q()(W,2),ne=I[0],R=I[1],ie=(0,v.useState)(!1),ke=Q()(ie,2),je=ke[0],Ee=ke[1],H=(0,v.useState)(null),ze=Q()(H,2),Re=ze[0],Se=ze[1],se=(0,v.useRef)(null),xe=(0,v.useRef)(null),de=(0,v.useRef)(null),Ae=function(j){return typeof File!="undefined"&&j instanceof File},et=function(j){return typeof Blob!="undefined"&&j instanceof Blob},tt=function(){var F=Je()(Te()().mark(function j(){var x,M;return Te()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:x="",M=!0;try{typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://"))?(G(t),x=t.split("/").pop()||o):typeof t=="string"&&t.startsWith("data:")?G(t):et(t)||Ae(t)?(G(t),x=Ae(t)&&t!==null&&t!==void 0&&t.name?t.name:o):(ae.ZP.error("\u4E0D\u652F\u6301\u7684\u6587\u4EF6\u683C\u5F0F"),M=!1),M&&R(x),B(!1)}catch(q){console.error("\u5904\u7406\u6587\u4EF6\u65F6\u51FA\u9519:",q),ae.ZP.error("\u65E0\u6CD5\u52A0\u8F7D\u6587\u4EF6"),B(!1)}case 3:case"end":return J.stop()}},j)}));return function(){return F.apply(this,arguments)}}();(0,v.useEffect)(function(){B(!0),G(null),s(1),tt()},[t,o]);var ct=function(j){var x=j.numPages;L(x),B(!1)},nt=function(){},pt=function(j){if(!(!se.current||!h)){Se("thumbnail");var x=se.current,M=x.scrollHeight,ee=M/(h||1),J=(j-1)*ee;x.scrollTo({top:J,behavior:"smooth"}),setTimeout(function(){Se(null)},500)}},ut=function(j){s(j+1),pt(j+1)},dt=function(){if(!(!xe.current||!r||!h)){var j=xe.current,x=j.clientHeight,M=j.scrollHeight,ee=M/(h||1),J=(r-1)*ee-x/2+ee/2;j.scrollTo({top:Math.max(0,J),behavior:"smooth"})}},Xe=function(){D(y*1.2)},yt=function(){D(y/1.2)},oe=function(){try{if(typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://")))window.open(t,"_blank");else if(typeof t=="string"&&t.startsWith("data:")){var j=document.createElement("a");j.href=t,j.download=ne||"document.pdf",j.click()}else if(et(t)||Ae(t)){var x=URL.createObjectURL(t),M=document.createElement("a");M.href=x,M.download=ne||"document.pdf",M.click(),setTimeout(function(){return URL.revokeObjectURL(x)},100)}}catch(ee){console.error("\u4E0B\u8F7D\u6587\u4EF6\u65F6\u51FA\u9519:",ee),ae.ZP.error("\u4E0B\u8F7D\u6587\u4EF6\u5931\u8D25")}},a=function(){Ee(!je)};(0,v.useEffect)(function(){var F=se.current;if(!(!F||!h)){var j=function(){if(Re!=="thumbnail"){Se("pdf");var J=F.scrollTop,q=F.scrollHeight,le=q/h,he=Math.floor(J/le)+1,ce=J%le/le,Fe=ce>.5?he+1:he,ge=Math.max(1,Math.min(Fe,h));ge!==r&&s(ge),de.current&&clearTimeout(de.current),de.current=setTimeout(function(){Se(null)},150)}},x=null,M=function(){x||(x=setTimeout(function(){j(),x=null},50))};return F.addEventListener("scroll",M),function(){F.removeEventListener("scroll",M),x&&clearTimeout(x),de.current&&clearTimeout(de.current)}}},[h,r,Re]),(0,v.useEffect)(function(){Re==="pdf"&&dt()},[r,Re]);var c=function(){return Y||!p?(0,e.jsx)("div",{className:"document-preview-loading",children:(0,e.jsxs)("div",{className:"loading-container",children:[(0,e.jsx)(Jt.Z,{size:"large"}),(0,e.jsx)("div",{className:"loading-text",style:{marginTop:"16px",color:"rgba(0, 0, 0, 0.65)",fontSize:"14px",fontWeight:500},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"pdf-controls",children:[(0,e.jsx)("div",{className:"pdf-controls-left",children:(0,e.jsx)(ve.ZP,{type:"text",icon:je?(0,e.jsx)(fn.Z,{}):(0,e.jsx)(gn.Z,{}),onClick:a,className:"thumbnail-toggle-btn"})}),(0,e.jsxs)("div",{className:"pdf-controls-center",children:[(0,e.jsx)("div",{className:"page-indicator",children:"".concat(r," / ").concat(h||1)}),(0,e.jsx)(st.Z,{type:"vertical",className:"page-divider"}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ve.ZP,{type:"text",icon:(0,e.jsx)(mn.Z,{}),onClick:yt}),(0,e.jsx)("span",{className:"zoom-indicator",children:"".concat(Math.round(y*100),"%")}),(0,e.jsx)(ve.ZP,{type:"text",icon:(0,e.jsx)(pn.Z,{}),onClick:Xe})]})]}),(0,e.jsx)("div",{className:"pdf-controls-right",children:(0,e.jsx)(ve.ZP,{type:"text",icon:(0,e.jsx)(yn.Z,{}),onClick:oe,className:"download-btn"})})]}),(0,e.jsxs)("div",{className:"pdf-content-container",children:[(0,e.jsx)("div",{className:"pdf-thumbnails-container ".concat(je?"collapsed":""),ref:xe,children:h&&(0,e.jsx)(Lt.Z,{file:p,onLoadSuccess:nt,loading:(0,e.jsx)(Jt.Z,{size:"small"}),children:Array.from(new Array(h),function(j,x){return(0,e.jsxs)("div",{className:"pdf-thumbnail ".concat(r===x+1?"active":""),onClick:function(){return ut(x)},children:[(0,e.jsx)(Mt.Z,{pageNumber:x+1,scale:.15,renderTextLayer:!1,renderAnnotationLayer:!1}),(0,e.jsx)("div",{className:"thumbnail-page-number",children:x+1})]},"thumbnail-".concat(x))})})}),(0,e.jsx)("div",{className:"pdf-container",ref:se,children:(0,e.jsx)(Lt.Z,{file:p,onLoadSuccess:ct,onLoadError:function(x){console.error("Error loading PDF:",x),ae.ZP.error("\u65E0\u6CD5\u52A0\u8F7DPDF\u6587\u4EF6"),B(!1)},loading:(0,e.jsx)(Jt.Z,{size:"large"}),children:Array.from(new Array(h),function(j,x){return(0,e.jsx)("div",{className:"pdf-page-wrapper",id:"pdf-page-".concat(x+1),children:(0,e.jsx)(Mt.Z,{pageNumber:x+1,scale:y,renderTextLayer:!1,renderAnnotationLayer:!1},"page-".concat(x))},"page-wrapper-".concat(x))})})})]})]})};return(0,e.jsx)("div",{className:"document-preview-container ".concat(d),style:T?f()({},T):void 0,children:c()})},On=Rn,Un=u(37653),Yn=u(43929),zn=u(60219),Wn=u(30019),mt=u(85576),xn=u(11941),In=u(20185),Hn=u.n(In),Kr=u(97679),Gr=u(22115),Vn=u(27484),be=u.n(Vn),Kn=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=(0,v.useState)(i),l=Q()(t,2),o=l[0],g=l[1],d=(0,v.useCallback)(function(b){g(function(C){return[].concat(_()(C),[b])})},[]),k=(0,v.useCallback)(function(b,C){g(function(r){return r.map(function(s){return s.id===b?f()(f()(f()({},s),C),{},{modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")}):s})})},[]),T=(0,v.useCallback)(function(b){g(function(C){return C.filter(function(r){return r.id!==b})})},[]),S=(0,v.useCallback)(function(){g([])},[]),A=(0,v.useCallback)(function(b){return o.filter(function(C){return C.pageNumber===b})},[o]),h=(0,v.useCallback)(function(b){return o.filter(function(C){return C.type===b})},[o]),L=(0,v.useCallback)(function(b){g(b)},[]);return{annotations:o,addAnnotation:d,updateAnnotation:k,removeAnnotation:T,clearAnnotations:S,getAnnotationsByPage:A,getAnnotationsByType:h,importAnnotations:L}},Ce=u(32237),Gn=function(i,t,l){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Arial",g=document.createElement("canvas"),d=g.getContext("2d");if(!d)return{width:200,height:100};d.font="".concat(t,"px ").concat(o);for(var k=i.split(" "),T=[],S=k[0]||"",A=1;A<k.length;A++){var h=k[A],L=d.measureText(S+" "+h).width;L<l?S+=" "+h:(T.push(S),S=h)}T.push(S);for(var b=t*1.2,C=T.length*b+16,r=0,s=0,n=T;s<n.length;s++){var m=n[s],y=d.measureText(m).width;r=Math.max(r,y)}return{width:Math.min(r+16,l),height:C}},$n=function(i){var t=i.pageNumber,l=i.scale,o=i.width,g=i.height,d=i.activeTool,k=i.activeColor,T=i.activeLineStyle,S=i.annotations,A=i.readOnly,h=A===void 0?!1:A,L=i.zIndex,b=L===void 0?5:L,C=i.onAnnotationAdd,r=i.onAnnotationUpdate,s=i.onAnnotationRemove,n=i.onToolReset,m=i.setShowTextNotePanel,y=i.setTextNotePanelData,D=(0,v.useRef)(null),fe=(0,v.useRef)(null),N=(0,v.useRef)(null),Y=(0,v.useState)(null),B=Q()(Y,2),K=B[0],E=B[1],p=(0,v.useState)(!1),G=Q()(p,2),W=G[0],I=G[1],ne=(0,v.useState)(null),R=Q()(ne,2),ie=R[0],ke=R[1],je=(0,v.useState)(null),Ee=Q()(je,2),H=Ee[0],ze=Ee[1],Re=S.filter(function(oe){return["rectangle","circle","ellipse"].includes(oe.type)}),Se=S.filter(function(oe){return["freedraw","freehighlight"].includes(oe.type)}),se=S.filter(function(oe){return["signature","stamp"].includes(oe.type)}),xe=S.filter(function(oe){return oe.type==="text"}),de=function(a){if(K){var c=a.target,F=c.id(),j=c.scaleX(),x=c.scaleY();try{var M=S.find(function(re){return re.id===F});if(!M)return;var ee,J=[];switch(M.type){case"rectangle":{var q=c.width()*j,le=c.height()*x,he=c.x(),ce=c.y();r(F,{x:he,y:ce,width:q,height:le,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")});break}case"circle":{var Fe=c.width()*j,ge=c.height()*x,Pe=Math.max(Fe,ge)/2,Ze=c.x(),rt=c.y(),Qt=Ze-Pe,qt=rt-Pe;r(F,{x:Qt,y:qt,width:Pe*2,height:Pe*2,radius:Pe,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")});break}case"ellipse":{var xt=c.width()*j,Rt=c.height()*x,bt=c.x(),_t=c.y(),Ot=bt-xt/2,en=_t-Rt/2;r(F,{x:Ot,y:en,width:xt,height:Rt,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")});break}case"signature":case"stamp":{var Ut=c.width()*j,Yt=c.height()*x,tn=c.x(),nn=c.y();r(F,{x:tn,y:nn,width:Ut,height:Yt,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")});break}case"freedraw":case"freehighlight":{ee=M;var Ve=_()(ee.points);try{for(var Ct=1/0,jt=1/0,St=-1/0,Dt=-1/0,Ke=0;Ke<Ve.length;Ke+=2)Ct=Math.min(Ct,Ve[Ke]),St=Math.max(St,Ve[Ke]),jt=Math.min(jt,Ve[Ke+1]),Dt=Math.max(Dt,Ve[Ke+1]);var zt=(Ct+St)/2,rn=(jt+Dt)/2,an=c.x(),on=c.y();J=[];for(var Qe=0;Qe<Ve.length;Qe+=2){var Wt=Ve[Qe]-zt,ln=Ve[Qe+1]-rn,sn=an+Wt*j,It=on+ln*x;J.push(sn,It)}r(F,{points:J,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")}),c.scaleX(1),c.scaleY(1),c.position({x:0,y:0})}catch(re){console.error("\u5904\u7406\u81EA\u7531\u7ED8\u5236/\u9AD8\u4EAE\u53D8\u6362\u65F6\u51FA\u9519:",re),c.scaleX(1),c.scaleY(1),c.position({x:0,y:0})}break}case"text":{var ht,Ht=c.width()*j,$=c.height()*x,w=c.x()/l,Z=c.y()/l;r(F,{x:w,y:Z,width:Ht/l,height:$/l,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")});var O=(ht=c.getStage())===null||ht===void 0?void 0:ht.findOne("#text-".concat(F));if(O){var X;O.position({x:c.x()+4*l,y:c.y()+4*l}),O.width((Ht/l-8)*l),O.height(($/l-8)*l),(X=O.getLayer())===null||X===void 0||X.batchDraw()}break}}}catch(re){console.error("\u66F4\u65B0\u6279\u6CE8\u5931\u8D25:",re)}c.scaleX(1),c.scaleY(1)}},Ae=function(a){if(!(h||!d)){var c=a.target===a.currentTarget;if(c){var F=D.current;if(F){var j=F.getPointerPosition();if(j){var x=j.x/l,M=j.y/l;switch(d){case"freedraw":case"freehighlight":{I(!0);var ee=d==="freedraw"?2:10,J={id:Date.now().toString(),type:d,pageNumber:t,createdAt:be()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss"),color:k,opacity:d==="freedraw"?1:.5,points:[x,M],strokeWidth:ee,lineStyle:T};ke(J);break}case"rectangle":case"circle":case"ellipse":{var q={id:Date.now().toString(),type:d,pageNumber:t,createdAt:be()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss"),color:k,opacity:1,x,y:M,width:0,height:0,strokeWidth:2,lineStyle:T};ze(q);break}case"text":{n&&n();break}default:break}}}}}},et=function(a){if(!h){var c=a.target.getStage();if(c){var F=c.getPointerPosition();if(F){var j=F.x/l,x=F.y/l;if(W&&ie&&ke(f()(f()({},ie),{},{points:[].concat(_()(ie.points),[j,x])})),H){var M=j-H.x,ee=x-H.y;ze(f()(f()({},H),{},{width:M,height:ee,radius:Math.max(Math.abs(M||0),Math.abs(ee||0))/2}))}}}}},tt=function(){if(!h&&(W&&ie&&(ie.points.length>4&&(C(ie),n==null||n()),I(!1),ke(null)),H)){if(Math.abs(H.width||0)>5&&Math.abs(H.height||0)>5){var a=H.width||0,c=H.height||0,F=a<0?H.x+a:H.x,j=c<0?H.y+c:H.y,x=Math.abs(a),M=Math.abs(c);C(f()(f()({},H),{},{x:F,y:j,width:x,height:M,radius:H.type==="circle"?Math.max(x,M)/2:void 0})),n==null||n()}ze(null)}},ct=function(a){if(!h){var c=a.target.getStage();if(c){if(a.target===a.currentTarget){E(null);return}var F=a.target,j=F.id();d||E(j||null)}}},nt=function(){return Re.map(function(a){var c=K===a.id,F=a.lineStyle==="dashed"?[5,5]:void 0;switch(a.type){case"rectangle":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(Ce.UL,{id:a.id,x:a.x,y:a.y,width:a.width||0,height:a.height||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:F,perfectDrawEnabled:!1,listening:!h,onClick:function(){return!h&&E(a.id)},onTap:function(){return!h&&E(a.id)},draggable:!h,onDragEnd:function(x){r(a.id,{x:x.target.x(),y:x.target.y(),modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:de}),c&&!h&&(0,e.jsx)(Ce.$T,{ref:N,boundBoxFunc:function(x,M){return M},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"circle":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(Ce.Cd,{id:a.id,x:a.x+(a.radius||0),y:a.y+(a.radius||0),radius:a.radius||0,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:F,perfectDrawEnabled:!1,listening:!h,onClick:function(){return!h&&E(a.id)},onTap:function(){return!h&&E(a.id)},draggable:!h,onDragEnd:function(x){var M=x.target.x(),ee=x.target.y(),J=a.radius||0,q=M-J,le=ee-J;r(a.id,{x:q,y:le,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:de}),c&&!h&&(0,e.jsx)(Ce.$T,{ref:N,boundBoxFunc:function(x,M){return M},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);case"ellipse":return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(Ce.Pj,{id:a.id,x:a.x+(a.width||0)/2,y:a.y+(a.height||0)/2,radiusX:(a.width||0)/2,radiusY:(a.height||0)/2,stroke:a.color,strokeWidth:a.strokeWidth||2,opacity:a.opacity,dash:F,perfectDrawEnabled:!1,listening:!h,onClick:function(){return!h&&E(a.id)},onTap:function(){return!h&&E(a.id)},draggable:!h,onDragEnd:function(x){var M=x.target.x(),ee=x.target.y(),J=a.width||0,q=a.height||0,le=M-J/2,he=ee-q/2;r(a.id,{x:le,y:he,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:de}),c&&!h&&(0,e.jsx)(Ce.$T,{ref:N,boundBoxFunc:function(x,M){return M},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},a.id);default:return null}})},pt=function(){return Se.map(function(a){var c=K===a.id,F=a.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(Ce.x1,{id:a.id,points:a.points,stroke:a.color,strokeWidth:a.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:a.opacity,dash:F,perfectDrawEnabled:!1,globalCompositeOperation:a.type==="freehighlight"?"multiply":"source-over",listening:!h,onClick:function(){return!h&&E(a.id)},onTap:function(){return!h&&E(a.id)},draggable:!h,onDragEnd:function(x){var M=x.target.x(),ee=x.target.y();x.target.position({x:0,y:0});for(var J=_()(a.points),q=0;q<J.length;q+=2)J[q]+=M,J[q+1]+=ee;r(a.id,{points:J,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")})},onTransformEnd:de}),c&&!h&&(0,e.jsx)(Ce.$T,{ref:N,boundBoxFunc:function(x,M){return M},rotateEnabled:!1})]},a.id)})},ut=function(){return se.map(function(a){var c=a.id,F=a.x,j=a.y,x=a.width,M=a.height,ee=a.imageData,J=a.opacity,q=K===a.id,le=new window.Image;return le.src=ee,(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(Ce.Ee,{id:c,x:F,y:j,width:x,height:M,image:le,opacity:J,draggable:!h,onClick:function(){return!h&&E(c)},onTap:function(){return!h&&E(c)},onDragEnd:function(ce){r(c,{x:ce.target.x(),y:ce.target.y()})},onTransformEnd:de}),q&&!h&&(0,e.jsx)(Ce.$T,{ref:N,boundBoxFunc:function(ce,Fe){return Fe},rotateEnabled:!1,keepRatio:a.type==="circle",enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]})]},c)})},dt=function(){if(!ie)return null;var a=ie.lineStyle==="dashed"?[5,5]:void 0;return(0,e.jsx)(Ce.x1,{points:ie.points,stroke:ie.color,strokeWidth:ie.strokeWidth||2,lineCap:"round",lineJoin:"round",tension:.5,opacity:ie.opacity,dash:a,perfectDrawEnabled:!1,globalCompositeOperation:ie.type==="freehighlight"?"multiply":"source-over",listening:!1})},Xe=function(){if(!H)return null;var a=H.lineStyle==="dashed"?[5,5]:void 0;switch(H.type){case"rectangle":return(0,e.jsx)(Ce.UL,{x:H.x,y:H.y,width:H.width||0,height:H.height||0,stroke:H.color,strokeWidth:H.strokeWidth||2,opacity:H.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});case"circle":{var c=H.radius||0;return(0,e.jsx)(Ce.Cd,{x:H.x+c,y:H.y+c,radius:c,stroke:H.color,strokeWidth:H.strokeWidth||2,opacity:H.opacity,dash:a,perfectDrawEnabled:!1,listening:!1})}case"ellipse":return(0,e.jsx)(Ce.Pj,{x:H.x+(H.width||0)/2,y:H.y+(H.height||0)/2,radiusX:Math.abs(H.width||0)/2,radiusY:Math.abs(H.height||0)/2,stroke:H.color,strokeWidth:H.strokeWidth||2,opacity:H.opacity,dash:a,perfectDrawEnabled:!1,listening:!1});default:return null}},yt=function(){var a;return xe==null||(a=xe.filter(function(c){return c.pageNumber===t}))===null||a===void 0?void 0:a.map(function(c){var F=K===c.id,j=o*.8,x=Gn(c.text||"",c.fontSize||16,j,"Arial"),M=c.width&&c.width>20?c.width:x.width/l,ee=c.height&&c.height>20?c.height:x.height/l;return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsx)(Ce.UL,{id:c.id,x:c.x*l,y:c.y*l,width:M*l,height:ee*l,fill:c.backgroundColor||"#FFFFA0",opacity:.8,cornerRadius:4,stroke:F?"#1890ff":"transparent",strokeWidth:F?2:0,onDblClick:function(){E(c.id),m(!0),y(c)},onDblTap:function(){},draggable:!h,onDragMove:function(q){var le,he=(le=q.target.getStage())===null||le===void 0?void 0:le.findOne("#text-".concat(c.id));if(he){var ce;he.position({x:q.target.x()+4*l,y:q.target.y()+4*l}),(ce=he.getLayer())===null||ce===void 0||ce.batchDraw()}},onDragEnd:function(q){r(c.id,{x:q.target.x()/l,y:q.target.y()/l,width:M,height:ee,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")})},onTransform:function(q){var le,he=q.target,ce=(le=he.getStage())===null||le===void 0?void 0:le.findOne("#text-".concat(c.id));if(ce){var Fe,ge=he.scaleX(),Pe=he.scaleY();ce.position({x:he.x()+4*l*ge,y:he.y()+4*l*Pe}),ce.width(he.width()*ge-8*l*ge),ce.height(he.height()*Pe-8*l*Pe),(Fe=ce.getLayer())===null||Fe===void 0||Fe.batchDraw()}},onTransformEnd:de}),(0,e.jsx)(Ce.xv,{id:"text-".concat(c.id),x:(c.x+4)*l,y:(c.y+4)*l,width:(M-8)*l,height:(ee-8)*l,text:c.text,fontSize:(c.fontSize||16)*l,fontFamily:"Arial",fill:"#333333",wrap:"word",listening:!1}),F&&!h&&(0,e.jsx)(Ce.$T,{ref:N,boundBoxFunc:function(q,le){return le.width<50||le.height<30?q:le}})]},c.id)})};return(0,v.useEffect)(function(){var oe=function(c){(c.key==="Delete"||c.key==="Backspace")&&K&&!h&&(s(K),E(null))};return window.addEventListener("keydown",oe),function(){window.removeEventListener("keydown",oe)}},[K,s,h]),(0,v.useEffect)(function(){if(K&&N.current&&D.current){var oe=D.current.findOne("#".concat(K));if(oe){var a=S.find(function(rt){return rt.id===K});if(a&&!["freedraw","freehighlight"].includes(a.type)){var c,F;if((c=N.current)===null||c===void 0||c.nodes([oe]),["signature","stamp"].includes(a.type)){var j,x,M;(j=N.current)===null||j===void 0||j.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(x=N.current)===null||x===void 0||x.rotateEnabled(!1),(M=N.current)===null||M===void 0||M.keepRatio(!0)}else if(a.type==="text"){var ee,J,q;(ee=N.current)===null||ee===void 0||ee.enabledAnchors(["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"]),(J=N.current)===null||J===void 0||J.rotateEnabled(!1),(q=N.current)===null||q===void 0||q.keepRatio(!1)}else{var le,he,ce;(le=N.current)===null||le===void 0||le.enabledAnchors(["top-left","top-center","top-right","middle-left","middle-right","bottom-left","bottom-center","bottom-right"]),(he=N.current)===null||he===void 0||he.rotateEnabled(!1),(ce=N.current)===null||ce===void 0||ce.keepRatio(a.type==="circle")}(F=N.current)===null||F===void 0||(F=F.getLayer())===null||F===void 0||F.batchDraw()}else{var Fe,ge;(Fe=N.current)===null||Fe===void 0||Fe.nodes([]),(ge=N.current)===null||ge===void 0||(ge=ge.getLayer())===null||ge===void 0||ge.batchDraw()}}}else if(N.current){var Pe,Ze;(Pe=N.current)===null||Pe===void 0||Pe.nodes([]),(Ze=N.current)===null||Ze===void 0||(Ze=Ze.getLayer())===null||Ze===void 0||Ze.batchDraw()}},[K,S]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:h?"none":"auto",zIndex:b},className:"annotation-layer",children:(0,e.jsx)(Ce.Hf,{ref:D,width:o*l,height:g*l,scale:{x:l,y:l},onClick:ct,onMouseDown:Ae,onMouseMove:et,onMouseUp:tt,onTouchStart:Ae,onTouchMove:et,onTouchEnd:tt,style:{position:"absolute",top:0,left:0,pointerEvents:"all"},children:(0,e.jsxs)(Ce.mh,{ref:fe,children:[nt(),pt(),ut(),yt(),dt(),Xe(),!h&&(0,e.jsx)(Ce.$T,{ref:N,rotateEnabled:!1,keepRatio:!1,borderDash:[6,2],borderStroke:"#1890ff",anchorStroke:"#1890ff",anchorFill:"#ffffff",anchorSize:8,boundBoxFunc:function(a,c){return c.width<5||c.height<5?a:c}})]})})})},Jn=$n,Xn=u(51947),Qn=u(84646),qn=u(90755),_n=u(21082),er=u(64593),tr=u(40666),bn=u(16801),nr=u(47389),rr=u(69980),ar=u(50797),ir=u(52745),or=u(63129),Xt=u(51663),lr=function(i){var t=i.icon,l=i.active,o=l===void 0?!1:l,g=i.disabled,d=g===void 0?!1:g,k=i.onClick;return(0,e.jsx)("div",{className:"annotation-tool-button ".concat(o?"active":""," ").concat(d?"disabled":""),onClick:function(){d||k()},children:(0,e.jsx)("span",{children:t})})},Me=lr,sr=function(i){var t=i.activeTool,l=i.activeColor,o=i.activeLineStyle,g=o===void 0?"solid":o,d=i.onToolSelect,k=i.onColorChange,T=i.onLineStyleChange,S=i.readOnly,A=S===void 0?!1:S;if(A)return null;var h=["#FFFF00","#FF0000","#00FF00","#0000FF","#FF00FF","#00FFFF","#FFA500","#000000","#FFFFFF","#888888"],L=function(C,r){k(r)};return(0,e.jsx)("div",{className:"annotation-toolbar",children:(0,e.jsxs)("div",{className:"annotation-tools",children:[(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(Xn.Z,{}),active:t==="highlight",disabled:!0,onClick:function(){return d("highlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u9AD8\u4EAE"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(Qn.Z,{}),active:t==="strikethrough",disabled:!0,onClick:function(){return d("strikethrough")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5220\u9664\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(qn.Z,{}),active:t==="underline",disabled:!0,onClick:function(){return d("underline")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u4E0B\u5212\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(_n.Z,{}),active:t==="text",onClick:function(){return d("text")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u6587\u672C"})]})]}),(0,e.jsx)(st.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(er.Z,{}),active:t==="rectangle",onClick:function(){return d("rectangle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u77E9\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(tr.Z,{style:{transform:"rotate(45deg)"}}),active:t==="circle",onClick:function(){return d("circle")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5706\u5F62"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(bn.Z,{}),active:t==="ellipse",onClick:function(){return d("ellipse")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u692D\u5706"})]})]}),(0,e.jsx)(st.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(nr.Z,{}),active:t==="freedraw",onClick:function(){return d("freedraw")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u7ED8\u5236"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(rr.Z,{}),active:t==="freehighlight",onClick:function(){return d("freehighlight")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u81EA\u7531\u9AD8\u4EAE"})]})]}),(0,e.jsx)(st.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(ar.Z,{}),active:t==="signature",onClick:function(){return d("signature")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u7B7E\u540D"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(bn.Z,{style:{color:"#ff4d4f"}}),active:t==="stamp",onClick:function(){return d("stamp")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u76D6\u7AE0"})]})]}),(0,e.jsx)(st.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsxs)("div",{className:"tool-group",children:[(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(ir.Z,{}),active:g==="solid",onClick:function(){return T("solid")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u5B9E\u7EBF"})]}),(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Me,{icon:(0,e.jsx)(or.Z,{}),active:g==="dashed",onClick:function(){return T("dashed")}}),(0,e.jsx)("span",{className:"tool-name",children:"\u865A\u7EBF"})]})]}),(0,e.jsx)(st.Z,{type:"vertical",className:"tool-divider"}),(0,e.jsx)("div",{className:"tool-group",children:(0,e.jsxs)("div",{className:"tool-item",children:[(0,e.jsx)(Xt.Z,{value:l,size:"small",className:"color-picker",format:"hex",arrow:!1,placement:"bottomRight",presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:h}],onChange:L}),(0,e.jsx)("span",{className:"tool-name",children:"\u989C\u8272\u9009\u62E9"})]})})]})})},cr=sr,ur=u(89724),dr=u.n(ur),Zt=new Set,hr=function(i){if(!Zt.has(i)){var t=i.querySelectorAll(".react-pdf__Page__textContent span, .react-pdf__Page__textContent div");t.forEach(function(d){var k=d;k.style.userSelect="text",k.style.webkitUserSelect="text",k.style.mozUserSelect="text",k.style.msUserSelect="text",k.style.cursor="text",k.style.position="relative",k.style.zIndex="2",k.style.color=k.style.color||"inherit",k.style.pointerEvents="auto"});var l=i.querySelectorAll("p, span, div:not(.konvajs-content):not([data-highlight-id])");l.forEach(function(d){var k=d;k.style.cursor="text",k.style.userSelect="text"});var o=i.querySelector(".react-pdf__Page__textContent");if(o){var g=o;g.style.userSelect="text",g.style.webkitUserSelect="text",g.style.mozUserSelect="text",g.style.msUserSelect="text",g.style.zIndex="2",g.style.position="absolute",g.style.top="0",g.style.left="0",g.style.right="0",g.style.bottom="0",g.style.pointerEvents="auto"}Zt.add(i)}},vr=function(i){var t=i.pageNumber,l=i.scale,o=i.activeTool,g=i.activeColor,d=i.pdfLayerRef,k=i.annotations,T=i.onAnnotationAdd,S=i.onAnnotationRemove,A=i.onToolReset,h=i.readOnly,L=h===void 0?!1:h,b=i.zIndex,C=b===void 0?6:b,r=(0,v.useRef)(null),s=(0,v.useState)(!1),n=Q()(s,2),m=n[0],y=n[1],D=(0,v.useState)(),fe=Q()(D,2),N=fe[1],Y=(0,v.useCallback)(function(){return N({})},[]);(0,v.useEffect)(function(){if(d.current){Zt.has(d.current)&&Zt.delete(d.current);var E=d.current.querySelectorAll(".web-highlighter-wrapper, [data-highlight-id]");E.forEach(function(G){try{G.remove()}catch(W){console.error("\u6E05\u7406\u73B0\u6709\u9AD8\u4EAE\u5931\u8D25:",W)}}),hr(d.current);try{if(r.current)try{r.current.dispose()}catch(G){console.error("\u6E05\u7406\u65E7\u9AD8\u4EAE\u5668\u5B9E\u4F8B\u5931\u8D25:",G)}var p=new(dr())({$root:d.current,exceptSelectors:["canvas",".konvajs-content",".annotation-layer","[data-highlight-id]",".text-selection-preview"],wrapTag:"span",style:{className:"web-highlighter-selection",style:{display:"inline"}}});p.includeSelector=[".react-pdf__Page__textContent"],p.devicePixelRatio=window.devicePixelRatio||1,r.current=p,r.current.run()}catch(G){console.error("\u521D\u59CB\u5316web-highlighter\u5931\u8D25:",G)}return function(){if(r.current)try{r.current.dispose(),r.current=null}catch(G){console.error("\u6E05\u7406\u9AD8\u4EAE\u5668\u5931\u8D25:",G)}}}},[d,t]);var B=function(p,G,W){setTimeout(function(){try{var I=document.querySelectorAll('[data-highlight-id="'.concat(p,'"], .web-highlighter-selection[data-highlight-source="').concat(p,'"]'));I&&I.length>0&&I.forEach(function(ne){var R=ne;R.style.display="inline",R.style.position="relative",R.style.zIndex="5",R.style.pointerEvents="auto",G==="strikethrough"?(R.style.textDecoration="line-through",R.style.textDecorationColor=W,R.style.textDecorationThickness="2px",R.style.backgroundColor="transparent"):G==="underline"?(R.style.textDecoration="underline",R.style.textDecorationColor=W,R.style.textDecorationThickness="2px",R.style.backgroundColor="transparent"):G==="highlight"&&(R.style.backgroundColor=W,R.style.opacity="0.3",R.style.mixBlendMode="multiply"),R.classList.add("pdf-text-".concat(G))})}catch(ne){console.error("\u5E94\u7528\u6837\u5F0F\u5931\u8D25:",ne)}},50)},K=function(){if(d.current){var p=d.current.querySelectorAll("[data-highlight-id]"),G=new Map;p.forEach(function(W){var I=W.getAttribute("data-highlight-id");if(I)if(G.has(I))try{W.remove()}catch(ne){console.error("\u6E05\u7406\u91CD\u590D\u9AD8\u4EAE\u5931\u8D25:",ne)}else G.set(I,!0)})}};return(0,v.useEffect)(function(){if(!(!r.current||L)){var E=function(W){var I=W.sources;if(!(!o||!I||I.length===0)){var ne=I[0],R={id:ne.id||Date.now().toString(),type:o,pageNumber:t,createdAt:be()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss"),color:g,opacity:o==="highlight"?.3:1,text:ne.text||"",rects:ne.rects||[],highlightId:ne.id};T(R),y(!1),B(ne.id,o,g),Y(),K(),A==null||A()}},p=function(W){var I=W.id;o||window.confirm("\u662F\u5426\u5220\u9664\u6B64\u6279\u6CE8\uFF1F")&&(r.current&&r.current.remove(I),S(I))};return r.current.on("selection:create",E),r.current.on("click",p),function(){r.current&&(r.current.off("selection:create",E),r.current.off("click",p))}}},[o,g,t,T,S,L,Y,A]),(0,v.useEffect)(function(){if(!(!r.current||L)){var E=function(){var W;if(o){var I=window.getSelection();if(!(!I||I.isCollapsed||I.rangeCount===0)){var ne=I.getRangeAt(0);(W=d.current)!==null&&W!==void 0&&W.contains(ne.commonAncestorContainer)&&y(!0)}}},p=function(){var W;if(!(!o||!r.current)){var I=window.getSelection();if(!(!I||I.isCollapsed||I.rangeCount===0)){var ne=I.getRangeAt(0);if((W=d.current)!==null&&W!==void 0&&W.contains(ne.commonAncestorContainer)&&!m){var R=I.toString().trim();if(R){var ie={className:"pdf-text-".concat(o)};switch(o){case"highlight":ie=f()(f()({},ie),{},{backgroundColor:g,opacity:.3,mixBlendMode:"multiply"});break;case"strikethrough":ie=f()(f()({},ie),{},{textDecoration:"line-through",textDecorationColor:g,textDecorationThickness:"2px",backgroundColor:"transparent"});break;case"underline":ie=f()(f()({},ie),{},{textDecoration:"underline",textDecorationColor:g,textDecorationThickness:"2px",backgroundColor:"transparent"});break}y(!0);try{if(typeof r.current.highlightSelection=="function"){var ke,je=r.current.highlightSelection(ie);B(je,o,g),(ke=window.getSelection())===null||ke===void 0||ke.removeAllRanges(),Y(),y(!1),K(),A==null||A()}}catch(Ee){console.error("\u9AD8\u4EAE\u9009\u533A\u5931\u8D25:",Ee),y(!1)}}}}}};return document.addEventListener("selectionchange",E),document.addEventListener("mouseup",p),function(){document.removeEventListener("selectionchange",E),document.removeEventListener("mouseup",p)}}},[o,g,d,L,Y,m,A]),(0,v.useEffect)(function(){if(!(!r.current||!d.current)){K();var E=k.filter(function(p){return["highlight","strikethrough","underline"].includes(p.type)&&p.pageNumber===t});E.length!==0&&(E.forEach(function(p){try{if(!r.current||!d.current)return;var G=d.current.querySelector('[data-highlight-id="'.concat(p.id,'"]'));if(G){B(p.id,p.type,p.color);return}var W=p;if(typeof r.current.fromStore=="function"&&W.startMeta&&W.endMeta){var I=r.current.fromStore(W.startMeta,W.endMeta,p.text,p.id);B(I,p.type,p.color)}else p.rects&&p.rects.length>0&&p.rects.forEach(function(ne){var R=document.createElement("span");R.className="web-highlighter-selection pdf-text-".concat(p.type),R.setAttribute("data-highlight-id",p.id),R.style.position="absolute",R.style.left="".concat(ne.x*l,"px"),R.style.top="".concat(ne.y*l,"px"),R.style.width="".concat(ne.width*l,"px"),R.style.height="".concat(ne.height*l,"px"),R.style.zIndex="5",p.type==="highlight"?(R.style.backgroundColor=p.color,R.style.opacity="0.3",R.style.mixBlendMode="multiply"):p.type==="strikethrough"?(R.style.textDecoration="line-through",R.style.textDecorationColor=p.color,R.style.textDecorationThickness="2px",R.style.backgroundColor="transparent"):p.type==="underline"&&(R.style.textDecoration="underline",R.style.textDecorationColor=p.color,R.style.textDecorationThickness="2px",R.style.backgroundColor="transparent"),d.current&&d.current.appendChild(R)})}catch(ne){console.error("\u6062\u590D\u6279\u6CE8\u5931\u8D25:",ne,p)}}),K())}},[k,t,d,l,Y]),(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:L?"none":"auto",zIndex:C},className:"highlighter-layer",children:(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:L||!o?"none":"auto",zIndex:C+1,cursor:o?"text":"default"},className:"text-selection-layer"})})},fr=vr,gr=u(64082),mr=u(36457),pr=mr.Z.Dragger,yr=function(i){var t=i.type,l=i.visible,o=i.onSave,g=i.onCancel,d=(0,v.useState)([]),k=Q()(d,2),T=k[0],S=k[1],A=(0,v.useState)(!1),h=Q()(A,2),L=h[0],b=h[1],C=(0,v.useState)(null),r=Q()(C,2),s=r[0],n=r[1],m=(0,v.useState)(t==="signature"?"#000000":"#ff0000"),y=Q()(m,2),D=y[0],fe=y[1],N=(0,v.useState)(t==="signature"?2:4),Y=Q()(N,2),B=Y[0],K=Y[1],E=(0,v.useRef)(null),p=400,G=200,W=function(se){b(!0);var xe=se.target.getStage().getPointerPosition();S([].concat(_()(T),[{points:[xe.x,xe.y],stroke:D,strokeWidth:B}]))},I=function(se){if(L){var xe=se.target.getStage(),de=xe.getPointerPosition(),Ae=T[T.length-1];Ae.points=Ae.points.concat([de.x,de.y]),S([].concat(_()(T.slice(0,-1)),[Ae]))}},ne=function(){b(!1)},R=function(se){se.evt.preventDefault();var xe=se.target.getStage(),de=xe.getPointerPosition();b(!0),S([].concat(_()(T),[{points:[de.x,de.y],stroke:D,strokeWidth:B}]))},ie=function(se){if(se.evt.preventDefault(),!!L){var xe=se.target.getStage(),de=xe.getPointerPosition(),Ae=T[T.length-1];Ae.points=Ae.points.concat([de.x,de.y]),S([].concat(_()(T.slice(0,-1)),[Ae]))}},ke=function(se){se.evt.preventDefault(),b(!1)},je=function(){S([]),n(null)},Ee=function(){if(s){o(s);return}if(T.length===0){ae.ZP.warning("\u8BF7\u5148\u7ED8\u5236\u6216\u4E0A\u4F20\u56FE\u50CF");return}if(E.current){var se=E.current.toDataURL();o(se)}},H=function(se,xe){fe(xe)},ze=t==="signature"?["#000000","#0000FF","#FF0000","#008000"]:["#FF0000","#0000FF","#800000","#FF8C00"],Re=[{key:"draw",label:"\u624B\u7ED8",children:(0,e.jsxs)("div",{className:"signature-canvas-container",children:[(0,e.jsx)(Ce.Hf,{width:p,height:G,ref:E,onMouseDown:W,onMouseMove:I,onMouseUp:ne,onTouchStart:R,onTouchMove:ie,onTouchEnd:ke,style:{border:"1px solid #ddd",borderRadius:4,background:"#fff"},children:(0,e.jsx)(Ce.mh,{children:T.map(function(Se,se){return(0,e.jsx)(Ce.x1,{points:Se.points,stroke:Se.stroke,strokeWidth:Se.strokeWidth,tension:.5,lineCap:"round",lineJoin:"round"},se)})})}),(0,e.jsxs)("div",{className:"signature-controls",children:[(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u989C\u8272:"}),(0,e.jsx)(Xt.Z,{value:D,onChange:H,presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:ze}],size:"small",format:"hex"})]}),(0,e.jsxs)("div",{className:"control-group",children:[(0,e.jsx)("div",{className:"control-label",children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,e.jsx)("div",{className:"stroke-width-control",children:(0,e.jsxs)(We.ZP.Group,{value:B,onChange:function(se){return K(se.target.value)},buttonStyle:"solid",size:"small",children:[(0,e.jsx)(We.ZP.Button,{value:1,children:"\u7EC6"}),(0,e.jsx)(We.ZP.Button,{value:3,children:"\u4E2D"}),(0,e.jsx)(We.ZP.Button,{value:5,children:"\u7C97"})]})})]}),(0,e.jsxs)("div",{className:"action-buttons",children:[(0,e.jsx)(ve.ZP,{size:"middle",onClick:je,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ve.ZP,{size:"middle",type:"primary",onClick:Ee,children:"\u4FDD\u5B58"})]})]})]})},{key:"upload",label:"\u4E0A\u4F20",children:s?(0,e.jsxs)("div",{style:{textAlign:"center"},children:[(0,e.jsx)("img",{src:s,alt:"\u4E0A\u4F20\u7684\u56FE\u7247",style:{maxWidth:"100%",maxHeight:200,marginBottom:16,border:"1px solid #ddd",borderRadius:4}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ve.ZP,{onClick:je,style:{marginRight:8},children:"\u6E05\u9664"}),(0,e.jsx)(ve.ZP,{type:"primary",onClick:Ee,children:"\u4F7F\u7528\u6B64\u56FE\u7247"})]})]}):(0,e.jsxs)(pr,{accept:".png,.jpg,.jpeg",showUploadList:!1,beforeUpload:function(se){var xe=new FileReader;return xe.onload=function(de){var Ae;(Ae=de.target)!==null&&Ae!==void 0&&Ae.result&&n(de.target.result)},xe.readAsDataURL(se),!1},multiple:!1,children:[(0,e.jsx)("p",{className:"ant-upload-drag-icon",children:(0,e.jsx)(gr.Z,{})}),(0,e.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u5230\u6B64\u533A\u57DF\u4E0A\u4F20"}),(0,e.jsx)("p",{className:"ant-upload-hint",children:"\u652F\u6301\u5355\u4E2A\u56FE\u7247\u4E0A\u4F20\uFF0C\u63A8\u8350\u4F7F\u7528\u900F\u660E\u80CC\u666F\u7684PNG\u56FE\u7247"})]})}];return(0,e.jsx)(mt.Z,{title:t==="signature"?"\u6DFB\u52A0\u7B7E\u540D":"\u6DFB\u52A0\u76D6\u7AE0",open:l,onCancel:g,footer:null,width:500,children:(0,e.jsx)(xn.Z,{defaultActiveKey:"draw",items:Re})})},xr=yr,br=function(i){var t=i.onSave,l=i.onCancel,o=i.visible,g=i.curTextNotePanelData,d=g===void 0?{}:g,k=Ne.Z.useForm(),T=Q()(k,1),S=T[0],A=Ne.Z.useWatch(["backgroundColor"],S),h=["#FFFFA0","#A0E7E5","#FFC0CB","#FFCBA4","#D3D3D3","#C1FFC1","#FFFFFF"];(0,v.useEffect)(function(){o&&S.setFieldsValue({text:(d==null?void 0:d.text)||"",fontSize:(d==null?void 0:d.fontSize)||12,backgroundColor:(d==null?void 0:d.backgroundColor)||"#FFFFA0"})},[o,d]);var L=function(C){var r=C.text,s=C.fontSize,n=C.backgroundColor;t(r,s,n)};return(0,e.jsx)(mt.Z,{title:"\u6DFB\u52A0\u6587\u672C\u6279\u6CE8",open:o,onCancel:l,footer:[(0,e.jsx)(ve.ZP,{onClick:l,children:"\u53D6\u6D88"},"cancel"),(0,e.jsx)(ve.ZP,{type:"primary",onClick:function(){return S.submit()},children:"\u6DFB\u52A0\u6279\u6CE8"},"save")],width:500,children:(0,e.jsxs)(Ne.Z,{form:S,layout:"vertical",onFinish:L,children:[(0,e.jsx)(Ne.Z.Item,{name:"text",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C"}],children:(0,e.jsx)(lt.Z.TextArea,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u6279\u6CE8\u6587\u672C...",autoFocus:!0,style:{padding:"8px",borderRadius:"4px",backgroundColor:A}})}),(0,e.jsx)(Ne.Z.Item,{label:"\u5B57\u4F53\u5927\u5C0F",name:"fontSize",children:(0,e.jsx)($e.Z,{min:1,max:100,style:{width:"200px"},addonAfter:"px"})}),(0,e.jsx)(Ne.Z.Item,{label:"\u80CC\u666F\u989C\u8272",name:"backgroundColor",children:(0,e.jsx)(Xt.Z,{presets:[{label:"\u9884\u8BBE\u989C\u8272",colors:h}],size:"middle",format:"hex",onChange:function(C){var r;S.setFieldValue("backgroundColor",C==null||(r=C.toHexString)===null||r===void 0?void 0:r.call(C))}})})]})})},Cr=br;function Ye(){var z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=new Uint8Array(32);return crypto.getRandomValues(i),Array.from(i).map(function(t){return z[t%z.length]}).join("")}var Cn=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;function jr(z){return Cn.test(z)}var Sr=u(18698),Dr=u.n(Sr);function Ar(z){return z==null?!0:typeof z=="string"?z.trim().length===0:Array.isArray(z)?z.length===0:Dr()(z)==="object"?Object.keys(z).length===0:!1}var jn=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;function Er(z){if(!jn.test(z))return!1;if(z.length===18){var i=parseInt(z.substr(6,4)),t=parseInt(z.substr(10,2)),l=parseInt(z.substr(12,2)),o=new Date(i,t-1,l);return o.getFullYear()===i&&o.getMonth()+1===t&&o.getDate()===l}return!0}function Pr(z){return!isNaN(parseFloat(z))&&isFinite(Number(z))}var Sn=/^1[3-9]\d{9}$/;function Fr(z){return Sn.test(z)}var kr=/^https?:\/\/([a-zA-Z0-9][a-zA-Z0-9-]*\.)*[a-zA-Z0-9][a-zA-Z0-9-]*\.[a-zA-Z]{2,}(:\d{1,5})?(\/[a-zA-Z0-9\-._~:/?#[\]@!$&'()*+,;=]*)?$/;function Tr(z){if(typeof z!="string"||!z.trim())return!1;var i=z.trim(),t;try{t=new URL(i)}catch(d){return!1}if(!["http:","https:"].includes(t.protocol))return!1;var l=t.hostname;if(/\s/.test(l)||l.startsWith(".")||l.endsWith(".")||/\.\./.test(l))return!1;var o=l.split(".").pop();if(!o||o.length<2)return!1;if(t.port){var g=Number(t.port);if(isNaN(g)||g<=0||g>65535)return!1}return!0}var Dn=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;function wr(z){return Dn.test(z)}var Nr=u(82061),Lr=u(32983),Mr=u(83062),Zr=function(i){var t=i.annotations,l=i.currentPage,o=i.pdfLayerRef,g=i.scale,d=i.readOnly,k=d===void 0?!1:d,T=i.handlePageChange,S=i.onAnnotationSelect,A=i.onAnnotationDelete,h=i.onAnnotationUpdate,L=function(s){var n={highlight:"\u9AD8\u4EAE",strikethrough:"\u5220\u9664\u7EBF",underline:"\u4E0B\u5212\u7EBF",rectangle:"\u77E9\u5F62",circle:"\u5706\u5F62",ellipse:"\u692D\u5706",freedraw:"\u81EA\u7531\u7ED8\u5236",freehighlight:"\u81EA\u7531\u9AD8\u4EAE",signature:"\u7B7E\u540D",stamp:"\u76D6\u7AE0",text:"\u6587\u672C"};return n[s]||s},b=function(s,n){h&&h(s,{comment:n})},C=function r(s){var n=t.find(function(Ee){return Ee.id===s});if(n){if(n.pageNumber!==l){typeof T=="function"&&T(n.pageNumber),setTimeout(function(){return r(s)},500);return}if(o!=null&&o.current){var m={x:0,y:0,width:100,height:50};if("x"in n&&"y"in n)if(n.type==="circle"){var y=n.radius||0;m.x=n.x*g,m.y=n.y*g,m.width=y*2*g,m.height=y*2*g}else n.type==="ellipse"||n.type,m.x=n.x*g,m.y=n.y*g,"width"in n&&n.width&&(m.width=n.width*g),"height"in n&&n.height&&(m.height=n.height*g);var D=document.createElement("div");if(D.classList.add("annotation-highlight-selected"),D.style.position="absolute",D.style.left="".concat(m.x,"px"),D.style.top="".concat(m.y,"px"),D.style.width="".concat(m.width,"px"),D.style.height="".concat(m.height,"px"),n.type==="circle"||n.type==="ellipse")D.style.borderRadius="50%",D.style.border="2px solid ".concat(n.color||"#ff5500"),D.style.backgroundColor="transparent";else if(n.type==="rectangle")D.style.border="2px solid ".concat(n.color||"#ff5500"),D.style.backgroundColor="transparent";else if(n.type==="freedraw"||n.type==="freehighlight")if("points"in n&&n.points&&n.points.length>0){for(var fe=n.points,N=1/0,Y=1/0,B=-1/0,K=-1/0,E=0;E<fe.length;E+=2){var p=fe[E]*g,G=fe[E+1]*g;N=Math.min(N,p),Y=Math.min(Y,G),B=Math.max(B,p),K=Math.max(K,G)}var W=5;D.style.left="".concat(N-W,"px"),D.style.top="".concat(Y-W,"px"),D.style.width="".concat(B-N+W*2,"px"),D.style.height="".concat(K-Y+W*2,"px"),D.style.border="2px solid ".concat(n.color||"#ff5500"),D.style.backgroundColor="transparent"}else D.style.transform="scale(1.2)",D.style.transformOrigin="center",D.style.backgroundColor="transparent";else["highlight","strikethrough","underline"].includes(n.type)&&(D.style.height="20px");o.current.appendChild(D);var I=o.current.parentElement;if(I){var ne=m.x+parseInt(D.style.width,10)/2,R=m.y+parseInt(D.style.height,10)/2,ie=o.current.getBoundingClientRect(),ke=I.scrollTop||0,je=I.scrollLeft||0;I.scrollTo({left:ne+je-ie.width/2,top:R+ke-ie.height/2,behavior:"smooth"})}setTimeout(function(){o.current&&o.current.contains(D)&&o.current.removeChild(D)},3e3),typeof S=="function"&&S(s)}}};return(0,e.jsxs)("div",{className:"annotation-list-container",children:[(0,e.jsx)("div",{className:"annotation-list-header",children:(0,e.jsxs)("h4",{style:{margin:0},children:["\u6279\u6CE8\u5217\u8868 (\u7B2C ",l," \u9875)"]})}),(0,e.jsx)("div",{className:"annotation-list-content",children:t.length===0?(0,e.jsx)(Lr.Z,{description:"\u6682\u65E0\u6279\u6CE8"}):(0,e.jsx)("div",{className:"custom-annotation-list",children:t==null?void 0:t.map(function(r){return(0,e.jsxs)("div",{className:"custom-annotation-item",onClick:function(){return C(r.id)},children:[(0,e.jsxs)("div",{className:"annotation-header",children:[(0,e.jsxs)("div",{className:"annotation-type",children:[(0,e.jsx)("span",{className:"annotation-color-block",style:{backgroundColor:r.color}}),L(r.type)]}),!k&&(0,e.jsx)(ve.ZP,{icon:(0,e.jsx)(Nr.Z,{}),size:"small",danger:!0,onClick:function(n){n.stopPropagation(),A(r.id)}})]}),(0,e.jsxs)("div",{className:"annotation-date",children:["\u521B\u5EFA: ",(r==null?void 0:r.createdAt)||""]}),"content"in r&&(0,e.jsxs)("div",{className:"annotation-content",children:["\u5185\u5BB9:",(0,e.jsx)(Mr.Z,{title:(r==null?void 0:r.content)||"",children:(0,e.jsx)("span",{className:"annotation-content-text",children:r.content})})]}),(0,e.jsx)("div",{className:"annotation-comment",children:(0,e.jsx)(lt.Z.TextArea,{rows:2,value:r.comment||"",onChange:function(n){var m;return b(r.id,(n==null||(m=n.target)===null||m===void 0?void 0:m.value)||"")},placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9...",disabled:k,onClick:function(n){return n.stopPropagation()}})})]},r.id)})})})]})},Br=Zr,Rr=function(i){var t=i.fileUrl,l=i.numPages,o=i.currentPage,g=i.onPageChange,d=(0,v.useRef)(null),k=(0,v.useState)([]),T=Q()(k,2),S=T[0],A=T[1],h=(0,v.useState)(!1),L=Q()(h,2),b=L[0],C=L[1],r=(0,v.useState)(!1),s=Q()(r,2),n=s[0],m=s[1],y=function(){C(!0);for(var Y=[],B=1;B<=Math.min(l,20);B++)Y.push(B);A(Y),setTimeout(function(){return m(!0)},500)},D=(0,v.useCallback)(function(){if(!(!d.current||l===0||!n)){for(var N=d.current,Y=N.scrollTop,B=N.clientHeight,K=5,E=150,p=Math.max(1,Math.floor(Y/E)-K),G=Math.min(l,Math.ceil((Y+B)/E)+K),W=[],I=p;I<=G;I++)W.push(I);!W.includes(o)&&o<=l&&W.push(o),A(W)}},[l,o,n]);(0,v.useEffect)(function(){if(!(!d.current||!n)){D();var N=d.current,Y=function(){requestAnimationFrame(D)};return N.addEventListener("scroll",Y),function(){N==null||N.removeEventListener("scroll",Y)}}},[D,n]);var fe=function(){if(!b)return(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7DPDF\u7F29\u7565\u56FE..."});for(var Y=[],B=function(p){var G=S.includes(p);Y.push((0,e.jsxs)("div",{className:"thumbnail-item ".concat(p===o?"active":""),onClick:function(){return g(p)},children:[(0,e.jsx)("div",{className:"thumbnail-page-number",children:p}),(0,e.jsx)("div",{className:"thumbnail-container",children:G&&(0,e.jsx)(Mt.Z,{pageNumber:p,width:100,renderTextLayer:!1,renderAnnotationLayer:!1,loading:null})})]},p))},K=1;K<=l;K++)B(K);return Y.push((0,e.jsx)("div",{style:{height:"20px",flexShrink:0}},"bottom-space")),Y};return(0,v.useEffect)(function(){if(d.current&&o&&b&&n){var N=150,Y=(o-1)*N,B=d.current,K=B.scrollTop,E=B.clientHeight;(Y<K||Y>K+E-N)&&B.scrollTo({top:Y-E/2+N/2,behavior:"smooth"})}},[o,b,n]),(0,e.jsx)("div",{className:"thumbnail-preview",children:(0,e.jsx)(Lt.Z,{file:t,onLoadSuccess:y,loading:(0,e.jsx)("div",{className:"thumbnail-loading",children:"\u52A0\u8F7D\u6587\u6863\u4E2D..."}),error:(0,e.jsx)("div",{className:"thumbnail-error",children:"PDF\u52A0\u8F7D\u5931\u8D25"}),children:(0,e.jsx)("div",{className:"thumbnail-list",ref:d,children:fe()})})})},Or=Rr;Hn().showWarnings=!1;var Bt={BASE:6,TOP:9};Nt.Tu.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(Nt.i8,"/pdf.worker.min.mjs");var Ur=function(i){var t=i.fileUrl,l=i.fileName,o=i.onSave,g=i.readOnly,d=g===void 0?!1:g,k=i.style,T=k===void 0?{}:k,S=i.className,A=S===void 0?"":S,h=i.annotationList,L=h===void 0?[]:h,b=(0,v.useState)(0),C=Q()(b,2),r=C[0],s=C[1],n=(0,v.useState)(1),m=Q()(n,2),y=m[0],D=m[1],fe=(0,v.useState)(1),N=Q()(fe,2),Y=N[0],B=N[1],K=(0,v.useState)({width:0,height:0}),E=Q()(K,2),p=E[0],G=E[1],W=(0,v.useState)(!0),I=Q()(W,2),ne=I[0],R=I[1],ie=(0,v.useState)(null),ke=Q()(ie,2),je=ke[0],Ee=ke[1],H=(0,v.useState)("#FFFF00"),ze=Q()(H,2),Re=ze[0],Se=ze[1],se=(0,v.useState)("solid"),xe=Q()(se,2),de=xe[0],Ae=xe[1],et=(0,v.useState)(!1),tt=Q()(et,2),ct=tt[0],nt=tt[1],pt=(0,v.useState)(!1),ut=Q()(pt,2),dt=ut[0],Xe=ut[1],yt=(0,v.useState)({}),oe=Q()(yt,2),a=oe[0],c=oe[1],F=(0,v.useState)("thumbnails"),j=Q()(F,2),x=j[0],M=j[1],ee=(0,v.useState)(!0),J=Q()(ee,2),q=J[0],le=J[1],he=(0,v.useRef)(null),ce=(0,v.useRef)(null),Fe=Kn(L),ge=Fe.annotations,Pe=Fe.addAnnotation,Ze=Fe.updateAnnotation,rt=Fe.removeAnnotation,Qt=(0,v.useRef)(null),qt=(0,v.useState)(!1),xt=Q()(qt,2),Rt=xt[0],bt=xt[1],_t=(0,v.useState)(""),Ot=Q()(_t,2),en=Ot[0],Ut=Ot[1],Yt=function(){var w=[".highlight-container","[data-highlight-id]",".custom-pdf-highlight",".web-highlighter-selection",".web-highlighter-wrapper"];w.forEach(function(O){document.querySelectorAll(O).forEach(function(X){try{if(X.textContent)if(X.parentNode&&X.parentNode!==document.body){var re=X.textContent,ue=document.createTextNode(re);X.parentNode.replaceChild(ue,X)}else X.remove();else X.remove()}catch(me){console.error("\u6E05\u7406\u9AD8\u4EAE\u5143\u7D20\u5931\u8D25:",me)}})});try{document.querySelectorAll("style[data-highlight-style]").forEach(function(O){O.remove()});var Z=document.querySelector(".react-pdf__Page__textContent");Z&&Z.querySelectorAll("span, div").forEach(function(O){O.style.userSelect="text",O.style.webkitUserSelect="text",O.style.pointerEvents="auto"})}catch(O){console.error("\u6E05\u7406web-highlighter\u5143\u7D20\u5931\u8D25:",O)}},tn=function(w){var Z=w.numPages;s(Z),R(!1)},nn=function(w){var Z=w.getViewport({scale:1});G({width:Z.width,height:Z.height})},Ve=function(w){Ae(w)},Ct=function(w){Ee(w),(w==="signature"||w==="stamp")&&nt(!0),w==="text"&&(Xe(!0),c({}))},jt=function(w,Z){!p.width||!p.height||(Pe({id:"add-"+Ye(),type:Z,pageNumber:y,x:p.width/4,y:p.height/4,width:p.width/2,height:Z==="signature"?p.height/8:p.width/4,imageData:w,createdAt:be()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss"),color:"#000000",opacity:1}),nt(!1),Ee(null))},St=function(w,Z,O){if(!(!p.width||!p.height)){var X=function(we,te){var V=document.createElement("canvas"),qe=V.getContext("2d");if(!qe)return{width:200,height:100};qe.font="".concat(te,"px Arial");for(var Vt=p.width*.8,An=we.split(""),Kt=[],at="",cn=0;cn<An.length;cn++){var En=An[cn],Pn=at+En,zr=qe.measureText(Pn);zr.width>Vt&&at.length>0?(Kt.push(at),at=En):at=Pn}at.length>0&&Kt.push(at);for(var Wr=te*1.5,Ir=Math.max(Kt.length*Wr+16,40),un=0,dn=0,Fn=Kt;dn<Fn.length;dn++){var Hr=Fn[dn],Vr=qe.measureText(Hr).width;un=Math.max(un,Vr)}return{width:Math.min(Math.max(un+16,100),Vt),height:Ir}};if(a!=null&&a.id){var re=X(w,Z),ue=re.width,me=re.height;Ze(a.id,{text:w,fontSize:Z,backgroundColor:O,width:ue,height:me,modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss")})}else{var pe=X(w,Z),P=pe.width,De=pe.height,ye={id:"add-"+Ye(),type:"text",pageNumber:y,x:(p.width-P)/2,y:p.height/4,width:P,height:De,text:w,fontSize:Z,backgroundColor:O,createdAt:be()().format("YYYY-MM-DD HH:mm:ss"),modifiedAt:be()().format("YYYY-MM-DD HH:mm:ss"),color:"#333333",opacity:1};Pe(ye)}Xe(!1),Ee(null),c({})}},Dt=function(){var $=Je()(Te()().mark(function w(){var Z,O,X,re,ue,me;return Te()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(P.prev=0,!o){P.next=28;break}if(typeof t!="string"){P.next=26;break}if(!t.startsWith("data:")){P.next=11;break}for(O=t.split(",")[1],X=atob(O),re=new Uint8Array(X.length),ue=0;ue<X.length;ue++)re[ue]=X.charCodeAt(ue);Z=new Blob([re],{type:"application/pdf"}),P.next=24;break;case 11:if(!t.startsWith("http")){P.next=24;break}return P.prev=12,P.next=15,fetch(t);case 15:return me=P.sent,P.next=18,me.blob();case 18:Z=P.sent,P.next=24;break;case 21:P.prev=21,P.t0=P.catch(12),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",P.t0);case 24:P.next=27;break;case 26:(t instanceof Blob||t instanceof File)&&(Z=t);case 27:o(ge,Z);case 28:ae.ZP.success("\u6279\u6CE8\u5DF2\u4FDD\u5B58"),P.next=34;break;case 31:P.prev=31,P.t1=P.catch(0),ae.ZP.error("\u4FDD\u5B58\u6279\u6CE8\u5931\u8D25");case 34:case"end":return P.stop()}},w,null,[[0,31],[12,21]])}));return function(){return $.apply(this,arguments)}}(),Ke=function(w){ce.current&&Yt(),D(w)},zt=function(w){var Z=Math.min(Math.max(y+w,1),r);Z!==y&&(ce.current&&Yt(),D(Z))},rn=function(){return B(Y*1.2)},an=function(){return B(Y/1.2)},on=function(){le(!q)},Qe=function(){var $=Je()(Te()().mark(function w(){var Z,O,X,re,ue,me,pe,P,De,ye,U;return Te()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(te.prev=0,Z=null,O=l||"document.pdf",typeof t!="string"){te.next=30;break}if(!t.startsWith("data:")){te.next=12;break}for(X=t.split(",")[1],re=atob(X),ue=new Uint8Array(re.length),me=0;me<re.length;me++)ue[me]=re.charCodeAt(me);Z=new Blob([ue],{type:"application/pdf"}),te.next=28;break;case 12:if(!t.startsWith("http")){te.next=28;break}return te.prev=13,te.next=16,fetch(t);case 16:return pe=te.sent,te.next=19,pe.blob();case 19:Z=te.sent,l||(P=t.split("/"),De=P[P.length-1],De&&De.includes(".pdf")&&(O=De)),te.next=28;break;case 23:return te.prev=23,te.t0=te.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",te.t0),ae.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"downloadLoading"}),te.abrupt("return");case 28:te.next=31;break;case 30:t instanceof Blob?Z=t:t instanceof File&&(Z=new Blob([t],{type:t.type}),l||(O=t.name));case 31:if(Z){te.next=34;break}return ae.ZP.error({content:"\u4E0B\u8F7D\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"downloadLoading"}),te.abrupt("return");case 34:ye=URL.createObjectURL(Z),U=document.createElement("a"),U.href=ye,U.download=O,document.body.appendChild(U),U.click(),setTimeout(function(){document.body.removeChild(U),URL.revokeObjectURL(ye),ae.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"})},100),te.next=47;break;case 43:te.prev=43,te.t1=te.catch(0),console.error("\u4E0B\u8F7D\u539F\u59CBPDF\u5931\u8D25:",te.t1),ae.ZP.error({content:"\u4E0B\u8F7D\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:"downloadLoading"});case 47:case"end":return te.stop()}},w,null,[[0,43],[13,23]])}));return function(){return $.apply(this,arguments)}}(),Wt=function(){var $=Je()(Te()().mark(function w(Z,O){var X,re,ue,me,pe,P,De;return Te()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(U.prev=0,ae.ZP.loading({content:"\u51C6\u5907\u5904\u7406PDF\u9875\u9762...",key:Z}),ce.current){U.next=5;break}return ae.ZP.error({content:"\u65E0\u6CD5\u83B7\u53D6PDF\u5185\u5BB9",key:Z}),U.abrupt("return");case 5:return X=y,bt(!0),Ut("\u51C6\u5907\u4E2D..."),U.prev=8,U.next=11,u.e(120).then(u.t.bind(u,46020,23));case 11:re=U.sent,ue=re.default,me=[],pe=1;case 15:if(!(pe<=r)){U.next=28;break}return P="\u6B63\u5728\u5904\u7406\u7B2C ".concat(pe," \u9875 / \u5171 ").concat(r," \u9875..."),Ut(P),D(pe),U.next=21,new Promise(function(we){setTimeout(function(){we()},1e3)});case 21:return U.next=23,ue(ce.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,ignoreElements:function(te){var V;return((V=te.classList)===null||V===void 0?void 0:V.contains("print-ignore"))||!1}});case 23:De=U.sent,me.push(De);case 25:pe++,U.next=15;break;case 28:return D(X),U.next=31,O(me);case 31:U.next=37;break;case 33:U.prev=33,U.t0=U.catch(8),console.error("\u5904\u7406PDF\u9875\u9762\u5931\u8D25:",U.t0),ae.ZP.error({content:"\u5904\u7406PDF\u9875\u9762\u5931\u8D25",key:Z});case 37:return U.prev=37,bt(!1),U.finish(37);case 40:U.next=47;break;case 42:U.prev=42,U.t1=U.catch(0),console.error("\u6355\u83B7\u9875\u9762\u9519\u8BEF:",U.t1),ae.ZP.error({content:"\u5904\u7406\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF",key:Z}),bt(!1);case 47:case"end":return U.stop()}},w,null,[[0,42],[8,33,37,40]])}));return function(Z,O){return $.apply(this,arguments)}}(),ln=function(){var $=Je()(Te()().mark(function w(){return Te()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:Wt("downloadLoading",function(){var X=Je()(Te()().mark(function re(ue){var me,pe,P,De,ye,U,we;return Te()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.prev=0,V.next=3,u.e(361).then(u.bind(u,36361));case 3:for(me=V.sent,pe=me.default,P=new pe({orientation:"portrait",unit:"px",format:[ue[0].width/2,ue[0].height/2]}),De=0;De<ue.length;De++)ye=ue[De],U=ye.toDataURL("image/jpeg",.85),De>0&&P.addPage([ye.width/2,ye.height/2]),P.addImage(U,"JPEG",0,0,ye.width/2,ye.height/2);we=l||"document-with-annotations.pdf",P.save(we),ae.ZP.success({content:"\u4E0B\u8F7D\u6210\u529F",key:"downloadLoading"}),V.next=17;break;case 12:V.prev=12,V.t0=V.catch(0),console.error("\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25:",V.t0),ae.ZP.error({content:"\u751F\u6210\u6279\u6CE8PDF\u5931\u8D25",key:"downloadLoading"}),Qe();case 17:case"end":return V.stop()}},re,null,[[0,12]])}));return function(re){return X.apply(this,arguments)}}()).catch(function(){Qe()});case 1:case"end":return O.stop()}},w)}));return function(){return $.apply(this,arguments)}}(),sn=function(){var $=Je()(Te()().mark(function w(){var Z,O,X,re,ue,me,pe,P,De,ye,U,we;return Te()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(V.prev=0,ae.ZP.loading({content:"\u51C6\u5907\u6253\u5370\u4E2D...",key:"printLoading"}),Z=null,typeof t!="string"){V.next=29;break}if(!t.startsWith("data:")){V.next=12;break}for(O=t.split(",")[1],X=atob(O),re=new Uint8Array(X.length),ue=0;ue<X.length;ue++)re[ue]=X.charCodeAt(ue);Z=new Blob([re],{type:"application/pdf"}),V.next=27;break;case 12:if(!t.startsWith("http")){V.next=27;break}return V.prev=13,V.next=16,fetch(t);case 16:return me=V.sent,V.next=19,me.blob();case 19:Z=V.sent,V.next=27;break;case 22:return V.prev=22,V.t0=V.catch(13),console.error("\u83B7\u53D6PDF\u6587\u4EF6\u5931\u8D25:",V.t0),ae.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6",key:"printLoading"}),V.abrupt("return");case 27:V.next=30;break;case 29:t instanceof Blob?Z=t:t instanceof File&&(Z=new Blob([t],{type:t.type}));case 30:if(Z){V.next=33;break}return ae.ZP.error({content:"\u6253\u5370\u5931\u8D25\uFF1A\u65E0\u6548\u7684\u6587\u4EF6\u683C\u5F0F",key:"printLoading"}),V.abrupt("return");case 33:pe=URL.createObjectURL(Z),P=document.createElement("iframe"),P.style.position="absolute",P.style.width="0px",P.style.height="0px",P.style.border="0",P.style.left="-1000px",document.body.appendChild(P),De=Date.now(),ye=!1,U=!1,we=function qe(){if(!U)try{if(!document.body.contains(P)){U=!0,URL.revokeObjectURL(pe),ae.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}if(ye&&document.hasFocus()&&Date.now()-De>1e3){U=!0,document.body.contains(P)&&document.body.removeChild(P),URL.revokeObjectURL(pe),ae.ZP.success({content:"\u6253\u5370\u64CD\u4F5C\u5DF2\u5B8C\u6210",key:"printLoading"});return}setTimeout(qe,3e3)}catch(Vt){console.error("\u68C0\u67E5\u6253\u5370\u72B6\u6001\u5931\u8D25:",Vt),document.body.contains(P)&&document.body.removeChild(P),URL.revokeObjectURL(pe)}},P.onload=function(){ae.ZP.success({content:"\u6587\u6863\u5DF2\u51C6\u5907\u597D\uFF0C\u6B63\u5728\u6253\u5F00\u6253\u5370\u5BF9\u8BDD\u6846...",key:"printLoading",duration:2}),setTimeout(function(){try{P.contentWindow?(P.contentWindow.focus(),P.contentWindow.print(),ye=!0,setTimeout(we,1e3)):(ae.ZP.error({content:"\u6253\u5370\u5931\u8D25: \u65E0\u6CD5\u8BBF\u95EE\u6253\u5370\u7A97\u53E3",key:"printLoading"}),document.body.contains(P)&&document.body.removeChild(P),URL.revokeObjectURL(pe))}catch(qe){console.error("\u6253\u5370\u5931\u8D25:",qe),document.body.contains(P)&&document.body.removeChild(P),URL.revokeObjectURL(pe),ae.ZP.error({content:"\u6253\u5370\u5931\u8D25",key:"printLoading"})}},800)},P.src=pe,V.next=53;break;case 49:V.prev=49,V.t1=V.catch(0),console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",V.t1),ae.ZP.error({content:"\u6253\u5370\u51C6\u5907\u5931\u8D25",key:"printLoading"});case 53:case"end":return V.stop()}},w,null,[[0,49],[13,22]])}));return function(){return $.apply(this,arguments)}}(),It=function(w){var Z;if(w==="original"){sn();return}var O=document.createElement("iframe");O.style.position="absolute",O.style.width="0px",O.style.height="0px",O.style.border="0",O.style.left="-1000px",document.body.appendChild(O);var X=(Z=O.contentWindow)===null||Z===void 0?void 0:Z.document;if(!X){document.body.removeChild(O),ae.ZP.error("\u521B\u5EFA\u6253\u5370\u6846\u67B6\u5931\u8D25");return}X.open(),X.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>PDF\u6253\u5370</title>
          <style>
            body {
              margin: 0;
              padding: 0;
              font-family: Arial, sans-serif;
            }
            .print-container {
              max-width: 100%;
              margin: 0;
              padding: 0;
            }
            .page-container {
              page-break-after: always;
              margin: 0;
              padding: 0;
              border: none;
            }
            .page-container:last-child {
              page-break-after: avoid;
              margin: 0;
            }
            img {
              max-width: 100%;
              display: block;
              margin: 0;
              padding: 0;
              box-shadow: none;
              border: none;
            }
            @media print {
              body {
                margin: 0;
                padding: 0;
              }
              .print-container {
                margin: 0;
                padding: 0;
              }
              .page-container {
                width: 100%;
                height: auto;
                page-break-after: always;
                margin: 0;
                padding: 0;
                border: none;
              }
              @page {
                margin: 0;
              }
            }
          </style>
        </head>
        <body>
          <div class="print-container" id="print-container">
            <!-- \u9875\u9762\u5185\u5BB9\u5C06\u52A8\u6001\u63D2\u5165\u8FD9\u91CC -->
          </div>
        </body>
      </html>
    `),X.close();var re=X.getElementById("print-container");if(!re){document.body.removeChild(O),ae.ZP.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25");return}Wt("printLoading",function(){var ue=Je()(Te()().mark(function me(pe){return Te()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:try{pe.forEach(function(ye){var U=X.createElement("div");U.className="page-container";var we=X.createElement("img");we.src=ye.toDataURL("image/png"),U.appendChild(we),re.appendChild(U)}),ae.ZP.success({content:"\u6253\u5370\u51C6\u5907\u5B8C\u6210",key:"printLoading",duration:1}),setTimeout(function(){try{var ye,U;(ye=O.contentWindow)===null||ye===void 0||ye.focus(),(U=O.contentWindow)===null||U===void 0||U.print(),setTimeout(function(){document.body.contains(O)&&document.body.removeChild(O)},1e3)}catch(we){console.error("\u6253\u5370\u8C03\u7528\u5931\u8D25:",we),document.body.removeChild(O),ae.ZP.error("\u6253\u5370\u8C03\u7528\u5931\u8D25")}},500)}catch(ye){console.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25:",ye),document.body.removeChild(O),ae.ZP.error("\u51C6\u5907\u6253\u5370\u5185\u5BB9\u5931\u8D25")}case 1:case"end":return De.stop()}},me)}));return function(me){return ue.apply(this,arguments)}}())},ht=function(w){mt.Z.info({title:w==="print"?"\u9009\u62E9\u6253\u5370\u7C7B\u578B":"\u9009\u62E9\u4E0B\u8F7D\u7C7B\u578B",icon:null,centered:!0,okText:"\u53D6\u6D88",content:(0,e.jsxs)("div",{className:"download-options",style:{marginTop:16,display:"flex",justifyContent:"center"},children:[ge!=null&&ge.length?(0,e.jsx)(ve.ZP,{type:"primary",style:{marginRight:16,height:60,fontSize:16,width:180},onClick:function(){if(mt.Z.destroyAll(),w==="print"){It("with-annotations");return}ln()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(w==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u5E26\u6279\u6CE8\u7684PDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u5305\u542B\u6240\u6709\u6279\u6CE8\u6807\u8BB0)"})]})}):null,(0,e.jsx)(ve.ZP,{type:"primary",style:{height:60,fontSize:16,width:180},onClick:function(){if(mt.Z.destroyAll(),w==="print"){It("original");return}Qe()},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(w==="print"?"\u6253\u5370":"\u4E0B\u8F7D","\u539F\u59CBPDF")}),(0,e.jsx)("div",{style:{fontSize:12},children:"(\u4E0D\u542B\u6279\u6CE8)"})]})})]}),width:500})},Ht=function(w){["rectangle","circle","ellipse","freedraw","freehighlight"].includes(w.type)?Pe(f()(f()({},w),{},{lineStyle:de})):Pe(w)};return(0,e.jsxs)("div",{className:"pdf-annotation-container ".concat(A),style:T,ref:he,children:[Rt&&(0,e.jsxs)("div",{className:"pdf-print-mask",children:[(0,e.jsx)("div",{className:"print-message",children:"\u6B63\u5728\u5904\u7406PDF\u6587\u4EF6\uFF0C\u8BF7\u52FF\u5173\u95ED\u6216\u64CD\u4F5C\u9875\u9762"}),(0,e.jsx)("div",{className:"print-progress",children:en})]}),(0,e.jsx)("div",{className:"pdf-annotation-header",children:(0,e.jsxs)("div",{className:"pdf-annotation-actions",children:[(0,e.jsx)("div",{className:"pdf-annotation-actions-sidebar",style:{cursor:"pointer"},onClick:on,children:q?(0,e.jsx)(gn.Z,{style:{fontSize:20}}):(0,e.jsx)(fn.Z,{style:{fontSize:20}})}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-option",children:[(0,e.jsxs)("div",{className:"pdf-annotation-actions-page",children:[(0,e.jsx)(ve.ZP,{icon:(0,e.jsx)(Un.Z,{}),onClick:function(){return zt(-1)},disabled:y<=1}),(0,e.jsx)("span",{style:{margin:"0 8px",minWidth:32},children:"".concat(y," / ").concat(r)}),(0,e.jsx)(ve.ZP,{icon:(0,e.jsx)(Yn.Z,{}),onClick:function(){return zt(1)},disabled:y>=r})]}),(0,e.jsxs)("div",{className:"pdf-annotation-actions-zoom",children:[(0,e.jsx)(ve.ZP,{icon:(0,e.jsx)(mn.Z,{}),onClick:an}),(0,e.jsxs)("span",{style:{margin:"0 8px"},children:[Math.round(Y*100),"%"]}),(0,e.jsx)(ve.ZP,{icon:(0,e.jsx)(pn.Z,{}),onClick:rn})]})]}),!d&&(0,e.jsxs)("div",{className:"pdf-annotation-actions-save",children:[(0,e.jsx)(ve.ZP,{icon:(0,e.jsx)(zn.Z,{}),type:"primary",onClick:Dt}),(0,e.jsx)(ve.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(yn.Z,{}),type:"primary",onClick:function(){return ht("download")}}),(0,e.jsx)(ve.ZP,{style:{marginLeft:8},icon:(0,e.jsx)(Wn.Z,{}),type:"primary",onClick:function(){return ht("print")}})]})]})}),!d&&(0,e.jsx)(cr,{activeTool:je,activeColor:Re,activeLineStyle:de,onToolSelect:Ct,onColorChange:Se,onLineStyleChange:Ve,readOnly:d}),(0,e.jsxs)("div",{className:"pdf-annotation-content",children:[(0,e.jsx)("div",{className:"pdf-annotation-sidebar ".concat(q?"visible":"hidden"),children:(0,e.jsx)(xn.Z,{activeKey:x,onChange:function(w){return M(w)},items:[{key:"thumbnails",label:"\u9875\u9762\u9884\u89C8",children:(0,e.jsx)(Or,{fileUrl:t,numPages:r,currentPage:y,onPageChange:Ke})},{key:"annotations",label:"\u6279\u6CE8\u5217\u8868",children:(0,e.jsx)(Br,{annotations:ge==null?void 0:ge.filter(function($){return $.pageNumber===y}),currentPage:y,pdfLayerRef:ce,scale:Y,handlePageChange:Ke,onAnnotationDelete:rt,onAnnotationUpdate:Ze,readOnly:d})}]})}),(0,e.jsx)("div",{className:"pdf-annotation-main",children:(0,e.jsxs)("div",{className:"pdf-viewer",ref:ce,children:[(0,e.jsx)(Lt.Z,{file:t,onLoadSuccess:tn,loading:(0,e.jsxs)("div",{className:"pdf-loading",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"0 0 1024 1024",width:"48",height:"48",fill:"#1677ff",children:[(0,e.jsx)("path",{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}),(0,e.jsx)("path",{d:"M304 544h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0-144h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 288h416c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H304c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"14px",fontWeight:500,textAlign:"center"},children:"\u6B63\u5728\u52A0\u8F7DPDF\u6587\u4EF6\uFF0C\u8BF7\u7A0D\u5019..."})]}),error:(0,e.jsxs)("div",{className:"pdf-error",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px"},children:[(0,e.jsx)("div",{style:{marginBottom:"16px"},children:(0,e.jsxs)("svg",{viewBox:"64 64 896 896",width:"48",height:"48",fill:"#ff4d4f",children:[(0,e.jsx)("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}),(0,e.jsx)("path",{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"})]})}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.85)",fontSize:"16px",fontWeight:500,marginBottom:"8px"},children:"\u52A0\u8F7DPDF\u5931\u8D25"}),(0,e.jsx)("div",{style:{color:"rgba(0, 0, 0, 0.65)",fontSize:"14px"},children:"\u8BF7\u68C0\u67E5\u6587\u4EF6\u683C\u5F0F\u6216\u7F51\u7EDC\u8FDE\u63A5\u540E\u91CD\u8BD5"})]}),children:(0,e.jsx)(Mt.Z,{pageNumber:y,scale:Y,onLoadSuccess:nn,renderTextLayer:!0,renderAnnotationLayer:!0,inputRef:Qt})}),!ne&&p.width>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(fr,{pageNumber:y,scale:Y,activeTool:["highlight","strikethrough","underline"].includes(je)?je:null,activeColor:Re,pdfLayerRef:ce,annotations:ge.filter(function($){return $.pageNumber===y}),onAnnotationAdd:Pe,onAnnotationRemove:rt,onAnnotationUpdate:Ze,onToolReset:function(){return Ee(null)},readOnly:d,zIndex:["highlight","strikethrough","underline"].includes(je)?Bt.TOP:Bt.BASE}),(0,e.jsx)(Jn,{pageNumber:y,scale:Y,width:p.width,height:p.height,activeTool:["highlight","strikethrough","underline"].includes(je)?null:je,activeColor:Re,activeLineStyle:de,annotations:ge.filter(function($){return $.pageNumber===y}),readOnly:d,zIndex:["highlight","strikethrough","underline"].includes(je)?Bt.BASE:Bt.TOP,onAnnotationAdd:Ht,onAnnotationUpdate:Ze,onAnnotationRemove:rt,onToolReset:function(){return Ee(null)},setShowTextNotePanel:Xe,setTextNotePanelData:c})]})]})})]}),ct&&je&&(0,e.jsx)(xr,{visible:ct,type:je,onSave:function(w){return jt(w,je)},onCancel:function(){nt(!1),Ee(null)}}),dt&&(0,e.jsx)(Cr,{onSave:St,onCancel:function(){Xe(!1),Ee(null),c({})},visible:dt,curTextNotePanelData:a})]})},Yr=Ur}}]);
